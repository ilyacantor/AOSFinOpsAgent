{"file_contents":{"client/src/components/data-flow-viz.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Database, Server, Cloud, Activity, TrendingDown, TrendingUp, CheckCircle2, DollarSign, Zap } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { formatCurrencyCompact } from \"@/lib/currency\";\nimport type { AwsResource, Recommendation, OptimizationHistory } from \"@shared/schema\";\n\ninterface MetricsSummary {\n  monthlySpend: number;\n  ytdSpend: number;\n  identifiedSavingsAwaitingApproval: number;\n  realizedSavingsYTD: number;\n  wastePercentOptimizedYTD: number;\n  monthlySpendChange: number;\n  ytdSpendChange: number;\n}\n\nexport function DataFlowVisualization() {\n  const { data: resources = [] } = useQuery<AwsResource[]>({ \n    queryKey: ['/api/aws-resources']\n  });\n  \n  const { data: recommendations = [] } = useQuery<Recommendation[]>({ \n    queryKey: ['/api/recommendations']\n  });\n  \n  const { data: history = [] } = useQuery<OptimizationHistory[]>({ \n    queryKey: ['/api/optimization-history']\n  });\n\n  const { data: metrics } = useQuery<MetricsSummary>({ \n    queryKey: ['/api/metrics/summary'],\n    refetchInterval: 3000 // Auto-refresh every 3 seconds\n  });\n\n  const ec2Count = resources.filter(r => r.resourceType === 'EC2').length;\n  const rdsCount = resources.filter(r => r.resourceType === 'RDS').length;\n  const s3Count = resources.filter(r => r.resourceType === 'S3').length;\n  const activeRecommendations = recommendations.filter(r => r.status === 'pending' || r.status === 'approved').length;\n  const appliedOptimizations = history.filter(h => h.status === 'completed').length;\n  const totalResources = resources.length;\n  const totalOutputs = activeRecommendations + appliedOptimizations + (history.length > 0 ? 1 : 0);\n  return (\n    <Card className=\"p-6 bg-card border-border\">\n      <div className=\"mb-4\">\n        <h3 className=\"text-lg font-semibold text-foreground\" data-testid=\"text-dataflow-title\">Data Flow Pipeline</h3>\n        <p className=\"text-sm text-muted-foreground\" data-testid=\"text-dataflow-description\">\n          AWS Resource Analysis ‚Üí AI Processing ‚Üí Cost Optimization\n        </p>\n      </div>\n\n      <div className=\"relative\">\n        {/* Flow Diagram */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8\">\n          {/* Input Sources */}\n          <div className=\"space-y-3\">\n            <div className=\"text-xs font-semibold text-primary mb-3\" data-testid=\"text-input-label\">INPUT SOURCES</div>\n            \n            <div className=\"group relative\" data-testid=\"card-input-ec2\">\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-primary/50 transition-all\">\n                <Server className=\"w-5 h-5 text-chart-1\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">EC2 Instances</div>\n                  <div className=\"text-xs text-muted-foreground\">{ec2Count} resources</div>\n                </div>\n              </div>\n              <div className=\"absolute -right-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-chart-1 to-transparent\"></div>\n            </div>\n\n            <div className=\"group relative\" data-testid=\"card-input-rds\">\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-primary/50 transition-all\">\n                <Database className=\"w-5 h-5 text-chart-3\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">RDS Databases</div>\n                  <div className=\"text-xs text-muted-foreground\">{rdsCount} resources</div>\n                </div>\n              </div>\n              <div className=\"absolute -right-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-chart-3 to-transparent\"></div>\n            </div>\n\n            <div className=\"group relative\" data-testid=\"card-input-s3\">\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-primary/50 transition-all\">\n                <Cloud className=\"w-5 h-5 text-chart-2\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">S3 Buckets</div>\n                  <div className=\"text-xs text-muted-foreground\">{s3Count} resources</div>\n                </div>\n              </div>\n              <div className=\"absolute -right-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-chart-2 to-transparent\"></div>\n            </div>\n\n            <div className=\"group relative\" data-testid=\"card-input-metrics\">\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-primary/50 transition-all\">\n                <Activity className=\"w-5 h-5 text-chart-4\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">CloudWatch</div>\n                  <div className=\"text-xs text-muted-foreground\">Metrics & Logs</div>\n                </div>\n              </div>\n              <div className=\"absolute -right-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-chart-4 to-transparent\"></div>\n            </div>\n          </div>\n\n          {/* Processing Stage */}\n          <div className=\"flex items-center justify-center\">\n            <div className=\"relative w-full\" data-testid=\"card-processing\">\n              <div className=\"text-xs font-semibold text-primary mb-3 text-center\" data-testid=\"text-processing-label\">AI PROCESSING</div>\n              <div className=\"relative p-6 rounded-xl bg-gradient-to-br from-primary/10 via-accent/10 to-chart-2/10 border-2 border-primary/30\">\n                <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent rounded-xl animate-pulse\"></div>\n                <div className=\"relative space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap className=\"w-5 h-5 text-primary animate-pulse\" />\n                    <span className=\"text-sm font-semibold text-foreground\">FinOps AI Agent</span>\n                  </div>\n                  <div className=\"space-y-2 text-xs text-muted-foreground\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-1.5 h-1.5 rounded-full bg-chart-1\"></div>\n                      <span>Resource Analysis</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-1.5 h-1.5 rounded-full bg-chart-3\"></div>\n                      <span>Cost Pattern Detection</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-1.5 h-1.5 rounded-full bg-chart-2\"></div>\n                      <span>Utilization Optimization</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-1.5 h-1.5 rounded-full bg-chart-4\"></div>\n                      <span>Recommendation Engine</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Output Results */}\n          <div className=\"space-y-3\">\n            <div className=\"text-xs font-semibold text-primary mb-3\" data-testid=\"text-output-label\">OUTPUT RESULTS</div>\n            \n            <div className=\"group relative\" data-testid=\"card-output-recommendations\">\n              <div className=\"absolute -left-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-transparent to-chart-1\"></div>\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-accent/50 transition-all\">\n                <CheckCircle2 className=\"w-5 h-5 text-accent\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">Recommendations</div>\n                  <div className=\"text-xs text-accent\">{activeRecommendations} active</div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"group relative\" data-testid=\"card-output-savings\">\n              <div className=\"absolute -left-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-transparent to-chart-3\"></div>\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-accent/50 transition-all\">\n                <DollarSign className=\"w-5 h-5 text-chart-3\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">Identified Savings</div>\n                  <div className=\"text-xs text-chart-3\">{formatCurrencyCompact(metrics?.identifiedSavingsAwaitingApproval || 0)}/month</div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"group relative\" data-testid=\"card-output-optimizations\">\n              <div className=\"absolute -left-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-transparent to-chart-2\"></div>\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-accent/50 transition-all\">\n                <TrendingDown className=\"w-5 h-5 text-chart-2\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">Auto-Optimizations</div>\n                  <div className=\"text-xs text-chart-2\">{appliedOptimizations} applied</div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"group relative\" data-testid=\"card-output-reports\">\n              <div className=\"absolute -left-4 top-1/2 -translate-y-1/2 w-4 h-0.5 bg-gradient-to-r from-transparent to-chart-4\"></div>\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-secondary/50 border border-border hover:border-accent/50 transition-all\">\n                <Activity className=\"w-5 h-5 text-chart-4\" />\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-medium text-foreground\">Cost Reports</div>\n                  <div className=\"text-xs text-chart-4\">Real-time updates</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Flow Lines Overlay (decorative) */}\n        <svg className=\"absolute inset-0 w-full h-full pointer-events-none\" style={{ zIndex: -1 }}>\n          <defs>\n            <linearGradient id=\"flowGradient1\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n              <stop offset=\"0%\" stopColor=\"hsl(186, 100%, 50%)\" stopOpacity=\"0.1\" />\n              <stop offset=\"50%\" stopColor=\"hsl(186, 100%, 50%)\" stopOpacity=\"0.3\" />\n              <stop offset=\"100%\" stopColor=\"hsl(152, 70%, 45%)\" stopOpacity=\"0.1\" />\n            </linearGradient>\n          </defs>\n          <path\n            d=\"M 33% 30% Q 50% 30%, 67% 25%\"\n            stroke=\"url(#flowGradient1)\"\n            strokeWidth=\"2\"\n            fill=\"none\"\n            opacity=\"0.3\"\n          />\n          <path\n            d=\"M 33% 50% Q 50% 50%, 67% 45%\"\n            stroke=\"url(#flowGradient1)\"\n            strokeWidth=\"2\"\n            fill=\"none\"\n            opacity=\"0.3\"\n          />\n          <path\n            d=\"M 33% 70% Q 50% 70%, 67% 65%\"\n            stroke=\"url(#flowGradient1)\"\n            strokeWidth=\"2\"\n            fill=\"none\"\n            opacity=\"0.3\"\n          />\n        </svg>\n      </div>\n\n      {/* Key Metrics Footer */}\n      <div className=\"mt-6 pt-4 border-t border-border space-y-6\">\n        {/* Financial Metrics */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6\">\n          <div data-testid=\"metric-monthly-spend\" className=\"text-center\">\n            <div className=\"text-sm font-medium text-muted-foreground mb-1\">Monthly AWS Spend</div>\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"monthly-spend-value\">\n              {formatCurrencyCompact(metrics?.monthlySpend || 0)}\n            </div>\n            {metrics && metrics.monthlySpendChange !== 0 && (\n              <div className={`text-xs mt-1 flex items-center justify-center gap-1 ${metrics.monthlySpendChange > 0 ? 'text-destructive' : 'text-green-500'}`}>\n                {metrics.monthlySpendChange > 0 ? <TrendingUp className=\"w-3 h-3\" /> : <TrendingDown className=\"w-3 h-3\" />}\n                {Math.abs(metrics.monthlySpendChange).toFixed(1)}% vs last month\n              </div>\n            )}\n          </div>\n          \n          <div data-testid=\"metric-ytd-spend\" className=\"text-center\">\n            <div className=\"text-sm font-medium text-muted-foreground mb-1\">YTD AWS Spend</div>\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"ytd-spend-value\">\n              {formatCurrencyCompact(metrics?.ytdSpend || 0)}\n            </div>\n            {metrics && metrics.ytdSpendChange !== 0 && (\n              <div className={`text-xs mt-1 flex items-center justify-center gap-1 ${metrics.ytdSpendChange > 0 ? 'text-destructive' : 'text-green-500'}`}>\n                {metrics.ytdSpendChange > 0 ? <TrendingUp className=\"w-3 h-3\" /> : <TrendingDown className=\"w-3 h-3\" />}\n                {Math.abs(metrics.ytdSpendChange).toFixed(1)}% vs prior-year YTD\n              </div>\n            )}\n          </div>\n          \n          <div data-testid=\"metric-identified-savings\" className=\"text-center\">\n            <div className=\"text-sm font-medium text-muted-foreground mb-1\">Identified Savings Awaiting Approval</div>\n            <div className=\"text-2xl font-bold text-accent\" data-testid=\"identified-savings-value\">\n              {formatCurrencyCompact(metrics?.identifiedSavingsAwaitingApproval || 0)}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              {activeRecommendations} recommendations\n            </div>\n          </div>\n        </div>\n        \n        {/* Pipeline Operations Stats */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 pt-4 border-t border-border\">\n          <div data-testid=\"stat-input-count\" className=\"text-center\">\n            <div className=\"text-lg font-bold text-chart-1\">{totalResources}</div>\n            <div className=\"text-xs text-muted-foreground\">Resources Monitored</div>\n          </div>\n          <div data-testid=\"stat-processing-rate\" className=\"text-center\">\n            <div className=\"text-lg font-bold text-chart-2\">Real-time</div>\n            <div className=\"text-xs text-muted-foreground\">Processing Speed</div>\n          </div>\n          <div data-testid=\"stat-output-count\" className=\"text-center\">\n            <div className=\"text-lg font-bold text-chart-3\">{totalOutputs}</div>\n            <div className=\"text-xs text-muted-foreground\">Active Outputs</div>\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n","size_bytes":15030},"setupFinOpsConnect.js":{"content":"import fs from \"fs\";\nimport https from \"https\";\nimport http from \"http\";\n\nconst envPath = \".env\";\n\n// Default fallback ‚Äî replace this with your actual DCL Replit URL once known\nconst DCL_URL_DEFAULT = process.env.DCL_URL || \"https://YOUR-DCL-PROJECT.yourusername.repl.co/api/unified_data\";\n\nfunction checkEndpoint(url) {\n  return new Promise((resolve) => {\n    const mod = url.startsWith(\"https\") ? https : http;\n    const req = mod.get(url, (res) => {\n      resolve(res.statusCode === 200);\n    });\n    req.on(\"error\", () => resolve(false));\n    req.end();\n  });\n}\n\nasync function main() {\n  console.log(`üîç Checking DCL endpoint: ${DCL_URL_DEFAULT}`);\n  const ok = await checkEndpoint(DCL_URL_DEFAULT);\n  if (ok) {\n    console.log(\"‚úÖ DCL is online. Linking FinOpsPilot ‚Üí DCL\");\n    fs.writeFileSync(envPath, `DCL_URL=${DCL_URL_DEFAULT}\\n`, \"utf-8\");\n  } else {\n    console.log(\"‚ö†Ô∏è DCL not reachable. Falling back to local mock endpoint.\");\n    fs.writeFileSync(envPath, \"DCL_URL=/api/unified_data\\n\", \"utf-8\");\n  }\n  console.log(\"üíæ Environment ready. FinOpsPilot will connect automatically on next run.\");\n}\nmain();\n","size_bytes":1133},"server/index.ts":{"content":"// Suppress AWS SDK v2 and other non-critical warnings (demo app uses synthetic data)\nprocess.removeAllListeners('warning');\nconst originalEmitWarning = process.emitWarning;\nprocess.emitWarning = function(warning, ...args: any[]) {\n  const warningString = typeof warning === 'string' ? warning : (warning as any)?.message || '';\n  \n  // Suppress AWS SDK maintenance mode warnings\n  if (warningString.includes('AWS SDK') || \n      warningString.includes('maintenance mode') ||\n      args[0] === 'DeprecationWarning' && warningString.includes('AWS')) {\n    return;\n  }\n  \n  return originalEmitWarning.apply(process, [warning, ...args] as any);\n};\n\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\n\nconst execPromise = promisify(exec);\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { loggingMiddleware } from \"./middleware/logging\";\nimport { logger } from \"./services/logger\";\nimport { configService } from \"./services/config\";\nimport { SchedulerService } from \"./services/scheduler\";\nimport { generalApiLimiter, authLimiter, writeLimiter, readLimiter } from \"./middleware/rate-limit\";\nimport { developmentSecurityHeaders, productionSecurityHeaders } from \"./middleware/security-headers\";\nimport { corsMiddleware } from \"./middleware/cors\";\n\nconst app = express();\n\napp.set('trust proxy', 1);\n\napp.use(corsMiddleware);\n\nconst isDevelopment = app.get(\"env\") === \"development\";\napp.use(isDevelopment ? developmentSecurityHeaders : productionSecurityHeaders);\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use(loggingMiddleware);\n\napp.use('/api/login', authLimiter);\napp.use('/api/register', authLimiter);\n\napp.use('/api/*', generalApiLimiter);\napp.use('/api/*', writeLimiter);\napp.use('/api/*', readLimiter);\n\n(async () => {\n  // Run database migrations in production before starting the app\n  const isProductionEnv = process.env.NODE_ENV === 'production';\n  if (isProductionEnv) {\n    try {\n      console.log('üóÑÔ∏è  Running database migrations in production...');\n      const { stdout, stderr } = await execPromise('npm run db:push --  --force');\n      if (stdout) console.log(stdout);\n      if (stderr && !stderr.includes('Warning')) console.error(stderr);\n      console.log('‚úÖ Database migrations complete');\n    } catch (error) {\n      console.error('‚ùå Database migration failed:', error);\n      console.error('Attempting to continue anyway - tables may already exist');\n    }\n  }\n\n  // Validate JWT_SECRET at startup - fail fast if missing or insecure\n  const JWT_SECRET = process.env.JWT_SECRET;\n  \n  if (!JWT_SECRET || JWT_SECRET.length === 0) {\n    console.error('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');\n    console.error('‚ïë CRITICAL SECURITY ERROR: JWT_SECRET not set                      ‚ïë');\n    console.error('‚ïü‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï¢');\n    console.error('‚ïë The JWT_SECRET environment variable is required for secure       ‚ïë');\n    console.error('‚ïë authentication. The application cannot start without it.         ‚ïë');\n    console.error('‚ïë                                                                   ‚ïë');\n    console.error('‚ïë Please set JWT_SECRET to a secure random string of at least      ‚ïë');\n    console.error('‚ïë 32 characters.                                                    ‚ïë');\n    console.error('‚ïë                                                                   ‚ïë');\n    console.error('‚ïë Example:                                                          ‚ïë');\n    console.error('‚ïë   export JWT_SECRET=$(openssl rand -base64 32)                   ‚ïë');\n    console.error('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');\n    process.exit(1);\n  }\n\n  if (JWT_SECRET.length < 32) {\n    console.error('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');\n    console.error(`‚ïë CRITICAL SECURITY ERROR: JWT_SECRET too short (${JWT_SECRET.length} chars)        ‚ïë`);\n    console.error('‚ïü‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï¢');\n    console.error('‚ïë JWT_SECRET must be at least 32 characters for security.          ‚ïë');\n    console.error('‚ïë                                                                   ‚ïë');\n    console.error('‚ïë Current length: ' + JWT_SECRET.length + ' characters                                  ‚ïë');\n    console.error('‚ïë Required length: 32+ characters                                  ‚ïë');\n    console.error('‚ïë                                                                   ‚ïë');\n    console.error('‚ïë Please generate a new secure JWT_SECRET:                         ‚ïë');\n    console.error('‚ïë   export JWT_SECRET=$(openssl rand -base64 32)                   ‚ïë');\n    console.error('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');\n    process.exit(1);\n  }\n\n  logger.info('JWT_SECRET validated successfully', { length: JWT_SECRET.length });\n\n  // Validate ALLOWED_ORIGINS in production - fail fast if missing or invalid\n  const isProduction = process.env.NODE_ENV === 'production';\n  if (isProduction) {\n    const ALLOWED_ORIGINS = process.env.ALLOWED_ORIGINS;\n    \n    if (!ALLOWED_ORIGINS || ALLOWED_ORIGINS.trim().length === 0) {\n      console.error('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');\n      console.error('‚ïë CRITICAL SECURITY ERROR: ALLOWED_ORIGINS not set in production  ‚ïë');\n      console.error('‚ïü‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï¢');\n      console.error('‚ïë The ALLOWED_ORIGINS environment variable is required in          ‚ïë');\n      console.error('‚ïë production to prevent CORS security vulnerabilities.             ‚ïë');\n      console.error('‚ïë                                                                   ‚ïë');\n      console.error('‚ïë Please set ALLOWED_ORIGINS to a comma-separated list of          ‚ïë');\n      console.error('‚ïë allowed origins.                                                  ‚ïë');\n      console.error('‚ïë                                                                   ‚ïë');\n      console.error('‚ïë Example:                                                          ‚ïë');\n      console.error('‚ïë   export ALLOWED_ORIGINS=https://example.com,https://app.com     ‚ïë');\n      console.error('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');\n      process.exit(1);\n    }\n\n    // Check for wildcard origin in production\n    const origins = ALLOWED_ORIGINS.split(',').map(origin => origin.trim());\n    if (origins.includes('*')) {\n      console.error('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');\n      console.error('‚ïë CRITICAL SECURITY ERROR: Wildcard (*) origin in production      ‚ïë');\n      console.error('‚ïü‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï¢');\n      console.error('‚ïë Using wildcard (*) in ALLOWED_ORIGINS is not permitted in        ‚ïë');\n      console.error('‚ïë production environments due to security risks.                   ‚ïë');\n      console.error('‚ïë                                                                   ‚ïë');\n      console.error('‚ïë Please specify explicit allowed origins instead.                 ‚ïë');\n      console.error('‚ïë                                                                   ‚ïë');\n      console.error('‚ïë Example:                                                          ‚ïë');\n      console.error('‚ïë   export ALLOWED_ORIGINS=https://example.com,https://app.com     ‚ïë');\n      console.error('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');\n      process.exit(1);\n    }\n\n    logger.info('ALLOWED_ORIGINS validated successfully', { origins });\n  }\n\n  try {\n    await configService.validateAndLoadConfig();\n    await configService.initializeDefaults();\n    logger.info('Application configuration initialized successfully');\n    \n    // Initialize scheduler service for demo mode simulation and background jobs\n    const scheduler = new SchedulerService();\n    await scheduler.initialize();\n    logger.info('Scheduler service initialized successfully');\n  } catch (error) {\n    logger.error('Failed to initialize configuration', {}, error as Error);\n    process.exit(1);\n  }\n\n  const server = await registerRoutes(app);\n\n  app.use((err: any, req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    logger.error('Request error', {\n      requestId: req.requestId,\n      method: req.method,\n      path: req.path,\n      status,\n      userId: req.user?.userId\n    }, err);\n\n    res.status(status).json({ message });\n  });\n\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    logger.info(`Server listening on port ${port}`, { port });\n  });\n})();\n","size_bytes":10898},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/lib/currency.ts":{"content":"// Utility functions for formatting financial values\n// All financial values are stored as direct dollar amounts (no multipliers)\n\nexport function formatCurrency(value: number | string | null | undefined): string {\n  if (value === null || value === undefined) {\n    return '$0';\n  }\n  \n  // Convert to number (values are already in dollars)\n  const numValue = typeof value === 'string' ? parseInt(value) : value;\n  const dollarAmount = numValue;\n  \n  // Format with exactly 2 decimal places and thousands separators\n  return `$${dollarAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n}\n\nexport function formatCurrencyWithSuffix(value: number | string | null | undefined, suffix: string): string {\n  const formatted = formatCurrency(value);\n  return `${formatted}${suffix}`;\n}\n\n// Global currency formatter - displays values in whole dollars (if < $1,000) or K-scale (if >= $1,000)\n// No decimals in either case. This is the primary formatter for all monetary values.\nexport function formatCurrencyK(value: number | string | null | undefined): string {\n  if (value === null || value === undefined) {\n    return '$0';\n  }\n  \n  // Convert to number (values are already in dollars)\n  const numValue = typeof value === 'string' ? parseInt(value) : value;\n  const dollarAmount = numValue;\n  \n  // If less than $1,000, show as whole dollars\n  if (dollarAmount < 1000) {\n    return `$${Math.round(dollarAmount).toLocaleString()}`;\n  }\n  \n  // Otherwise, convert to thousands and show K-scale\n  const thousands = Math.round(dollarAmount / 1000);\n  return `$${thousands.toLocaleString()} K`;\n}\n\n// Legacy: Keep formatCurrencyCompact as an alias to formatCurrencyK for backward compatibility\nexport const formatCurrencyCompact = formatCurrencyK;","size_bytes":1775},"client/src/components/dashboard/resource-monitor.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { RotateCcw, MessageSquare } from \"lucide-react\";\nimport type { AwsResource } from \"@shared/schema\";\n\nexport function ResourceMonitor() {\n  const { data: resources, isLoading } = useQuery<AwsResource[]>({\n    queryKey: ['/api/aws-resources'],\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Resource Utilization</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-6\">\n            {Array.from({ length: 4 }).map((_, i) => (\n              <div key={i} className=\"animate-pulse space-y-3\">\n                <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n                <div className=\"h-2 bg-muted rounded\"></div>\n                <div className=\"h-3 bg-muted rounded w-1/3\"></div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!resources || resources.length === 0) {\n    return (\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-lg font-semibold text-foreground\">Resource Utilization</CardTitle>\n            <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n              <RotateCcw className=\"w-4 h-4\" />\n              <span>Real-time</span>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8\">\n            <p className=\"text-muted-foreground\">No resources found</p>\n            <p className=\"text-sm text-muted-foreground mt-2\">AWS resources will appear here once discovered</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Group resources by type for better display\n  const resourcesByType = resources.reduce((acc, resource) => {\n    if (!acc[resource.resourceType]) {\n      acc[resource.resourceType] = [];\n    }\n    acc[resource.resourceType].push(resource);\n    return acc;\n  }, {} as Record<string, AwsResource[]>);\n\n  const getUtilizationData = (resourceType: string, resources: AwsResource[]) => {\n    // Calculate average utilization for resource type\n    const utilizationValues = resources\n      .map(r => r.utilizationMetrics)\n      .filter(Boolean)\n      .map(metrics => {\n        if (typeof metrics === 'object' && metrics && 'avgCpuUtilization' in metrics) {\n          return Number(metrics.avgCpuUtilization) || 0;\n        }\n        return 0;\n      });\n    \n    const avgUtilization = utilizationValues.length > 0 \n      ? utilizationValues.reduce((sum, val) => sum + val, 0) / utilizationValues.length \n      : 0;\n\n    const underUtilizedCount = resources.filter(r => {\n      const metrics = r.utilizationMetrics;\n      if (typeof metrics === 'object' && metrics && 'avgCpuUtilization' in metrics) {\n        return Number(metrics.avgCpuUtilization) < 50;\n      }\n      return false;\n    }).length;\n\n    return {\n      avgUtilization: Math.round(avgUtilization),\n      underUtilizedCount,\n      totalCount: resources.length\n    };\n  };\n\n  const getUtilizationColor = (utilization: number) => {\n    if (utilization < 30) return 'bg-destructive';\n    if (utilization < 70) return 'bg-chart-3';\n    return 'bg-accent';\n  };\n\n  const getUtilizationStatus = (utilization: number, underUtilized: number, total: number) => {\n    if (utilization > 80) return 'Well optimized';\n    if (underUtilized === 0) return 'Optimized';\n    return `${underUtilized} of ${total} under-utilized`;\n  };\n\n  return (\n    <Card data-testid=\"resource-monitor\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-semibold text-foreground\">Resource Utilization</CardTitle>\n          <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n            <RotateCcw className=\"w-4 h-4\" />\n            <span>Real-time</span>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          {Object.entries(resourcesByType).map(([resourceType, typeResources], index) => {\n            const utilData = getUtilizationData(resourceType, typeResources);\n            \n            return (\n              <div key={resourceType} data-testid={`resource-type-${index}`}>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm font-medium text-foreground\" data-testid={`resource-type-name-${index}`}>\n                    {resourceType} {resourceType === 'Redshift' ? 'Clusters' : 'Instances'}\n                  </span>\n                  <span className=\"text-sm text-muted-foreground\" data-testid={`resource-utilization-${index}`}>\n                    {utilData.avgUtilization}% avg utilization\n                  </span>\n                </div>\n                <Progress \n                  value={utilData.avgUtilization} \n                  className=\"w-full h-2\"\n                  data-testid={`resource-progress-${index}`}\n                />\n                <p className=\"text-xs text-muted-foreground mt-1\" data-testid={`resource-status-${index}`}>\n                  {getUtilizationStatus(utilData.avgUtilization, utilData.underUtilizedCount, utilData.totalCount)}\n                </p>\n              </div>\n            );\n          })}\n\n          <div className=\"mt-6 p-4 bg-muted/50 rounded-lg\" data-testid=\"slack-integration\">\n            <div className=\"flex items-center space-x-2 mb-2\">\n              <MessageSquare className=\"w-4 h-4 text-chart-3\" />\n              <span className=\"text-sm font-medium text-foreground\">Slack Integration</span>\n            </div>\n            <p className=\"text-xs text-muted-foreground mb-2\">\n              #finops-alerts channel configured for notifications\n            </p>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 bg-accent rounded-full animate-pulse\"></div>\n                <span className=\"text-xs text-muted-foreground\">Connected</span>\n              </div>\n              <Button variant=\"ghost\" size=\"sm\" className=\"text-xs text-primary hover:underline\" data-testid=\"button-configure-slack\">\n                Configure\n              </Button>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":6685},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"server/services/data-generator.ts":{"content":"import { nanoid } from 'nanoid';\nimport type { IStorage } from '../storage.js';\n\n// Data generator is a system service that operates in the default tenant context\nconst SYSTEM_TENANT_ID = 'default-tenant';\n\nexport class DataGenerator {\n  private storage: IStorage;\n\n  constructor(storage: IStorage) {\n    this.storage = storage;\n  }\n\n  async generateAWSData() {\n    console.log('üöÄ Starting AWS data simulation...');\n\n    // Generate AWS resources\n    const resources = await this.generateAWSResources();\n    console.log(`‚úÖ Generated ${resources.length} AWS resources`);\n\n    // Generate cost data for the past 6 months\n    await this.generateCostData();\n    console.log('‚úÖ Generated cost data for past 6 months');\n\n    // Generate recommendations based on resources\n    const recommendations = await this.generateRecommendations(resources);\n    console.log(`‚úÖ Generated ${recommendations.length} recommendations`);\n\n    // Generate some optimization history\n    await this.generateOptimizationHistory();\n    console.log('‚úÖ Generated optimization history');\n\n    console.log('üéâ AWS simulation data generation complete!');\n\n    return {\n      resourcesCount: resources.length,\n      recommendationsCount: recommendations.length,\n      message: 'AWS simulation data generated successfully'\n    };\n  }\n\n  private async generateAWSResources() {\n    const resources = [];\n\n    // EC2 Instances\n    const ec2Instances = [\n      {\n        resourceId: `i-${nanoid(17)}`, // Unique EC2 instance ID\n        resourceType: 'EC2',\n        region: 'us-east-1',\n        currentConfig: JSON.stringify({\n          instanceType: 'm5.2xlarge',\n          vcpus: 8,\n          memory: '32 GiB',\n          storage: 'EBS-optimized'\n        }),\n        utilizationMetrics: JSON.stringify({\n          cpuUtilization: 25.5,\n          memoryUtilization: 40.2,\n          networkIn: 1024.5,\n          networkOut: 2048.1\n        }),\n        monthlyCost: 245760, // $245,760/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'production',\n          Team: 'backend',\n          Project: 'web-api'\n        })\n      },\n      {\n        resourceId: `i-${nanoid(17)}`, // Unique EC2 instance ID\n        resourceType: 'EC2',\n        region: 'us-west-2',\n        currentConfig: JSON.stringify({\n          instanceType: 't3.large',\n          vcpus: 2,\n          memory: '8 GiB',\n          storage: 'EBS-optimized'\n        }),\n        utilizationMetrics: JSON.stringify({\n          cpuUtilization: 85.3,\n          memoryUtilization: 75.8,\n          networkIn: 512.3,\n          networkOut: 1024.7\n        }),\n        monthlyCost: 67320, // $67,320/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'development',\n          Team: 'frontend',\n          Project: 'web-ui'\n        })\n      },\n      {\n        resourceId: `i-${nanoid(17)}`, // Unique EC2 instance ID\n        resourceType: 'EC2',\n        region: 'us-east-1',\n        currentConfig: JSON.stringify({\n          instanceType: 'c5.4xlarge',\n          vcpus: 16,\n          memory: '32 GiB',\n          storage: 'EBS-optimized'\n        }),\n        utilizationMetrics: JSON.stringify({\n          cpuUtilization: 12.1,\n          memoryUtilization: 18.5,\n          networkIn: 256.1,\n          networkOut: 512.3\n        }),\n        monthlyCost: 501120, // $501,120/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'production',\n          Team: 'data',\n          Project: 'analytics'\n        })\n      }\n    ];\n\n    // RDS Instances\n    const rdsInstances = [\n      {\n        resourceId: `db-${nanoid(12)}`, // Unique RDS instance ID\n        resourceType: 'RDS',\n        region: 'us-east-1',\n        currentConfig: JSON.stringify({\n          engine: 'mysql',\n          instanceClass: 'db.r5.xlarge',\n          allocatedStorage: 500,\n          storageType: 'gp2'\n        }),\n        utilizationMetrics: JSON.stringify({\n          cpuUtilization: 45.2,\n          connections: 125,\n          readLatency: 0.002,\n          writeLatency: 0.005\n        }),\n        monthlyCost: 412500, // $412,500/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'production',\n          Team: 'backend',\n          Project: 'web-api'\n        })\n      },\n      {\n        resourceId: `db-${nanoid(12)}`, // Unique RDS instance ID\n        resourceType: 'RDS',\n        region: 'us-west-2',\n        currentConfig: JSON.stringify({\n          engine: 'postgres',\n          instanceClass: 'db.t3.medium',\n          allocatedStorage: 100,\n          storageType: 'gp2'\n        }),\n        utilizationMetrics: JSON.stringify({\n          cpuUtilization: 15.8,\n          connections: 12,\n          readLatency: 0.001,\n          writeLatency: 0.003\n        }),\n        monthlyCost: 89250, // $89,250/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'development',\n          Team: 'backend',\n          Project: 'web-api'\n        })\n      }\n    ];\n\n    // S3 Buckets\n    const s3Buckets = [\n      {\n        resourceId: `bucket-${nanoid(12)}`, // Unique S3 bucket ID\n        resourceType: 'S3',\n        region: 'us-east-1',\n        currentConfig: JSON.stringify({\n          storageClass: 'STANDARD',\n          sizeGB: 2500,\n          objectCount: 125000,\n          versioning: true\n        }),\n        utilizationMetrics: JSON.stringify({\n          getRequests: 50000,\n          putRequests: 5000,\n          dataTransferOut: 100.5\n        }),\n        monthlyCost: 57380, // $57,380/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'production',\n          Team: 'devops',\n          Project: 'backup'\n        })\n      },\n      {\n        resourceId: `bucket-${nanoid(12)}`, // Unique S3 bucket ID\n        resourceType: 'S3',\n        region: 'us-east-1',\n        currentConfig: JSON.stringify({\n          storageClass: 'STANDARD',\n          sizeGB: 450,\n          objectCount: 25000,\n          versioning: false\n        }),\n        utilizationMetrics: JSON.stringify({\n          getRequests: 500000,\n          putRequests: 1000,\n          dataTransferOut: 1500.2\n        }),\n        monthlyCost: 23670, // $23,670/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'production',\n          Team: 'frontend',\n          Project: 'web-ui'\n        })\n      }\n    ];\n\n    // Load Balancers\n    const loadBalancers = [\n      {\n        resourceId: `alb-${nanoid(10)}`, // Unique ALB resource ID\n        resourceType: 'ALB',\n        region: 'us-east-1',\n        currentConfig: JSON.stringify({\n          type: 'application',\n          scheme: 'internet-facing',\n          targets: 3\n        }),\n        utilizationMetrics: JSON.stringify({\n          requestCount: 2500000,\n          targetResponseTime: 0.045,\n          healthyTargets: 3\n        }),\n        monthlyCost: 22500, // $22,500/month (enterprise scale)\n        tags: JSON.stringify({\n          Environment: 'production',\n          Team: 'devops',\n          Project: 'web-api'\n        })\n      }\n    ];\n\n    const allResources = [...ec2Instances, ...rdsInstances, ...s3Buckets, ...loadBalancers];\n\n    for (const resource of allResources) {\n      const created = await this.storage.createAwsResource({\n        tenantId: SYSTEM_TENANT_ID,\n        ...resource,\n        lastAnalyzed: new Date()\n      }, SYSTEM_TENANT_ID);\n      resources.push(created);\n    }\n\n    return resources;\n  }\n\n  public async generateCostData() {\n    const services = [\n      'EC2-Instance', 'RDS', 'S3', 'ELB', 'CloudWatch', 'Route53', \n      'CloudFront', 'Lambda', 'EBS', 'Data Transfer'\n    ];\n\n    // Generate data for past 6 months\n    for (let monthsBack = 6; monthsBack >= 0; monthsBack--) {\n      const reportDate = new Date();\n      reportDate.setMonth(reportDate.getMonth() - monthsBack);\n      reportDate.setDate(1); // First of month\n      \n      for (const service of services) {\n        const baseCost = this.getBaseCostForService(service);\n        // Add some randomness (¬±20%)\n        const variation = (Math.random() - 0.5) * 0.4;\n        const cost = baseCost * (1 + variation);\n        \n        await this.storage.createCostReport({\n          tenantId: SYSTEM_TENANT_ID,\n          reportDate,\n          serviceCategory: service,\n          cost: Math.round(cost), // Direct dollar amounts (enterprise scale)\n          usage: this.generateUsageForService(service),\n          usageType: this.getUsageTypeForService(service),\n          region: ['us-east-1', 'us-west-2', 'eu-west-1'][Math.floor(Math.random() * 3)]\n        }, SYSTEM_TENANT_ID);\n      }\n    }\n  }\n\n  private getBaseCostForService(service: string): number {\n    const baseCosts: { [key: string]: number } = {\n      'EC2-Instance': 814000, // $814k/month (enterprise scale)\n      'RDS': 501750, // $501.75k/month\n      'S3': 81050, // $81k/month\n      'ELB': 22500, // $22.5k/month\n      'CloudWatch': 15250, // $15.25k/month\n      'Route53': 12000, // $12k/month\n      'CloudFront': 45300, // $45.3k/month\n      'Lambda': 8750, // $8.75k/month\n      'EBS': 125400, // $125.4k/month\n      'Data Transfer': 89600 // $89.6k/month\n    };\n    return baseCosts[service] || 50000; // Default $50k/month\n  }\n\n  private generateUsageForService(service: string): string {\n    const usageRanges: { [key: string]: [number, number] } = {\n      'EC2-Instance': [500, 1000],\n      'RDS': [200, 500],\n      'S3': [1000, 5000],\n      'ELB': [50, 200],\n      'CloudWatch': [10000, 50000],\n      'Route53': [100000, 500000], // Reduced to fit precision 12, scale 6\n      'CloudFront': [10000, 100000],\n      'Lambda': [50000, 500000], // Reduced to fit precision 12, scale 6\n      'EBS': [1000, 10000],\n      'Data Transfer': [100, 1000]\n    };\n\n    const [min, max] = usageRanges[service] || [100, 1000];\n    return (Math.random() * (max - min) + min).toFixed(2);\n  }\n\n  private getUsageTypeForService(service: string): string {\n    const usageTypes: { [key: string]: string } = {\n      'EC2-Instance': 'Instance-Hours',\n      'RDS': 'Instance-Hours',\n      'S3': 'GB-Month',\n      'ELB': 'LoadBalancer-Hours',\n      'CloudWatch': 'Requests',\n      'Route53': 'Queries',\n      'CloudFront': 'Requests',\n      'Lambda': 'Invocations',\n      'EBS': 'GB-Month',\n      'Data Transfer': 'GB'\n    };\n    return usageTypes[service] || 'Units';\n  }\n\n  private async generateRecommendations(resources: any[]) {\n    const recommendations = [];\n\n    // Recommendation 1: Downsize over-provisioned EC2\n    const overProvisionedEC2 = resources.find(r => \n      r.resourceType === 'EC2' && \n      r.currentConfig.instanceType === 'c5.4xlarge'\n    );\n\n    if (overProvisionedEC2) {\n      recommendations.push({\n        tenantId: SYSTEM_TENANT_ID,\n        resourceId: overProvisionedEC2.resourceId,\n        type: 'resize',\n        priority: 'high',\n        title: 'Downsize Over-Provisioned EC2 Instance',\n        description: 'This c5.4xlarge instance shows low CPU (12%) and memory (18%) utilization. Consider downsizing to c5.xlarge to reduce costs without impacting performance.',\n        currentConfig: overProvisionedEC2.currentConfig,\n        recommendedConfig: JSON.stringify({\n          instanceType: 'c5.xlarge',\n          vcpus: 4,\n          memory: '8 GiB',\n          storage: 'EBS-optimized'\n        }),\n        projectedMonthlySavings: 250560, // $250,560/month (enterprise scale)\n        riskLevel: 16,\n        status: 'pending',\n        executionMode: 'hitl' // High impact requires approval\n      });\n    }\n\n    // Recommendation 2: Move S3 to cheaper storage class\n    const s3Bucket = resources.find(r => \n      r.resourceType === 'S3' &&\n      r.currentConfig.sizeGB >= 2000 // Find the large backup bucket\n    );\n\n    if (s3Bucket) {\n      recommendations.push({\n        tenantId: SYSTEM_TENANT_ID,\n        resourceId: s3Bucket.resourceId,\n        type: 'storage-class',\n        priority: 'medium',\n        title: 'Migrate Backup Data to S3 Intelligent Tiering',\n        description: 'Your backup bucket contains 2.5TB of data that could benefit from S3 Intelligent Tiering to automatically move objects to cheaper storage classes.',\n        currentConfig: s3Bucket.currentConfig,\n        recommendedConfig: JSON.stringify({\n          storageClass: 'INTELLIGENT_TIERING',\n          sizeGB: 2500,\n          objectCount: 125000,\n          versioning: true\n        }),\n        projectedMonthlySavings: 17210, // $17,210/month (enterprise scale)\n        riskLevel: 5,\n        status: 'pending',\n        executionMode: 'autonomous' // Low risk autonomous execution\n      });\n    }\n\n    // Recommendation 3: Reserved Instance opportunity\n    const prodEC2 = resources.find(r => \n      r.resourceType === 'EC2' && \n      r.currentConfig.instanceType === 'm5.2xlarge'\n    );\n\n    if (prodEC2) {\n      recommendations.push({\n        tenantId: SYSTEM_TENANT_ID,\n        resourceId: prodEC2.resourceId,\n        type: 'reserved-instance',\n        priority: 'medium',\n        title: 'Purchase Reserved Instance for Production Workload',\n        description: 'This production m5.2xlarge instance runs 24/7. A 1-year reserved instance would provide significant savings over on-demand pricing.',\n        currentConfig: prodEC2.currentConfig,\n        recommendedConfig: JSON.stringify({\n          instanceType: 'm5.2xlarge',\n          pricingModel: 'reserved-1year',\n          paymentOption: 'partial-upfront'\n        }),\n        projectedMonthlySavings: 73680, // $73,680/month (enterprise scale)\n        riskLevel: 3,\n        status: 'pending',\n        executionMode: 'autonomous' // Low risk reservation\n      });\n    }\n\n    // Recommendation 4: Stop development resources after hours\n    const devResources = resources.filter(r => {\n      try {\n        const tags = r.tags || {};\n        return tags.Environment === 'development';\n      } catch {\n        return false;\n      }\n    });\n\n    if (devResources.length > 0) {\n      const totalDevCost = devResources.reduce((sum, r) => sum + parseFloat(r.monthlyCost), 0);\n      const potentialSavings = totalDevCost * 0.65; // Assume 65% savings by stopping after hours\n\n      recommendations.push({\n        tenantId: SYSTEM_TENANT_ID,\n        resourceId: 'dev-environment-group',\n        type: 'terminate',\n        priority: 'critical',\n        title: 'Implement Auto-Shutdown for Development Environment',\n        description: `Schedule automatic shutdown of development resources (${devResources.length} instances) after business hours (6 PM - 8 AM) and weekends to reduce costs.`,\n        currentConfig: JSON.stringify({\n          schedule: '24/7',\n          resources: devResources.length\n        }),\n        recommendedConfig: JSON.stringify({\n          schedule: 'weekdays 8 AM - 6 PM',\n          autoShutdown: true,\n          resources: devResources.length\n        }),\n        projectedMonthlySavings: Math.round(potentialSavings), // Direct dollar amounts (enterprise scale)\n        riskLevel: 8,\n        status: 'pending',\n        executionMode: 'autonomous' // Automated scheduling\n      });\n    }\n\n    // Recommendation 5: RDS rightsizing\n    const underutilizedRDS = resources.find(r => \n      r.resourceType === 'RDS' && \n      r.currentConfig.engine === 'postgres'\n    );\n\n    if (underutilizedRDS) {\n      recommendations.push({\n        tenantId: SYSTEM_TENANT_ID,\n        resourceId: underutilizedRDS.resourceId,\n        type: 'resize',\n        priority: 'low',\n        title: 'Downsize Development Database Instance',\n        description: 'Development PostgreSQL database shows low utilization (16% CPU, 12 connections). Consider moving to db.t3.micro for development workloads.',\n        currentConfig: underutilizedRDS.currentConfig,\n        recommendedConfig: JSON.stringify({\n          engine: 'postgres',\n          instanceClass: 'db.t3.micro',\n          allocatedStorage: 50,\n          storageType: 'gp2'\n        }),\n        projectedMonthlySavings: 63180, // $63,180/month (enterprise scale)\n        riskLevel: 12,\n        status: 'pending',\n        executionMode: 'hitl' // Database changes require approval\n      });\n    }\n\n    // Store recommendations\n    const createdRecommendations = [];\n    for (const rec of recommendations) {\n      const created = await this.storage.createRecommendation(rec, SYSTEM_TENANT_ID);\n      createdRecommendations.push(created);\n    }\n\n    return createdRecommendations;\n  }\n\n  private async generateOptimizationHistory() {\n    const historyItems = [\n      {\n        tenantId: SYSTEM_TENANT_ID,\n        id: nanoid(),\n        recommendationId: 'completed-1',\n        executedBy: 'system',\n        executionDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 1 week ago\n        beforeConfig: JSON.stringify({\n          instanceType: 't3.2xlarge',\n          vcpus: 8,\n          memory: '32 GiB'\n        }),\n        afterConfig: JSON.stringify({\n          instanceType: 't3.xlarge',\n          vcpus: 4,\n          memory: '16 GiB'\n        }),\n        actualSavings: 142500, // $142,500 savings (enterprise scale)\n        status: 'success'\n      },\n      {\n        tenantId: SYSTEM_TENANT_ID,\n        id: nanoid(),\n        recommendationId: 'completed-2',\n        executedBy: 'john.davis@company.com',\n        executionDate: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000), // 2 weeks ago\n        beforeConfig: JSON.stringify({\n          storageClass: 'STANDARD',\n          autoTiering: false\n        }),\n        afterConfig: JSON.stringify({\n          storageClass: 'INTELLIGENT_TIERING',\n          autoTiering: true\n        }),\n        actualSavings: 89320, // $89,320 savings (enterprise scale)\n        status: 'success'\n      },\n      {\n        tenantId: SYSTEM_TENANT_ID,\n        id: nanoid(),\n        recommendationId: 'completed-3',\n        executedBy: 'system',\n        executionDate: new Date(Date.now() - 21 * 24 * 60 * 60 * 1000), // 3 weeks ago\n        beforeConfig: JSON.stringify({\n          schedule: '24/7',\n          instances: 5\n        }),\n        afterConfig: JSON.stringify({\n          schedule: 'weekdays 8 AM - 8 PM',\n          instances: 5\n        }),\n        actualSavings: 425680, // $425,680 savings (enterprise scale)\n        status: 'success'\n      },\n      {\n        tenantId: SYSTEM_TENANT_ID,\n        id: nanoid(),\n        recommendationId: 'failed-1',\n        executedBy: 'system',\n        executionDate: new Date(Date.now() - 28 * 24 * 60 * 60 * 1000), // 4 weeks ago\n        beforeConfig: JSON.stringify({\n          instanceType: 'm5.large'\n        }),\n        afterConfig: JSON.stringify({\n          instanceType: 'm5.medium'\n        }),\n        actualSavings: null,\n        status: 'failed',\n        errorMessage: 'Insufficient capacity for m5.medium in us-east-1a'\n      }\n    ];\n\n    for (const item of historyItems) {\n      await this.storage.createOptimizationHistory(item, SYSTEM_TENANT_ID);\n    }\n  }\n\n  async clearAllData() {\n    // Note: This would need to be implemented in the storage layer\n    // For now, we'll just indicate this is a placeholder\n    console.log('üóëÔ∏è  Data clearing would need to be implemented in storage layer');\n  }\n}","size_bytes":19055},"server/services/slack.ts":{"content":"import { WebClient, type ChatPostMessageArguments } from \"@slack/web-api\";\n\n// Check if Slack is properly configured\nconst isSlackEnabled = Boolean(process.env.SLACK_BOT_TOKEN && process.env.SLACK_CHANNEL_ID);\nconst SLACK_CHANNEL_ID = process.env.SLACK_CHANNEL_ID || \"C1234567890\";\n\nconst slack = isSlackEnabled ? new WebClient(process.env.SLACK_BOT_TOKEN!) : null;\n\nexport async function sendSlackMessage(\n  message: ChatPostMessageArguments\n): Promise<string | undefined> {\n  if (!isSlackEnabled || !slack) {\n    console.log('Slack disabled - skipping message');\n    return undefined;\n  }\n  \n  try {\n    const response = await slack.chat.postMessage(message);\n    return response.ts;\n  } catch (error) {\n    console.error('Error sending Slack message:', error);\n    throw error;\n  }\n}\n\nexport async function sendOptimizationRecommendation(recommendation: {\n  title: string;\n  description: string;\n  resourceId: string;\n  projectedMonthlySavings: number;\n  priority: string;\n  recommendationId: string;\n}) {\n  const channel = SLACK_CHANNEL_ID;\n  \n  const priorityEmoji = {\n    critical: 'üö®',\n    high: '‚ö†Ô∏è',\n    medium: 'üìä',\n    low: '‚ÑπÔ∏è'\n  };\n\n  const message = {\n    channel,\n    blocks: [\n      {\n        type: 'header',\n        text: {\n          type: 'plain_text',\n          text: `${priorityEmoji[recommendation.priority as keyof typeof priorityEmoji]} New Cost Optimization Opportunity`\n        }\n      },\n      {\n        type: 'section',\n        fields: [\n          {\n            type: 'mrkdwn',\n            text: `*Resource:* ${recommendation.resourceId}`\n          },\n          {\n            type: 'mrkdwn',\n            text: `*Priority:* ${recommendation.priority.toUpperCase()}`\n          },\n          {\n            type: 'mrkdwn',\n            text: `*Monthly Savings:* $${recommendation.projectedMonthlySavings.toLocaleString()}`\n          }\n        ]\n      },\n      {\n        type: 'section',\n        text: {\n          type: 'mrkdwn',\n          text: `*${recommendation.title}*\\n${recommendation.description}`\n        }\n      },\n      {\n        type: 'actions',\n        elements: [\n          {\n            type: 'button',\n            text: {\n              type: 'plain_text',\n              text: 'Review in Dashboard'\n            },\n            style: 'primary',\n            url: `${process.env.REPLIT_DOMAINS || 'http://localhost:5000'}`,\n            action_id: 'review_recommendation'\n          },\n          {\n            type: 'button',\n            text: {\n              type: 'plain_text',\n              text: 'Approve'\n            },\n            style: 'primary',\n            action_id: 'approve_recommendation',\n            value: recommendation.recommendationId\n          },\n          {\n            type: 'button',\n            text: {\n              type: 'plain_text',\n              text: 'Reject'\n            },\n            style: 'danger',\n            action_id: 'reject_recommendation',\n            value: recommendation.recommendationId\n          }\n        ]\n      }\n    ]\n  };\n\n  return await sendSlackMessage(message);\n}\n\nexport async function sendOptimizationComplete(optimization: {\n  title: string;\n  resourceId: string;\n  actualSavings: number;\n  status: string;\n}) {\n  const channel = SLACK_CHANNEL_ID;\n  \n  const statusEmoji = optimization.status === 'success' ? '‚úÖ' : '‚ùå';\n  \n  const message = {\n    channel,\n    blocks: [\n      {\n        type: 'header',\n        text: {\n          type: 'plain_text',\n          text: `${statusEmoji} Optimization ${optimization.status === 'success' ? 'Completed' : 'Failed'}`\n        }\n      },\n      {\n        type: 'section',\n        fields: [\n          {\n            type: 'mrkdwn',\n            text: `*Resource:* ${optimization.resourceId}`\n          },\n          {\n            type: 'mrkdwn',\n            text: `*Status:* ${optimization.status.toUpperCase()}`\n          }\n        ]\n      },\n      {\n        type: 'section',\n        text: {\n          type: 'mrkdwn',\n          text: `*${optimization.title}*`\n        }\n      }\n    ]\n  };\n\n  if (optimization.status === 'success' && optimization.actualSavings) {\n    message.blocks.splice(2, 0, {\n      type: 'section',\n      text: {\n        type: 'mrkdwn',\n        text: `üí∞ *Monthly Savings Realized:* $${optimization.actualSavings.toLocaleString()}`\n      }\n    });\n  }\n\n  return await sendSlackMessage(message);\n}\n","size_bytes":4359},"runtimeInjector.js":{"content":"import fs from \"fs\";\nimport path from \"path\";\nimport dotenv from \"dotenv\";\n\nconst envPath = \".env\";\ndotenv.config({ path: envPath });\n\nconst DCL_URL = process.env.DCL_URL || \"/api/unified_data\";\nconst targetFiles = [\n  \"server.js\",\n  \"index.js\",\n  \"src/App.jsx\",\n  \"src/main.jsx\",\n  \"public/index.html\"\n].filter(f => fs.existsSync(f));\n\nconsole.log(`üß† FinOpsInjector: using DCL_URL=${DCL_URL}`);\n\nfor (const file of targetFiles) {\n  let content = fs.readFileSync(file, \"utf-8\");\n\n  // Patch any hard-coded /api/unified_data or placeholder URLs\n  const replaced = content.replace(\n    /([\"'`])\\/api\\/unified_data\\1|https:\\/\\/[^\\s'\"]*\\/api\\/unified_data/g,\n    `\"${DCL_URL}\"`\n  );\n\n  if (replaced !== content) {\n    fs.writeFileSync(file, replaced, \"utf-8\");\n    console.log(`ü©µ Patched endpoint in ${file}`);\n  } else {\n    console.log(`‚ÑπÔ∏è No patch needed in ${file}`);\n  }\n}\n\nconsole.log(\"‚úÖ Runtime injection complete. FinOpsPilot now aligned with .env.\");\n","size_bytes":968},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"server/services/aws.ts":{"content":"import AWS from 'aws-sdk';\n\nexport class AWSService {\n  private costExplorer?: AWS.CostExplorer;\n  private cloudWatch?: AWS.CloudWatch;\n  private redshift?: AWS.Redshift;\n  private support?: AWS.Support;\n  private s3?: AWS.S3;\n  private initialized = false;\n  private initializationFailed = false;\n  private lastInitAttempt = 0;\n\n  constructor() {\n    // Don't instantiate AWS clients in constructor - use lazy initialization\n  }\n\n  private hasAWSCredentials(): boolean {\n    return !!(process.env.AWS_ACCESS_KEY_ID && process.env.AWS_SECRET_ACCESS_KEY);\n  }\n\n  /**\n   * Layer 3 Defense: Centralized guard for AWS client availability\n   * Returns true if clients are ready, false otherwise\n   * NEVER throws - safe to call from any context\n   */\n  private isReady(): boolean {\n    // First check: already initialized and all clients exist\n    if (this.initialized && this.costExplorer && this.cloudWatch && this.redshift && this.support && this.s3) {\n      return true;\n    }\n    \n    // Second check: if initialization previously failed, don't retry immediately (cooldown: 30 seconds)\n    const now = Date.now();\n    if (this.initializationFailed && (now - this.lastInitAttempt) < 30000) {\n      return false;\n    }\n    \n    // Third check: try to initialize if credentials available\n    if (!this.initialized && this.hasAWSCredentials()) {\n      this.lastInitAttempt = now;\n      this.initializeClients(); // Never throws\n      return this.initialized;\n    }\n    \n    // Final fallback: not ready (no credentials or initialization failed)\n    return false;\n  }\n\n  /**\n   * Layer 3 Defense: Initialize AWS clients - NEVER throws\n   * Sets initialized=true on success, initializationFailed=true on failure\n   */\n  private initializeClients() {\n    if (this.initialized) return;\n\n    try {\n      if (!this.hasAWSCredentials()) {\n        // Layer 3 Defense: Gracefully handle missing credentials\n        const simulationMode = process.env.SIMULATION_MODE?.toLowerCase() === 'true';\n        console.warn(`‚ö†Ô∏è  [AWS Service] No credentials available${simulationMode ? ' (simulation mode enabled)' : ''} - AWS clients not initialized`);\n        this.initializationFailed = true;\n        return; // Graceful exit - DO NOT THROW\n      }\n\n      // Configure AWS SDK only when we have credentials\n      AWS.config.update({\n        accessKeyId: process.env.AWS_ACCESS_KEY_ID,\n        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\n        region: process.env.AWS_REGION || 'us-east-1'\n      });\n\n      this.costExplorer = new AWS.CostExplorer({ region: 'us-east-1' });\n      this.cloudWatch = new AWS.CloudWatch();\n      this.redshift = new AWS.Redshift();\n      this.support = new AWS.Support({ region: 'us-east-1' });\n      this.s3 = new AWS.S3();\n      this.initialized = true;\n      this.initializationFailed = false;\n      console.log('‚úÖ [AWS Service] AWS clients initialized successfully');\n    } catch (error) {\n      console.error('‚ö†Ô∏è  [AWS Service] Failed to initialize AWS clients:', error);\n      this.initializationFailed = true;\n      // DO NOT THROW - graceful failure\n    }\n  }\n\n  async getCostAndUsageReports(startDate: string, endDate: string) {\n    // Layer 3 Defense: Centralized guard - never throws\n    if (!this.isReady()) {\n      console.warn('‚ö†Ô∏è  [AWS Service] getCostAndUsageReports - clients not available, returning empty array');\n      return [];\n    }\n    \n    try {\n      const params = {\n        TimePeriod: {\n          Start: startDate,\n          End: endDate\n        },\n        Granularity: 'DAILY',\n        Metrics: ['BlendedCost', 'UsageQuantity'],\n        GroupBy: [\n          {\n            Type: 'DIMENSION',\n            Key: 'SERVICE'\n          }\n        ]\n      };\n\n      const result = await this.costExplorer.getCostAndUsage(params).promise();\n      return result.ResultsByTime || [];\n    } catch (error) {\n      console.error('Error fetching cost and usage reports:', error);\n      throw error;\n    }\n  }\n\n  async getCloudWatchMetrics(resourceId: string, metricName: string, namespace: string, startTime: Date, endTime: Date) {\n    // Layer 3 Defense: Centralized guard - never throws\n    if (!this.isReady()) {\n      console.warn('‚ö†Ô∏è  [AWS Service] getCloudWatchMetrics - clients not available, returning empty array');\n      return [];\n    }\n    \n    try {\n      const params = {\n        MetricName: metricName,\n        Namespace: namespace,\n        StartTime: startTime,\n        EndTime: endTime,\n        Period: 3600, // 1 hour\n        Statistics: ['Average', 'Maximum'],\n        Dimensions: [\n          {\n            Name: 'DBInstanceIdentifier',\n            Value: resourceId\n          }\n        ]\n      };\n\n      const result = await this.cloudWatch.getMetricStatistics(params).promise();\n      return result.Datapoints || [];\n    } catch (error) {\n      console.error('Error fetching CloudWatch metrics:', error);\n      throw error;\n    }\n  }\n\n  async getTrustedAdvisorChecks() {\n    // Layer 3 Defense: Centralized guard - never throws\n    if (!this.isReady()) {\n      console.warn('‚ö†Ô∏è  [AWS Service] getTrustedAdvisorChecks - clients not available, returning empty array');\n      return [];\n    }\n    \n    try {\n      const checks = await this.support.describeTrustedAdvisorChecks({ language: 'en' }).promise();\n      \n      const costOptimizationChecks = checks.checks.filter(check => \n        check.category === 'cost_optimizing'\n      );\n\n      const results = [];\n      for (const check of costOptimizationChecks) {\n        try {\n          const checkResult = await this.support.describeTrustedAdvisorCheckResult({\n            checkId: check.id,\n            language: 'en'\n          }).promise();\n          \n          results.push({\n            checkId: check.id,\n            name: check.name,\n            description: check.description,\n            category: check.category,\n            result: checkResult.result\n          });\n        } catch (error) {\n          console.error(`Error fetching Trusted Advisor check ${check.id}:`, error);\n        }\n      }\n\n      return results;\n    } catch (error) {\n      console.error('Error fetching Trusted Advisor checks:', error);\n      throw error;\n    }\n  }\n\n  async getRedshiftClusters() {\n    // Layer 3 Defense: Centralized guard - never throws\n    if (!this.isReady()) {\n      console.warn('‚ö†Ô∏è  [AWS Service] getRedshiftClusters - clients not available, returning empty array');\n      return [];\n    }\n    \n    try {\n      const result = await this.redshift.describeClusters().promise();\n      return result.Clusters || [];\n    } catch (error) {\n      console.error('Error fetching Redshift clusters:', error);\n      throw error;\n    }\n  }\n\n  async resizeRedshiftCluster(clusterIdentifier: string, nodeType: string, numberOfNodes: number) {\n    // Layer 3 Defense: Centralized guard - throw for mutating operations\n    if (!this.isReady()) {\n      throw new Error('Cannot resize Redshift cluster - AWS credentials not available');\n    }\n    \n    try {\n      const params = {\n        ClusterIdentifier: clusterIdentifier,\n        NodeType: nodeType,\n        NumberOfNodes: numberOfNodes\n      };\n\n      const result = await this.redshift.resizeCluster(params).promise();\n      return result.Cluster;\n    } catch (error) {\n      console.error('Error resizing Redshift cluster:', error);\n      throw error;\n    }\n  }\n\n  async getRedshiftClusterUtilization(clusterIdentifier: string, startTime: Date, endTime: Date) {\n    // Layer 3 Defense: Centralized guard - never throws\n    if (!this.isReady()) {\n      console.warn('‚ö†Ô∏è  [AWS Service] getRedshiftClusterUtilization - clients not available, returning empty utilization');\n      return { cpuUtilization: [] };\n    }\n    \n    try {\n      const cpuParams = {\n        MetricName: 'CPUUtilization',\n        Namespace: 'AWS/Redshift',\n        StartTime: startTime,\n        EndTime: endTime,\n        Period: 3600,\n        Statistics: ['Average'],\n        Dimensions: [\n          {\n            Name: 'ClusterIdentifier',\n            Value: clusterIdentifier\n          }\n        ]\n      };\n\n      const cpuMetrics = await this.cloudWatch.getMetricStatistics(cpuParams).promise();\n      \n      return {\n        cpuUtilization: cpuMetrics.Datapoints || []\n      };\n    } catch (error) {\n      console.error('Error fetching Redshift cluster utilization:', error);\n      throw error;\n    }\n  }\n\n  async analyzeRedshiftClusterOptimization(clusterIdentifier: string) {\n    // Layer 3 Defense: Centralized guard - never throws\n    if (!this.isReady()) {\n      console.warn('‚ö†Ô∏è  [AWS Service] analyzeRedshiftClusterOptimization - clients not available, returning no recommendation');\n      return { cluster: null, utilization: 0, recommendation: null };\n    }\n    \n    try {\n      // Get cluster details (safe to call - isReady() already passed)\n      const clusters = await this.getRedshiftClusters();\n      const cluster = clusters.find(c => c.ClusterIdentifier === clusterIdentifier);\n      \n      if (!cluster) {\n        throw new Error(`Cluster ${clusterIdentifier} not found`);\n      }\n\n      // Get utilization data for the last 30 days\n      const endTime = new Date();\n      const startTime = new Date();\n      startTime.setDate(startTime.getDate() - 30);\n\n      const utilization = await this.getRedshiftClusterUtilization(clusterIdentifier, startTime, endTime);\n      \n      // Calculate average utilization\n      const avgCpuUtilization = utilization.cpuUtilization.reduce((sum, point) => \n        sum + (point.Average || 0), 0) / utilization.cpuUtilization.length;\n\n      // Determine if optimization is needed\n      const isUnderUtilized = avgCpuUtilization < 40; // Less than 40% average CPU\n      \n      let recommendation = null;\n      if (isUnderUtilized) {\n        // Suggest smaller instance type\n        const currentNodeType = cluster.NodeType;\n        let recommendedNodeType = currentNodeType;\n        \n        // Simple node type downgrade logic\n        if (currentNodeType?.includes('16xlarge')) {\n          recommendedNodeType = currentNodeType.replace('16xlarge', '4xlarge');\n        } else if (currentNodeType?.includes('8xlarge')) {\n          recommendedNodeType = currentNodeType.replace('8xlarge', '2xlarge');\n        } else if (currentNodeType?.includes('4xlarge')) {\n          recommendedNodeType = currentNodeType.replace('4xlarge', 'xlarge');\n        }\n\n        if (recommendedNodeType !== currentNodeType) {\n          recommendation = {\n            type: 'resize',\n            currentNodeType,\n            recommendedNodeType,\n            currentNodes: cluster.NumberOfNodes,\n            recommendedNodes: cluster.NumberOfNodes,\n            avgUtilization: avgCpuUtilization,\n            projectedSavings: this.calculateRedshiftSavings(currentNodeType || '', recommendedNodeType || '', cluster.NumberOfNodes || 1)\n          };\n        }\n      }\n\n      return {\n        cluster,\n        utilization: avgCpuUtilization,\n        recommendation\n      };\n    } catch (error) {\n      console.error('Error analyzing Redshift cluster optimization:', error);\n      throw error;\n    }\n  }\n\n  private calculateRedshiftSavings(currentNodeType: string, recommendedNodeType: string, numberOfNodes: number) {\n    // Simplified pricing calculation (should use actual AWS pricing API)\n    const pricing: { [key: string]: number } = {\n      'ra3.xlarge': 3.26,\n      'ra3.2xlarge': 6.52,\n      'ra3.4xlarge': 13.04,\n      'ra3.16xlarge': 52.16\n    };\n\n    const currentHourlyCost = (pricing[currentNodeType] || 0) * numberOfNodes;\n    const recommendedHourlyCost = (pricing[recommendedNodeType] || 0) * numberOfNodes;\n    \n    const hourlySavings = currentHourlyCost - recommendedHourlyCost;\n    const monthlySavings = hourlySavings * 24 * 30;\n    const annualSavings = monthlySavings * 12;\n\n    return {\n      hourly: hourlySavings,\n      monthly: monthlySavings,\n      annual: annualSavings\n    };\n  }\n}\n\nexport const awsService = new AWSService();\n","size_bytes":11935},"client/src/components/layout/sidebar.tsx":{"content":"import { Activity, Bot, ChartLine, Cog, Shield, Lightbulb, BarChart3, Presentation, HelpCircle, X } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface SidebarProps {\n  isMobileOpen?: boolean;\n  onClose?: () => void;\n}\n\nexport function Sidebar({ isMobileOpen = false, onClose }: SidebarProps) {\n  const [location] = useLocation();\n  \n  const isActive = (path: string) => location === path;\n  \n  // Get user role from localStorage\n  const getUserRole = () => {\n    try {\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\n      return user.role;\n    } catch {\n      return null;\n    }\n  };\n  \n  const isAdmin = getUserRole() === 'admin';\n  \n  const handleLinkClick = () => {\n    if (onClose) {\n      onClose();\n    }\n  };\n  \n  return (\n    <>\n      {/* Mobile backdrop */}\n      {isMobileOpen && (\n        <div \n          className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n          onClick={(e) => {\n            e.stopPropagation();\n            onClose?.();\n          }}\n          data-testid=\"sidebar-backdrop\"\n        />\n      )}\n      \n      {/* Sidebar */}\n      <aside \n        className={`\n          fixed lg:static inset-y-0 left-0 z-50 w-64 bg-card border-r border-border flex-shrink-0 \n          transition-transform duration-300 ease-in-out\n          ${isMobileOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n        `}\n        onClick={(e) => e.stopPropagation()}\n        data-testid=\"sidebar\"\n      >\n        {/* Mobile close button */}\n        <div className=\"lg:hidden flex justify-end p-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onClose}\n            data-testid=\"button-close-sidebar\"\n          >\n            <X className=\"w-5 h-5\" />\n          </Button>\n        </div>\n        \n        <nav className=\"px-4 pt-0 lg:pt-4 pb-4\">\n        {/* Executive Section */}\n        <div className=\"mb-6\">\n          <h3 className=\"px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n            Executive\n          </h3>\n          <ul className=\"space-y-2\">\n            <li>\n              <Link \n                href=\"/executive\"\n                onClick={handleLinkClick}\n                className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                  isActive('/executive') \n                    ? 'bg-primary text-primary-foreground shadow-sm' \n                    : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                }`}\n                data-testid=\"nav-executive\"\n              >\n                <Presentation className=\"w-5 h-5 mr-3\" />\n                Executive Dashboard\n              </Link>\n            </li>\n          </ul>\n        </div>\n\n        {/* Operations Section */}\n        <div className=\"mb-6\">\n          <h3 className=\"px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n            Operations\n          </h3>\n          <ul className=\"space-y-2\">\n            <li>\n              <Link \n                href=\"/\"\n                onClick={handleLinkClick}\n                className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                  isActive('/') \n                    ? 'bg-primary text-primary-foreground shadow-sm' \n                    : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                }`}\n                data-testid=\"nav-dashboard\"\n              >\n                <BarChart3 className=\"w-5 h-5 mr-3\" />\n                Dashboard\n              </Link>\n            </li>\n            <li>\n              <Link \n                href=\"/cost-analysis\"\n                onClick={handleLinkClick}\n                className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                  isActive('/cost-analysis') \n                    ? 'bg-primary text-primary-foreground shadow-sm' \n                    : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                }`}\n                data-testid=\"nav-cost-analysis\"\n              >\n                <ChartLine className=\"w-5 h-5 mr-3\" />\n                Cost Analysis\n              </Link>\n            </li>\n            <li>\n              <Link \n                href=\"/recommendations\"\n                onClick={handleLinkClick}\n                className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                  isActive('/recommendations') \n                    ? 'bg-primary text-primary-foreground shadow-sm' \n                    : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                }`}\n                data-testid=\"nav-recommendations\"\n              >\n                <Lightbulb className=\"w-5 h-5 mr-3\" />\n                Recommendations\n              </Link>\n            </li>\n          </ul>\n        </div>\n\n        {/* Automation & Governance Section */}\n        <div className=\"mb-6\">\n          <h3 className=\"px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n            Automation & Governance\n          </h3>\n          <ul className=\"space-y-2\">\n            <li>\n              <Link \n                href=\"/automation\"\n                onClick={handleLinkClick}\n                className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                  isActive('/automation') \n                    ? 'bg-primary text-primary-foreground shadow-sm' \n                    : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                }`}\n                data-testid=\"nav-automation\"\n              >\n                <Cog className=\"w-5 h-5 mr-3\" />\n                Automation\n              </Link>\n            </li>\n            <li>\n              <Link \n                href=\"/governance\"\n                onClick={handleLinkClick}\n                className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                  isActive('/governance') \n                    ? 'bg-primary text-primary-foreground shadow-sm' \n                    : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                }`}\n                data-testid=\"nav-governance\"\n              >\n                <Shield className=\"w-5 h-5 mr-3\" />\n                Governance\n              </Link>\n            </li>\n          </ul>\n        </div>\n\n        {/* Agent Configuration Section - Only visible to admins */}\n        {isAdmin && (\n          <div className=\"mb-6\">\n            <h3 className=\"px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n              AI Configuration\n            </h3>\n            <ul className=\"space-y-2\">\n              <li>\n                <Link \n                  href=\"/agent-config\"\n                  onClick={handleLinkClick}\n                  className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                    isActive('/agent-config') \n                      ? 'bg-primary text-primary-foreground shadow-sm' \n                      : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                  }`}\n                  data-testid=\"nav-agent-config\"\n                >\n                  <Bot className=\"w-5 h-5 mr-3\" />\n                  Agent Config\n                </Link>\n              </li>\n            </ul>\n          </div>\n        )}\n\n        {/* Help Section */}\n        <div className=\"mb-6\">\n          <h3 className=\"px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n            Help\n          </h3>\n          <ul className=\"space-y-2\">\n            <li>\n              <Link \n                href=\"/faq\"\n                onClick={handleLinkClick}\n                className={`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${\n                  isActive('/faq') \n                    ? 'bg-primary text-primary-foreground shadow-sm' \n                    : 'text-muted-foreground hover:bg-muted hover:text-foreground'\n                }`}\n                data-testid=\"nav-faq\"\n              >\n                <HelpCircle className=\"w-5 h-5 mr-3\" />\n                FAQ\n              </Link>\n            </li>\n          </ul>\n        </div>\n        \n        <div className=\"mt-8\">\n          <h3 className=\"px-3 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">AWS Services</h3>\n          <ul className=\"mt-3 space-y-2\">\n            <li>\n              <div className=\"flex items-center px-3 py-1 text-sm text-muted-foreground\">\n                <div className=\"w-2 h-2 bg-accent rounded-full mr-3 animate-pulse\"></div>\n                Cost & Usage Reports\n              </div>\n            </li>\n            <li>\n              <div className=\"flex items-center px-3 py-1 text-sm text-muted-foreground\">\n                <div className=\"w-2 h-2 bg-accent rounded-full mr-3 animate-pulse\"></div>\n                CloudWatch\n              </div>\n            </li>\n            <li>\n              <div className=\"flex items-center px-3 py-1 text-sm text-muted-foreground\">\n                <div className=\"w-2 h-2 bg-accent rounded-full mr-3 animate-pulse\"></div>\n                Trusted Advisor\n              </div>\n            </li>\n          </ul>\n        </div>\n      </nav>\n    </aside>\n    </>\n  );\n}\n","size_bytes":9469},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\nimport { clearAuthAndRedirect } from \"@/lib/auth-utils\";\n\nfunction handleUnauthorized() {\n  clearAuthAndRedirect();\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    \n    // Handle authentication errors (401 or 403 with token-related messages)\n    if (res.status === 401) {\n      handleUnauthorized();\n      return;\n    }\n    \n    if (res.status === 403 && text.toLowerCase().includes('token')) {\n      console.error('[queryClient] 403 with token error - logging out');\n      handleUnauthorized();\n      return;\n    }\n    \n    // Provide user-friendly error messages for common status codes\n    if (res.status === 429) {\n      throw new Error('Rate limit exceeded. Please wait a moment before trying again.');\n    }\n    if (res.status === 403) {\n      throw new Error('Access denied. You do not have permission to access this resource.');\n    }\n    if (res.status === 404) {\n      throw new Error('Resource not found.');\n    }\n    if (res.status >= 500) {\n      throw new Error('Server error. Please try again later.');\n    }\n    \n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const token = localStorage.getItem(\"token\");\n  const headers: Record<string, string> = {};\n  \n  if (data) {\n    headers[\"Content-Type\"] = \"application/json\";\n  }\n  \n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const token = localStorage.getItem(\"token\");\n    const headers: Record<string, string> = {};\n    \n    if (token) {\n      headers[\"Authorization\"] = `Bearer ${token}`;\n    }\n\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      headers,\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    if (res.status === 401) {\n      handleUnauthorized();\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2813},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/pages/automation.tsx":{"content":"import { Sidebar } from \"@/components/layout/sidebar\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Cog, PlayCircle, PauseCircle, Clock, CheckCircle } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport default function Automation() {\n  const { agentConfig, updateProdMode } = useAgentConfig();\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n  const automationRules = [\n    {\n      id: 1,\n      name: \"Auto-scale EC2 instances\",\n      description: \"Automatically resize EC2 instances based on utilization\",\n      enabled: true,\n      schedule: \"Hourly\",\n      lastRun: \"2 hours ago\",\n      status: \"Active\"\n    },\n    {\n      id: 2,\n      name: \"Shutdown dev environments\",\n      description: \"Automatically stop development resources after hours\",\n      enabled: true,\n      schedule: \"Daily at 6 PM\",\n      lastRun: \"Yesterday\",\n      status: \"Active\"\n    },\n    {\n      id: 3,\n      name: \"RDS backup optimization\",\n      description: \"Optimize backup retention for non-production databases\",\n      enabled: false,\n      schedule: \"Weekly\",\n      lastRun: \"Never\",\n      status: \"Disabled\"\n    },\n    {\n      id: 4,\n      name: \"S3 lifecycle policies\",\n      description: \"Move objects to cheaper storage classes automatically\",\n      enabled: true,\n      schedule: \"Daily\",\n      lastRun: \"4 hours ago\",\n      status: \"Active\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <TopNav \n        lastSync=\"5 min ago\"\n        prodMode={agentConfig?.prodMode || false}\n        onProdModeChange={updateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n        \n        <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Automation</h1>\n          <p className=\"text-muted-foreground\">\n            Automated cost optimization rules and policies\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Active Rules</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">3</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Currently running\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Disabled Rules</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">1</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Needs attention\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Executions Today</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">24</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Automated actions\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle>Automation Rules</CardTitle>\n              <Button>\n                <Cog className=\"w-4 h-4 mr-2\" />\n                Create Rule\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {automationRules.map((rule) => (\n                <div key={rule.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-3 mb-2\">\n                      <h3 className=\"font-medium\">{rule.name}</h3>\n                      <Badge variant={rule.status === 'Active' ? 'default' : 'secondary'}>\n                        {rule.status}\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground mb-2\">{rule.description}</p>\n                    <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                      <div className=\"flex items-center gap-1\">\n                        <Clock className=\"w-3 h-3\" />\n                        {rule.schedule}\n                      </div>\n                      <div>Last run: {rule.lastRun}</div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-3\">\n                    <Switch \n                      checked={rule.enabled}\n                      data-testid={`toggle-automation-${rule.id}`}\n                    />\n                    <Button variant=\"outline\" size=\"sm\">\n                      Configure\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Recent Activity</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-3 text-sm\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                <span className=\"text-muted-foreground\">2 hours ago</span>\n                <span>Scaled down 3 EC2 instances (t3.medium ‚Üí t3.small)</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">$45/month saved</Badge>\n              </div>\n              <div className=\"flex items-center gap-3 text-sm\">\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                <span className=\"text-muted-foreground\">4 hours ago</span>\n                <span>Applied S3 lifecycle policy to 15 buckets</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">$120/month saved</Badge>\n              </div>\n              <div className=\"flex items-center gap-3 text-sm\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                <span className=\"text-muted-foreground\">Yesterday</span>\n                <span>Stopped 8 development resources after hours</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">$200/month saved</Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n          </div>\n        </div>\n      </main>\n      </div>\n    </div>\n  );\n}","size_bytes":7186},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/dashboard/activity-feed.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Bot, Clock, TrendingUp } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { OptimizationHistory } from \"@shared/schema\";\n\nexport function ActivityFeed() {\n  const { data: history, isLoading } = useQuery<OptimizationHistory[]>({\n    queryKey: ['/api/optimization-history'],\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Recent Activity</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"animate-pulse flex items-start space-x-3 p-3 bg-muted rounded-lg\">\n                <div className=\"w-8 h-8 bg-muted-foreground/20 rounded-full\"></div>\n                <div className=\"flex-1 space-y-2\">\n                  <div className=\"h-4 bg-muted-foreground/20 rounded w-3/4\"></div>\n                  <div className=\"h-3 bg-muted-foreground/20 rounded w-1/2\"></div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!history || history.length === 0) {\n    return (\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-lg font-semibold text-foreground\">Recent Activity</CardTitle>\n            <Button variant=\"ghost\" size=\"sm\" className=\"text-primary text-sm hover:underline\">\n              View All\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8\">\n            <Clock className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <p className=\"text-muted-foreground\">No recent activity</p>\n            <p className=\"text-sm text-muted-foreground mt-2\">Optimization activities will appear here</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const getStatusBadge = (status: string, actualSavings?: number) => {\n    switch (status) {\n      case 'success':\n        return (\n          <Badge className=\"bg-accent text-accent-foreground\" data-testid=\"status-success\">\n            {actualSavings ? `${formatCurrencyK(actualSavings)}/mo saved` : '$0 K/mo saved'}\n          </Badge>\n        );\n      case 'approved':\n        return (\n          <Badge className=\"bg-blue-500 text-white\" data-testid=\"status-approved\">\n            APPROVED\n          </Badge>\n        );\n      case 'in-progress':\n        return <Badge variant=\"secondary\">IN PROGRESS</Badge>;\n      case 'failed':\n        return <Badge variant=\"destructive\">FAILED</Badge>;\n      default:\n        return <Badge variant=\"outline\">UNKNOWN</Badge>;\n    }\n  };\n\n  const getActivityIcon = (status: string) => {\n    switch (status) {\n      case 'success':\n        return <Bot className=\"text-accent text-sm\" />;\n      case 'approved':\n        return <TrendingUp className=\"text-blue-500 text-sm\" />;\n      case 'in-progress':\n        return <Clock className=\"text-chart-3 text-sm\" />;\n      case 'failed':\n        return <TrendingUp className=\"text-destructive text-sm\" />;\n      default:\n        return <Bot className=\"text-muted-foreground text-sm\" />;\n    }\n  };\n\n  const getActivityBgColor = (status: string) => {\n    switch (status) {\n      case 'success':\n        return 'bg-accent/5';\n      case 'approved':\n        return 'bg-blue-50 dark:bg-blue-950/20';\n      case 'in-progress':\n        return 'bg-chart-3/5';\n      case 'failed':\n        return 'bg-destructive/5';\n      default:\n        return 'bg-muted/30';\n    }\n  };\n\n  return (\n    <Card data-testid=\"activity-feed\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-semibold text-foreground\">Recent Activity</CardTitle>\n          <Button variant=\"ghost\" size=\"sm\" className=\"text-primary text-sm hover:underline\">\n            View All\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          {history.slice(0, 5).map((item, index) => (\n            <div \n              key={item.id} \n              className={`flex items-start space-x-3 p-3 ${getActivityBgColor(item.status)} rounded-lg transition-colors hover:bg-opacity-80`}\n              data-testid={`activity-item-${index}`}\n            >\n              <Avatar className=\"w-8 h-8 flex-shrink-0 mt-1\">\n                <AvatarFallback className={`${item.status === 'success' ? 'bg-accent' : item.status === 'approved' ? 'bg-blue-500' : item.status === 'failed' ? 'bg-destructive' : 'bg-chart-3'} text-white`}>\n                  {getActivityIcon(item.status)}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium text-foreground\" data-testid={`activity-title-${index}`}>\n                  {item.status === 'success' ? 'Optimization Completed' : \n                   item.status === 'approved' ? 'Optimization Approved' :\n                   item.status === 'failed' ? 'Optimization Failed' : 'Optimization In Progress'}\n                </p>\n                <p className=\"text-sm text-muted-foreground\" data-testid={`activity-description-${index}`}>\n                  Resource optimization executed for {JSON.stringify(item.beforeConfig).substring(0, 50)}...\n                </p>\n                <div className=\"flex items-center justify-between mt-2\">\n                  <span className=\"text-xs text-muted-foreground\" data-testid={`activity-time-${index}`}>\n                    {formatDistanceToNow(new Date(item.createdAt), { addSuffix: true })}\n                  </span>\n                  {getStatusBadge(item.status, item.actualSavings ?? undefined)}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":6276},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"server/services/scheduler.ts":{"content":"import cron from 'node-cron';\nimport { awsService } from './aws';\nimport { sendOptimizationRecommendation, sendOptimizationComplete } from './slack';\nimport { storage } from '../storage';\nimport { configService } from './config';\nimport { geminiAI } from './gemini-ai';\nimport { syntheticDataGenerator } from './synthetic-data';\n\n// Scheduler is a system service that operates in the default tenant context\nconst SYSTEM_TENANT_ID = 'default-tenant';\n\nexport class SchedulerService {\n  private continuousSimulationInterval: NodeJS.Timeout | null = null;\n  private isSimulationRunning: boolean = false;\n  private simulationCycleCount: number = 0;\n\n  constructor() {\n    // NOTE: Cron job registration moved to initialize() to prevent race condition\n    // where jobs fire before config is loaded\n  }\n\n  async initialize() {\n    await this.initializeConfiguration();\n    await this.initializeSyntheticData();\n    this.initializeScheduledTasks(); // Now safe - config is loaded\n    this.startContinuousSimulation();\n  }\n\n  private async initializeConfiguration() {\n    try {\n      await configService.initializeDefaults();\n      console.log('‚úÖ Agent configuration initialized');\n    } catch (error) {\n      console.error('‚ùå Failed to initialize agent configuration:', error);\n    }\n  }\n\n  private async initializeSyntheticData() {\n    try {\n      const config = await configService.getAgentConfig();\n      if (config.simulationMode) {\n        console.log('üìä Simulation Mode is ON - initializing synthetic dataset...');\n        await syntheticDataGenerator.generateInitialDataset();\n        \n        // Check if cost reports exist - if not, generate them\n        const existingReports = await storage.getCostReports(SYSTEM_TENANT_ID);\n        if (existingReports.length === 0) {\n          console.log('üìà No cost reports found - generating historical cost data...');\n          const { DataGenerator } = await import('./data-generator.js');\n          const generator = new DataGenerator(storage);\n          await generator.generateCostData();\n          console.log('‚úÖ Historical cost data generated (6 months)');\n        }\n      }\n    } catch (error) {\n      console.error('‚ùå Failed to initialize synthetic data:', error);\n    }\n  }\n\n  private startContinuousSimulation() {\n    console.log('‚ö° Demo Mode Active ‚Äî 3s scan interval');\n    console.log('üí∞ Enterprise-scale monetary values (millions in savings)');\n    \n    this.continuousSimulationInterval = setInterval(async () => {\n      // Guard against overlapping executions\n      if (this.isSimulationRunning) {\n        return;\n      }\n\n      this.isSimulationRunning = true;\n      try {\n        const config = await configService.getAgentConfig();\n        if (config.simulationMode) {\n          // Evolve resource utilization data\n          await syntheticDataGenerator.evolveResources();\n          \n          // Increment cycle counter\n          this.simulationCycleCount++;\n          \n          // Generate heuristic recommendations every cycle (3s)\n          await this.generateHeuristicRecommendations();\n        }\n      } catch (error) {\n        console.error('Error in continuous simulation loop:', error);\n      } finally {\n        this.isSimulationRunning = false;\n      }\n    }, 3000);\n  }\n\n  private initializeScheduledTasks() {\n    // NOTE: Continuous simulation loop now handles real-time synthetic data evolution (every 5s)\n    // The 30-minute cron has been replaced with continuous simulation\n    \n    // Resource analysis every 6 hours - checks Prod Mode to decide AI vs Heuristics\n    cron.schedule('0 */6 * * *', async () => {\n      await this.runResourceAnalysis();\n    });\n\n    // Sync cost data daily at 2 AM\n    cron.schedule('0 2 * * *', async () => {\n      console.log('Running daily cost data sync...');\n      await this.syncCostData();\n    });\n\n    // Check Trusted Advisor recommendations weekly\n    cron.schedule('0 3 * * 0', async () => {\n      console.log('Running weekly Trusted Advisor check...');\n      await this.checkTrustedAdvisor();\n    });\n  }\n\n  // Determines which analysis method to use based on Prod Mode configuration\n  private async runResourceAnalysis() {\n    // Layer 2 Defense: Check environment variable first (bootstrap failsafe)\n    const envSimulationMode = process.env.SIMULATION_MODE?.toLowerCase() === 'true';\n    if (envSimulationMode) {\n      console.log('‚ö° [ENV:SIMULATION_MODE] Skipping AWS analysis - using continuous simulation loop');\n      return;\n    }\n    \n    const config = await configService.getAgentConfig();\n    \n    // Skip AWS API calls if simulation mode is enabled\n    if (config.simulationMode) {\n      console.log('‚ö° [SIMULATION MODE] Skipping AWS analysis - using continuous simulation loop');\n      return;\n    }\n    \n    if (config.prodMode) {\n      console.log('üöÄ [PROD MODE ON] Running AI-powered analysis with Gemini 2.5 Flash + RAG...');\n      await this.analyzeWithAI();\n    } else {\n      console.log('‚öôÔ∏è [PROD MODE OFF] Running heuristics-based analysis...');\n      await this.analyzeAWSResources();\n    }\n  }\n\n  private async analyzeAWSResources() {\n    try {\n      // Analyze Redshift clusters\n      const clusters = await awsService.getRedshiftClusters();\n      \n      for (const cluster of clusters) {\n        if (!cluster.ClusterIdentifier) continue;\n        \n        const analysis = await awsService.analyzeRedshiftClusterOptimization(cluster.ClusterIdentifier);\n        \n        if (analysis.recommendation) {\n          // Check if we already have a pending recommendation for this resource\n          const existingRecommendations = await storage.getRecommendations(SYSTEM_TENANT_ID, 'pending');\n          const hasExisting = existingRecommendations.some(r => r.resourceId === cluster.ClusterIdentifier);\n          \n          if (!hasExisting) {\n            // Create new recommendation\n            const riskLevel = analysis.recommendation.avgUtilization < 25 ? 5 : 10;\n            const recommendation = await storage.createRecommendation({\n              tenantId: SYSTEM_TENANT_ID,\n              resourceId: cluster.ClusterIdentifier,\n              type: 'resize',\n              priority: analysis.recommendation.avgUtilization < 25 ? 'critical' : 'high',\n              title: 'Redshift Cluster Over-provisioned',\n              description: `Cluster running at ${analysis.recommendation.avgUtilization.toFixed(1)}% average utilization. Recommend resizing from ${analysis.recommendation.currentNodeType} to ${analysis.recommendation.recommendedNodeType}.`,\n              currentConfig: {\n                nodeType: analysis.recommendation.currentNodeType,\n                numberOfNodes: analysis.recommendation.currentNodes,\n                utilization: analysis.recommendation.avgUtilization\n              },\n              recommendedConfig: {\n                nodeType: analysis.recommendation.recommendedNodeType,\n                numberOfNodes: analysis.recommendation.recommendedNodes\n              },\n              projectedMonthlySavings: Number(analysis.recommendation.projectedSavings.monthly),\n              riskLevel: riskLevel,\n              executionMode: riskLevel <= 5 ? 'autonomous' : 'hitl'\n            }, SYSTEM_TENANT_ID);\n\n            // Check if we can execute autonomously\n            const canExecuteAutonomously = await configService.canExecuteAutonomously({\n              type: recommendation.type,\n              riskLevel: recommendation.riskLevel ?? 0,\n              projectedMonthlySavings: recommendation.projectedMonthlySavings\n            });\n\n            if (canExecuteAutonomously) {\n              // Execute immediately in autonomous mode\n              try {\n                await this.executeOptimization(recommendation);\n                await storage.updateRecommendationStatus(recommendation.id, 'executed', SYSTEM_TENANT_ID);\n\n                // Send Slack notification about autonomous execution\n                await sendOptimizationComplete({\n                  title: `[AUTONOMOUS] ${recommendation.title}`,\n                  resourceId: recommendation.resourceId,\n                  actualSavings: recommendation.projectedMonthlySavings,\n                  status: 'success'\n                });\n\n                console.log(`ü§ñ Autonomously executed recommendation: ${recommendation.title}`);\n              } catch (error) {\n                await storage.updateRecommendationStatus(recommendation.id, 'failed', SYSTEM_TENANT_ID);\n                \n                // Create failed optimization history entry\n                await storage.createOptimizationHistory({\n                  tenantId: SYSTEM_TENANT_ID,\n                  recommendationId: recommendation.id,\n                  executedBy: 'autonomous-agent',\n                  executionDate: new Date(),\n                  beforeConfig: recommendation.currentConfig as any,\n                  afterConfig: recommendation.recommendedConfig as any,\n                  status: 'failed',\n                  errorMessage: error instanceof Error ? error.message : String(error)\n                }, SYSTEM_TENANT_ID);\n\n                // Send failure notification\n                await sendOptimizationComplete({\n                  title: `[AUTONOMOUS] ${recommendation.title}`,\n                  resourceId: recommendation.resourceId,\n                  actualSavings: 0,\n                  status: 'failed'\n                });\n\n                console.error(`‚ùå Autonomous execution failed for ${recommendation.id}:`, error);\n              }\n            } else {\n              // Send traditional notification requiring approval\n              await sendOptimizationRecommendation({\n                title: recommendation.title,\n                description: recommendation.description,\n                resourceId: recommendation.resourceId,\n                projectedMonthlySavings: recommendation.projectedMonthlySavings,\n                priority: recommendation.priority,\n                recommendationId: recommendation.id\n              });\n            }\n          }\n        }\n\n        // Update resource in database\n        await storage.createAwsResource({\n          tenantId: SYSTEM_TENANT_ID,\n          resourceId: cluster.ClusterIdentifier,\n          resourceType: 'Redshift',\n          region: cluster.AvailabilityZone?.slice(0, -1) || 'us-east-1',\n          currentConfig: {\n            nodeType: cluster.NodeType,\n            numberOfNodes: cluster.NumberOfNodes,\n            clusterStatus: cluster.ClusterStatus\n          },\n          utilizationMetrics: {\n            avgCpuUtilization: analysis.utilization\n          },\n          monthlyCost: analysis.recommendation?.projectedSavings ? \n            (analysis.recommendation.projectedSavings.monthly * 2) : \n            undefined\n        }, SYSTEM_TENANT_ID);\n      }\n    } catch (error) {\n      console.error('Error analyzing AWS resources:', error);\n    }\n  }\n\n  // Public method to trigger analysis manually - respects Prod Mode setting\n  public async triggerAnalysis() {\n    await this.runResourceAnalysis();\n  }\n\n  // Backward compatibility: public method to trigger AI analysis manually\n  public async triggerAIAnalysis() {\n    await this.analyzeWithAI();\n  }\n\n  private async analyzeWithAI() {\n    let historyId: string | undefined;\n    const startTime = new Date();\n    \n    try {\n      console.log('‚ö° Prod Mode (RAG) triggered ‚Äì auto-revert in 5 minutes');\n      console.log('ü§ñ Starting AI-powered resource analysis with Gemini 2.5 Flash...');\n      \n      // Create AI mode history entry to track this run\n      const historyEntry = await storage.createAiModeHistory({\n        tenantId: SYSTEM_TENANT_ID,\n        startTime,\n        status: 'running',\n        summary: 'AI-powered analysis with Gemini 2.5 Flash + Pinecone RAG',\n        triggeredBy: 'user'\n      }, SYSTEM_TENANT_ID);\n      historyId = historyEntry.id;\n      \n      // Get all AWS resources from database\n      const allResources = await storage.getAllAwsResources(SYSTEM_TENANT_ID);\n      \n      if (allResources.length === 0) {\n        console.log('No resources found to analyze');\n        await storage.updateAiModeHistory(historyId, {\n          endTime: new Date(),\n          status: 'success',\n          summary: 'No resources found to analyze',\n          recommendationsGenerated: 0,\n          totalSavingsIdentified: 0\n        }, SYSTEM_TENANT_ID);\n        return;\n      }\n\n      console.log(`Analyzing ${allResources.length} resources with AI...`);\n      \n      // Use Gemini AI to analyze resources and generate recommendations\n      // Pass the history ID to link recommendations to this AI run\n      const aiRecommendations = await geminiAI.analyzeResourcesForOptimization(allResources, historyId);\n      \n      console.log(`üéØ AI generated ${aiRecommendations.length} recommendations`);\n      \n      for (const aiRec of aiRecommendations) {\n        // Check if we already have a pending recommendation for this resource\n        const existingRecommendations = await storage.getRecommendations(SYSTEM_TENANT_ID, 'pending');\n        const hasExisting = existingRecommendations.some(r => r.resourceId === aiRec.resourceId);\n        \n        if (!hasExisting) {\n          // Create new AI-powered recommendation\n          const recommendation = await storage.createRecommendation(aiRec, SYSTEM_TENANT_ID);\n          \n          console.log(`‚ú® Created AI recommendation: ${recommendation.title}`);\n\n          // Check if we can execute autonomously\n          const canExecuteAutonomously = await configService.canExecuteAutonomously({\n            type: recommendation.type,\n            riskLevel: recommendation.riskLevel ?? 0,\n            projectedMonthlySavings: recommendation.projectedMonthlySavings\n          });\n\n          if (canExecuteAutonomously) {\n            // Execute immediately in autonomous mode\n            try {\n              await this.executeOptimization(recommendation);\n              await storage.updateRecommendationStatus(recommendation.id, 'executed', SYSTEM_TENANT_ID);\n\n              // Send Slack notification about autonomous execution\n              await sendOptimizationComplete({\n                title: `[AI AUTONOMOUS] ${recommendation.title}`,\n                resourceId: recommendation.resourceId,\n                actualSavings: recommendation.projectedMonthlySavings,\n                status: 'success'\n              });\n\n              console.log(`ü§ñ AI-powered autonomous execution: ${recommendation.title}`);\n            } catch (error) {\n              await storage.updateRecommendationStatus(recommendation.id, 'failed', SYSTEM_TENANT_ID);\n              \n              // Create failed optimization history entry\n              await storage.createOptimizationHistory({\n                tenantId: SYSTEM_TENANT_ID,\n                recommendationId: recommendation.id,\n                executedBy: 'gemini-ai-agent',\n                executionDate: new Date(),\n                beforeConfig: recommendation.currentConfig as any,\n                afterConfig: recommendation.recommendedConfig as any,\n                status: 'failed',\n                errorMessage: error instanceof Error ? error.message : String(error)\n              }, SYSTEM_TENANT_ID);\n\n              console.error(`‚ùå AI autonomous execution failed for ${recommendation.id}:`, error);\n            }\n          } else {\n            // Send notification requiring approval\n            await sendOptimizationRecommendation({\n              title: `[AI] ${recommendation.title}`,\n              description: recommendation.description,\n              resourceId: recommendation.resourceId,\n              projectedMonthlySavings: recommendation.projectedMonthlySavings,\n              priority: recommendation.priority,\n              recommendationId: recommendation.id\n            });\n            \n            console.log(`üìß Sent AI recommendation for approval: ${recommendation.title}`);\n          }\n        }\n      }\n      \n      // Update AI mode history with results\n      if (historyId) {\n        const totalSavings = aiRecommendations.reduce((sum, rec) => \n          sum + (rec.projectedMonthlySavings || 0), 0\n        );\n        \n        await storage.updateAiModeHistory(historyId, {\n          endTime: new Date(),\n          status: 'success',\n          summary: `AI analysis complete: ${aiRecommendations.length} recommendations generated`,\n          recommendationsGenerated: aiRecommendations.length,\n          totalSavingsIdentified: totalSavings\n        }, SYSTEM_TENANT_ID);\n        console.log('üß† AI history updated');\n      }\n      \n      console.log('‚úÖ AI analysis completed successfully');\n    } catch (error) {\n      console.error('‚ùå Error in AI-powered analysis:', error);\n      \n      // Update AI mode history with error\n      if (historyId) {\n        await storage.updateAiModeHistory(historyId, {\n          endTime: new Date(),\n          status: 'failed',\n          errorMessage: error instanceof Error ? error.message : String(error)\n        }, SYSTEM_TENANT_ID);\n      }\n    }\n  }\n\n  private async syncCostData() {\n    try {\n      // Layer 2 Defense: Check environment variable first (bootstrap failsafe)\n      const envSimulationMode = process.env.SIMULATION_MODE?.toLowerCase() === 'true';\n      if (envSimulationMode) {\n        console.log('‚ö° [ENV:SIMULATION_MODE] Skipping AWS cost data sync - using synthetic data');\n        return;\n      }\n      \n      // Skip AWS API calls if simulation mode is enabled\n      const config = await configService.getAgentConfig();\n      if (config.simulationMode) {\n        console.log('‚ö° [SIMULATION MODE] Skipping AWS cost data sync - using synthetic data');\n        return;\n      }\n      \n      const endDate = new Date();\n      const startDate = new Date();\n      startDate.setDate(startDate.getDate() - 7); // Last 7 days\n\n      const costData = await awsService.getCostAndUsageReports(\n        startDate.toISOString().split('T')[0],\n        endDate.toISOString().split('T')[0]\n      );\n\n      for (const timeResult of costData) {\n        if (!timeResult.Groups) continue;\n        \n        const reportDate = new Date(timeResult.TimePeriod?.Start || '');\n        \n        for (const group of timeResult.Groups) {\n          const service = group.Keys?.[0] || 'Unknown';\n          const cost = parseFloat(group.Metrics?.BlendedCost?.Amount || '0');\n          const usage = parseFloat(group.Metrics?.UsageQuantity?.Amount || '0');\n          \n          if (cost > 0) {\n            await storage.createCostReport({\n              tenantId: SYSTEM_TENANT_ID,\n              reportDate,\n              serviceCategory: service,\n              cost: Math.round(cost), // Direct dollar amounts (enterprise scale)\n              usage: usage.toString(),\n              usageType: group.Metrics?.UsageQuantity?.Unit || 'Unknown',\n              region: 'us-east-1' // Default region\n            }, SYSTEM_TENANT_ID);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Error syncing cost data:', error);\n    }\n  }\n\n  private async checkTrustedAdvisor() {\n    try {\n      // Layer 2 Defense: Check environment variable first (bootstrap failsafe)\n      const envSimulationMode = process.env.SIMULATION_MODE?.toLowerCase() === 'true';\n      if (envSimulationMode) {\n        console.log('‚ö° [ENV:SIMULATION_MODE] Skipping AWS Trusted Advisor check - using synthetic data');\n        return;\n      }\n      \n      // Skip AWS API calls if simulation mode is enabled\n      const config = await configService.getAgentConfig();\n      if (config.simulationMode) {\n        console.log('‚ö° [SIMULATION MODE] Skipping AWS Trusted Advisor check - using synthetic data');\n        return;\n      }\n      \n      const checks = await awsService.getTrustedAdvisorChecks();\n      \n      for (const check of checks) {\n        if (check.result && (check.result.status === 'error' || check.result.status === 'warning')) {\n          console.log(`Trusted Advisor alert: ${check.name} - ${check.result.status}`);\n          \n          // Process flagged resources\n          if (check.result.flaggedResources) {\n            for (const resource of check.result.flaggedResources) {\n              // Create recommendations based on Trusted Advisor findings\n              // This would need more specific logic based on check type\n              console.log('Flagged resource:', resource);\n            }\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Error checking Trusted Advisor:', error);\n    }\n  }\n\n  // Heuristic recommendation generator - analyzes synthetic resources for waste\n  private async generateHeuristicRecommendations() {\n    try {\n      const config = await configService.getAgentConfig();\n      \n      // Get all resources from database\n      const resources = await storage.getAllAwsResources(SYSTEM_TENANT_ID);\n      \n      if (resources.length === 0) {\n        return;\n      }\n      \n      // Identify underutilized resources (potential waste)\n      const wastefulResources = resources.filter(resource => {\n        const metrics = resource.utilizationMetrics as any;\n        if (!metrics) return false;\n        \n        // Get utilization metrics (default to 0 if missing, treat as wasteful)\n        const cpuUtil = metrics.avgCpuUtilization ?? metrics.cpuUtilization ?? 0;\n        const memUtil = metrics.avgMemoryUtilization ?? metrics.memoryUtilization ?? 0;\n        \n        // Resource is wasteful if CPU < 30% OR Memory < 40%\n        return cpuUtil < 30 || memUtil < 40;\n      });\n      \n      if (wastefulResources.length === 0) {\n        return;\n      }\n      \n      // Generate 2-5 recommendations per cycle\n      const numRecommendations = Math.min(\n        Math.floor(Math.random() * 4) + 2, // 2-5 recommendations\n        wastefulResources.length\n      );\n      \n      // Shuffle and pick random resources\n      const shuffled = wastefulResources.sort(() => Math.random() - 0.5);\n      const selectedResources = shuffled.slice(0, numRecommendations);\n      \n      let newRecommendationsCount = 0;\n      let totalSavings = 0;\n      let autoOptimizedCount = 0;\n      let autonomousCount = 0;\n      let hitlCount = 0;\n      \n      for (const resource of selectedResources) {\n        // Check if we already have a pending recommendation for this resource\n        const existingRecommendations = await storage.getRecommendations(SYSTEM_TENANT_ID);\n        const hasExisting = existingRecommendations.some(\n          r => r.resourceId === resource.resourceId && (r.status === 'pending' || r.status === 'approved')\n        );\n        \n        if (hasExisting) {\n          continue;\n        }\n        \n        // Generate synthetic recommendation\n        const recType = ['rightsizing', 'scheduling', 'storage-tiering'][Math.floor(Math.random() * 3)] as any;\n        \n        // 80% autonomous (low-risk) / 20% HITL (medium+high risk) distribution\n        const riskRandom = Math.random();\n        const riskLevel = riskRandom < 0.80 ? 'low' : (riskRandom < 0.90 ? 'medium' : 'high');\n        const numericRiskLevel = riskLevel === 'low' ? 3 : (riskLevel === 'medium' ? 7 : 9);\n        \n        // Calculate savings based on actual resource cost\n        const resourceMonthlyCost = resource.monthlyCost || 100000; // Fallback to $100k if cost missing\n        let savingsPercentage = 0;\n        \n        if (recType === 'rightsizing') {\n          // Rightsizing: 30-60% savings (downsize underutilized resources)\n          savingsPercentage = 0.30 + Math.random() * 0.30; // 30-60%\n        } else if (recType === 'scheduling') {\n          // Scheduling: 50-70% savings (shutdown off-hours)\n          savingsPercentage = 0.50 + Math.random() * 0.20; // 50-70%\n        } else {\n          // Storage-tiering: 20-40% savings (move to cold storage)\n          savingsPercentage = 0.20 + Math.random() * 0.20; // 20-40%\n        }\n        \n        const monthlySavings = Math.round(resourceMonthlyCost * savingsPercentage);\n        \n        // Determine execution mode using configService (consistent with AI flow)\n        const executionModeResult = await configService.determineExecutionMode({\n          type: recType,\n          riskLevel: numericRiskLevel,\n          projectedMonthlySavings: monthlySavings\n        });\n        \n        const metrics = resource.utilizationMetrics as any;\n        const cpuUtil = metrics?.avgCpuUtilization || metrics?.cpuUtilization || 0;\n        const memUtil = metrics?.avgMemoryUtilization || metrics?.memoryUtilization || 0;\n        \n        // Create recommendation with calculation metadata\n        const recommendation = await storage.createRecommendation({\n          tenantId: SYSTEM_TENANT_ID,\n          resourceId: resource.resourceId,\n          type: recType,\n          priority: riskLevel === 'high' ? 'critical' : (riskLevel === 'medium' ? 'high' : 'medium'),\n          title: this.generateRecommendationTitle(recType, resource.resourceType),\n          description: this.generateRecommendationDescription(recType, cpuUtil, memUtil, monthlySavings),\n          currentConfig: resource.currentConfig as any,\n          recommendedConfig: this.generateRecommendedConfig(recType, resource),\n          projectedMonthlySavings: monthlySavings,\n          riskLevel: numericRiskLevel,\n          executionMode: executionModeResult.executionMode,\n          calculationMetadata: {\n            resourceMonthlyCost: resourceMonthlyCost,\n            savingsPercentage: savingsPercentage * 100, // Convert to percentage\n            methodology: 'Heuristics-based analysis using utilization patterns and cost data'\n          }\n        }, SYSTEM_TENANT_ID);\n        \n        newRecommendationsCount++;\n        totalSavings += monthlySavings;\n        \n        // Count autonomous vs HITL\n        if (executionModeResult.executionMode === 'autonomous') {\n          autonomousCount++;\n        } else {\n          hitlCount++;\n        }\n        \n        // Auto-execute autonomous recommendations (regardless of autonomousMode config)\n        if (executionModeResult.executionMode === 'autonomous') {\n          try {\n            await this.executeSyntheticOptimization(recommendation);\n            await storage.updateRecommendationStatus(recommendation.id, 'executed', SYSTEM_TENANT_ID);\n            autoOptimizedCount++;\n            \n            console.log(`‚úÖ Auto-executed: ${recommendation.title} (autonomous)`);\n          } catch (error) {\n            console.error(`‚ùå Auto-execution failed for ${recommendation.id}:`, error);\n            await storage.updateRecommendationStatus(recommendation.id, 'failed', SYSTEM_TENANT_ID);\n          }\n        }\n      }\n      \n      if (newRecommendationsCount > 0) {\n        console.log(`üí° ${newRecommendationsCount} Recommendation${newRecommendationsCount > 1 ? 's' : ''} (${autonomousCount} Auto | ${hitlCount} HITL)`);\n        if (autoOptimizedCount > 0) {\n          console.log(`‚úÖ ${autoOptimizedCount} Auto-Optimization${autoOptimizedCount > 1 ? 's' : ''} Executed`);\n        }\n        if (hitlCount > 0) {\n          console.log(`üïí ${hitlCount} HITL Pending Approval`);\n        }\n      }\n    } catch (error) {\n      console.error('Error generating heuristic recommendations:', error);\n    }\n  }\n  \n  private generateRecommendationTitle(type: string, resourceType: string): string {\n    const titles: Record<string, string[]> = {\n      rightsizing: [\n        `Downsize Underutilized ${resourceType} Instance`,\n        `${resourceType} Right-Sizing Opportunity`,\n        `Reduce ${resourceType} Instance Capacity`\n      ],\n      scheduling: [\n        `Enable Scheduled Shutdown for ${resourceType}`,\n        `Implement Auto-Scaling Schedule for ${resourceType}`,\n        `Add Off-Hours Scheduling to ${resourceType}`\n      ],\n      'storage-tiering': [\n        `Move ${resourceType} Data to Cold Storage`,\n        `Implement Storage Tiering for ${resourceType}`,\n        `Archive Unused ${resourceType} Data`\n      ]\n    };\n    \n    const options = titles[type] || [`Optimize ${resourceType} Configuration`];\n    return options[Math.floor(Math.random() * options.length)];\n  }\n  \n  private generateRecommendationDescription(type: string, cpuUtil: number, memUtil: number, monthlySavings: number): string {\n    const savingsFormatted = (monthlySavings / 1000).toFixed(0); // Convert to K notation\n    if (type === 'rightsizing') {\n      return `Resource running at ${cpuUtil.toFixed(1)}% CPU and ${memUtil.toFixed(1)}% memory utilization. Recommend downsizing to reduce costs by approximately $${savingsFormatted}K/month.`;\n    } else if (type === 'scheduling') {\n      return `Resource usage patterns suggest potential for scheduled shutdown during off-peak hours. Estimated savings: $${savingsFormatted}K/month.`;\n    } else {\n      return `Storage analysis indicates underutilized capacity. Implement tiering to cold storage for $${savingsFormatted}K/month savings.`;\n    }\n  }\n  \n  private generateRecommendedConfig(type: string, resource: any): any {\n    const current = resource.currentConfig || {};\n    \n    if (type === 'rightsizing') {\n      return {\n        ...current,\n        instanceSize: 'reduced',\n        recommendation: 'Downsize by 1-2 tiers'\n      };\n    } else if (type === 'scheduling') {\n      return {\n        ...current,\n        schedule: 'Mon-Fri 8AM-6PM',\n        autoShutdown: true\n      };\n    } else {\n      return {\n        ...current,\n        storageClass: 'GLACIER',\n        tieringEnabled: true\n      };\n    }\n  }\n  \n  // Execute synthetic optimization (simulation only - no real AWS changes)\n  private async executeSyntheticOptimization(recommendation: any) {\n    try {\n      // Record the optimization in history\n      await storage.createOptimizationHistory({\n        tenantId: SYSTEM_TENANT_ID,\n        recommendationId: recommendation.id,\n        executedBy: 'heuristic-autopilot',\n        executionDate: new Date(),\n        beforeConfig: recommendation.currentConfig,\n        afterConfig: recommendation.recommendedConfig,\n        actualSavings: recommendation.projectedMonthlySavings,\n        status: 'success'\n      }, SYSTEM_TENANT_ID);\n    } catch (error) {\n      // Record failed optimization\n      await storage.createOptimizationHistory({\n        tenantId: SYSTEM_TENANT_ID,\n        recommendationId: recommendation.id,\n        executedBy: 'heuristic-autopilot',\n        executionDate: new Date(),\n        beforeConfig: recommendation.currentConfig,\n        afterConfig: recommendation.recommendedConfig,\n        status: 'failed',\n        errorMessage: error instanceof Error ? error.message : String(error)\n      }, SYSTEM_TENANT_ID);\n      \n      throw error;\n    }\n  }\n\n  private async executeOptimization(recommendation: any) {\n    try {\n      let result;\n      \n      if (recommendation.type === 'resize' && recommendation.resourceId.includes('redshift')) {\n        // Execute Redshift cluster resize\n        const config = recommendation.recommendedConfig;\n        result = await awsService.resizeRedshiftCluster(\n          recommendation.resourceId,\n          config.nodeType,\n          config.numberOfNodes\n        );\n        \n        // Record the optimization in history\n        await storage.createOptimizationHistory({\n          tenantId: SYSTEM_TENANT_ID,\n          recommendationId: recommendation.id,\n          executedBy: 'autonomous-agent',\n          executionDate: new Date(),\n          beforeConfig: recommendation.currentConfig,\n          afterConfig: recommendation.recommendedConfig,\n          actualSavings: recommendation.projectedMonthlySavings,\n          status: 'success'\n        }, SYSTEM_TENANT_ID);\n      }\n      \n      return result;\n    } catch (error) {\n      // Record failed optimization\n      await storage.createOptimizationHistory({\n        tenantId: SYSTEM_TENANT_ID,\n        recommendationId: recommendation.id,\n        executedBy: 'autonomous-agent',\n        executionDate: new Date(),\n        beforeConfig: recommendation.currentConfig,\n        afterConfig: recommendation.recommendedConfig,\n        status: 'failed',\n        errorMessage: error instanceof Error ? error.message : String(error)\n      }, SYSTEM_TENANT_ID);\n\n      throw error;\n    }\n  }\n}\n\nexport const schedulerService = new SchedulerService();\n","size_bytes":32191},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"shared/schema.ts":{"content":"/**\n * MULTI-TENANT MIGRATION PLAN\n * \n * This schema implements multi-tenant data isolation for the FinOps platform.\n * All user-scoped data is isolated by tenantId to ensure data security and privacy.\n * \n * MIGRATION STRATEGY (Safe, Zero-Downtime):\n * \n * Step 1: Add Nullable TenantId Columns (THIS COMMIT)\n *   - Add tenantId as VARCHAR (nullable) to all user-scoped tables\n *   - Add tenants table with: id, name, status, createdAt\n *   - Deploy schema changes: npm run db:push --force\n *   - Application continues to work without tenantId (nullable)\n * \n * Step 2: Backfill Default Tenant (Post-Deployment)\n *   - Create default tenant: INSERT INTO tenants (id, name, status) VALUES ('default-tenant', 'Default Organization', 'active')\n *   - Backfill existing data with default tenantId:\n *     UPDATE users SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE aws_resources SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE cost_reports SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE recommendations SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE optimization_history SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE approval_requests SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE system_config SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE historical_cost_snapshots SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n *     UPDATE ai_mode_history SET tenant_id = 'default-tenant' WHERE tenant_id IS NULL;\n * \n * Step 3: Make TenantId NOT NULL (Future Commit)\n *   - Alter columns to make tenantId NOT NULL\n *   - Update insert schemas to require tenantId\n *   - Update all application code to enforce tenantId\n * \n * Step 4: Add Performance Indexes (Future Commit)\n *   - CREATE INDEX idx_users_tenant_id ON users(tenant_id);\n *   - CREATE INDEX idx_aws_resources_tenant_id_created_at ON aws_resources(tenant_id, created_at);\n *   - CREATE INDEX idx_cost_reports_tenant_id_report_date ON cost_reports(tenant_id, report_date);\n *   - CREATE INDEX idx_recommendations_tenant_id_status ON recommendations(tenant_id, status);\n *   - CREATE INDEX idx_optimization_history_tenant_id_created_at ON optimization_history(tenant_id, created_at);\n *   - CREATE INDEX idx_approval_requests_tenant_id_status ON approval_requests(tenant_id, status);\n *   - CREATE INDEX idx_system_config_tenant_id ON system_config(tenant_id);\n *   - CREATE INDEX idx_historical_cost_snapshots_tenant_id_snapshot_date ON historical_cost_snapshots(tenant_id, snapshot_date);\n *   - CREATE INDEX idx_ai_mode_history_tenant_id_created_at ON ai_mode_history(tenant_id, created_at);\n * \n * TECHNICAL NOTES:\n *   - TenantId uses VARCHAR to match existing UUID pattern\n *   - Foreign key constraints ensure referential integrity\n *   - Composite indexes optimize tenant-scoped queries\n *   - auditLogs table is NOT tenant-scoped (system-wide auditing)\n */\n\nimport { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, decimal, integer, bigint, boolean, jsonb, index } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const tenants = pgTable(\"tenants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  status: text(\"status\").notNull().default(\"active\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  role: text(\"role\").notNull().default(\"user\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdIdx: index(\"idx_users_tenant_id\").on(table.tenantId),\n}));\n\nexport const awsResources = pgTable(\"aws_resources\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  resourceId: text(\"resource_id\").notNull().unique(),\n  resourceType: text(\"resource_type\").notNull(), // EC2, RDS, Redshift, S3, etc.\n  region: text(\"region\").notNull(),\n  currentConfig: jsonb(\"current_config\").notNull(),\n  utilizationMetrics: jsonb(\"utilization_metrics\"),\n  monthlyCost: bigint(\"monthly_cost\", { mode: \"number\" }), // Direct dollar amounts (enterprise scale)\n  lastAnalyzed: timestamp(\"last_analyzed\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdCreatedAtIdx: index(\"idx_aws_resources_tenant_id_created_at\").on(table.tenantId, table.createdAt),\n}));\n\nexport const costReports = pgTable(\"cost_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  reportDate: timestamp(\"report_date\").notNull(),\n  serviceCategory: text(\"service_category\").notNull(),\n  resourceId: text(\"resource_id\"),\n  cost: bigint(\"cost\", { mode: \"number\" }).notNull(), // Direct dollar amounts (enterprise scale)\n  usage: decimal(\"usage\", { precision: 12, scale: 6 }),\n  usageType: text(\"usage_type\"),\n  region: text(\"region\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdReportDateIdx: index(\"idx_cost_reports_tenant_id_report_date\").on(table.tenantId, table.reportDate),\n}));\n\nexport const recommendations = pgTable(\"recommendations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  aiModeHistoryId: varchar(\"ai_mode_history_id\"), // Links to the AI run that generated this recommendation\n  resourceId: text(\"resource_id\").notNull(),\n  type: text(\"type\").notNull(), // resize, terminate, storage-class, reserved-instance\n  priority: text(\"priority\").notNull(), // critical, high, medium, low\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  currentConfig: jsonb(\"current_config\").notNull(),\n  recommendedConfig: jsonb(\"recommended_config\").notNull(),\n  projectedMonthlySavings: bigint(\"projected_monthly_savings\", { mode: \"number\" }).notNull(), // Direct dollar amounts (enterprise scale)\n  calculationMetadata: jsonb(\"calculation_metadata\"), // Stores resource cost, savings %, methodology for transparency\n  riskLevel: integer(\"risk_level\").default(50), // percentage value 1-100, defaults to 50 (medium risk)\n  executionMode: text(\"execution_mode\").notNull(), // autonomous, hitl\n  status: text(\"status\").notNull().default(\"pending\"), // pending, approved, rejected, executed\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdStatusIdx: index(\"idx_recommendations_tenant_id_status\").on(table.tenantId, table.status),\n  tenantIdAiHistoryIdx: index(\"idx_recommendations_tenant_id_ai_history\").on(table.tenantId, table.aiModeHistoryId),\n}));\n\nexport const optimizationHistory = pgTable(\"optimization_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  recommendationId: varchar(\"recommendation_id\").notNull(),\n  executedBy: varchar(\"executed_by\").notNull(),\n  executionDate: timestamp(\"execution_date\").notNull(),\n  beforeConfig: jsonb(\"before_config\").notNull(),\n  afterConfig: jsonb(\"after_config\").notNull(),\n  actualSavings: bigint(\"actual_savings\", { mode: \"number\" }), // Direct dollar amounts (enterprise scale)\n  status: text(\"status\").notNull(), // success, failed, in-progress\n  errorMessage: text(\"error_message\"),\n  slackMessageId: text(\"slack_message_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdCreatedAtIdx: index(\"idx_optimization_history_tenant_id_created_at\").on(table.tenantId, table.createdAt),\n}));\n\nexport const approvalRequests = pgTable(\"approval_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  recommendationId: varchar(\"recommendation_id\").notNull(),\n  requestedBy: varchar(\"requested_by\").notNull(),\n  approverRole: text(\"approver_role\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, approved, rejected\n  approvedBy: varchar(\"approved_by\"),\n  approvalDate: timestamp(\"approval_date\"),\n  comments: text(\"comments\"),\n  slackThreadId: text(\"slack_thread_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdStatusIdx: index(\"idx_approval_requests_tenant_id_status\").on(table.tenantId, table.status),\n}));\n\nexport const systemConfig = pgTable(\"system_config\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  key: text(\"key\").notNull().unique(),\n  value: text(\"value\").notNull(),\n  description: text(\"description\"),\n  updatedBy: varchar(\"updated_by\").notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdIdx: index(\"idx_system_config_tenant_id\").on(table.tenantId),\n}));\n\nexport const historicalCostSnapshots = pgTable(\"historical_cost_snapshots\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  snapshotDate: timestamp(\"snapshot_date\").notNull(),\n  totalMonthlyCost: bigint(\"total_monthly_cost\", { mode: \"number\" }).notNull(),\n  computeCost: bigint(\"compute_cost\", { mode: \"number\" }).notNull(),\n  storageCost: bigint(\"storage_cost\", { mode: \"number\" }).notNull(),\n  databaseCost: bigint(\"database_cost\", { mode: \"number\" }).notNull(),\n  networkCost: bigint(\"network_cost\", { mode: \"number\" }).notNull(),\n  otherCost: bigint(\"other_cost\", { mode: \"number\" }).notNull(),\n  resourceCount: integer(\"resource_count\").notNull(),\n  avgUtilization: decimal(\"avg_utilization\", { precision: 5, scale: 2 }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdSnapshotDateIdx: index(\"idx_historical_cost_snapshots_tenant_id_snapshot_date\").on(table.tenantId, table.snapshotDate),\n}));\n\nexport const aiModeHistory = pgTable(\"ai_mode_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tenantId: varchar(\"tenant_id\").notNull(),\n  startTime: timestamp(\"start_time\").notNull(),\n  endTime: timestamp(\"end_time\"),\n  status: text(\"status\").notNull(), // running, success, failed\n  summary: text(\"summary\"),\n  recommendationsGenerated: integer(\"recommendations_generated\").default(0),\n  totalSavingsIdentified: bigint(\"total_savings_identified\", { mode: \"number\" }).default(0), // Multiplied by 1000, supports 10√ó scale\n  triggeredBy: text(\"triggered_by\").default(\"user\"), // user, system\n  errorMessage: text(\"error_message\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  tenantIdCreatedAtIdx: index(\"idx_ai_mode_history_tenant_id_created_at\").on(table.tenantId, table.createdAt),\n}));\n\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n  requestId: varchar(\"request_id\").notNull(),\n  userId: varchar(\"user_id\"),\n  action: text(\"action\").notNull(), // CREATE, UPDATE, DELETE, APPROVE, REJECT, EXECUTE\n  resourceType: text(\"resource_type\").notNull(),\n  resourceId: text(\"resource_id\"),\n  changes: jsonb(\"changes\"),\n  metadata: jsonb(\"metadata\"),\n  ipAddress: text(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Relations\nexport const tenantsRelations = relations(tenants, ({ many }) => ({\n  users: many(users),\n  awsResources: many(awsResources),\n  costReports: many(costReports),\n  recommendations: many(recommendations),\n  optimizationHistory: many(optimizationHistory),\n  approvalRequests: many(approvalRequests),\n  systemConfig: many(systemConfig),\n  historicalCostSnapshots: many(historicalCostSnapshots),\n  aiModeHistory: many(aiModeHistory),\n}));\n\nexport const usersRelations = relations(users, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [users.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const awsResourcesRelations = relations(awsResources, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [awsResources.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const costReportsRelations = relations(costReports, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [costReports.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const recommendationsRelations = relations(recommendations, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [recommendations.tenantId],\n    references: [tenants.id],\n  }),\n  resource: one(awsResources, {\n    fields: [recommendations.resourceId],\n    references: [awsResources.resourceId],\n  }),\n}));\n\nexport const optimizationHistoryRelations = relations(optimizationHistory, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [optimizationHistory.tenantId],\n    references: [tenants.id],\n  }),\n  recommendation: one(recommendations, {\n    fields: [optimizationHistory.recommendationId],\n    references: [recommendations.id],\n  }),\n  executedByUser: one(users, {\n    fields: [optimizationHistory.executedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const approvalRequestsRelations = relations(approvalRequests, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [approvalRequests.tenantId],\n    references: [tenants.id],\n  }),\n  recommendation: one(recommendations, {\n    fields: [approvalRequests.recommendationId],\n    references: [recommendations.id],\n  }),\n  requestedByUser: one(users, {\n    fields: [approvalRequests.requestedBy],\n    references: [users.id],\n  }),\n  approvedByUser: one(users, {\n    fields: [approvalRequests.approvedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const systemConfigRelations = relations(systemConfig, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [systemConfig.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const historicalCostSnapshotsRelations = relations(historicalCostSnapshots, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [historicalCostSnapshots.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const aiModeHistoryRelations = relations(aiModeHistory, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [aiModeHistory.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertTenantSchema = createInsertSchema(tenants).omit({ id: true, createdAt: true });\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true }).extend({\n  tenantId: z.string().optional().default('default-tenant')\n});\nexport const insertAwsResourceSchema = createInsertSchema(awsResources).omit({ id: true, createdAt: true });\nexport const insertCostReportSchema = createInsertSchema(costReports).omit({ id: true, createdAt: true });\nexport const insertRecommendationSchema = createInsertSchema(recommendations).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertOptimizationHistorySchema = createInsertSchema(optimizationHistory).omit({ id: true, createdAt: true });\nexport const insertApprovalRequestSchema = createInsertSchema(approvalRequests).omit({ id: true, createdAt: true, approvalDate: true });\nexport const insertSystemConfigSchema = createInsertSchema(systemConfig).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertHistoricalCostSnapshotSchema = createInsertSchema(historicalCostSnapshots).omit({ id: true, createdAt: true });\nexport const insertAiModeHistorySchema = createInsertSchema(aiModeHistory).omit({ id: true, createdAt: true });\nexport const insertAuditLogSchema = createInsertSchema(auditLogs).omit({ id: true, createdAt: true, timestamp: true });\n\n// Types\nexport type Tenant = typeof tenants.$inferSelect;\nexport type InsertTenant = z.infer<typeof insertTenantSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type AwsResource = typeof awsResources.$inferSelect;\nexport type InsertAwsResource = z.infer<typeof insertAwsResourceSchema>;\nexport type CostReport = typeof costReports.$inferSelect;\nexport type InsertCostReport = z.infer<typeof insertCostReportSchema>;\nexport type Recommendation = typeof recommendations.$inferSelect;\nexport type InsertRecommendation = z.infer<typeof insertRecommendationSchema>;\nexport type OptimizationHistory = typeof optimizationHistory.$inferSelect;\nexport type InsertOptimizationHistory = z.infer<typeof insertOptimizationHistorySchema>;\nexport type ApprovalRequest = typeof approvalRequests.$inferSelect;\nexport type InsertApprovalRequest = z.infer<typeof insertApprovalRequestSchema>;\nexport type SystemConfig = typeof systemConfig.$inferSelect;\nexport type InsertSystemConfig = z.infer<typeof insertSystemConfigSchema>;\nexport type HistoricalCostSnapshot = typeof historicalCostSnapshots.$inferSelect;\nexport type InsertHistoricalCostSnapshot = z.infer<typeof insertHistoricalCostSnapshotSchema>;\nexport type AiModeHistory = typeof aiModeHistory.$inferSelect;\nexport type InsertAiModeHistory = z.infer<typeof insertAiModeHistorySchema>;\nexport type AuditLog = typeof auditLogs.$inferSelect;\nexport type InsertAuditLog = z.infer<typeof insertAuditLogSchema>;\n","size_bytes":17484},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport { storage, validatePassword, pineconeCircuitBreaker } from \"./storage\";\nimport { awsService } from \"./services/aws\";\nimport { sendOptimizationComplete } from \"./services/slack\";\nimport { insertRecommendationSchema, insertApprovalRequestSchema, insertUserSchema } from \"@shared/schema\";\nimport { authenticateToken, requireRole, generateToken, enforceSessionTimeout } from \"./middleware/auth\";\nimport { auditMiddleware, logAudit, auditActions, auditResourceTypes } from \"./middleware/audit\";\nimport { handleApprovalTransaction, handleOptimizationExecutionTransaction, withTransaction } from './lib/transaction';\n// Import scheduler service to ensure it's instantiated and configuration is initialized\nimport { schedulerService } from \"./services/scheduler.js\";\nimport { db } from \"./db\";\nimport jwt from 'jsonwebtoken';\nimport { URL } from 'url';\nimport type { IncomingMessage } from 'http';\n\n// Extended WebSocket interface with authentication metadata\ninterface AuthenticatedWebSocket extends WebSocket {\n  userId?: string;\n  username?: string;\n  tenantId?: string;\n  connectedAt?: Date;\n  isAlive?: boolean;\n  lastActivity?: Date;\n  ipAddress?: string;\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Middleware chains for authenticated routes\n  // enforceSessionTimeout runs AFTER authenticateToken to ensure req.user is populated\n  const authenticated = [authenticateToken, enforceSessionTimeout];\n  const authenticatedAdmin = [authenticateToken, enforceSessionTimeout, requireRole('admin')];\n  const authenticatedUser = [authenticateToken, enforceSessionTimeout, requireRole('user')];\n\n  const httpServer = createServer(app);\n\n  // WebSocket server for real-time updates\n  const wss = new WebSocketServer({ server: httpServer, path: '/ws' });\n  \n  // Store connected clients with authentication\n  const clients = new Set<AuthenticatedWebSocket>();\n\n  // Connection rate limiting: Track connections per IP\n  const connectionsByIP = new Map<string, number>();\n  const MAX_CONNECTIONS_PER_IP = 10;\n  const IDLE_TIMEOUT = 5 * 60 * 1000; // 5 minutes\n  const HEARTBEAT_INTERVAL = 30 * 1000; // 30 seconds\n\n  const JWT_SECRET = process.env.JWT_SECRET || '';\n\n  // WebSocket connection handler with authentication\n  wss.on('connection', (ws: AuthenticatedWebSocket, req: IncomingMessage) => {\n    const clientIP = req.socket.remoteAddress || 'unknown';\n    ws.ipAddress = clientIP;\n\n    // Rate limiting: Check connections per IP\n    const currentConnections = connectionsByIP.get(clientIP) || 0;\n    if (currentConnections >= MAX_CONNECTIONS_PER_IP) {\n      console.error(`[WebSocket Auth] Rate limit exceeded for IP: ${clientIP}`);\n      ws.close(1008, 'Too many connections from this IP');\n      return;\n    }\n\n    // Origin validation to prevent CSRF\n    const origin = req.headers.origin;\n    const allowedOrigins = [\n      process.env.REPLIT_DOMAINS?.split(',') || [],\n      'http://localhost:5000',\n      'https://localhost:5000'\n    ].flat();\n    \n    if (origin && allowedOrigins.length > 0 && !allowedOrigins.some(allowed => origin.includes(allowed))) {\n      console.error(`[WebSocket Auth] Invalid origin: ${origin}`);\n      ws.close(1008, 'Invalid origin');\n      return;\n    }\n\n    // Parse JWT token from query parameters\n    const url = new URL(req.url || '', `http://${req.headers.host}`);\n    const token = url.searchParams.get('token');\n\n    if (!token) {\n      console.error('[WebSocket Auth] No token provided');\n      ws.close(1008, 'Authentication required');\n      return;\n    }\n\n    // Verify JWT token\n    try {\n      const payload = jwt.verify(token, JWT_SECRET) as {\n        userId: string;\n        username: string;\n        role: string;\n        tenantId?: string;\n        iat?: number;\n        exp?: number;\n      };\n\n      // Validate session age - CRITICAL SECURITY CHECK\n      const now = Math.floor(Date.now() / 1000);\n      const MAX_SESSION_AGE = 2 * 60 * 60; // 2 hours (matches REST enforceSessionTimeout)\n\n      // Check 1: Token expiration (hard expiration)\n      if (payload.exp && payload.exp <= now) {\n        console.error('[WebSocket Auth] Token expired', {\n          username: payload.username,\n          exp: payload.exp,\n          now: now,\n          expired: now - payload.exp\n        });\n        ws.close(1008, 'Token expired');\n        return;\n      }\n\n      // Check 2: Session age (absolute session duration from issuance)\n      if (payload.iat) {\n        const sessionAge = now - payload.iat;\n        if (sessionAge > MAX_SESSION_AGE) {\n          console.error('[WebSocket Auth] Session too old - please login again', {\n            username: payload.username,\n            sessionAge: sessionAge,\n            maxAge: MAX_SESSION_AGE,\n            overAge: sessionAge - MAX_SESSION_AGE\n          });\n          ws.close(1008, 'Session too old - please login again');\n          return;\n        }\n      }\n\n      // Store authenticated user info in WebSocket object\n      ws.userId = payload.userId;\n      ws.username = payload.username;\n      ws.tenantId = payload.tenantId || 'default-tenant';\n      ws.connectedAt = new Date();\n      ws.isAlive = true;\n      ws.lastActivity = new Date();\n\n      console.log(`[WebSocket Auth] User authenticated: ${payload.username} (tenant: ${ws.tenantId})`);\n\n      // Add to clients and update connection count\n      clients.add(ws);\n      connectionsByIP.set(clientIP, currentConnections + 1);\n\n      // Send connection success message\n      ws.send(JSON.stringify({\n        type: 'connection_established',\n        data: {\n          userId: ws.userId,\n          username: ws.username,\n          tenantId: ws.tenantId,\n          connectedAt: ws.connectedAt\n        }\n      }));\n\n    } catch (error) {\n      console.error('[WebSocket Auth] Invalid token:', error instanceof Error ? error.message : error);\n      ws.close(1008, 'Invalid or expired token');\n      return;\n    }\n\n    // Handle incoming messages with tenant validation\n    ws.on('message', (message: string) => {\n      try {\n        ws.lastActivity = new Date();\n        const data = JSON.parse(message.toString());\n        \n        // Validate that message includes tenantId matching the connection\n        if (data.tenantId && data.tenantId !== ws.tenantId) {\n          console.error(`[WebSocket Security] Tenant mismatch for user ${ws.username}: expected ${ws.tenantId}, got ${data.tenantId}`);\n          ws.send(JSON.stringify({\n            type: 'error',\n            data: { message: 'Tenant validation failed' }\n          }));\n          return;\n        }\n\n        // Process message (can be extended for different message types)\n        console.log(`[WebSocket] Message from ${ws.username} (tenant: ${ws.tenantId}):`, data.type);\n      } catch (error) {\n        console.error('[WebSocket] Error processing message:', error);\n      }\n    });\n\n    // Heartbeat: Pong response\n    ws.on('pong', () => {\n      ws.isAlive = true;\n      ws.lastActivity = new Date();\n    });\n\n    // Connection close handler\n    ws.on('close', () => {\n      console.log(`[WebSocket] Connection closed for user ${ws.username} (tenant: ${ws.tenantId})`);\n      clients.delete(ws);\n      \n      // Decrement connection count for this IP\n      const count = connectionsByIP.get(clientIP) || 0;\n      if (count <= 1) {\n        connectionsByIP.delete(clientIP);\n      } else {\n        connectionsByIP.set(clientIP, count - 1);\n      }\n    });\n\n    ws.on('error', (error) => {\n      console.error(`[WebSocket] Error for user ${ws.username}:`, error);\n    });\n  });\n\n  // Heartbeat mechanism: Ping all clients every 30 seconds\n  const heartbeatInterval = setInterval(() => {\n    clients.forEach((ws) => {\n      if (ws.isAlive === false) {\n        console.log(`[WebSocket Heartbeat] Terminating dead connection for user ${ws.username}`);\n        return ws.terminate();\n      }\n      \n      ws.isAlive = false;\n      ws.ping();\n    });\n  }, HEARTBEAT_INTERVAL);\n\n  // Idle timeout: Disconnect clients idle for more than 5 minutes\n  const idleCheckInterval = setInterval(() => {\n    const now = Date.now();\n    clients.forEach((ws) => {\n      if (ws.lastActivity && (now - ws.lastActivity.getTime()) > IDLE_TIMEOUT) {\n        console.log(`[WebSocket Idle] Disconnecting idle user ${ws.username} (idle for ${Math.floor((now - ws.lastActivity.getTime()) / 1000)}s)`);\n        ws.close(1000, 'Connection idle timeout');\n      }\n    });\n  }, 60000); // Check every minute\n\n  // Cleanup on server shutdown\n  wss.on('close', () => {\n    clearInterval(heartbeatInterval);\n    clearInterval(idleCheckInterval);\n  });\n\n  // Broadcast to all connected clients (legacy - use broadcastToTenant instead)\n  const broadcast = (data: any) => {\n    const message = JSON.stringify(data);\n    clients.forEach(client => {\n      if (client.readyState === WebSocket.OPEN) {\n        client.send(message);\n      }\n    });\n  };\n\n  // Tenant-scoped broadcast: Only send to clients in the same tenant\n  const broadcastToTenant = (tenantId: string, data: any) => {\n    const message = JSON.stringify({\n      ...data,\n      tenantId // Always include tenantId in broadcast messages\n    });\n    \n    let recipientCount = 0;\n    clients.forEach(client => {\n      if (client.readyState === WebSocket.OPEN && client.tenantId === tenantId) {\n        client.send(message);\n        recipientCount++;\n      }\n    });\n    \n    console.log(`[WebSocket Broadcast] Sent ${data.type} to ${recipientCount} clients in tenant ${tenantId}`);\n  };\n\n  // Prod Mode auto-revert state\n  let prodModeTimeout: NodeJS.Timeout | null = null;\n  let prodModeActivationTime: number | null = null;\n\n  // ===== Health Check Endpoints =====\n  // Basic health check - no authentication required\n  app.get(\"/api/health\", (req, res) => {\n    const uptime = process.uptime();\n    res.status(200).json({\n      status: \"healthy\",\n      uptime: Math.floor(uptime),\n      timestamp: new Date().toISOString()\n    });\n  });\n\n  // Detailed health check with component status\n  app.get(\"/api/health/detailed\", async (req, res) => {\n    const healthChecks: {\n      database: { status: string; responseTime?: number; error?: string };\n      pinecone: { status: string; circuitState?: string; responseTime?: number };\n      platform: { status: string; responseTime?: number; error?: string };\n    } = {\n      database: { status: \"unknown\" },\n      pinecone: { status: \"unknown\" },\n      platform: { status: \"unknown\" }\n    };\n\n    let overallHealthy = true;\n\n    // Check database connection with timeout\n    try {\n      const dbStart = Date.now();\n      const timeoutPromise = new Promise((_, reject) => \n        setTimeout(() => reject(new Error(\"Database check timeout\")), 5000)\n      );\n      \n      const checkPromise = db.execute('SELECT 1 as health_check');\n      \n      await Promise.race([checkPromise, timeoutPromise]);\n      \n      healthChecks.database = {\n        status: \"healthy\",\n        responseTime: Date.now() - dbStart\n      };\n    } catch (error) {\n      overallHealthy = false;\n      healthChecks.database = {\n        status: \"unhealthy\",\n        error: error instanceof Error ? error.message : String(error)\n      };\n    }\n\n    // Check Pinecone circuit breaker state\n    try {\n      const pineconeStats = pineconeCircuitBreaker.getStats();\n      const circuitState = pineconeStats.state;\n      \n      // Circuit is healthy if CLOSED or HALF_OPEN\n      const isHealthy = circuitState === 'CLOSED' || circuitState === 'HALF_OPEN';\n      \n      healthChecks.pinecone = {\n        status: isHealthy ? \"healthy\" : \"degraded\",\n        circuitState: circuitState,\n        responseTime: 0 // Circuit breaker check is instant\n      };\n      \n      // If circuit is OPEN, mark as degraded but not unhealthy (graceful degradation)\n      if (circuitState === 'OPEN') {\n        // Don't fail overall health, just mark as degraded\n        console.warn('[Health Check] Pinecone circuit breaker is OPEN - service degraded');\n      }\n    } catch (error) {\n      healthChecks.pinecone = {\n        status: \"unhealthy\",\n        circuitState: \"ERROR\"\n      };\n      overallHealthy = false;\n    }\n\n    // Check Platform (AOS) connection - optional, don't fail if not configured\n    try {\n      const platformUrl = process.env.VITE_AOS_BASE_URL || process.env.VITE_PLATFORM_URL;\n      \n      if (platformUrl) {\n        const platformStart = Date.now();\n        const timeoutPromise = new Promise((_, reject) => \n          setTimeout(() => reject(new Error(\"Platform check timeout\")), 5000)\n        );\n        \n        const checkPromise = fetch(`${platformUrl}/health`, { \n          method: 'GET',\n          signal: AbortSignal.timeout(5000)\n        }).then(res => {\n          if (!res.ok) throw new Error(`Platform returned ${res.status}`);\n          return res;\n        });\n        \n        await Promise.race([checkPromise, timeoutPromise]);\n        \n        healthChecks.platform = {\n          status: \"healthy\",\n          responseTime: Date.now() - platformStart\n        };\n      } else {\n        healthChecks.platform = {\n          status: \"not_configured\",\n          responseTime: 0\n        };\n      }\n    } catch (error) {\n      // Platform is optional, don't fail overall health\n      healthChecks.platform = {\n        status: \"unavailable\",\n        error: error instanceof Error ? error.message : String(error)\n      };\n      console.warn('[Health Check] Platform (AOS) unavailable:', error instanceof Error ? error.message : error);\n    }\n\n    // Return appropriate status code\n    const statusCode = overallHealthy ? 200 : 503;\n    \n    res.status(statusCode).json({\n      status: overallHealthy ? \"healthy\" : \"unhealthy\",\n      timestamp: new Date().toISOString(),\n      uptime: Math.floor(process.uptime()),\n      components: healthChecks\n    });\n  });\n\n  // Dashboard metrics endpoint\n  app.get(\"/api/dashboard/metrics\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const metrics = await storage.getDashboardMetrics(tenantId);\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching dashboard metrics:\", error);\n      res.status(500).json({ error: \"Failed to fetch dashboard metrics\" });\n    }\n  });\n\n  // Cost trends endpoint\n  app.get(\"/api/dashboard/cost-trends\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const trends = await storage.getMonthlyCostSummary(tenantId);\n      res.json(trends);\n    } catch (error) {\n      console.error(\"Error fetching cost trends:\", error);\n      res.status(500).json({ error: \"Failed to fetch cost trends\" });\n    }\n  });\n\n  // Metrics summary endpoint for autopilot\n  app.get(\"/api/metrics/summary\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const summary = await storage.getMetricsSummary(tenantId);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Error fetching metrics summary:\", error);\n      res.status(500).json({ error: \"Failed to fetch metrics summary\" });\n    }\n  });\n\n  // Optimization mix endpoint (Autonomous vs HITL distribution)\n  app.get(\"/api/metrics/optimization-mix\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const mix = await storage.getOptimizationMix(tenantId);\n      res.json(mix);\n    } catch (error) {\n      console.error(\"Error fetching optimization mix:\", error);\n      res.status(500).json({ error: \"Failed to fetch optimization mix\" });\n    }\n  });\n\n  // Prod Mode toggle with auto-revert\n  app.post(\"/api/mode/prod\", ...authenticatedAdmin, async (req, res) => {\n    try {\n      const { enabled } = req.body;\n      const { configService } = await import('./services/config.js');\n\n      if (typeof enabled !== 'boolean') {\n        return res.status(400).json({ error: \"Enabled must be a boolean value\" });\n      }\n\n      // Clear existing timeout if any\n      if (prodModeTimeout) {\n        clearTimeout(prodModeTimeout);\n        prodModeTimeout = null;\n        prodModeActivationTime = null;\n      }\n\n      if (enabled) {\n        // Turn on prod mode\n        await configService.setProdMode(true, 'user');\n        prodModeActivationTime = Date.now();\n\n        // Schedule auto-revert after 5 minutes\n        prodModeTimeout = setTimeout(async () => {\n          console.log('Auto-reverting Prod Mode to OFF after 5 minutes');\n          await configService.setProdMode(false, 'system-auto-revert');\n          prodModeTimeout = null;\n          prodModeActivationTime = null;\n        }, 5 * 60 * 1000);\n\n        res.json({ \n          prodMode: true, \n          timeRemaining: 300 \n        });\n      } else {\n        // Turn off prod mode immediately\n        await configService.setProdMode(false, 'user');\n        res.json({ \n          prodMode: false, \n          timeRemaining: 0 \n        });\n      }\n    } catch (error) {\n      console.error(\"Error toggling prod mode:\", error);\n      res.status(500).json({ error: \"Failed to toggle prod mode\" });\n    }\n  });\n\n  // Authentication endpoints\n  app.post(\"/api/register\", auditMiddleware(auditActions.REGISTER, auditResourceTypes.USER, req => req.body?.username), async (req, res) => {\n    try {\n      const validatedData = insertUserSchema.parse(req.body);\n      \n      // Check if username already exists\n      const existingUser = await storage.getUserByUsername(validatedData.username);\n      if (existingUser) {\n        return res.status(400).json({ error: \"Username already exists\" });\n      }\n\n      // Extract tenantId from validated data or default to 'default-tenant'\n      const tenantId = validatedData.tenantId || 'default-tenant';\n      const user = await storage.createUser(validatedData, tenantId);\n      \n      // Generate JWT token with tenantId\n      const token = generateToken({\n        userId: user.id,\n        username: user.username,\n        role: user.role,\n        tenantId: user.tenantId\n      });\n\n      res.json({ \n        token,\n        user: {\n          id: user.id,\n          username: user.username,\n          role: user.role,\n          tenantId: user.tenantId\n        }\n      });\n    } catch (error) {\n      console.error(\"Error registering user:\", error);\n      res.status(400).json({ error: \"Failed to register user\" });\n    }\n  });\n\n  app.post(\"/api/login\", auditMiddleware(auditActions.LOGIN, auditResourceTypes.SESSION, req => req.body?.username), async (req, res) => {\n    try {\n      const { username, password } = req.body;\n\n      if (!username || !password) {\n        return res.status(400).json({ error: \"Username and password are required\" });\n      }\n\n      const user = await storage.getUserByUsername(username);\n      if (!user) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n\n      const isValid = await validatePassword(password, user.password);\n      if (!isValid) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n\n      // Generate JWT token with tenantId\n      const token = generateToken({\n        userId: user.id,\n        username: user.username,\n        role: user.role,\n        tenantId: user.tenantId || 'default-tenant'\n      });\n\n      res.json({ \n        token,\n        user: {\n          id: user.id,\n          username: user.username,\n          role: user.role,\n          tenantId: user.tenantId\n        }\n      });\n    } catch (error) {\n      console.error(\"Error logging in:\", error);\n      res.status(500).json({ error: \"Failed to login\" });\n    }\n  });\n\n  app.post(\"/api/logout\", ...authenticated, auditMiddleware(auditActions.LOGOUT, auditResourceTypes.SESSION), async (req, res) => {\n    // JWT logout is handled client-side by removing the token\n    // This endpoint exists for consistency and can be used for logging/analytics\n    res.json({ message: \"Logged out successfully\" });\n  });\n\n  app.get(\"/api/me\", ...authenticated, async (req, res) => {\n    try {\n      if (!req.user) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const tenantId = req.user.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const user = await storage.getUser(req.user.userId, tenantId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json({\n        id: user.id,\n        username: user.username,\n        role: user.role\n      });\n    } catch (error) {\n      console.error(\"Error fetching current user:\", error);\n      res.status(500).json({ error: \"Failed to fetch user information\" });\n    }\n  });\n\n  // Recommendations endpoints\n  app.get(\"/api/recommendations\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const status = req.query.status as string | undefined;\n      const recommendations = await storage.getRecommendations(tenantId, status);\n      res.json(recommendations);\n    } catch (error) {\n      console.error(\"Error fetching recommendations:\", error);\n      res.status(500).json({ error: \"Failed to fetch recommendations\" });\n    }\n  });\n\n  app.get(\"/api/recommendations/:id\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const recommendation = await storage.getRecommendation(req.params.id, tenantId);\n      if (!recommendation) {\n        return res.status(404).json({ error: \"Recommendation not found\" });\n      }\n      res.json(recommendation);\n    } catch (error) {\n      console.error(\"Error fetching recommendation:\", error);\n      res.status(500).json({ error: \"Failed to fetch recommendation\" });\n    }\n  });\n\n  app.post(\"/api/recommendations\", ...authenticated, auditMiddleware(auditActions.CREATE, auditResourceTypes.RECOMMENDATION, req => req.body?.id), async (req, res) => {\n    try {\n      const validatedData = insertRecommendationSchema.parse(req.body);\n      \n      // Extract tenantId from authenticated user\n      const tenantId = req.user?.tenantId || 'default-tenant';\n      const recommendation = await storage.createRecommendation(validatedData, tenantId);\n      \n      // Broadcast new recommendation to connected clients in the same tenant\n      broadcastToTenant(tenantId, {\n        type: 'new_recommendation',\n        data: recommendation\n      });\n      \n      res.json(recommendation);\n    } catch (error) {\n      console.error(\"Error creating recommendation:\", error);\n      res.status(400).json({ error: \"Failed to create recommendation\" });\n    }\n  });\n\n  // Approval request endpoints - Require admin or CFO role\n  app.post(\"/api/approval-requests\", ...authenticatedUser, auditMiddleware(auditActions.CREATE, auditResourceTypes.APPROVAL_REQUEST, req => req.body?.recommendationId), async (req, res) => {\n    try {\n      console.log(\"Creating approval request with data:\", req.body);\n      const validatedData = insertApprovalRequestSchema.parse(req.body);\n      console.log(\"Validated data:\", validatedData);\n      \n      // Extract tenantId from authenticated user - MUST validate BEFORE any storage calls\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      // For high-impact recommendations, require admin or CFO role\n      const recommendation = await storage.getRecommendation(validatedData.recommendationId, tenantId);\n      if (recommendation && req.body.status === 'approved') {\n        const userRole = req.user?.role;\n        const projectedAnnualSavings = (recommendation.projectedMonthlySavings || 0) * 12;\n        const highImpact = projectedAnnualSavings > 100000000; // > $100k annual savings\n        \n        if (highImpact && userRole !== 'admin' && userRole !== 'cfo' && userRole !== 'Head of Cloud Platform') {\n          return res.status(403).json({ \n            error: \"High-impact recommendations require admin or CFO approval\",\n            required: \"admin or cfo\",\n            current: userRole\n          });\n        }\n      }\n      \n      // Create approval request with date handling\n      const approvalRequestData = {\n        ...validatedData,\n        ...(req.body.approvalDate && { approvalDate: new Date(req.body.approvalDate) })\n      };\n      console.log(\"Final approval request data:\", approvalRequestData);\n      \n      const approvalRequest = await storage.createApprovalRequest(approvalRequestData as any, tenantId);\n      console.log(\"Created approval request:\", approvalRequest);\n      \n      // If approved, update the recommendation status and create activity entry\n      if (req.body.status === 'approved') {\n        console.log(\"Updating recommendation status to approved for:\", validatedData.recommendationId);\n        await storage.updateRecommendationStatus(validatedData.recommendationId, 'approved', tenantId);\n        \n        // Get the recommendation details for the activity entry\n        if (recommendation) {\n          console.log(\"Creating activity entry for approval\");\n          await storage.createOptimizationHistory({\n            tenantId,\n            recommendationId: validatedData.recommendationId,\n            executedBy: req.user?.userId || validatedData.approvedBy || 'system',\n            executionDate: new Date(),\n            beforeConfig: recommendation.currentConfig as any,\n            afterConfig: recommendation.recommendedConfig as any,\n            actualSavings: recommendation.projectedMonthlySavings,\n            status: 'approved'\n          }, tenantId);\n        }\n      }\n      \n      // Broadcast approval request to connected clients in the same tenant\n      broadcastToTenant(tenantId, {\n        type: 'approval_request',\n        data: approvalRequest\n      });\n      \n      res.json(approvalRequest);\n    } catch (error) {\n      console.error(\"Error creating approval request:\", error);\n      res.status(500).json({ error: \"Failed to create approval request\" });\n    }\n  });\n\n  app.patch(\"/api/approval-requests/:id\", ...authenticatedUser, auditMiddleware(auditActions.APPROVE, auditResourceTypes.APPROVAL_REQUEST, req => req.params.id), async (req, res) => {\n    try {\n      const { status, approvedBy, comments } = req.body;\n      \n      // First, get the existing approval request to find the recommendationId\n      const { approvalRequests } = await import('@shared/schema');\n      const { eq } = await import('drizzle-orm');\n      const [existingRequest] = await db.select().from(approvalRequests).where(eq(approvalRequests.id, req.params.id)).limit(1);\n\n      if (!existingRequest) {\n        return res.status(404).json({ error: \"Approval request not found\" });\n      }\n\n      // Use transaction to update both approval request and recommendation atomically\n      const { recommendation, approvalRequest } = await handleApprovalTransaction({\n        recommendationId: existingRequest.recommendationId,\n        approvalRequestId: req.params.id,\n        status,\n        approvedBy,\n        comments,\n        tenantId: req.user?.tenantId || 'default-tenant'\n      }, {\n        requestId: (req as any).requestId,\n        userId: req.user?.userId\n      });\n\n      // If approved, execute the optimization (separate operation, kept as is)\n      if (status === 'approved') {\n        const tenantId = recommendation.tenantId || req.user?.tenantId || 'default-tenant';\n        try {\n          const execResult = await executeOptimization(recommendation);\n          await storage.updateRecommendationStatus(recommendation.id, 'executed', tenantId);\n          \n          await logAudit(req, {\n            action: auditActions.EXECUTE,\n            resourceType: auditResourceTypes.OPTIMIZATION,\n            resourceId: recommendation.id,\n            metadata: { \n              tenantId: req.user?.tenantId || 'default-tenant',\n              status: 'success',\n              savings: recommendation.projectedMonthlySavings\n            }\n          });\n          \n          // Broadcast optimization execution to tenant\n          broadcastToTenant(tenantId, {\n            type: 'optimization_executed',\n            data: { recommendationId: recommendation.id, status: 'success' }\n          });\n        } catch (error) {\n          console.error(\"Error executing optimization:\", error);\n          await storage.updateRecommendationStatus(recommendation.id, 'failed', tenantId);\n          \n          await logAudit(req, {\n            action: auditActions.EXECUTE,\n            resourceType: auditResourceTypes.OPTIMIZATION,\n            resourceId: recommendation.id,\n            metadata: { \n              tenantId: req.user?.tenantId || 'default-tenant',\n              status: 'failed',\n              error: error instanceof Error ? error.message : String(error)\n            }\n          });\n          \n          broadcastToTenant(tenantId, {\n            type: 'optimization_executed',\n            data: { recommendationId: recommendation.id, status: 'failed', error: error instanceof Error ? error.message : String(error) }\n          });\n        }\n      }\n\n      res.json(approvalRequest);\n    } catch (error) {\n      console.error(\"Error updating approval request:\", error);\n      res.status(400).json({ error: \"Failed to update approval request\" });\n    }\n  });\n\n  // Bulk approve all pending recommendations - Require admin or CFO role\n  app.post(\"/api/approve-all-recommendations\", ...authenticatedAdmin, auditMiddleware(auditActions.APPROVE, auditResourceTypes.OPTIMIZATION), async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      console.log(\"Starting bulk approval of all pending recommendations\");\n      const approvedBy = req.user?.userId || 'current-user';\n      const { comments } = req.body;\n      \n      // Get all pending recommendations\n      const allRecommendations = await storage.getRecommendations(tenantId);\n      const pendingRecommendations = allRecommendations.filter(r => r.status === 'pending');\n      \n      if (pendingRecommendations.length === 0) {\n        return res.json({ \n          message: \"No pending recommendations to approve\",\n          approvedCount: 0,\n          recommendations: []\n        });\n      }\n\n      console.log(`Found ${pendingRecommendations.length} pending recommendations to approve`);\n      \n      const approvedRecommendations = [];\n      const errors = [];\n\n      // Process each pending recommendation\n      for (const recommendation of pendingRecommendations) {\n        try {\n          // Create approval request with pending status first\n          const approvalRequest = await storage.createApprovalRequest({\n            recommendationId: recommendation.id,\n            requestedBy: approvedBy,\n            approverRole: 'Head of Cloud Platform',\n            status: 'pending',\n            requestDate: new Date()\n          } as any, tenantId);\n\n          // Use transaction to update both recommendation and approval request to approved atomically\n          const { recommendation: approvedRec, approvalRequest: approvedReq } = await handleApprovalTransaction({\n            recommendationId: recommendation.id,\n            approvalRequestId: approvalRequest.id,\n            status: 'approved',\n            approvedBy,\n            comments: comments || `Bulk approved with ${pendingRecommendations.length - 1} other recommendations`,\n            tenantId\n          }, {\n            requestId: (req as any).requestId,\n            userId: req.user?.userId\n          });\n\n          // Audit log for individual recommendation approval\n          await logAudit(req, {\n            action: auditActions.APPROVE,\n            resourceType: auditResourceTypes.RECOMMENDATION,\n            resourceId: recommendation.id,\n            metadata: { tenantId }\n          });\n\n          // Execute the optimization\n          try {\n            let execResult;\n            if (recommendation.type === 'resize' && recommendation.resourceId.includes('redshift')) {\n              const config = recommendation.recommendedConfig as any;\n              execResult = await awsService.resizeRedshiftCluster(\n                recommendation.resourceId,\n                config.nodeType,\n                config.numberOfNodes\n              );\n            }\n\n            // Use transaction to update recommendation to executed and create history atomically\n            await handleOptimizationExecutionTransaction({\n              recommendationId: recommendation.id,\n              executedBy: approvedBy,\n              beforeConfig: recommendation.currentConfig as any,\n              afterConfig: recommendation.recommendedConfig as any,\n              actualSavings: recommendation.projectedMonthlySavings,\n              status: 'success',\n              tenantId\n            }, {\n              requestId: (req as any).requestId,\n              userId: req.user?.userId\n            });\n\n            // Send Slack notification\n            await sendOptimizationComplete({\n              title: recommendation.title,\n              resourceId: recommendation.resourceId,\n              actualSavings: Number(recommendation.projectedMonthlySavings),\n              status: 'success'\n            });\n\n            await logAudit(req, {\n              action: auditActions.EXECUTE,\n              resourceType: auditResourceTypes.OPTIMIZATION,\n              resourceId: recommendation.id,\n              metadata: { \n                status: 'success',\n                tenantId\n              }\n            });\n          } catch (execError) {\n            console.error(`Error executing optimization for ${recommendation.id}:`, execError);\n            \n            // Use transaction to update recommendation to failed and create history atomically\n            await handleOptimizationExecutionTransaction({\n              recommendationId: recommendation.id,\n              executedBy: approvedBy,\n              beforeConfig: recommendation.currentConfig as any,\n              afterConfig: recommendation.recommendedConfig as any,\n              status: 'failed',\n              errorMessage: execError instanceof Error ? execError.message : String(execError),\n              tenantId\n            }, {\n              requestId: (req as any).requestId,\n              userId: req.user?.userId\n            });\n\n            await logAudit(req, {\n              action: auditActions.EXECUTE,\n              resourceType: auditResourceTypes.OPTIMIZATION,\n              resourceId: recommendation.id,\n              metadata: { \n                status: 'failed',\n                error: execError instanceof Error ? execError.message : String(execError),\n                tenantId\n              }\n            });\n          }\n\n          approvedRecommendations.push({\n            id: recommendation.id,\n            title: recommendation.title,\n            projectedAnnualSavings: (recommendation.projectedMonthlySavings || 0) * 12\n          });\n\n          console.log(`Successfully approved recommendation: ${recommendation.title}`);\n        } catch (error) {\n          console.error(`Error approving recommendation ${recommendation.id}:`, error);\n          errors.push({\n            recommendationId: recommendation.id,\n            title: recommendation.title,\n            error: error instanceof Error ? error.message : String(error)\n          });\n        }\n      }\n\n      // Broadcast bulk approval to connected clients in the same tenant\n      broadcastToTenant(tenantId, {\n        type: 'bulk_approval',\n        data: { \n          approvedCount: approvedRecommendations.length,\n          totalAttempted: pendingRecommendations.length,\n          errors: errors.length\n        }\n      });\n\n      const totalSavings = approvedRecommendations.reduce((sum, rec) => sum + (rec.projectedAnnualSavings || 0), 0);\n\n      res.json({\n        message: `Successfully approved ${approvedRecommendations.length} of ${pendingRecommendations.length} pending recommendations`,\n        approvedCount: approvedRecommendations.length,\n        totalAttempted: pendingRecommendations.length,\n        totalAnnualSavings: totalSavings,\n        recommendations: approvedRecommendations,\n        errors\n      });\n\n      console.log(`Bulk approval completed: ${approvedRecommendations.length}/${pendingRecommendations.length} successful`);\n    } catch (error) {\n      console.error(\"Error in bulk approval:\", error);\n      res.status(500).json({ error: \"Failed to approve recommendations\" });\n    }\n  });\n\n  // Optimization history endpoint\n  app.get(\"/api/optimization-history\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      const history = await storage.getOptimizationHistory(tenantId, limit);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching optimization history:\", error);\n      res.status(500).json({ error: \"Failed to fetch optimization history\" });\n    }\n  });\n\n  // AWS resources endpoint\n  app.get(\"/api/aws-resources\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const resources = await storage.getAllAwsResources(tenantId);\n      res.json(resources);\n    } catch (error) {\n      console.error(\"Error fetching AWS resources:\", error);\n      res.status(500).json({ error: \"Failed to fetch AWS resources\" });\n    }\n  });\n\n  // Manual analysis trigger\n  app.post(\"/api/analyze-resources\", ...authenticated, auditMiddleware(auditActions.EXECUTE, auditResourceTypes.AWS_RESOURCE), async (req, res) => {\n    try {\n      // Trigger analysis for specific resource type or all\n      const { resourceType, resourceId } = req.body;\n      \n      if (resourceType === 'redshift' && resourceId) {\n        const analysis = await awsService.analyzeRedshiftClusterOptimization(resourceId);\n        \n        await logAudit(req, {\n          action: auditActions.EXECUTE,\n          resourceType: auditResourceTypes.AWS_RESOURCE,\n          resourceId: resourceId,\n          metadata: {\n            resourceType: resourceType,\n            analysisResult: analysis ? 'success' : 'no_result',\n            tenantId: req.user?.tenantId || 'default-tenant'\n          }\n        });\n        \n        res.json(analysis);\n      } else {\n        res.status(400).json({ error: \"Invalid analysis request\" });\n      }\n    } catch (error) {\n      console.error(\"Error analyzing resources:\", error);\n      res.status(500).json({ error: \"Failed to analyze resources\" });\n    }\n  });\n\n  // AWS Data Simulation endpoints - Require admin role\n  app.post(\"/api/generate-aws-data\", ...authenticatedAdmin, auditMiddleware(auditActions.EXECUTE, auditResourceTypes.AWS_RESOURCE), async (req, res) => {\n    try {\n      const { DataGenerator } = await import('./services/data-generator.js');\n      const generator = new DataGenerator(storage);\n      const result = await generator.generateAWSData();\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error generating AWS data:\", error);\n      res.status(500).json({ error: \"Failed to generate AWS data\" });\n    }\n  });\n\n  app.post(\"/api/clear-simulation-data\", ...authenticatedAdmin, auditMiddleware(auditActions.DELETE, auditResourceTypes.AWS_RESOURCE), async (req, res) => {\n    try {\n      const { DataGenerator } = await import('./services/data-generator.js');\n      const generator = new DataGenerator(storage);\n      await generator.clearAllData();\n      res.json({ message: \"Simulation data cleared\" });\n    } catch (error) {\n      console.error(\"Error clearing simulation data:\", error);\n      res.status(500).json({ error: \"Failed to clear simulation data\" });\n    }\n  });\n\n  // System Configuration Routes - Require admin role\n  app.get(\"/api/system-config\", ...authenticatedAdmin, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const configs = await storage.getAllSystemConfig(tenantId);\n      res.json(configs);\n    } catch (error) {\n      console.error(\"Error fetching system config:\", error);\n      res.status(500).json({ error: \"Failed to fetch system configuration\" });\n    }\n  });\n\n  app.get(\"/api/system-config/:key\", ...authenticatedAdmin, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const config = await storage.getSystemConfig(req.params.key, tenantId);\n      if (!config) {\n        return res.status(404).json({ error: \"Configuration not found\" });\n      }\n      res.json(config);\n    } catch (error) {\n      console.error(\"Error fetching system config:\", error);\n      res.status(500).json({ error: \"Failed to fetch system configuration\" });\n    }\n  });\n\n  app.post(\"/api/system-config\", ...authenticatedAdmin, auditMiddleware(auditActions.CREATE, auditResourceTypes.SYSTEM_CONFIG, req => req.body?.key), async (req, res) => {\n    try {\n      const { insertSystemConfigSchema } = await import(\"@shared/schema\");\n      const validatedData = insertSystemConfigSchema.parse(req.body);\n      \n      // Extract tenantId from authenticated user\n      const tenantId = req.user?.tenantId || 'default-tenant';\n      const config = await storage.setSystemConfig(validatedData, tenantId);\n      res.json(config);\n    } catch (error) {\n      console.error(\"Error setting system config:\", error);\n      res.status(500).json({ error: \"Failed to set system configuration\" });\n    }\n  });\n\n  app.put(\"/api/system-config/:key\", ...authenticatedAdmin, auditMiddleware(auditActions.UPDATE, auditResourceTypes.SYSTEM_CONFIG, req => req.params.key), async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const { value, updatedBy } = req.body;\n      \n      // Basic validation for numeric values\n      if (req.params.key.includes('risk_level') || req.params.key.includes('savings')) {\n        const numValue = parseFloat(value);\n        if (isNaN(numValue) || numValue < 0) {\n          return res.status(400).json({ error: \"Invalid numeric value\" });\n        }\n      }\n      \n      const config = await storage.updateSystemConfig(req.params.key, value, updatedBy || 'system', tenantId);\n      if (!config) {\n        return res.status(404).json({ error: \"Configuration not found\" });\n      }\n\n      // Invalidate configuration service cache when system config is updated\n      const { configService } = await import('./services/config.js');\n      configService.invalidateCache();\n      \n      res.json(config);\n    } catch (error) {\n      console.error(\"Error updating system config:\", error);\n      res.status(500).json({ error: \"Failed to update system configuration\" });\n    }\n  });\n\n  // Agent Configuration Helper Routes\n  app.get(\"/api/agent-config\", ...authenticatedAdmin, async (req, res) => {\n    try {\n      const { configService } = await import('./services/config.js');\n      const agentConfig = await configService.getAgentConfig();\n      res.json(agentConfig);\n    } catch (error) {\n      console.error(\"Error fetching agent config:\", error);\n      res.status(500).json({ error: \"Failed to fetch agent configuration\" });\n    }\n  });\n\n  app.post(\"/api/agent-config/autonomous-mode\", ...authenticatedAdmin, auditMiddleware(auditActions.UPDATE, auditResourceTypes.SYSTEM_CONFIG, req => 'autonomous-mode'), async (req, res) => {\n    try {\n      const { enabled, updatedBy } = req.body;\n      \n      if (typeof enabled !== 'boolean') {\n        return res.status(400).json({ error: \"Enabled must be a boolean value\" });\n      }\n      \n      const { configService } = await import('./services/config.js');\n      await configService.setAutonomousMode(enabled, updatedBy || 'system');\n      const agentConfig = await configService.getAgentConfig();\n      \n      // Broadcast configuration change to connected clients in the same tenant\n      const tenantId = req.user?.tenantId || 'default-tenant';\n      broadcastToTenant(tenantId, {\n        type: 'agent_config_updated',\n        data: { autonomousMode: enabled, updatedBy }\n      });\n      \n      res.json(agentConfig);\n    } catch (error) {\n      console.error(\"Error updating autonomous mode:\", error);\n      res.status(500).json({ error: \"Failed to update autonomous mode\" });\n    }\n  });\n\n  app.post(\"/api/agent-config/prod-mode\", ...authenticatedAdmin, auditMiddleware(auditActions.UPDATE, auditResourceTypes.SYSTEM_CONFIG, req => 'prod-mode'), async (req, res) => {\n    try {\n      const { enabled, updatedBy } = req.body;\n      \n      if (typeof enabled !== 'boolean') {\n        return res.status(400).json({ error: \"Enabled must be a boolean value\" });\n      }\n      \n      const { configService } = await import('./services/config.js');\n      await configService.setProdMode(enabled, updatedBy || 'system');\n      const agentConfig = await configService.getAgentConfig();\n      \n      // Broadcast configuration change to connected clients in the same tenant\n      const tenantId = req.user?.tenantId || 'default-tenant';\n      broadcastToTenant(tenantId, {\n        type: 'agent_config_updated',\n        data: { prodMode: enabled, updatedBy }\n      });\n      \n      res.json(agentConfig);\n    } catch (error) {\n      console.error(\"Error updating prod mode:\", error);\n      res.status(500).json({ error: \"Failed to update prod mode\" });\n    }\n  });\n\n  app.post(\"/api/agent-config/simulation-mode\", ...authenticatedAdmin, auditMiddleware(auditActions.UPDATE, auditResourceTypes.SYSTEM_CONFIG, req => 'simulation-mode'), async (req, res) => {\n    try {\n      const { enabled, updatedBy } = req.body;\n      \n      if (typeof enabled !== 'boolean') {\n        return res.status(400).json({ error: \"Enabled must be a boolean value\" });\n      }\n      \n      const { configService } = await import('./services/config.js');\n      await configService.setSimulationMode(enabled, updatedBy || 'system');\n      const agentConfig = await configService.getAgentConfig();\n      \n      // Broadcast configuration change to connected clients in the same tenant\n      const tenantId = req.user?.tenantId || 'default-tenant';\n      broadcastToTenant(tenantId, {\n        type: 'agent_config_updated',\n        data: { simulationMode: enabled, updatedBy }\n      });\n      \n      res.json(agentConfig);\n    } catch (error) {\n      console.error(\"Error updating simulation mode:\", error);\n      res.status(500).json({ error: \"Failed to update simulation mode\" });\n    }\n  });\n\n  // AI Mode History routes\n  app.get(\"/api/ai-mode-history\", ...authenticatedAdmin, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const limit = parseInt(req.query.limit as string) || 10;\n      const history = await storage.getRecentAiModeHistory(limit, tenantId);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching AI mode history:\", error);\n      res.status(500).json({ error: \"Failed to fetch AI mode history\" });\n    }\n  });\n\n  // Get specific AI mode history with recommendations drill-down\n  app.get(\"/api/ai-mode-history/:id\", ...authenticated, async (req, res) => {\n    try {\n      const tenantId = req.user?.tenantId;\n      if (!tenantId) {\n        return res.status(401).json({ error: 'Invalid authentication: missing tenant context' });\n      }\n\n      const { id } = req.params;\n      const data = await storage.getAiModeHistoryWithRecommendations(id, tenantId);\n      \n      if (!data) {\n        return res.status(404).json({ error: 'AI mode history not found' });\n      }\n\n      res.json(data);\n    } catch (error) {\n      console.error(\"Error fetching AI mode history details:\", error);\n      res.status(500).json({ error: \"Failed to fetch AI mode history details\" });\n    }\n  });\n\n  // Manual AI analysis trigger endpoint\n  app.post(\"/api/ai/analyze\", ...authenticated, async (req, res) => {\n    try {\n      console.log('ü§ñ Manual AI analysis triggered...');\n      \n      // Trigger AI analysis manually (useful for testing)\n      schedulerService.triggerAIAnalysis().catch(err => {\n        console.error('AI analysis error:', err);\n      });\n      \n      await logAudit(req, {\n        action: auditActions.EXECUTE,\n        resourceType: 'ai_analysis',\n        metadata: { \n          prompt: req.body.prompt || 'manual_trigger',\n          tenantId: req.user?.tenantId || 'default-tenant'\n        }\n      });\n      \n      res.json({ \n        success: true, \n        message: 'AI analysis started. Check logs for progress.' \n      });\n    } catch (error) {\n      console.error(\"Error triggering AI analysis:\", error);\n      res.status(500).json({ error: \"Failed to trigger AI analysis\" });\n    }\n  });\n\n  // Execute optimization function\n  async function executeOptimization(recommendation: any) {\n    try {\n      let result;\n      \n      // Extract tenantId from recommendation\n      const tenantId = recommendation.tenantId || 'default-tenant';\n      \n      if (recommendation.type === 'resize' && recommendation.resourceId.includes('redshift')) {\n        // Execute Redshift cluster resize\n        const config = recommendation.recommendedConfig;\n        result = await awsService.resizeRedshiftCluster(\n          recommendation.resourceId,\n          config.nodeType,\n          config.numberOfNodes\n        );\n        \n        // Record the optimization in history\n        await storage.createOptimizationHistory({\n          tenantId,\n          recommendationId: recommendation.id,\n          executedBy: 'system', // In a real app, this would be the current user\n          executionDate: new Date(),\n          beforeConfig: recommendation.currentConfig,\n          afterConfig: recommendation.recommendedConfig,\n          actualSavings: recommendation.projectedMonthlySavings,\n          status: 'success'\n        }, tenantId);\n\n        // Send Slack notification\n        await sendOptimizationComplete({\n          title: recommendation.title,\n          resourceId: recommendation.resourceId,\n          actualSavings: Number(recommendation.projectedMonthlySavings),\n          status: 'success'\n        });\n      }\n      \n      return result;\n    } catch (error) {\n      // Extract tenantId from recommendation\n      const tenantId = recommendation.tenantId || 'default-tenant';\n      \n      // Record failed optimization\n      await storage.createOptimizationHistory({\n        tenantId,\n        recommendationId: recommendation.id,\n        executedBy: 'system',\n        executionDate: new Date(),\n        beforeConfig: recommendation.currentConfig,\n        afterConfig: recommendation.recommendedConfig,\n        status: 'failed',\n        errorMessage: error instanceof Error ? error.message : String(error)\n      }, tenantId);\n\n      await sendOptimizationComplete({\n        title: recommendation.title,\n        resourceId: recommendation.resourceId,\n        actualSavings: 0,\n        status: 'failed'\n      });\n\n      throw error;\n    }\n  }\n\n  return httpServer;\n}\n","size_bytes":52475},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2755},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthGuard } from \"@/components/AuthGuard\";\nimport Auth from \"@/pages/Auth\";\nimport Dashboard from \"@/pages/dashboard\";\nimport ExecutiveDashboard from \"@/pages/executive-dashboard\";\nimport CostAnalysis from \"@/pages/cost-analysis\";\nimport Recommendations from \"@/pages/recommendations\";\nimport Automation from \"@/pages/automation\";\nimport Governance from \"@/pages/governance\";\nimport AgentConfig from \"@/pages/agent-config\";\nimport FAQ from \"@/pages/faq\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/login\" component={Auth}/>\n      <Route path=\"/\">\n        {() => (\n          <AuthGuard>\n            <Dashboard />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route path=\"/executive\">\n        {() => (\n          <AuthGuard>\n            <ExecutiveDashboard />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route path=\"/cost-analysis\">\n        {() => (\n          <AuthGuard>\n            <CostAnalysis />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route path=\"/recommendations\">\n        {() => (\n          <AuthGuard>\n            <Recommendations />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route path=\"/automation\">\n        {() => (\n          <AuthGuard>\n            <Automation />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route path=\"/governance\">\n        {() => (\n          <AuthGuard>\n            <Governance />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route path=\"/agent-config\">\n        {() => (\n          <AuthGuard>\n            <AgentConfig />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route path=\"/faq\">\n        {() => (\n          <AuthGuard>\n            <FAQ />\n          </AuthGuard>\n        )}\n      </Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2318},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(210, 30%, 8%);\n  --foreground: hsl(210, 15%, 95%);\n  --card: hsl(215, 25%, 12%);\n  --card-foreground: hsl(210, 15%, 90%);\n  --popover: hsl(215, 28%, 10%);\n  --popover-foreground: hsl(210, 15%, 95%);\n  --primary: hsl(186, 100%, 50%);\n  --primary-foreground: hsl(210, 30%, 8%);\n  --secondary: hsl(215, 20%, 20%);\n  --secondary-foreground: hsl(210, 15%, 95%);\n  --muted: hsl(215, 20%, 16%);\n  --muted-foreground: hsl(210, 10%, 60%);\n  --accent: hsl(152, 70%, 45%);\n  --accent-foreground: hsl(0, 0%, 100%);\n  --destructive: hsl(0, 72%, 51%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --border: hsl(215, 22%, 20%);\n  --input: hsl(215, 24%, 18%);\n  --ring: hsl(186, 100%, 50%);\n  --chart-1: hsl(186, 100%, 50%);\n  --chart-2: hsl(280, 70%, 60%);\n  --chart-3: hsl(152, 70%, 45%);\n  --chart-4: hsl(45, 90%, 55%);\n  --chart-5: hsl(270, 75%, 55%);\n  --sidebar: hsl(215, 28%, 10%);\n  --sidebar-foreground: hsl(210, 15%, 90%);\n  --sidebar-primary: hsl(186, 100%, 50%);\n  --sidebar-primary-foreground: hsl(210, 30%, 8%);\n  --sidebar-accent: hsl(215, 22%, 16%);\n  --sidebar-accent-foreground: hsl(186, 100%, 60%);\n  --sidebar-border: hsl(215, 22%, 18%);\n  --sidebar-ring: hsl(186, 100%, 50%);\n  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 8px;\n  --shadow-2xs: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 1px 2px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 1px 2px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 2px 4px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 4px 6px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 8px 10px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --spacing: 0.25rem;\n}\n\n.dark {\n  --background: hsl(210, 30%, 8%);\n  --foreground: hsl(210, 15%, 95%);\n  --card: hsl(215, 25%, 12%);\n  --card-foreground: hsl(210, 15%, 90%);\n  --popover: hsl(215, 28%, 10%);\n  --popover-foreground: hsl(210, 15%, 95%);\n  --primary: hsl(186, 100%, 50%);\n  --primary-foreground: hsl(210, 30%, 8%);\n  --secondary: hsl(215, 20%, 20%);\n  --secondary-foreground: hsl(210, 15%, 95%);\n  --muted: hsl(215, 20%, 16%);\n  --muted-foreground: hsl(210, 10%, 60%);\n  --accent: hsl(152, 70%, 45%);\n  --accent-foreground: hsl(0, 0%, 100%);\n  --destructive: hsl(0, 72%, 51%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --border: hsl(215, 22%, 20%);\n  --input: hsl(215, 24%, 18%);\n  --ring: hsl(186, 100%, 50%);\n  --chart-1: hsl(186, 100%, 50%);\n  --chart-2: hsl(280, 70%, 60%);\n  --chart-3: hsl(152, 70%, 45%);\n  --chart-4: hsl(45, 90%, 55%);\n  --chart-5: hsl(270, 75%, 55%);\n  --sidebar: hsl(215, 28%, 10%);\n  --sidebar-foreground: hsl(210, 15%, 90%);\n  --sidebar-primary: hsl(186, 100%, 50%);\n  --sidebar-primary-foreground: hsl(210, 30%, 8%);\n  --sidebar-accent: hsl(215, 22%, 16%);\n  --sidebar-accent-foreground: hsl(186, 100%, 60%);\n  --sidebar-border: hsl(215, 22%, 18%);\n  --sidebar-ring: hsl(186, 100%, 50%);\n  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 8px;\n  --shadow-2xs: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 1px 2px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 1px 2px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 2px 4px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 4px 6px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00), 0px 8px 10px -1px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(202.8169, 89.1213%, 53.1373%, 0.00);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/* Custom enterprise styling */\n.metric-card {\n  background: var(--card);\n  border: 1px solid var(--border);\n  transition: all 0.2s ease-in-out;\n}\n\n.metric-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n}\n\n.chart-container {\n  background: linear-gradient(135deg, hsl(var(--primary), 0.05) 0%, hsl(var(--accent), 0.05) 100%);\n}\n\n.recommendation-card {\n  background: var(--card);\n  border-left: 4px solid var(--accent);\n}\n\n.critical-recommendation {\n  border-left-color: var(--destructive);\n}\n","size_bytes":5296},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/pages/agent-config.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Bot, Shield, Settings, AlertTriangle, Activity } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig as useAgentConfigHook } from \"@/hooks/use-agent-config\";\nimport { Sidebar } from \"@/components/layout/sidebar\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface AgentConfig {\n  autonomousMode: boolean;\n  prodMode: boolean;\n  simulationMode: boolean;\n  maxAutonomousRiskLevel: number;\n  approvalRequiredAboveSavings: number;\n  autoExecuteTypes: string[];\n}\n\nexport default function AgentConfig() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [localConfig, setLocalConfig] = useState<AgentConfig | null>(null);\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n  const { agentConfig: hookConfig, updateProdMode: hookUpdateProdMode } = useAgentConfigHook();\n\n  // Fetch current agent configuration\n  const { data: agentConfig, isLoading, error } = useQuery<AgentConfig>({\n    queryKey: ['/api/agent-config'],\n    staleTime: 30000, // 30 seconds\n    retry: false, // Don't retry on 403 errors\n  });\n\n  // Update local state when data changes\n  useEffect(() => {\n    if (agentConfig) {\n      setLocalConfig(agentConfig);\n    }\n  }, [agentConfig]);\n\n  // Mutation to update autonomous mode\n  const updateAutonomousMode = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      const response = await apiRequest('POST', '/api/agent-config/autonomous-mode', \n        { enabled, updatedBy: 'admin-user' }\n      );\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(['/api/agent-config'], data);\n      toast({\n        title: \"Configuration Updated\",\n        description: `Autonomous mode ${data.autonomousMode ? 'enabled' : 'disabled'} successfully.`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update autonomous mode configuration.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Mutation to update prod mode\n  const updateProdMode = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      const response = await apiRequest('POST', '/api/agent-config/prod-mode',\n        { enabled, updatedBy: 'admin-user' }\n      );\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(['/api/agent-config'], data);\n      toast({\n        title: \"Prod Mode Updated\",\n        description: `Prod Mode ${data.prodMode ? 'ON (AI with RAG)' : 'OFF (Heuristics)'} successfully.`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update prod mode configuration.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Mutation to trigger AI analysis manually\n  const triggerAIAnalysis = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', '/api/ai/analyze');\n      \n      // Handle 204 No Content response (no body to parse)\n      if (response.status === 204) {\n        return { success: true };\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"AI Analysis Started\",\n        description: \"AI-powered analysis with Gemini 2.5 Flash + RAG is running. New recommendations will appear shortly.\",\n      });\n      // Invalidate queries to refresh recommendations when analysis completes\n      setTimeout(() => {\n        queryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\n      }, 5000);\n    },\n    onError: () => {\n      toast({\n        title: \"Analysis Failed\",\n        description: \"Failed to trigger AI analysis. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Mutation to update risk level\n  const updateRiskLevel = useMutation({\n    mutationFn: async (riskLevel: number) => {\n      const response = await apiRequest('PUT', '/api/system-config/agent.max_autonomous_risk_level',\n        { value: riskLevel.toString(), updatedBy: 'admin-user' }\n      );\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/agent-config'] });\n      toast({\n        title: \"Risk Level Updated\",\n        description: \"Maximum autonomous risk level updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update risk level configuration.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleToggleAutonomous = async () => {\n    if (localConfig) {\n      await updateAutonomousMode.mutateAsync(!localConfig.autonomousMode);\n    }\n  };\n\n  // Mutation to update simulation mode\n  const updateSimulationMode = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      const response = await apiRequest('POST', '/api/agent-config/simulation-mode',\n        { enabled, updatedBy: 'admin-user' }\n      );\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(['/api/agent-config'], data);\n      toast({\n        title: \"Simulation Mode Updated\",\n        description: `Simulation Mode ${data.simulationMode ? 'ON (Dynamic Data)' : 'OFF (Static Data)'} successfully.`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update simulation mode configuration.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleToggleProdMode = async () => {\n    if (localConfig) {\n      await updateProdMode.mutateAsync(!localConfig.prodMode);\n    }\n  };\n\n  const handleToggleSimulationMode = async () => {\n    if (localConfig) {\n      await updateSimulationMode.mutateAsync(!localConfig.simulationMode);\n    }\n  };\n\n  const handleRiskLevelChange = async (value: string) => {\n    const riskLevel = parseFloat(value);\n    if (!isNaN(riskLevel) && riskLevel >= 0 && riskLevel <= 100) {\n      setLocalConfig(prev => prev ? { ...prev, maxAutonomousRiskLevel: riskLevel } : null);\n      await updateRiskLevel.mutateAsync(riskLevel);\n    }\n  };\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex flex-col bg-background\">\n        <TopNav \n          lastSync=\"Error\"\n          prodMode={false}\n          onProdModeChange={() => {}}\n          onMenuClick={() => setIsMobileSidebarOpen(true)}\n        />\n        <div className=\"flex-1 flex pt-[60px]\">\n          <Sidebar \n            isMobileOpen={isMobileSidebarOpen}\n            onClose={() => setIsMobileSidebarOpen(false)}\n          />\n          <main className=\"flex-1 overflow-hidden w-full\">\n            <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n              <Alert variant=\"destructive\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertTitle>Access Denied</AlertTitle>\n                <AlertDescription>\n                  You don't have permission to access agent configuration. \n                  This page requires administrator privileges.\n                </AlertDescription>\n              </Alert>\n            </div>\n          </main>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading || !localConfig) {\n    return (\n      <div className=\"min-h-screen flex flex-col bg-background\">\n        <TopNav \n          lastSync=\"Loading...\"\n          prodMode={false}\n          onProdModeChange={() => {}}\n          onMenuClick={() => setIsMobileSidebarOpen(true)}\n        />\n        <div className=\"flex-1 flex pt-[60px]\">\n          <Sidebar \n            isMobileOpen={isMobileSidebarOpen}\n            onClose={() => setIsMobileSidebarOpen(false)}\n          />\n          <main className=\"flex-1 overflow-hidden w-full\">\n            <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n              <div>\n                <h1 className=\"text-3xl font-bold\">Agent Configuration</h1>\n                <p className=\"text-muted-foreground\">Loading configuration...</p>\n              </div>\n            </div>\n          </main>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <TopNav \n        lastSync=\"1 min ago\"\n        prodMode={hookConfig?.prodMode || false}\n        onProdModeChange={hookUpdateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n          <div className=\"h-full overflow-y-auto p-4 sm:p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n          <Bot className=\"h-8 w-8\" />\n          Agent Configuration\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Configure autonomous AI agent behavior and safety controls\n        </p>\n      </div>\n\n      {/* Prod Mode Card */}\n      <Card className=\"border-cyan-500/30 bg-gradient-to-br from-background to-cyan-950/10\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Settings className=\"h-5 w-5 text-cyan-400\" />\n            Production Mode\n            <Badge variant={localConfig.prodMode ? \"default\" : \"secondary\"} className={localConfig.prodMode ? \"bg-cyan-500\" : \"\"} data-testid=\"prod-mode-badge\">\n              {localConfig.prodMode ? \"AI + RAG\" : \"HEURISTICS\"}\n            </Badge>\n          </CardTitle>\n          <CardDescription>\n            Toggle between AI-powered analysis with RAG and traditional heuristics-based analysis\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"prod-mode\" className=\"text-base font-medium\">\n                Production Mode\n              </Label>\n              <p className=\"text-sm text-muted-foreground\">\n                {localConfig.prodMode \n                  ? \"üöÄ AI-powered analysis with Gemini 2.5 Flash + RAG (learns from historical optimizations)\" \n                  : \"‚öôÔ∏è Traditional heuristics-based analysis (rule-based thresholds)\"\n                }\n              </p>\n            </div>\n            <Switch\n              id=\"prod-mode\"\n              checked={localConfig.prodMode}\n              onCheckedChange={handleToggleProdMode}\n              disabled={updateProdMode.isPending}\n              data-testid=\"prod-mode-toggle\"\n            />\n          </div>\n\n          {localConfig.prodMode && (\n            <>\n              <Alert className=\"border-cyan-500/30 bg-cyan-950/10\">\n                <Bot className=\"h-4 w-4 text-cyan-400\" />\n                <AlertDescription>\n                  <strong>AI Mode Active.</strong> Using Gemini 2.5 Flash with Retrieval Augmented Generation (RAG) \n                  to analyze resources based on historical optimization patterns and intelligent context analysis.\n                </AlertDescription>\n              </Alert>\n              \n              <div className=\"pt-2\">\n                <Button \n                  onClick={() => triggerAIAnalysis.mutate()}\n                  disabled={triggerAIAnalysis.isPending}\n                  className=\"w-full sm:w-auto bg-cyan-500 hover:bg-cyan-600\"\n                  data-testid=\"trigger-ai-analysis-button\"\n                >\n                  {triggerAIAnalysis.isPending ? (\n                    <>\n                      <Bot className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Running AI Analysis...\n                    </>\n                  ) : (\n                    <>\n                      <Bot className=\"mr-2 h-4 w-4\" />\n                      Run AI Analysis Now\n                    </>\n                  )}\n                </Button>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Manually trigger AI-powered analysis. Normally runs automatically every 6 hours.\n                </p>\n              </div>\n            </>\n          )}\n\n          {!localConfig.prodMode && (\n            <Alert>\n              <AlertDescription>\n                <strong>Heuristics Mode Active.</strong> Using traditional rule-based analysis with fixed thresholds \n                (CPU &lt;40% triggers resize recommendations).\n              </AlertDescription>\n            </Alert>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Simulation Mode Card */}\n      <Card className=\"border-purple-500/30 bg-gradient-to-br from-background to-purple-950/10\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Activity className=\"h-5 w-5 text-purple-400\" />\n            Simulation Mode\n            <Badge variant={localConfig.simulationMode ? \"default\" : \"secondary\"} className={localConfig.simulationMode ? \"bg-purple-500\" : \"\"} data-testid=\"simulation-mode-badge\">\n              {localConfig.simulationMode ? \"ON\" : \"OFF\"}\n            </Badge>\n          </CardTitle>\n          <CardDescription>\n            Toggle between dynamic synthetic data generation and static data mode\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"simulation-mode\" className=\"text-base font-medium\">\n                Simulation Mode\n              </Label>\n              <p className=\"text-sm text-muted-foreground\">\n                {localConfig.simulationMode \n                  ? \"üìä Dynamic data generation active (synthetic resource evolution over time)\" \n                  : \"üìã Static data mode (fixed resource snapshots)\"\n                }\n              </p>\n            </div>\n            <Switch\n              id=\"simulation-mode\"\n              checked={localConfig.simulationMode}\n              onCheckedChange={handleToggleSimulationMode}\n              disabled={updateSimulationMode.isPending}\n              data-testid=\"simulation-mode-toggle\"\n            />\n          </div>\n\n          {localConfig.simulationMode && (\n            <Alert className=\"border-purple-500/30 bg-purple-950/10\">\n              <Activity className=\"h-4 w-4 text-purple-400\" />\n              <AlertDescription>\n                <strong>Simulation Active.</strong> Generating synthetic data that evolves over time with realistic \n                usage patterns, cost fluctuations, and resource lifecycle events.\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {!localConfig.simulationMode && (\n            <Alert>\n              <AlertDescription>\n                <strong>Static Mode Active.</strong> Using fixed resource data without time-based evolution.\n              </AlertDescription>\n            </Alert>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Autonomous Mode Card */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bot className=\"h-5 w-5\" />\n            Autonomous Operation Mode\n            <Badge variant={localConfig.autonomousMode ? \"default\" : \"secondary\"} data-testid=\"mode-badge\">\n              {localConfig.autonomousMode ? \"AUTONOMOUS\" : \"MANUAL APPROVAL\"}\n            </Badge>\n          </CardTitle>\n          <CardDescription>\n            Enable autonomous execution of cost optimization recommendations without human approval\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"autonomous-mode\" className=\"text-base font-medium\">\n                Autonomous Execution\n              </Label>\n              <p className=\"text-sm text-muted-foreground\">\n                {localConfig.autonomousMode \n                  ? \"Agent will automatically execute approved optimization recommendations\" \n                  : \"All recommendations require manual approval before execution\"\n                }\n              </p>\n            </div>\n            <Switch\n              id=\"autonomous-mode\"\n              checked={localConfig.autonomousMode}\n              onCheckedChange={handleToggleAutonomous}\n              disabled={updateAutonomousMode.isPending}\n              data-testid=\"autonomous-toggle\"\n            />\n          </div>\n\n          {localConfig.autonomousMode && (\n            <Alert>\n              <AlertTriangle className=\"h-4 w-4\" />\n              <AlertDescription>\n                <strong>Autonomous mode is active.</strong> The agent will automatically execute \n                optimizations that meet the safety criteria below. Monitor the system closely.\n              </AlertDescription>\n            </Alert>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Safety Controls Card */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Shield className=\"h-5 w-5\" />\n            Safety Controls\n          </CardTitle>\n          <CardDescription>\n            Configure safety thresholds for autonomous execution\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"space-y-3\">\n            <Label htmlFor=\"risk-level\" className=\"text-base font-medium\">\n              Maximum Risk Level for Autonomous Execution\n            </Label>\n            <div className=\"flex items-center gap-4\">\n              <Input\n                id=\"risk-level\"\n                type=\"number\"\n                value={localConfig.maxAutonomousRiskLevel}\n                onChange={(e) => handleRiskLevelChange(e.target.value)}\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                className=\"w-32\"\n                data-testid=\"risk-level-input\"\n              />\n              <span className=\"text-sm text-muted-foreground\">\n                % risk threshold (recommendations above this require approval)\n              </span>\n            </div>\n          </div>\n\n          <Separator />\n\n          <div className=\"space-y-3\">\n            <Label className=\"text-base font-medium\">\n              Annual Savings Threshold\n            </Label>\n            <div className=\"flex items-center gap-4\">\n              <Input\n                type=\"text\"\n                value={formatCurrencyK(localConfig.approvalRequiredAboveSavings)}\n                readOnly\n                className=\"w-48\"\n                data-testid=\"savings-threshold-input\"\n              />\n              <span className=\"text-sm text-muted-foreground\">\n                USD/year (recommendations above this always require approval)\n              </span>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              High-value optimizations above this threshold will always require human approval, \n              regardless of risk level.\n            </p>\n          </div>\n\n          <Separator />\n\n          <div className=\"space-y-3\">\n            <Label className=\"text-base font-medium\">\n              Autonomous Execution Types\n            </Label>\n            <div className=\"flex gap-2 flex-wrap\">\n              {localConfig.autoExecuteTypes.map((type) => (\n                <Badge key={type} variant=\"outline\" data-testid={`auto-type-${type}`}>\n                  {type}\n                </Badge>\n              ))}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              Only these recommendation types can be executed autonomously. \n              Other types always require approval.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* System Status Card */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Settings className=\"h-5 w-5\" />\n            System Status\n          </CardTitle>\n          <CardDescription>\n            Current agent configuration and operational status\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 gap-4 text-sm\">\n            <div>\n              <p className=\"font-medium\">Analysis Mode</p>\n              <p className=\"text-muted-foreground\">\n                {localConfig.prodMode ? \"AI + RAG (Gemini 2.5 Flash)\" : \"Heuristics (Rule-based)\"}\n              </p>\n            </div>\n            <div>\n              <p className=\"font-medium\">Data Mode</p>\n              <p className=\"text-muted-foreground\">\n                {localConfig.simulationMode ? \"Dynamic (Simulation)\" : \"Static\"}\n              </p>\n            </div>\n            <div>\n              <p className=\"font-medium\">Operation Mode</p>\n              <p className=\"text-muted-foreground\">\n                {localConfig.autonomousMode ? \"Autonomous\" : \"Manual Approval Required\"}\n              </p>\n            </div>\n            <div>\n              <p className=\"font-medium\">Max Risk Level</p>\n              <p className=\"text-muted-foreground\">{localConfig.maxAutonomousRiskLevel}%</p>\n            </div>\n            <div>\n              <p className=\"font-medium\">Approval Threshold</p>\n              <p className=\"text-muted-foreground\">\n                {formatCurrencyK(localConfig.approvalRequiredAboveSavings)}/year\n              </p>\n            </div>\n            <div>\n              <p className=\"font-medium\">Auto-execute Types</p>\n              <p className=\"text-muted-foreground\">{localConfig.autoExecuteTypes.length} types</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}","size_bytes":22411},"client/src/components/modals/approval-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { AlertTriangle, X, User } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Recommendation } from \"@shared/schema\";\nimport { postIntent, pollTaskStatus, mapHITLToIntentParams, type TaskStatusResponse, type PlatformIntentResponse } from \"@/lib/aosClient\";\nimport { TaskStatusBadge } from \"@/components/TaskStatusBadge\";\nimport { TraceIdFooter } from \"@/components/TraceIdFooter\";\n\nexport function ApprovalModal() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedRecommendationId, setSelectedRecommendationId] = useState<string | null>(null);\n  const [platformIntentResponse, setPlatformIntentResponse] = useState<PlatformIntentResponse | null>(null);\n  const [taskStatus, setTaskStatus] = useState<TaskStatusResponse | null>(null);\n  const { toast } = useToast();\n\n  // Listen for modal open events\n  useEffect(() => {\n    const handleOpenModal = (event: CustomEvent) => {\n      setSelectedRecommendationId(event.detail.recommendationId);\n      setIsOpen(true);\n    };\n\n    window.addEventListener('openApprovalModal', handleOpenModal as EventListener);\n    return () => {\n      window.removeEventListener('openApprovalModal', handleOpenModal as EventListener);\n    };\n  }, []);\n\n  const { data: recommendation } = useQuery<Recommendation>({\n    queryKey: ['/api/recommendations', selectedRecommendationId],\n    enabled: !!selectedRecommendationId,\n  });\n\n  const approvalMutation = useMutation({\n    mutationFn: async ({ status, comments }: { status: string; comments?: string }) => {\n      if (!selectedRecommendationId) throw new Error(\"No recommendation selected\");\n      \n      // Create approval request in local system (always)\n      await apiRequest('POST', '/api/approval-requests', {\n        recommendationId: selectedRecommendationId,\n        requestedBy: 'current-user',\n        approverRole: 'Head of Cloud Platform',\n        status,\n        comments,\n        approvedBy: status === 'approved' ? 'current-user' : undefined,\n        approvalDate: status === 'approved' ? new Date() : undefined\n      });\n\n      // If approved and recommendation exists, send intent to platform\n      if (status === 'approved' && recommendation) {\n        try {\n          // Determine HITL mode from executionMode (HITL = true, autonomous = false)\n          const isHITL = recommendation.executionMode === 'hitl';\n          const intentParams = mapHITLToIntentParams(isHITL);\n\n          // Post intent to platform with idempotency key\n          const intentResponse = await postIntent(\n            'finops',\n            'execute',\n            {\n              intent: 'optimize-resource',\n              targets: [recommendation.resourceId],\n              ...intentParams,\n              metadata: {\n                recommendationId: selectedRecommendationId,\n                title: recommendation.title,\n                type: recommendation.type,\n                projectedSavings: recommendation.projectedMonthlySavings,\n              }\n            },\n            {\n              idempotencyKey: `finops-approval-${selectedRecommendationId}`,\n            }\n          );\n\n          setPlatformIntentResponse(intentResponse);\n\n          // Check if platform is in degraded mode\n          if (intentResponse.status === 'failed' && intentResponse.result?.degraded) {\n            // Show degraded-mode notification\n            toast({\n              title: \"Platform Unavailable\",\n              description: \"Approval saved locally. Platform integration is currently unavailable - optimization will sync when platform is back online.\",\n              variant: \"default\",\n            });\n          } else {\n            // Start polling task status only if platform is working\n            pollTaskStatus(intentResponse.task_id, {\n              intervalMs: 1000,\n              timeoutMs: 30000,\n              onProgress: (status) => {\n                setTaskStatus(status);\n              }\n            }).catch((error) => {\n              console.error('Task polling error:', error);\n            });\n          }\n\n        } catch (error) {\n          console.error('Platform intent error:', error);\n          // Don't fail the approval if platform intent fails\n          // The local approval is already complete\n        }\n      }\n    },\n    onSuccess: async (_, variables) => {\n      // Show approval success message (only if platform is not showing degraded toast)\n      if (!platformIntentResponse || platformIntentResponse.status !== 'failed') {\n        toast({\n          title: variables.status === 'approved' ? \"Optimization Approved\" : \"Optimization Rejected\",\n          description: variables.status === 'approved' \n            ? \"The optimization will be executed during the next maintenance window.\"\n            : \"The optimization request has been rejected.\",\n        });\n      }\n      \n      // Force refresh recommendation data and activity feed\n      await queryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\n      await queryClient.invalidateQueries({ queryKey: ['/api/approval-requests'] });\n      await queryClient.invalidateQueries({ queryKey: ['/api/optimization-history'] });\n      await queryClient.refetchQueries({ queryKey: ['/api/recommendations'] });\n      \n      setIsOpen(false);\n      setSelectedRecommendationId(null);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to process approval request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleApprove = () => {\n    approvalMutation.mutate({ status: 'approved' });\n  };\n\n  const handleReject = () => {\n    approvalMutation.mutate({ status: 'rejected', comments: 'Rejected via dashboard' });\n  };\n\n  const handleClose = () => {\n    setIsOpen(false);\n    setSelectedRecommendationId(null);\n  };\n\n  if (!recommendation) {\n    return null;\n  }\n\n  const currentConfig = recommendation.currentConfig as any;\n  const recommendedConfig = recommendation.recommendedConfig as any;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogContent className=\"max-w-2xl\" data-testid=\"approval-modal\" aria-describedby=\"approval-description\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-xl font-bold text-foreground\">Approve Optimization</DialogTitle>\n            <Button variant=\"ghost\" size=\"sm\" onClick={handleClose} data-testid=\"button-close-modal\">\n              <X className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </DialogHeader>\n        \n        <div className=\"space-y-6\">\n          <div id=\"approval-description\" className=\"bg-destructive/10 border border-destructive/20 rounded-lg p-4\">\n            <div className=\"flex items-start space-x-3\">\n              <AlertTriangle className=\"text-destructive text-lg mt-1 flex-shrink-0\" />\n              <div>\n                <h3 className=\"font-semibold text-destructive mb-2\">Critical Resource Optimization</h3>\n                <p className=\"text-sm text-foreground\" data-testid=\"optimization-description\">\n                  {recommendation.description}\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-6\">\n            <div className=\"space-y-3\">\n              <h4 className=\"font-semibold text-foreground\">Current Configuration</h4>\n              <div className=\"space-y-2 text-sm\">\n                {currentConfig.nodeType && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Instance Type:</span>\n                    <span className=\"font-medium\" data-testid=\"current-instance-type\">{currentConfig.nodeType}</span>\n                  </div>\n                )}\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Monthly Cost:</span>\n                  <span className=\"font-medium\" data-testid=\"current-monthly-cost\">\n                    {formatCurrencyK(recommendation.projectedMonthlySavings + 7560000)}\n                  </span>\n                </div>\n                {currentConfig.utilization && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Avg Utilization:</span>\n                    <span className=\"font-medium text-destructive\" data-testid=\"current-utilization\">\n                      {Math.round(currentConfig.utilization)}%\n                    </span>\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            <div className=\"space-y-3\">\n              <h4 className=\"font-semibold text-foreground\">Recommended Configuration</h4>\n              <div className=\"space-y-2 text-sm\">\n                {recommendedConfig.nodeType && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Instance Type:</span>\n                    <span className=\"font-medium text-accent\" data-testid=\"recommended-instance-type\">{recommendedConfig.nodeType}</span>\n                  </div>\n                )}\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Monthly Cost:</span>\n                  <span className=\"font-medium text-accent\" data-testid=\"recommended-monthly-cost\">{formatCurrencyK(7560000)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Expected Utilization:</span>\n                  <span className=\"font-medium text-accent\" data-testid=\"expected-utilization\">85%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-accent/10 border border-accent/20 rounded-lg p-4\">\n            <h4 className=\"font-semibold text-accent mb-2\">Impact Analysis</h4>\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div>\n                <span className=\"text-muted-foreground\">Monthly Savings:</span>\n                <span className=\"font-bold text-accent ml-2\" data-testid=\"monthly-savings\">\n                  {formatCurrencyK(recommendation.projectedMonthlySavings)}\n                </span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Annual Savings:</span>\n                <span className=\"font-bold text-accent ml-2\" data-testid=\"annual-savings\">\n                  {formatCurrencyK(recommendation.projectedMonthlySavings * 12)}\n                </span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Performance Risk:</span>\n                <span className=\"font-medium text-accent ml-2\" data-testid=\"performance-risk\">\n                  &lt; {recommendation.riskLevel}%\n                </span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Maintenance Window:</span>\n                <span className=\"font-medium ml-2\" data-testid=\"maintenance-window\">Sun 2-4 AM EST</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Platform Task Status */}\n          {taskStatus && (\n            <div className=\"flex items-center justify-between border-t pt-4\">\n              <div className=\"text-sm text-muted-foreground\">\n                Platform Execution Status:\n              </div>\n              <TaskStatusBadge status={taskStatus} />\n            </div>\n          )}\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n              <User className=\"w-4 h-4\" />\n              <span>Requires Head of Cloud Platform approval</span>\n              {taskStatus && (\n                <span className=\"ml-4 text-xs font-mono text-cyan-400\">\n                  task_id: {platformIntentResponse?.task_id}\n                </span>\n              )}\n            </div>\n            <div className=\"flex space-x-3\">\n              <Button \n                variant=\"outline\" \n                onClick={handleReject}\n                disabled={approvalMutation.isPending}\n                data-testid=\"button-reject\"\n              >\n                Reject\n              </Button>\n              <Button \n                onClick={handleApprove}\n                disabled={approvalMutation.isPending}\n                data-testid=\"button-approve\"\n              >\n                {approvalMutation.isPending ? \"Processing...\" : \"Approve Optimization\"}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n      <TraceIdFooter traceId={platformIntentResponse?.trace_id} />\n    </Dialog>\n  );\n}\n","size_bytes":13247},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/dashboard/cost-trends-chart.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from \"recharts\";\nimport { formatCurrencyK } from '@/lib/currency';\nimport { useState } from \"react\";\nimport { TrendingUp } from \"lucide-react\";\n\ninterface CostTrend {\n  month: string;\n  totalCost: number;\n}\n\nexport function CostTrendsChart() {\n  const [timeRange, setTimeRange] = useState('6M');\n  \n  const { data: trends, isLoading } = useQuery<CostTrend[]>({\n    queryKey: ['/api/dashboard/cost-trends'],\n    refetchInterval: 300000, // Refresh every 5 minutes\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Cost Trends & Optimization Impact</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-64 flex items-center justify-center\">\n            <div className=\"animate-pulse text-muted-foreground\">Loading chart data...</div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!trends || trends.length === 0) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Cost Trends & Optimization Impact</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-64 flex items-center justify-center text-center\">\n            <div>\n              <TrendingUp className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">No cost data available</p>\n              <p className=\"text-sm text-muted-foreground mt-2\">Cost trends will appear here once data is synced</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Transform data for chart\n  const chartData = trends.map(trend => ({\n    month: new Date(trend.month + '-01').toLocaleDateString('en-US', { month: 'short', year: '2-digit' }),\n    actualSpend: trend.totalCost,\n    projectedSavings: trend.totalCost * 0.15 // Simplified projection\n  }));\n\n  return (\n    <Card data-testid=\"cost-trends-chart\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"text-lg font-semibold text-foreground\">Cost Trends & Optimization Impact</CardTitle>\n            <p className=\"text-muted-foreground text-sm\">Monthly spend vs. projected savings</p>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Button \n              variant={timeRange === '3M' ? \"default\" : \"outline\"} \n              size=\"sm\"\n              onClick={() => setTimeRange('3M')}\n              data-testid=\"button-3m\"\n            >\n              3M\n            </Button>\n            <Button \n              variant={timeRange === '6M' ? \"default\" : \"outline\"} \n              size=\"sm\"\n              onClick={() => setTimeRange('6M')}\n              data-testid=\"button-6m\"\n            >\n              6M\n            </Button>\n            <Button \n              variant={timeRange === '12M' ? \"default\" : \"outline\"} \n              size=\"sm\"\n              onClick={() => setTimeRange('12M')}\n              data-testid=\"button-12m\"\n            >\n              12M\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"h-64\" data-testid=\"chart-container\">\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <LineChart data={chartData}>\n              <CartesianGrid strokeDasharray=\"3 3\" className=\"opacity-30\" />\n              <XAxis \n                dataKey=\"month\" \n                axisLine={false}\n                tickLine={false}\n                className=\"text-sm\"\n              />\n              <YAxis \n                axisLine={false}\n                tickLine={false}\n                className=\"text-sm\"\n                tickFormatter={(value) => formatCurrencyK(value)}\n              />\n              <Tooltip \n                formatter={(value: number) => [formatCurrencyK(value), '']}\n                labelFormatter={(label) => `Month: ${label}`}\n                contentStyle={{\n                  backgroundColor: 'hsl(var(--card))',\n                  border: '1px solid hsl(var(--border))',\n                  borderRadius: '8px',\n                  color: 'hsl(var(--foreground))'\n                }}\n              />\n              <Legend />\n              <Line \n                type=\"monotone\" \n                dataKey=\"actualSpend\" \n                stroke=\"hsl(var(--primary))\" \n                strokeWidth={2}\n                name=\"Actual Spend\"\n                dot={{ fill: 'hsl(var(--primary))', strokeWidth: 2 }}\n              />\n              <Line \n                type=\"monotone\" \n                dataKey=\"projectedSavings\" \n                stroke=\"hsl(var(--accent))\" \n                strokeWidth={2}\n                name=\"Projected Savings\"\n                dot={{ fill: 'hsl(var(--accent))', strokeWidth: 2 }}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        </div>\n        <div className=\"flex justify-center space-x-4 mt-4 text-sm\">\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-primary rounded mr-2\"></div>\n            <span>Actual Spend</span>\n          </div>\n          <div className=\"flex items-center\">\n            <div className=\"w-3 h-3 bg-accent rounded mr-2\"></div>\n            <span>Projected Savings</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":5582},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"server/storage.ts":{"content":"import { \n  users, awsResources, costReports, recommendations, optimizationHistory, approvalRequests, systemConfig, aiModeHistory,\n  type User, type InsertUser, type AwsResource, type InsertAwsResource,\n  type CostReport, type InsertCostReport, type Recommendation, type InsertRecommendation,\n  type OptimizationHistory, type InsertOptimizationHistory, type ApprovalRequest, type InsertApprovalRequest,\n  type SystemConfig, type InsertSystemConfig, type AiModeHistory, type InsertAiModeHistory\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, gte, lte, sql } from \"drizzle-orm\";\nimport { pineconeService } from \"./services/pinecone.js\";\nimport { CircuitBreaker } from \"./lib/circuit-breaker.js\";\nimport bcrypt from \"bcrypt\";\n\n// Circuit breaker for Pinecone operations\n// Exported for use in other services (e.g., gemini-ai.ts)\nexport const pineconeCircuitBreaker = new CircuitBreaker('Pinecone', {\n  failureThreshold: 5,\n  successThreshold: 2,\n  timeout: 30000 // 30 seconds\n});\n\nconst SALT_ROUNDS = 10;\n\nexport async function hashPassword(password: string): Promise<string> {\n  return await bcrypt.hash(password, SALT_ROUNDS);\n}\n\nexport async function validatePassword(password: string, hashedPassword: string): Promise<boolean> {\n  return await bcrypt.compare(password, hashedPassword);\n}\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string, tenantId: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser, tenantId: string): Promise<User>;\n\n  // AWS Resources\n  createAwsResource(resource: InsertAwsResource, tenantId: string): Promise<AwsResource>;\n  getAwsResource(resourceId: string, tenantId: string): Promise<AwsResource | undefined>;\n  updateAwsResource(resourceId: string, updates: Partial<InsertAwsResource>, tenantId: string): Promise<AwsResource | undefined>;\n  getAllAwsResources(tenantId: string): Promise<AwsResource[]>;\n\n  // Cost Reports\n  createCostReport(report: InsertCostReport, tenantId: string): Promise<CostReport>;\n  getCostReports(tenantId: string, dateFrom?: Date, dateTo?: Date): Promise<CostReport[]>;\n  getMonthlyCostSummary(tenantId: string): Promise<{ month: string; totalCost: number; }[]>;\n\n  // Recommendations\n  createRecommendation(recommendation: InsertRecommendation, tenantId: string): Promise<Recommendation>;\n  getRecommendations(tenantId: string, status?: string): Promise<Recommendation[]>;\n  getRecentRecommendations(limit: number, tenantId: string): Promise<Recommendation[]>;\n  getRecommendation(id: string, tenantId: string): Promise<Recommendation | undefined>;\n  updateRecommendationStatus(id: string, status: string, tenantId: string): Promise<Recommendation | undefined>;\n  \n  // Optimization History\n  createOptimizationHistory(history: InsertOptimizationHistory, tenantId: string): Promise<OptimizationHistory>;\n  getOptimizationHistory(tenantId: string, limit?: number): Promise<OptimizationHistory[]>;\n  getRecentOptimizationHistory(limit: number, tenantId: string): Promise<OptimizationHistory[]>;\n\n  // Approval Requests\n  createApprovalRequest(request: InsertApprovalRequest, tenantId: string): Promise<ApprovalRequest>;\n  getApprovalRequests(tenantId: string, status?: string): Promise<ApprovalRequest[]>;\n  updateApprovalRequest(id: string, updates: Partial<InsertApprovalRequest>, tenantId: string): Promise<ApprovalRequest | undefined>;\n\n  // System Configuration\n  getSystemConfig(key: string, tenantId: string): Promise<SystemConfig | undefined>;\n  setSystemConfig(config: InsertSystemConfig, tenantId: string): Promise<SystemConfig>;\n  updateSystemConfig(key: string, value: string, updatedBy: string, tenantId: string): Promise<SystemConfig | undefined>;\n  getAllSystemConfig(tenantId: string): Promise<SystemConfig[]>;\n\n  // AI Mode History\n  createAiModeHistory(history: InsertAiModeHistory, tenantId: string): Promise<AiModeHistory>;\n  updateAiModeHistory(id: string, updates: Partial<InsertAiModeHistory>, tenantId: string): Promise<AiModeHistory | undefined>;\n  getRecentAiModeHistory(limit: number, tenantId: string): Promise<AiModeHistory[]>;\n  getAiModeHistory(id: string, tenantId: string): Promise<AiModeHistory | undefined>;\n  getAiModeHistoryWithRecommendations(id: string, tenantId: string): Promise<{\n    aiRun: AiModeHistory;\n    recommendations: Recommendation[];\n    savingsBreakdown: {\n      totalSavings: number;\n      averageSavings: number;\n      savingsByType: Record<string, number>;\n    };\n    executionModeCounts: {\n      autonomous: number;\n      hitl: number;\n      autonomousPercentage: number;\n      hitlPercentage: number;\n    };\n  } | undefined>;\n\n  // Dashboard metrics\n  getDashboardMetrics(tenantId: string): Promise<{\n    monthlySpend: number;\n    identifiedSavings: number;\n    resourcesAnalyzed: number;\n    wastePercentage: number;\n  }>;\n\n  // Metrics summary for autopilot\n  getMetricsSummary(tenantId: string): Promise<{\n    monthlySpend: number;\n    ytdSpend: number;\n    autonomousSavingsPending: number;\n    hitlSavingsAwaiting: number;\n    realizedSavingsYTD: number;\n    wastePercentOptimizedYTD: number;\n    monthlySpendChange: number;\n    ytdSpendChange: number;\n  }>;\n\n  // Optimization mix (Autonomous vs HITL distribution)\n  getOptimizationMix(tenantId: string): Promise<{\n    autonomousCount: number;\n    hitlCount: number;\n    autonomousPercentage: number;\n    hitlPercentage: number;\n    totalRecommendations: number;\n  }>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string, tenantId: string): Promise<User | undefined> {\n    const [user] = await db.select()\n      .from(users)\n      .where(\n        and(\n          eq(users.id, id),\n          eq(users.tenantId, tenantId)\n        )\n      );\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser, tenantId: string): Promise<User> {\n    const hashedPassword = await hashPassword(insertUser.password);\n    const [user] = await db\n      .insert(users)\n      .values({ ...insertUser, password: hashedPassword, tenantId })\n      .returning();\n    return user;\n  }\n\n  async createAwsResource(resource: InsertAwsResource, tenantId: string): Promise<AwsResource> {\n    const [created] = await db\n      .insert(awsResources)\n      .values({ ...resource, tenantId })\n      .returning();\n    return created;\n  }\n\n  async getAwsResource(resourceId: string, tenantId: string): Promise<AwsResource | undefined> {\n    const [resource] = await db\n      .select()\n      .from(awsResources)\n      .where(\n        and(\n          eq(awsResources.resourceId, resourceId),\n          eq(awsResources.tenantId, tenantId)\n        )\n      );\n    return resource || undefined;\n  }\n\n  async updateAwsResource(resourceId: string, updates: Partial<InsertAwsResource>, tenantId: string): Promise<AwsResource | undefined> {\n    const [updated] = await db\n      .update(awsResources)\n      .set({ ...updates, lastAnalyzed: new Date() })\n      .where(\n        and(\n          eq(awsResources.resourceId, resourceId),\n          eq(awsResources.tenantId, tenantId)\n        )\n      )\n      .returning();\n    return updated || undefined;\n  }\n\n  async getAllAwsResources(tenantId: string): Promise<AwsResource[]> {\n    return await db.select()\n      .from(awsResources)\n      .where(eq(awsResources.tenantId, tenantId));\n  }\n\n  async createCostReport(report: InsertCostReport, tenantId: string): Promise<CostReport> {\n    const [created] = await db\n      .insert(costReports)\n      .values({ ...report, tenantId })\n      .returning();\n    return created;\n  }\n\n  async getCostReports(tenantId: string, dateFrom?: Date, dateTo?: Date): Promise<CostReport[]> {\n    if (dateFrom && dateTo) {\n      return await db\n        .select()\n        .from(costReports)\n        .where(\n          and(\n            eq(costReports.tenantId, tenantId),\n            gte(costReports.reportDate, dateFrom),\n            lte(costReports.reportDate, dateTo)\n          )\n        )\n        .orderBy(desc(costReports.reportDate));\n    }\n    \n    return await db\n      .select()\n      .from(costReports)\n      .where(eq(costReports.tenantId, tenantId))\n      .orderBy(desc(costReports.reportDate));\n  }\n\n  async getMonthlyCostSummary(tenantId: string): Promise<{ month: string; totalCost: number; }[]> {\n    const result = await db\n      .select({\n        month: sql<string>`TO_CHAR(${costReports.reportDate}, 'YYYY-MM')`,\n        totalCost: sql<number>`SUM(${costReports.cost})::numeric`\n      })\n      .from(costReports)\n      .where(eq(costReports.tenantId, tenantId))\n      .groupBy(sql`TO_CHAR(${costReports.reportDate}, 'YYYY-MM')`)\n      .orderBy(sql`TO_CHAR(${costReports.reportDate}, 'YYYY-MM')`);\n    \n    return result.map(r => ({ month: r.month, totalCost: Number(r.totalCost) }));\n  }\n\n  async createRecommendation(recommendation: InsertRecommendation, tenantId: string): Promise<Recommendation> {\n    const [created] = await db\n      .insert(recommendations)\n      .values({ ...recommendation, tenantId })\n      .returning();\n    \n    // Store in Pinecone for RAG (async, non-blocking) with circuit breaker protection\n    pineconeCircuitBreaker.executeWithFallback(\n      () => pineconeService.storeRecommendation(created)\n    ).catch(err => {\n      console.warn('[Storage] Pinecone storage degraded, skipping vector storage for recommendation:', created.id);\n      console.error('Pinecone error:', err.message || err);\n    });\n    \n    return created;\n  }\n\n  async getRecommendations(tenantId: string, status?: string): Promise<Recommendation[]> {\n    if (status) {\n      return await db\n        .select()\n        .from(recommendations)\n        .where(\n          and(\n            eq(recommendations.tenantId, tenantId),\n            eq(recommendations.status, status)\n          )\n        )\n        .orderBy(desc(recommendations.createdAt));\n    }\n    \n    return await db\n      .select()\n      .from(recommendations)\n      .where(eq(recommendations.tenantId, tenantId))\n      .orderBy(desc(recommendations.createdAt));\n  }\n\n  async getRecommendation(id: string, tenantId: string): Promise<Recommendation | undefined> {\n    const [recommendation] = await db\n      .select()\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.id, id),\n          eq(recommendations.tenantId, tenantId)\n        )\n      );\n    return recommendation || undefined;\n  }\n\n  async updateRecommendationStatus(id: string, status: string, tenantId: string): Promise<Recommendation | undefined> {\n    const [updated] = await db\n      .update(recommendations)\n      .set({ status, updatedAt: new Date() })\n      .where(\n        and(\n          eq(recommendations.id, id),\n          eq(recommendations.tenantId, tenantId)\n        )\n      )\n      .returning();\n    return updated || undefined;\n  }\n\n  async createOptimizationHistory(history: InsertOptimizationHistory, tenantId: string): Promise<OptimizationHistory> {\n    const [created] = await db\n      .insert(optimizationHistory)\n      .values({ ...history, tenantId })\n      .returning();\n    \n    // Store in Pinecone for RAG (async, non-blocking) with circuit breaker protection\n    pineconeCircuitBreaker.executeWithFallback(\n      () => pineconeService.storeOptimizationHistory(created)\n    ).catch(err => {\n      console.warn('[Storage] Pinecone storage degraded, skipping vector storage for optimization history:', created.id);\n      console.error('Pinecone error:', err.message || err);\n    });\n    \n    return created;\n  }\n\n  async getOptimizationHistory(tenantId: string, limit = 50): Promise<OptimizationHistory[]> {\n    return await db\n      .select()\n      .from(optimizationHistory)\n      .where(eq(optimizationHistory.tenantId, tenantId))\n      .orderBy(desc(optimizationHistory.createdAt))\n      .limit(limit);\n  }\n\n  // Optimized: Get recent recommendations with database-level limit\n  async getRecentRecommendations(limit: number, tenantId: string): Promise<Recommendation[]> {\n    return await db\n      .select()\n      .from(recommendations)\n      .where(eq(recommendations.tenantId, tenantId))\n      .orderBy(desc(recommendations.createdAt))\n      .limit(limit);\n  }\n\n  // Optimized: Get recent optimization history with database-level limit\n  async getRecentOptimizationHistory(limit: number, tenantId: string): Promise<OptimizationHistory[]> {\n    return await db\n      .select()\n      .from(optimizationHistory)\n      .where(eq(optimizationHistory.tenantId, tenantId))\n      .orderBy(desc(optimizationHistory.createdAt))\n      .limit(limit);\n  }\n\n  async createApprovalRequest(request: InsertApprovalRequest & { approvalDate?: Date }, tenantId: string): Promise<ApprovalRequest> {\n    const [created] = await db\n      .insert(approvalRequests)\n      .values({ ...request, tenantId })\n      .returning();\n    return created;\n  }\n\n  async getApprovalRequests(tenantId: string, status?: string): Promise<ApprovalRequest[]> {\n    if (status) {\n      return await db\n        .select()\n        .from(approvalRequests)\n        .where(\n          and(\n            eq(approvalRequests.tenantId, tenantId),\n            eq(approvalRequests.status, status)\n          )\n        )\n        .orderBy(desc(approvalRequests.createdAt));\n    }\n    \n    return await db\n      .select()\n      .from(approvalRequests)\n      .where(eq(approvalRequests.tenantId, tenantId))\n      .orderBy(desc(approvalRequests.createdAt));\n  }\n\n  async updateApprovalRequest(id: string, updates: Partial<InsertApprovalRequest>, tenantId: string): Promise<ApprovalRequest | undefined> {\n    const [updated] = await db\n      .update(approvalRequests)\n      .set(updates)\n      .where(\n        and(\n          eq(approvalRequests.id, id),\n          eq(approvalRequests.tenantId, tenantId)\n        )\n      )\n      .returning();\n    return updated || undefined;\n  }\n\n  async getSystemConfig(key: string, tenantId: string): Promise<SystemConfig | undefined> {\n    const [config] = await db\n      .select()\n      .from(systemConfig)\n      .where(\n        and(\n          eq(systemConfig.key, key),\n          eq(systemConfig.tenantId, tenantId)\n        )\n      );\n    return config || undefined;\n  }\n\n  async setSystemConfig(config: InsertSystemConfig, tenantId: string): Promise<SystemConfig> {\n    // Use upsert functionality - insert or update if key exists\n    const [result] = await db\n      .insert(systemConfig)\n      .values({ ...config, tenantId })\n      .onConflictDoUpdate({\n        target: systemConfig.key,\n        set: {\n          value: config.value,\n          description: config.description,\n          updatedBy: config.updatedBy,\n          updatedAt: new Date()\n        }\n      })\n      .returning();\n    return result;\n  }\n\n  async updateSystemConfig(key: string, value: string, updatedBy: string, tenantId: string): Promise<SystemConfig | undefined> {\n    const [updated] = await db\n      .update(systemConfig)\n      .set({ value, updatedBy, updatedAt: new Date() })\n      .where(\n        and(\n          eq(systemConfig.key, key),\n          eq(systemConfig.tenantId, tenantId)\n        )\n      )\n      .returning();\n    return updated || undefined;\n  }\n\n  async getAllSystemConfig(tenantId: string): Promise<SystemConfig[]> {\n    return await db\n      .select()\n      .from(systemConfig)\n      .where(eq(systemConfig.tenantId, tenantId))\n      .orderBy(systemConfig.key);\n  }\n\n  async createAiModeHistory(history: InsertAiModeHistory, tenantId: string): Promise<AiModeHistory> {\n    const [created] = await db\n      .insert(aiModeHistory)\n      .values({ ...history, tenantId })\n      .returning();\n    return created;\n  }\n\n  async updateAiModeHistory(id: string, updates: Partial<InsertAiModeHistory>, tenantId: string): Promise<AiModeHistory | undefined> {\n    const [updated] = await db\n      .update(aiModeHistory)\n      .set(updates)\n      .where(\n        and(\n          eq(aiModeHistory.id, id),\n          eq(aiModeHistory.tenantId, tenantId)\n        )\n      )\n      .returning();\n    return updated || undefined;\n  }\n\n  async getRecentAiModeHistory(limit: number, tenantId: string): Promise<AiModeHistory[]> {\n    return await db\n      .select()\n      .from(aiModeHistory)\n      .where(eq(aiModeHistory.tenantId, tenantId))\n      .orderBy(desc(aiModeHistory.createdAt))\n      .limit(limit);\n  }\n\n  async getAiModeHistory(id: string, tenantId: string): Promise<AiModeHistory | undefined> {\n    const [history] = await db\n      .select()\n      .from(aiModeHistory)\n      .where(\n        and(\n          eq(aiModeHistory.id, id),\n          eq(aiModeHistory.tenantId, tenantId)\n        )\n      );\n    return history || undefined;\n  }\n\n  async getAiModeHistoryWithRecommendations(id: string, tenantId: string): Promise<{\n    aiRun: AiModeHistory;\n    recommendations: Recommendation[];\n    savingsBreakdown: {\n      totalSavings: number;\n      averageSavings: number;\n      savingsByType: Record<string, number>;\n    };\n    executionModeCounts: {\n      autonomous: number;\n      hitl: number;\n      autonomousPercentage: number;\n      hitlPercentage: number;\n    };\n  } | undefined> {\n    // Get the AI mode history record\n    const aiRun = await this.getAiModeHistory(id, tenantId);\n    if (!aiRun) {\n      return undefined;\n    }\n\n    // Get all recommendations linked to this AI run\n    const recs = await db\n      .select()\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.tenantId, tenantId),\n          eq(recommendations.aiModeHistoryId, id)\n        )\n      )\n      .orderBy(desc(recommendations.createdAt));\n\n    // Calculate savings breakdown\n    const totalSavings = recs.reduce((sum, rec) => sum + (rec.projectedMonthlySavings || 0), 0);\n    const averageSavings = recs.length > 0 ? Math.round(totalSavings / recs.length) : 0;\n    \n    // Group savings by type\n    const savingsByType: Record<string, number> = {};\n    recs.forEach(rec => {\n      const type = rec.type;\n      savingsByType[type] = (savingsByType[type] || 0) + (rec.projectedMonthlySavings || 0);\n    });\n\n    // Count execution modes\n    const autonomousCount = recs.filter(rec => rec.executionMode === 'autonomous').length;\n    const hitlCount = recs.filter(rec => rec.executionMode === 'hitl').length;\n    const total = recs.length;\n\n    return {\n      aiRun,\n      recommendations: recs,\n      savingsBreakdown: {\n        totalSavings,\n        averageSavings,\n        savingsByType\n      },\n      executionModeCounts: {\n        autonomous: autonomousCount,\n        hitl: hitlCount,\n        autonomousPercentage: total > 0 ? Math.round((autonomousCount / total) * 100) : 0,\n        hitlPercentage: total > 0 ? Math.round((hitlCount / total) * 100) : 0\n      }\n    };\n  }\n\n  async getDashboardMetrics(tenantId: string): Promise<{\n    monthlySpend: number;\n    identifiedSavings: number;\n    realizedSavings: number;\n    resourcesAnalyzed: number;\n    wastePercentage: number;\n  }> {\n    // Get current month cost\n    const currentMonth = new Date();\n    currentMonth.setDate(1);\n    currentMonth.setHours(0, 0, 0, 0);\n    \n    const [monthlySpendResult] = await db\n      .select({\n        total: sql<number>`COALESCE(SUM(${costReports.cost}), 0)::numeric`\n      })\n      .from(costReports)\n      .where(\n        and(\n          eq(costReports.tenantId, tenantId),\n          gte(costReports.reportDate, currentMonth)\n        )\n      );\n\n    // Get total identified savings from active recommendations\n    const [savingsResult] = await db\n      .select({\n        total: sql<number>`COALESCE(SUM(${recommendations.projectedMonthlySavings}), 0)::numeric`\n      })\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.tenantId, tenantId),\n          eq(recommendations.status, 'pending')\n        )\n      );\n\n    // Get total realized savings from approved recommendations\n    const [realizedSavingsResult] = await db\n      .select({\n        total: sql<number>`COALESCE(SUM(${recommendations.projectedMonthlySavings}), 0)::numeric`\n      })\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.tenantId, tenantId),\n          eq(recommendations.status, 'approved')\n        )\n      );\n\n    // Get total resources analyzed\n    const [resourcesResult] = await db\n      .select({\n        count: sql<number>`COUNT(*)`\n      })\n      .from(awsResources)\n      .where(eq(awsResources.tenantId, tenantId));\n\n    // Calculate waste percentage (simplified)\n    const monthlySpend = Number(monthlySpendResult.total);\n    const identifiedSavings = Number(savingsResult.total);\n    const realizedSavings = Number(realizedSavingsResult.total);\n    const wastePercentage = monthlySpend > 0 ? (identifiedSavings / monthlySpend) * 100 : 0;\n\n    return {\n      monthlySpend,\n      identifiedSavings,\n      realizedSavings,\n      resourcesAnalyzed: Number(resourcesResult.count),\n      wastePercentage: Math.round(wastePercentage)\n    };\n  }\n\n  async getMetricsSummary(tenantId: string): Promise<{\n    monthlySpend: number;\n    ytdSpend: number;\n    autonomousSavingsPending: number;\n    hitlSavingsAwaiting: number;\n    realizedSavingsYTD: number;\n    wastePercentOptimizedYTD: number;\n    monthlySpendChange: number;\n    ytdSpendChange: number;\n  }> {\n    const now = new Date();\n    \n    // Current month start\n    const currentMonthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    \n    // Last month start and end\n    const lastMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);\n    \n    // Year-to-date start\n    const ytdStart = new Date(now.getFullYear(), 0, 1);\n    \n    // Prior year YTD start and end\n    const priorYtdStart = new Date(now.getFullYear() - 1, 0, 1);\n    const priorYtdEnd = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());\n\n    // Check if cost reports exist (fallback to aws_resources if empty)\n    const [costReportCountResult] = await db\n      .select({\n        count: sql<number>`COUNT(*)`\n      })\n      .from(costReports)\n      .where(eq(costReports.tenantId, tenantId));\n    \n    const hasCostReports = Number(costReportCountResult.count) > 0;\n\n    let monthlySpend = 0;\n    let lastMonthSpend = 0;\n    let ytdSpend = 0;\n    let priorYtdSpend = 0;\n\n    if (hasCostReports) {\n      // Use cost reports data\n      const [currentMonthResult] = await db\n        .select({\n          total: sql<number>`COALESCE(SUM(${costReports.cost}), 0)::numeric`\n        })\n        .from(costReports)\n        .where(\n          and(\n            eq(costReports.tenantId, tenantId),\n            gte(costReports.reportDate, currentMonthStart)\n          )\n        );\n\n      const [lastMonthResult] = await db\n        .select({\n          total: sql<number>`COALESCE(SUM(${costReports.cost}), 0)::numeric`\n        })\n        .from(costReports)\n        .where(\n          and(\n            eq(costReports.tenantId, tenantId),\n            gte(costReports.reportDate, lastMonthStart),\n            lte(costReports.reportDate, lastMonthEnd)\n          )\n        );\n\n      const [ytdResult] = await db\n        .select({\n          total: sql<number>`COALESCE(SUM(${costReports.cost}), 0)::numeric`\n        })\n        .from(costReports)\n        .where(\n          and(\n            eq(costReports.tenantId, tenantId),\n            gte(costReports.reportDate, ytdStart)\n          )\n        );\n\n      const [priorYtdResult] = await db\n        .select({\n          total: sql<number>`COALESCE(SUM(${costReports.cost}), 0)::numeric`\n        })\n        .from(costReports)\n        .where(\n          and(\n            eq(costReports.tenantId, tenantId),\n            gte(costReports.reportDate, priorYtdStart),\n            lte(costReports.reportDate, priorYtdEnd)\n          )\n        );\n\n      monthlySpend = Number(currentMonthResult.total);\n      lastMonthSpend = Number(lastMonthResult.total);\n      ytdSpend = Number(ytdResult.total);\n      priorYtdSpend = Number(priorYtdResult.total);\n    } else {\n      // Fallback: Use aws_resources current monthly costs\n      const [resourceCostResult] = await db\n        .select({\n          total: sql<number>`COALESCE(SUM(${awsResources.monthlyCost}), 0)::numeric`\n        })\n        .from(awsResources)\n        .where(eq(awsResources.tenantId, tenantId));\n\n      monthlySpend = Number(resourceCostResult.total);\n      // For demo mode: estimate last month as 95% of current (simulate slight increase)\n      lastMonthSpend = monthlySpend * 0.95;\n      // For demo mode: estimate YTD as current month √ó months elapsed\n      const monthsElapsed = now.getMonth() + 1;\n      ytdSpend = monthlySpend * monthsElapsed;\n      // For demo mode: estimate prior year YTD as 90% of current YTD (simulate growth)\n      priorYtdSpend = ytdSpend * 0.90;\n    }\n\n    // Get autonomous savings pending (autonomous + pending only)\n    const [autonomousSavingsResult] = await db\n      .select({\n        total: sql<number>`COALESCE(SUM(${recommendations.projectedMonthlySavings}), 0)::numeric`\n      })\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.tenantId, tenantId),\n          eq(recommendations.status, 'pending'),\n          eq(recommendations.executionMode, 'autonomous')\n        )\n      );\n\n    // Get HITL savings awaiting (HITL + pending only - needs human approval)\n    const [hitlSavingsResult] = await db\n      .select({\n        total: sql<number>`COALESCE(SUM(${recommendations.projectedMonthlySavings}), 0)::numeric`\n      })\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.tenantId, tenantId),\n          eq(recommendations.status, 'pending'),\n          eq(recommendations.executionMode, 'hitl')\n        )\n      );\n\n    // Get realized savings YTD (from successful optimizations this year)\n    // IMPORTANT: Only count LATEST optimization per resource to prevent accumulation\n    const [realizedSavingsResult] = await db\n      .select({\n        total: sql<number>`\n          COALESCE(\n            SUM(latest_opt.actual_savings), \n            0\n          )::numeric`\n      })\n      .from(\n        sql`(\n          SELECT DISTINCT ON (r.resource_id) \n            oh.actual_savings\n          FROM ${optimizationHistory} oh\n          INNER JOIN ${recommendations} r ON oh.recommendation_id = r.id\n          WHERE oh.tenant_id = ${tenantId}\n            AND oh.execution_date >= ${ytdStart}\n            AND oh.status = 'success'\n            AND r.tenant_id = ${tenantId}\n          ORDER BY r.resource_id, oh.execution_date DESC\n        ) AS latest_opt`\n      );\n\n    // Calculate values\n    const autonomousSavingsPending = Number(autonomousSavingsResult.total);\n    const hitlSavingsAwaiting = Number(hitlSavingsResult.total);\n    const realizedSavingsYTD = Number(realizedSavingsResult.total);\n\n    // Calculate percent changes\n    const monthlySpendChange = lastMonthSpend > 0 \n      ? ((monthlySpend - lastMonthSpend) / lastMonthSpend) * 100 \n      : 0;\n    \n    const ytdSpendChange = priorYtdSpend > 0 \n      ? ((ytdSpend - priorYtdSpend) / priorYtdSpend) * 100 \n      : 0;\n\n    // Calculate waste percent optimized YTD\n    const wastePercentOptimizedYTD = ytdSpend > 0 \n      ? (realizedSavingsYTD / ytdSpend) * 100 \n      : 0;\n\n    return {\n      monthlySpend,\n      ytdSpend,\n      autonomousSavingsPending,\n      hitlSavingsAwaiting,\n      realizedSavingsYTD,\n      wastePercentOptimizedYTD: Math.round(wastePercentOptimizedYTD * 10) / 10,\n      monthlySpendChange: Math.round(monthlySpendChange * 10) / 10,\n      ytdSpendChange: Math.round(ytdSpendChange * 10) / 10\n    };\n  }\n\n  async getOptimizationMix(tenantId: string): Promise<{\n    autonomousCount: number;\n    hitlCount: number;\n    autonomousPercentage: number;\n    hitlPercentage: number;\n    totalRecommendations: number;\n  }> {\n    // Get count of autonomous recommendations\n    const [autonomousResult] = await db\n      .select({\n        count: sql<number>`COUNT(*)`\n      })\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.tenantId, tenantId),\n          eq(recommendations.executionMode, 'autonomous')\n        )\n      );\n\n    // Get count of HITL recommendations\n    const [hitlResult] = await db\n      .select({\n        count: sql<number>`COUNT(*)`\n      })\n      .from(recommendations)\n      .where(\n        and(\n          eq(recommendations.tenantId, tenantId),\n          eq(recommendations.executionMode, 'hitl')\n        )\n      );\n\n    const autonomousCount = Number(autonomousResult.count);\n    const hitlCount = Number(hitlResult.count);\n    const totalRecommendations = autonomousCount + hitlCount;\n\n    const autonomousPercentage = totalRecommendations > 0 \n      ? (autonomousCount / totalRecommendations) * 100 \n      : 0;\n    \n    const hitlPercentage = totalRecommendations > 0 \n      ? (hitlCount / totalRecommendations) * 100 \n      : 0;\n\n    return {\n      autonomousCount,\n      hitlCount,\n      autonomousPercentage: Math.round(autonomousPercentage),\n      hitlPercentage: Math.round(hitlPercentage),\n      totalRecommendations\n    };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":29205},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/simulation/data-generator-card.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Database, Play, RotateCcw, CheckCircle, AlertCircle, Sparkles } from \"lucide-react\";\n\nexport function DataGeneratorCard() {\n  const [hasData, setHasData] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const generateDataMutation = useMutation({\n    mutationFn: () => apiRequest('POST', '/api/generate-aws-data'),\n    onSuccess: (data: any) => {\n      setHasData(true);\n      toast({\n        title: \"üéâ Simulation Data Generated!\",\n        description: `Generated ${data.resourcesCount} AWS resources and ${data.recommendationsCount} cost optimization recommendations`,\n      });\n      \n      // Invalidate all queries to refresh the dashboard\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/metrics'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/aws-resources'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/optimization-history'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/cost-trends'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"‚ùå Generation Failed\",\n        description: error.message || \"Failed to generate simulation data\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const clearDataMutation = useMutation({\n    mutationFn: () => apiRequest('POST', '/api/clear-simulation-data'),\n    onSuccess: () => {\n      setHasData(false);\n      toast({\n        title: \"Data Cleared\",\n        description: \"All simulation data has been removed\",\n      });\n      \n      // Invalidate all queries to refresh the dashboard\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/metrics'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/aws-resources'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/optimization-history'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/cost-trends'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Clear Failed\",\n        description: error.message || \"Failed to clear simulation data\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const aiAnalysisMutation = useMutation({\n    mutationFn: () => apiRequest('POST', '/api/ai/analyze'),\n    onSuccess: () => {\n      toast({\n        title: \"ü§ñ AI Analysis Started\",\n        description: \"Gemini 2.5 Flash is analyzing your resources. New recommendations will appear shortly.\",\n      });\n      \n      // Refresh recommendations after a delay\n      setTimeout(() => {\n        queryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\n      }, 3000);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"AI Analysis Failed\",\n        description: error.message || \"Failed to start AI analysis\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <Card className=\"border-2 border-dashed border-primary/20 bg-primary/5\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Database className=\"w-5 h-5 text-primary\" />\n            AWS Data Simulation\n          </CardTitle>\n          <Badge variant={hasData ? \"default\" : \"secondary\"} data-testid=\"simulation-status\">\n            {hasData ? \"Active\" : \"Empty\"}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          Load realistic AWS resources, cost data, and optimization recommendations to explore the FinOps platform with sample data.\n        </p>\n        \n        <div className=\"grid grid-cols-2 gap-2 text-xs text-muted-foreground\">\n          <div className=\"flex items-center gap-1\">\n            <CheckCircle className=\"w-3 h-3 text-green-500\" />\n            7+ AWS Resources\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <CheckCircle className=\"w-3 h-3 text-green-500\" />\n            6 months cost data\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <CheckCircle className=\"w-3 h-3 text-blue-500\" />\n            5+ Recommendations\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <CheckCircle className=\"w-3 h-3 text-purple-500\" />\n            Optimization history\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <div className=\"flex gap-2\">\n            <Button\n              onClick={() => generateDataMutation.mutate()}\n              disabled={generateDataMutation.isPending}\n              className=\"flex-1\"\n              data-testid=\"button-generate-data\"\n            >\n              {generateDataMutation.isPending ? (\n                <RotateCcw className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <Play className=\"w-4 h-4 mr-2\" />\n              )}\n              {generateDataMutation.isPending ? 'Generating...' : 'Generate Simulation Data'}\n            </Button>\n\n            {hasData && (\n              <Button\n                onClick={() => clearDataMutation.mutate()}\n                disabled={clearDataMutation.isPending}\n                variant=\"outline\"\n                size=\"sm\"\n                data-testid=\"button-clear-data\"\n              >\n                Clear\n              </Button>\n            )}\n          </div>\n\n          {hasData && (\n            <Button\n              onClick={() => aiAnalysisMutation.mutate()}\n              disabled={aiAnalysisMutation.isPending}\n              variant=\"default\"\n              className=\"w-full bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90\"\n              data-testid=\"button-ai-analyze\"\n            >\n              {aiAnalysisMutation.isPending ? (\n                <RotateCcw className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <Sparkles className=\"w-4 h-4 mr-2\" />\n              )}\n              {aiAnalysisMutation.isPending ? 'AI Analyzing...' : 'ü§ñ Run AI Analysis (Gemini 2.5 Flash)'}\n            </Button>\n          )}\n        </div>\n\n        {generateDataMutation.isError && (\n          <div className=\"flex items-center gap-2 p-3 bg-destructive/10 border border-destructive/20 rounded-md\">\n            <AlertCircle className=\"w-4 h-4 text-destructive flex-shrink-0\" />\n            <p className=\"text-sm text-destructive\">\n              {(generateDataMutation.error as any)?.message || 'Failed to generate data'}\n            </p>\n          </div>\n        )}\n\n        <div className=\"text-xs text-muted-foreground border-t pt-3\">\n          <strong>What gets generated:</strong>\n          <ul className=\"list-disc list-inside space-y-1 mt-1\">\n            <li>EC2 instances with utilization metrics</li>\n            <li>RDS databases and S3 buckets</li>\n            <li>6 months of cost and usage data</li>\n            <li>Cost optimization recommendations</li>\n            <li>Historical optimization results</li>\n          </ul>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":7535},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"server.js":{"content":"import { fileURLToPath } from \"url\";\nimport { dirname, join } from \"path\";\nimport express from \"express\";\nimport cors from \"cors\";\n\n// ES module __dirname compatibility\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nconst app = express();\napp.use(cors());\napp.use(express.json());\n\n// --- /api/unified_data endpoint (mock DCL output) ---\napp.get(\"/api/unified_data\", (req, res) => {\n  const now = new Date();\n  const day = (n) => {\n    const d = new Date(now);\n    d.setDate(d.getDate() - n);\n    return d.toISOString().slice(0,10);\n  };\n\n  const usage_timeseries = [\n    { date: day(6), vendor: \"AWS\", cost: 1123 },\n    { date: day(5), vendor: \"AWS\", cost: 1104 },\n    { date: day(4), vendor: \"AWS\", cost: 1680 }, // spike\n    { date: day(3), vendor: \"AWS\", cost: 1188 },\n    { date: day(2), vendor: \"AWS\", cost: 1220 },\n    { date: day(1), vendor: \"AWS\", cost: 1254 },\n    { date: day(0), vendor: \"AWS\", cost: 1272 }\n  ];\n\n  res.json({\n    period: {\n      month_iso: now.toISOString().slice(0,7),\n      days_in_month: new Date(now.getFullYear(), now.getMonth()+1, 0).getDate(),\n      day_of_month: now.getDate(),\n    },\n    vendors: [{ name: \"AWS\", account_id: \"1111-2222-3333\" }],\n    budgets: [{ scope: \"vendor\", key: \"AWS\", monthly_budget: 35000 }],\n    usage_timeseries\n  });\n});\n\n// --- Serve your front-end files (optional if using /src) ---\napp.use(express.static(join(__dirname, \"public\")));\napp.get(\"*\", (_req, res) => {\n  res.sendFile(join(__dirname, \"public\", \"index.html\"));\n});\n\n// Use PORT from environment or default to 5000 (production default)\nconst PORT = parseInt(process.env.PORT || '5000', 10);\napp.listen(PORT, \"0.0.0.0\", () => {\n  console.log(`‚úÖ Server running on port ${PORT}`);\n});\n","size_bytes":1755},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"HOW_TO_GUIDE.md":{"content":"# FinOps Autopilot - User Guide & Technical Documentation\n\n## Table of Contents\n1. [Overview](#overview)\n2. [AI Analysis Modes](#ai-analysis-modes)\n3. [Data Sources](#data-sources)\n4. [Getting Started](#getting-started)\n5. [Dashboard Features](#dashboard-features)\n6. [Cost Analysis](#cost-analysis)\n7. [Managing Recommendations](#managing-recommendations)\n8. [Approval Workflows](#approval-workflows)\n9. [Automation & Governance](#automation--governance)\n10. [Real-Time Monitoring](#real-time-monitoring)\n11. [API Reference](#api-reference)\n12. [Troubleshooting](#troubleshooting)\n\n## Overview\n\nFinOps Autopilot is an enterprise cloud cost optimization platform that automatically analyzes your AWS infrastructure, identifies cost-saving opportunities, and provides actionable recommendations to reduce cloud spending. The platform combines intelligent resource analysis with financial operations (FinOps) best practices, offering both automated insights and human oversight for cost optimization decisions.\n\n### Key Benefits\n- **Automated Cost Analysis**: Continuous monitoring of AWS resources and spending patterns\n- **AI-Powered Recommendations**: Advanced AI analysis using Google Gemini 2.0 Flash with RAG for intelligent cost optimization\n- **Dual-Mode Operation**: Switch between AI-powered analysis (Production Mode) and heuristic-based recommendations (Demo Mode)\n- **Enterprise Workflows**: Multi-stage approval processes for governance and compliance\n- **Real-Time Insights**: Live dashboards showing cost trends, savings opportunities, and optimization progress\n- **Slack Integration**: Automated notifications for team collaboration\n\n## AI Analysis Modes\n\nFinOps Autopilot supports two operational modes for generating cost optimization recommendations:\n\n### Production Mode (AI + RAG)\n\n**Technology**: Google Gemini 2.0 Flash with Pinecone vector database for Retrieval-Augmented Generation (RAG)\n\n**When to Use**:\n- Production environments requiring high-accuracy recommendations\n- Complex infrastructure with diverse workload patterns\n- Environments where AWS credentials are available\n\n**Features**:\n- **Advanced AI Analysis**: Uses Google's Gemini 2.0 Flash model for intelligent resource analysis\n- **Context-Aware**: RAG integration provides recommendations based on historical patterns and best practices\n- **Scheduled Analysis**: Runs automatically every 6 hours\n- **Manual Trigger**: On-demand analysis via Agent Configuration page\n- **Higher Accuracy**: More sophisticated analysis compared to rule-based systems\n\n**How to Enable**:\n1. Navigate to **Agent Configuration** page\n2. Toggle **Production Mode** switch to ON\n3. Ensure AWS credentials are configured (if using real AWS data)\n4. System will automatically run AI analysis every 6 hours\n\n**Manual AI Analysis**:\n- When Production Mode is active, a \"Run AI Analysis Now\" button appears\n- Click to trigger immediate AI-powered resource analysis\n- Analysis typically completes within 30-60 seconds\n- New recommendations appear automatically on the dashboard\n\n**Configuration**:\n```javascript\n// Production Mode settings\n{\n  \"prodMode\": true,           // Enable AI + RAG analysis\n  \"aiAnalysisInterval\": \"0 */6 * * *\",  // Every 6 hours\n  \"aiModel\": \"gemini-2.0-flash\",\n  \"ragEnabled\": true,\n  \"ragDatabase\": \"pinecone\"\n}\n```\n\n### Demo/Simulation Mode (Heuristics)\n\n**Technology**: Rule-based heuristic engine\n\n**When to Use**:\n- Development and testing environments\n- Demos and proof-of-concept scenarios\n- When AWS credentials are not available\n- Rapid synthetic data generation for testing\n\n**Features**:\n- **Fast Recommendations**: Generates 2-5 recommendations every 3 seconds\n- **Synthetic Data**: Creates realistic AWS resource data for testing\n- **No AWS Credentials Required**: Works with simulated data\n- **High-Velocity Updates**: Continuous 3-second data refresh cycles\n- **Predictable Patterns**: Rule-based recommendations for common scenarios\n\n**Common Recommendation Types**:\n- **EC2 Rightsizing**: Based on CPU utilization thresholds (<30% = downsize)\n- **Resource Scheduling**: Stop non-production instances during off-hours\n- **Storage Tiering**: Move infrequently accessed S3 data to cheaper tiers\n- **Idle Resource Termination**: Remove unused resources\n\n**How to Enable**:\n1. Navigate to **Agent Configuration** page\n2. Toggle **Simulation Mode** switch to ON\n3. System immediately begins generating synthetic data\n4. Recommendations appear within seconds\n\n### Agent Configuration\n\nAccess the **Agent Configuration** page to control operational modes and system behavior:\n\n**Available Controls**:\n- **Production Mode**: Enable/disable AI-powered analysis with Gemini 2.0 Flash\n- **Simulation Mode**: Enable/disable synthetic data generation\n- **Autonomous Mode**: Toggle automatic optimization execution\n- **Approval Threshold**: Set minimum savings requiring manual approval\n- **Risk Level**: Configure maximum acceptable risk for autonomous execution\n- **Auto-Execute Types**: Select which recommendation types can run automatically\n\n**System Status Display**:\n- **Analysis Mode**: Shows current mode (AI + RAG or Heuristics)\n- **Data Mode**: Indicates if using simulation or real AWS data\n- **Operation Mode**: Autonomous or manual approval required\n- **Max Risk Level**: Current risk tolerance percentage\n\n### AI Analysis History\n\nTrack AI analysis executions and results:\n\n**Available Metrics**:\n- Analysis timestamp and duration\n- Model used (Gemini 2.0 Flash)\n- Number of recommendations generated\n- Total identified savings\n- Success/failure status\n\n**Access History**:\n- Navigate to **Agent Configuration** page\n- View \"AI Mode History\" section\n- Each entry shows complete analysis details\n\n## Data Sources\n\n### Primary AWS Data Sources\n\n#### 1. AWS Cost Explorer API\n**Purpose**: Provides detailed cost and usage data for comprehensive spend analysis.\n\n**Data Collected**:\n- Daily cost breakdowns by service (EC2, RDS, S3, etc.)\n- Usage quantities and pricing metrics\n- Cost trends and projections\n- Service-level spending patterns\n\n**How It Works**:\n```javascript\n// Example API call structure\nconst costData = await costExplorer.getCostAndUsage({\n  TimePeriod: { Start: '2025-01-01', End: '2025-01-31' },\n  Granularity: 'DAILY',\n  Metrics: ['BlendedCost', 'UsageQuantity'],\n  GroupBy: [{ Type: 'DIMENSION', Key: 'SERVICE' }]\n});\n```\n\n**Update Frequency**: Daily (automated via scheduler)\n\n#### 2. AWS CloudWatch Metrics\n**Purpose**: Resource utilization monitoring for optimization recommendations.\n\n**Data Collected**:\n- CPU utilization percentages\n- Memory usage statistics\n- Network I/O metrics\n- Storage performance data\n- Custom application metrics\n\n**Key Metrics Monitored**:\n- EC2: CPU, Memory, Network, Disk I/O\n- RDS: CPU, Connections, Read/Write IOPS\n- Redshift: CPU, Connection count, Query performance\n- S3: Request metrics, Transfer rates\n\n**Update Frequency**: Hourly collection, analyzed daily\n\n#### 3. AWS Trusted Advisor\n**Purpose**: AWS-native cost optimization recommendations and security insights.\n\n**Data Collected**:\n- Low utilization EC2 instances\n- Unattached EBS volumes\n- Idle load balancers\n- Reserved Instance optimization opportunities\n- Security group violations\n\n**Integration Method**: \n- Requires AWS Business or Enterprise Support plan\n- Automated checks run weekly\n- Results integrated with platform recommendations\n\n#### 4. AWS Resource APIs\n**Purpose**: Current configuration and state information for all monitored resources.\n\n**Resources Monitored**:\n\n| Resource Type | API Source | Configuration Data |\n|---------------|------------|-------------------|\n| EC2 Instances | EC2 API | Instance type, region, tags, security groups |\n| RDS Databases | RDS API | Engine, instance class, storage, backup settings |\n| Redshift Clusters | Redshift API | Node type, cluster size, encryption |\n| S3 Buckets | S3 API | Storage class, lifecycle policies, versioning |\n| Load Balancers | ELB API | Type, targets, health checks |\n\n### Data Storage Schema\n\n#### AWS Resources Table\n```sql\nCREATE TABLE aws_resources (\n  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),\n  resource_id TEXT NOT NULL UNIQUE,        -- AWS resource identifier\n  resource_type TEXT NOT NULL,             -- EC2, RDS, S3, etc.\n  region TEXT NOT NULL,                    -- AWS region\n  current_config JSONB NOT NULL,          -- Current resource configuration\n  utilization_metrics JSONB,              -- Performance metrics\n  monthly_cost DECIMAL(10,2),             -- Current monthly cost\n  last_analyzed TIMESTAMP DEFAULT NOW(),   -- Last analysis timestamp\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n#### Cost Reports Table\n```sql\nCREATE TABLE cost_reports (\n  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),\n  report_date TIMESTAMP NOT NULL,         -- Cost report date\n  service_category TEXT NOT NULL,         -- AWS service (EC2, RDS, etc.)\n  resource_id TEXT,                       -- Specific resource (optional)\n  cost DECIMAL(12,2) NOT NULL,           -- Daily cost amount\n  usage DECIMAL(12,6),                   -- Usage quantity\n  usage_type TEXT,                       -- Usage type (hours, GB, etc.)\n  region TEXT,                           -- AWS region\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n#### Recommendations Table\n```sql\nCREATE TABLE recommendations (\n  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),\n  resource_id TEXT NOT NULL,             -- Target AWS resource\n  type TEXT NOT NULL,                    -- resize, terminate, storage-class, etc.\n  priority TEXT NOT NULL,               -- critical, high, medium, low\n  title TEXT NOT NULL,                  -- Recommendation title\n  description TEXT NOT NULL,            -- Detailed description\n  current_config JSONB NOT NULL,       -- Current resource state\n  recommended_config JSONB NOT NULL,   -- Proposed new configuration\n  projected_monthly_savings DECIMAL(10,2), -- Expected monthly savings\n  projected_annual_savings DECIMAL(10,2),  -- Expected annual savings\n  risk_level DECIMAL(5,2),             -- Risk percentage (0-100)\n  status TEXT DEFAULT 'pending',       -- pending, approved, rejected, executed\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Data Update Schedule\n\n| Data Source | Frequency | Method | Purpose |\n|-------------|-----------|---------|----------|\n| Cost Explorer | Daily at 6 AM UTC | Automated | Cost trend analysis |\n| CloudWatch Metrics | Every hour | Automated | Utilization monitoring |\n| Trusted Advisor | Weekly | Automated | AWS-native recommendations |\n| Resource Configuration | Daily at 8 AM UTC | API polling | Configuration drift detection |\n| Recommendations Generation | Daily at 10 AM UTC | Analysis engine | New optimization opportunities |\n\n## Getting Started\n\n### Initial Setup\n\n1. **Access the Platform**\n   - Navigate to your FinOps Autopilot dashboard\n   - Log in with your enterprise credentials\n   - Verify your user role (User, Admin, or CFO)\n\n2. **Generate Sample Data** (Development/Testing)\n   ```bash\n   # Navigate to dashboard and use the data generation endpoint\n   curl -X POST /api/generate-aws-data\n   ```\n\n3. **Verify Data Integration**\n   - Check the \"Resources Analyzed\" metric on the dashboard\n   - Ensure cost data is populated for the current month\n   - Verify recommendations are being generated\n\n### Dashboard Overview\n\nYour dashboard provides a real-time view of your cloud cost optimization status:\n\n**Key Metrics Displayed**:\n- **Monthly Spend**: Current month's AWS costs\n- **Identified Savings**: Total potential monthly savings from pending recommendations\n- **Realized Savings**: Actual savings from approved optimizations\n- **Resources Analyzed**: Number of AWS resources under management\n- **Waste Percentage**: Percentage of spend that could be optimized\n\n## Dashboard Features\n\n### Real-Time Metrics Cards\n\n#### Monthly Spend Tracking\n**Purpose**: Monitor current month's AWS expenditure against projections.\n\n**How to Use**:\n1. View the large dollar amount for current month spend\n2. Compare against last month's total (shown as trend)\n3. Check the percentage change indicator (green = decrease, red = increase)\n\n**What to Watch For**:\n- Sudden spikes in daily spending\n- Consistent month-over-month increases\n- Spending approaching budget thresholds\n\n#### Cost Optimization Opportunities\n**Purpose**: Track potential and realized savings from recommendations.\n\n**Metrics Explained**:\n- **Identified Savings**: Total monthly savings available from pending recommendations\n- **Realized Savings**: Actual savings achieved from approved optimizations\n- **Conversion Rate**: Percentage of identified savings that have been realized\n\n**Best Practices**:\n- Aim for 80%+ conversion rate of identified to realized savings\n- Focus on high-impact, low-risk recommendations first\n- Regular review of pending recommendations\n\n### Resource Utilization Overview\n\n**Purpose**: Understand the distribution and efficiency of your AWS resources.\n\n**Resource Categories**:\n- **EC2 Instances**: Compute resources and their utilization\n- **RDS Databases**: Database instances and performance metrics\n- **S3 Storage**: Storage usage and lifecycle optimization\n- **Other Services**: Load balancers, Redshift, additional services\n\n**Utilization Indicators**:\n- **Green**: Optimal utilization (70-90%)\n- **Yellow**: Moderate efficiency opportunities (50-70%)\n- **Red**: Significant optimization needed (<50%)\n\n### Activity Feed\n\n**Purpose**: Track recent optimization activities and their outcomes.\n\n**Activity Types**:\n- **New Recommendations**: Recently identified optimization opportunities\n- **Approvals**: Recommendations approved for implementation\n- **Optimizations Executed**: Completed cost-saving actions\n- **Cost Impact**: Realized savings from completed optimizations\n\n**How to Use**:\n1. Monitor the feed for new recommendations requiring attention\n2. Track the progress of approved optimizations\n3. Verify successful completion of cost-saving measures\n\n## Cost Analysis\n\n### Monthly Cost Trends\n\n#### Viewing Cost Trends\n1. **Navigate to Cost Analysis** page from the main navigation\n2. **Review the trend chart** showing 6 months of historical data\n3. **Analyze patterns** for seasonal trends or unusual spikes\n\n#### Understanding the Metrics\n\n**Chart Components**:\n- **Blue Line**: Historical monthly costs\n- **Orange Line**: Projected costs with current optimizations\n- **Green Areas**: Potential savings periods\n- **Red Areas**: Cost increase periods\n\n**Key Indicators**:\n- **Trend Direction**: Overall cost trajectory (increasing/decreasing)\n- **Volatility**: Month-to-month variance in spending\n- **Optimization Impact**: Difference between actual and projected costs\n\n#### Cost Breakdown Analysis\n\n**Service-Level Analysis**:\n```javascript\n// Example cost breakdown by service\n{\n  \"EC2\": \"$12,450.23\",\n  \"RDS\": \"$3,240.18\", \n  \"S3\": \"$1,890.45\",\n  \"Redshift\": \"$2,156.78\"\n}\n```\n\n**Regional Distribution**:\n- Monitor costs across different AWS regions\n- Identify opportunities for regional optimization\n- Consider data transfer costs between regions\n\n### Savings Tracking\n\n#### Potential vs. Realized Savings\n\n**Potential Savings**:\n- Total monthly savings from all pending recommendations\n- Calculated based on current resource utilization\n- Updated daily as new recommendations are generated\n\n**Realized Savings**:\n- Actual cost reductions from approved and executed optimizations\n- Verified against monthly billing data\n- Tracked over time to measure optimization program success\n\n#### Savings Categories\n\n| Category | Typical Savings | Implementation Risk | Time to Realize |\n|----------|-----------------|-------------------|-----------------|\n| EC2 Rightsizing | 20-40% | Low | Immediate |\n| Reserved Instances | 30-60% | Low | 1-3 years |\n| Storage Optimization | 50-80% | Very Low | Immediate |\n| Unused Resources | 100% | Medium | Immediate |\n\n## Managing Recommendations\n\n### Understanding Recommendation Types\n\n#### 1. Resource Rightsizing\n**Purpose**: Optimize instance sizes based on actual utilization.\n\n**Common Scenarios**:\n- **Downsize EC2 instances** with consistently low CPU usage\n- **Upgrade under-performing instances** causing bottlenecks\n- **Switch instance families** for better price/performance ratio\n\n**Example Recommendation**:\n```json\n{\n  \"type\": \"resize\",\n  \"priority\": \"high\",\n  \"title\": \"Downsize Over-Provisioned EC2 Instance\",\n  \"currentConfig\": {\n    \"instanceType\": \"m5.2xlarge\",\n    \"vcpus\": 8,\n    \"memory\": \"32 GiB\"\n  },\n  \"recommendedConfig\": {\n    \"instanceType\": \"m5.large\", \n    \"vcpus\": 2,\n    \"memory\": \"8 GiB\"\n  },\n  \"projectedMonthlySavings\": \"185.50\",\n  \"riskLevel\": \"12.0\"\n}\n```\n\n#### 2. Reserved Instance Optimization\n**Purpose**: Reduce costs through AWS Reserved Instance commitments.\n\n**Best For**:\n- Stable, predictable workloads running 24/7\n- Production environments with consistent usage\n- Long-term projects (1-3 years)\n\n**Savings Potential**: 30-60% compared to On-Demand pricing\n\n#### 3. Storage Class Optimization\n**Purpose**: Move infrequently accessed data to cheaper storage classes.\n\n**S3 Storage Classes**:\n- **Standard**: Frequently accessed data\n- **Standard-IA**: Infrequently accessed (30+ days)\n- **Glacier**: Long-term archival (90+ days)\n- **Deep Archive**: Rarely accessed (180+ days)\n\n#### 4. Resource Termination\n**Purpose**: Eliminate unused or idle resources.\n\n**Common Targets**:\n- Development instances running outside business hours\n- Unattached EBS volumes\n- Idle load balancers\n- Unused NAT gateways\n\n### Recommendation Priority Levels\n\n#### Critical Priority\n- **Risk Level**: Very low (0-5%)\n- **Impact**: High cost savings with minimal business risk\n- **Action Required**: Should be implemented immediately\n- **Examples**: Terminate unused resources, fix misconfigurations\n\n#### High Priority  \n- **Risk Level**: Low (5-15%)\n- **Impact**: Significant savings with manageable risk\n- **Action Required**: Review and implement within 1 week\n- **Examples**: Rightsize over-provisioned instances, storage optimization\n\n#### Medium Priority\n- **Risk Level**: Medium (15-25%)\n- **Impact**: Moderate savings requiring careful evaluation\n- **Action Required**: Assess impact and plan implementation\n- **Examples**: Instance family changes, reserved instance purchases\n\n#### Low Priority\n- **Risk Level**: Higher (25%+)\n- **Impact**: Potential savings but requires extensive testing\n- **Action Required**: Consider for future optimization cycles\n- **Examples**: Major architectural changes, multi-region optimizations\n\n### Bulk Approval Process\n\n#### Using the \"Approve All\" Feature\n1. **Navigate to the Dashboard** recommendations panel\n2. **Review pending recommendations** to ensure they align with your policies\n3. **Click \"Approve All (X)\"** where X is the number of pending recommendations\n4. **Monitor the progress** as the system processes all approvals\n5. **Verify completion** through the success notification showing total savings\n\n#### What Happens During Bulk Approval\n```javascript\n// Bulk approval process\nfor (const recommendation of pendingRecommendations) {\n  // Create approval request\n  await createApprovalRequest({\n    recommendationId: recommendation.id,\n    status: 'approved',\n    approvedBy: currentUser,\n    comments: 'Bulk approved with X other recommendations'\n  });\n  \n  // Update recommendation status\n  await updateRecommendationStatus(recommendation.id, 'approved');\n  \n  // Log optimization history\n  await createOptimizationHistory({\n    recommendationId: recommendation.id,\n    executedBy: currentUser,\n    executionDate: new Date(),\n    actualSavings: recommendation.projectedMonthlySavings,\n    status: 'approved'\n  });\n}\n```\n\n#### Post-Approval Actions\n- **Real-time notifications** sent to Slack channels\n- **Dashboard metrics updated** with new realized savings\n- **Activity feed updated** with approval records\n- **Optimization history created** for audit trails\n\n## Approval Workflows\n\n### Enterprise Approval Process\n\n#### 1. Recommendation Generation\n- System analyzes AWS resources daily\n- Recommendations created with risk assessment\n- Initial status set to \"pending\"\n\n#### 2. Review and Assessment\n**Who**: Cloud platform team, DevOps engineers, resource owners\n**Timeline**: 24-48 hours for review\n**Process**:\n1. Evaluate business impact of proposed changes\n2. Assess risk level and mitigation strategies\n3. Coordinate with affected teams\n4. Schedule implementation window if needed\n\n#### 3. Approval Request Submission\n**Required Information**:\n- Recommendation details and justification\n- Requested by (engineer submitting for approval)\n- Approver role (typically \"Head of Cloud Platform\")\n- Implementation comments and special instructions\n\n**Example Approval Request**:\n```json\n{\n  \"recommendationId\": \"rec-abc123\",\n  \"requestedBy\": \"john.doe@company.com\",\n  \"approverRole\": \"Head of Cloud Platform\",\n  \"comments\": \"Low-risk optimization for development environment. Implementation planned during maintenance window.\",\n  \"urgency\": \"normal\"\n}\n```\n\n#### 4. Executive Approval\n**Approver Roles**:\n- **Head of Cloud Platform**: Technical optimizations under $10k annual savings\n- **Engineering Director**: Medium-impact changes $10k-$50k annual savings  \n- **CFO**: High-impact optimizations over $50k annual savings\n\n**Approval Criteria**:\n- Business impact assessment\n- Risk mitigation plans\n- ROI calculation and timeline\n- Compliance with governance policies\n\n#### 5. Implementation and Monitoring\n- Automated execution of approved optimizations\n- Real-time monitoring of implementation success\n- Rollback procedures for failed optimizations\n- Post-implementation validation and reporting\n\n### Approval Request Statuses\n\n| Status | Description | Next Actions |\n|--------|-------------|--------------|\n| **pending** | Awaiting approval decision | Review required |\n| **approved** | Ready for implementation | Execute optimization |\n| **rejected** | Not approved for implementation | Document reasoning, consider alternatives |\n| **executed** | Successfully implemented | Monitor performance, validate savings |\n| **failed** | Implementation unsuccessful | Investigate failure, plan retry |\n\n### Governance Integration\n\n#### Policy Compliance\n- All approvals tracked for audit purposes\n- Approval chains enforce spending authority limits\n- Automated policy checks before implementation\n\n#### Audit Trail\n```sql\n-- Example optimization history record\nSELECT \n  r.title,\n  oh.executed_by,\n  oh.execution_date,\n  oh.actual_savings,\n  oh.status,\n  ar.approver_role,\n  ar.approval_date\nFROM optimization_history oh\nJOIN recommendations r ON oh.recommendation_id = r.id\nJOIN approval_requests ar ON ar.recommendation_id = r.id\nWHERE oh.execution_date >= '2025-01-01';\n```\n\n## Automation & Governance\n\n### Automated Analysis Scheduling\n\n#### Daily Analysis Tasks\n**Time**: 6:00 AM UTC\n**Tasks**:\n1. **Cost Data Sync**: Import previous day's cost data from AWS Cost Explorer\n2. **Resource Discovery**: Scan for new AWS resources across all monitored regions\n3. **Utilization Analysis**: Process CloudWatch metrics for optimization opportunities\n4. **Recommendation Generation**: Create new cost optimization recommendations\n\n#### Weekly Analysis Tasks  \n**Time**: Sunday 8:00 AM UTC\n**Tasks**:\n1. **Trusted Advisor Sync**: Import AWS Trusted Advisor findings\n2. **Trend Analysis**: Analyze weekly cost and usage patterns\n3. **Recommendation Prioritization**: Update recommendation priorities based on utilization trends\n4. **Governance Report Generation**: Create weekly governance and compliance reports\n\n#### Monthly Analysis Tasks\n**Time**: 1st of month, 10:00 AM UTC  \n**Tasks**:\n1. **Monthly Cost Report**: Generate comprehensive cost analysis\n2. **Savings Validation**: Verify actual savings against projections\n3. **ROI Calculation**: Calculate return on investment for optimization program\n4. **Capacity Planning**: Forecast future resource and cost requirements\n\n### Governance Policies\n\n#### Automated Policy Enforcement\n\n**Resource Tagging Compliance**:\n```javascript\n// Example policy check\nconst requiredTags = ['Environment', 'Team', 'Project', 'CostCenter'];\nconst untaggedResources = resources.filter(resource => {\n  const tags = JSON.parse(resource.tags || '{}');\n  return !requiredTags.every(tag => tags[tag]);\n});\n```\n\n**Cost Threshold Monitoring**:\n- Alert when monthly costs exceed budget by 10%\n- Automatic approval required for optimizations over $5k annual savings\n- CFO approval mandatory for changes affecting production resources\n\n**Security and Compliance**:\n- All optimization activities logged for audit\n- Approval chains enforce separation of duties\n- Automated checks for PCI/SOX compliance requirements\n\n### Notification and Alerting\n\n#### Slack Integration\n**Setup Requirements**:\n- Slack workspace with bot permissions\n- Channel designated for FinOps notifications\n- Integration token configured in environment variables\n\n**Notification Types**:\n```javascript\n// New high-priority recommendation\n{\n  \"type\": \"new_recommendation\",\n  \"priority\": \"critical\", \n  \"title\": \"Urgent: Idle EC2 instance costing $500/month\",\n  \"potential_savings\": \"$500.00/month\",\n  \"action_required\": \"Review and approve termination\"\n}\n\n// Optimization completed\n{\n  \"type\": \"optimization_completed\",\n  \"title\": \"Successfully downsized RDS instance\",\n  \"actual_savings\": \"$245.67/month\",\n  \"status\": \"success\"\n}\n\n// Monthly summary\n{\n  \"type\": \"monthly_summary\",\n  \"total_savings\": \"$12,450.32\",\n  \"recommendations_processed\": 15,\n  \"success_rate\": \"93%\"\n}\n```\n\n#### Email Alerts\n- Daily digest of new recommendations\n- Weekly optimization summary\n- Monthly cost and savings report\n- Critical alerts for budget threshold breaches\n\n## Real-Time Monitoring\n\n### WebSocket Integration\n\n#### Live Dashboard Updates\nThe platform uses WebSocket connections to provide real-time updates without page refreshes.\n\n**Connection Setup**:\n```javascript\n// Client-side WebSocket connection\nconst ws = new WebSocket('wss://your-domain/ws');\n\nws.onmessage = (event) => {\n  const data = JSON.parse(event.data);\n  handleRealtimeUpdate(data);\n};\n```\n\n**Update Types**:\n- **new_recommendation**: New optimization opportunity identified\n- **approval_request**: Recommendation submitted for approval  \n- **optimization_executed**: Optimization implementation completed\n- **bulk_approval**: Multiple recommendations approved simultaneously\n- **cost_alert**: Spending threshold exceeded\n\n#### Automatic Data Refresh\n**Query Invalidation**: When real-time events occur, the frontend automatically refreshes related data:\n\n```javascript\n// Example: After bulk approval, refresh all related queries\nqueryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\nqueryClient.invalidateQueries({ queryKey: ['/api/dashboard/metrics'] });\nqueryClient.invalidateQueries({ queryKey: ['/api/optimization-history'] });\n```\n\n### Performance Monitoring\n\n#### System Health Metrics\n- **API Response Times**: Monitor for degradation in API performance\n- **Database Query Performance**: Track slow queries and optimization opportunities\n- **WebSocket Connection Health**: Monitor real-time connection stability\n- **AWS API Rate Limits**: Ensure compliance with AWS API throttling\n\n#### Cost Optimization Metrics\n- **Recommendation Accuracy**: Track how often projections match actual results\n- **Implementation Success Rate**: Monitor failed optimization attempts\n- **Time to Value**: Measure time from recommendation to realized savings\n\n## API Reference\n\n### Authentication\nAll API endpoints require valid session authentication. Ensure you're logged in before making API calls.\n\n### Core Endpoints\n\n#### Dashboard Metrics\n```http\nGET /api/dashboard/metrics\n```\n**Response**:\n```json\n{\n  \"monthlySpend\": 18501.68,\n  \"identifiedSavings\": 3245.67,\n  \"realizedSavings\": 12456.89,\n  \"resourcesAnalyzed\": 234,\n  \"wastePercentage\": 17.5,\n  \"trendsData\": {\n    \"currentMonth\": 18501.68,\n    \"lastMonth\": 19234.12,\n    \"changePercentage\": -3.8\n  }\n}\n```\n\n#### Cost Trends\n```http\nGET /api/dashboard/cost-trends\n```\n**Response**:\n```json\n[\n  {\n    \"month\": \"2025-01\",\n    \"totalCost\": 18501.68,\n    \"projectedCost\": 15234.12,\n    \"potentialSavings\": 3267.56\n  }\n]\n```\n\n#### Recommendations\n```http\nGET /api/recommendations?status=pending\n```\n**Parameters**:\n- `status` (optional): Filter by status (pending, approved, rejected, executed)\n\n**Response**:\n```json\n[\n  {\n    \"id\": \"rec-abc123\",\n    \"resourceId\": \"i-1234567890abcdef0\",\n    \"type\": \"resize\",\n    \"priority\": \"high\",\n    \"title\": \"Downsize Over-Provisioned EC2 Instance\",\n    \"description\": \"Instance shows consistently low utilization...\",\n    \"currentConfig\": {\n      \"instanceType\": \"m5.2xlarge\",\n      \"vcpus\": 8,\n      \"memory\": \"32 GiB\"\n    },\n    \"recommendedConfig\": {\n      \"instanceType\": \"m5.large\",\n      \"vcpus\": 2, \n      \"memory\": \"8 GiB\"\n    },\n    \"projectedMonthlySavings\": \"185.50\",\n    \"projectedAnnualSavings\": \"2226.00\",\n    \"riskLevel\": \"12.0\",\n    \"status\": \"pending\",\n    \"createdAt\": \"2025-09-13T10:30:00Z\"\n  }\n]\n```\n\n#### Create Approval Request\n```http\nPOST /api/approval-requests\n```\n**Request Body**:\n```json\n{\n  \"recommendationId\": \"rec-abc123\",\n  \"requestedBy\": \"john.doe@company.com\",\n  \"approverRole\": \"Head of Cloud Platform\",\n  \"comments\": \"Low-risk optimization for development environment\"\n}\n```\n\n#### Bulk Approve Recommendations\n```http\nPOST /api/approve-all-recommendations\n```\n**Request Body**:\n```json\n{\n  \"approvedBy\": \"jane.smith@company.com\",\n  \"comments\": \"Quarterly bulk approval of low-risk optimizations\"\n}\n```\n\n**Response**:\n```json\n{\n  \"message\": \"Successfully approved 4 of 4 pending recommendations\",\n  \"approvedCount\": 4,\n  \"totalAttempted\": 4,\n  \"totalAnnualSavings\": 4855.56,\n  \"recommendations\": [\n    {\n      \"id\": \"rec-abc123\",\n      \"title\": \"Downsize Development Database Instance\", \n      \"projectedAnnualSavings\": \"758.16\"\n    }\n  ],\n  \"errors\": []\n}\n```\n\n#### AWS Resources\n```http\nGET /api/aws-resources\n```\n**Response**:\n```json\n[\n  {\n    \"id\": \"res-xyz789\",\n    \"resourceId\": \"i-1234567890abcdef0\",\n    \"resourceType\": \"EC2\",\n    \"region\": \"us-east-1\",\n    \"currentConfig\": {\n      \"instanceType\": \"m5.2xlarge\",\n      \"state\": \"running\"\n    },\n    \"utilizationMetrics\": {\n      \"cpuUtilization\": 25.5,\n      \"memoryUtilization\": 40.2\n    },\n    \"monthlyCost\": \"245.76\",\n    \"lastAnalyzed\": \"2025-09-13T10:00:00Z\"\n  }\n]\n```\n\n#### Optimization History\n```http\nGET /api/optimization-history?limit=50\n```\n**Parameters**:\n- `limit` (optional): Number of records to return (default: 50)\n\n**Response**:\n```json\n[\n  {\n    \"id\": \"hist-def456\",\n    \"recommendationId\": \"rec-abc123\",\n    \"executedBy\": \"john.doe@company.com\",\n    \"executionDate\": \"2025-09-13T14:30:00Z\",\n    \"beforeConfig\": {\n      \"instanceType\": \"m5.2xlarge\"\n    },\n    \"afterConfig\": {\n      \"instanceType\": \"m5.large\"\n    },\n    \"actualSavings\": \"185.50\",\n    \"status\": \"success\"\n  }\n]\n```\n\n### Data Management Endpoints\n\n#### Generate Test Data\n```http\nPOST /api/generate-aws-data\n```\n**Response**:\n```json\n{\n  \"resourcesCount\": 8,\n  \"recommendationsCount\": 4,\n  \"message\": \"AWS simulation data generated successfully\"\n}\n```\n\n#### Clear Test Data\n```http\nPOST /api/clear-simulation-data\n```\n**Response**:\n```json\n{\n  \"message\": \"All simulation data cleared successfully\"\n}\n```\n\n## Troubleshooting\n\n### Common Issues\n\n#### 1. No Recommendations Appearing\n\n**Symptoms**: Dashboard shows 0 recommendations despite having AWS resources.\n\n**Possible Causes**:\n- AWS credentials not configured correctly\n- Resources haven't been analyzed yet (wait for daily analysis cycle)\n- All resources are optimally configured\n\n**Solutions**:\n1. **Check AWS Integration**:\n   ```bash\n   # Verify AWS credentials\n   curl GET /api/aws-resources\n   ```\n\n2. **Trigger Manual Analysis**:\n   ```bash\n   # Generate fresh recommendations\n   curl -X POST /api/generate-aws-data\n   ```\n\n3. **Review Resource Utilization**:\n   - Ensure CloudWatch metrics are being collected\n   - Verify resources have sufficient historical data (7+ days)\n\n#### 2. Cost Data Not Updating\n\n**Symptoms**: Cost trends showing stale data or $0 costs.\n\n**Possible Causes**:\n- AWS Cost Explorer API permissions missing\n- Cost data not yet available from AWS (24-48 hour delay)\n- Analysis scheduler not running\n\n**Solutions**:\n1. **Verify Cost Explorer Access**:\n   - Ensure IAM role has `ce:GetCostAndUsage` permission\n   - Check AWS Cost Explorer is enabled in your account\n\n2. **Check Analysis Schedule**:\n   - Verify daily cost sync is running at 6 AM UTC\n   - Review server logs for cost data import errors\n\n3. **Manual Cost Data Import**:\n   ```bash\n   # Trigger cost data sync\n   curl -X POST /api/sync-cost-data\n   ```\n\n#### 3. Approval Workflow Issues\n\n**Symptoms**: Approved recommendations not executing or stuck in pending state.\n\n**Possible Causes**:\n- Missing execution permissions\n- AWS API rate limiting\n- Resource dependencies preventing changes\n\n**Solutions**:\n1. **Check Approval Status**:\n   ```bash\n   # Review approval request details\n   curl GET /api/approval-requests/{request-id}\n   ```\n\n2. **Review Execution Logs**:\n   - Check optimization history for error messages\n   - Verify AWS permissions for resource modifications\n\n3. **Manual Retry**:\n   ```bash\n   # Retry failed optimization\n   curl -X PATCH /api/approval-requests/{request-id} \n   -d '{\"status\": \"approved\"}'\n   ```\n\n#### 4. Real-Time Updates Not Working\n\n**Symptoms**: Dashboard not updating automatically, manual refresh required.\n\n**Possible Causes**:\n- WebSocket connection failure\n- Browser blocking WebSocket connections\n- Server WebSocket configuration issues\n\n**Solutions**:\n1. **Check WebSocket Connection**:\n   - Open browser developer tools\n   - Look for WebSocket connection errors in Console tab\n\n2. **Network Configuration**:\n   - Verify firewall allows WebSocket connections\n   - Check proxy settings aren't blocking WebSocket traffic\n\n3. **Browser Compatibility**:\n   - Try different browser or incognito mode\n   - Clear browser cache and cookies\n\n### Performance Optimization\n\n#### Dashboard Loading Slowly\n\n**Optimization Steps**:\n1. **Enable Query Caching**: Ensure React Query cache is working properly\n2. **Optimize Database Queries**: Review slow query logs\n3. **Resource Cleanup**: Remove old optimization history records\n4. **Database Indexing**: Ensure proper indexes on frequently queried columns\n\n#### High Memory Usage\n\n**Monitoring and Fixes**:\n1. **Monitor Node.js Memory**: Use `process.memoryUsage()` to track heap usage\n2. **Database Connection Pooling**: Verify connection pool limits\n3. **Resource Cleanup**: Implement proper cleanup for large data processing\n\n### Getting Help\n\n#### Support Channels\n1. **Internal Documentation**: Check company wiki for AWS-specific configurations\n2. **Technical Support**: Contact DevOps team for infrastructure issues\n3. **Business Questions**: Reach out to FinOps team for policy and process questions\n\n#### Log Files and Debugging\n```bash\n# Server logs\ntail -f /var/log/finops-autopilot/server.log\n\n# Database query logs  \ntail -f /var/log/postgresql/postgresql.log\n\n# Application metrics\ncurl GET /api/health\n```\n\n#### Diagnostic API\n```http\nGET /api/diagnostics\n```\n**Response includes**:\n- System health status\n- Database connection status\n- AWS API connectivity\n- Last successful data sync timestamps\n- Current recommendation counts by status\n\n---\n\n*This documentation is maintained by the Platform Engineering team. For updates or corrections, please submit a pull request or contact the maintainers.*","size_bytes":35530},"server/services/config.ts":{"content":"import { storage } from '../storage.js';\nimport { logger } from './logger.js';\n\n// Config service operates in the system tenant context\nconst SYSTEM_TENANT_ID = 'default-tenant';\n\nexport interface AgentConfig {\n  autonomousMode: boolean;\n  prodMode: boolean;\n  simulationMode: boolean;\n  maxAutonomousRiskLevel: number;\n  approvalRequiredAboveSavings: number;\n  autoExecuteTypes: string[];\n  prodModeTimeRemaining?: number;\n}\n\nexport interface DatabaseConfig {\n  url: string;\n  poolSize: number;\n}\n\nexport interface PlatformConfig {\n  baseUrl: string;\n  tenantId: string;\n  agentId: string;\n  jwt: string;\n  enabled: boolean;\n}\n\nexport interface SecurityConfig {\n  jwtSecret: string;\n  jwtExpiry: string;\n  bcryptRounds: number;\n}\n\nexport interface FeatureFlags {\n  usePlatform: boolean;\n  simulationMode: boolean;\n  autoApproveLowRisk: boolean;\n}\n\nexport interface RateLimitConfig {\n  windowMs: number;\n  maxRequests: number;\n}\n\nexport interface AppConfig {\n  database: DatabaseConfig;\n  platform: PlatformConfig;\n  security: SecurityConfig;\n  features: FeatureFlags;\n  rateLimit: RateLimitConfig;\n  agent: AgentConfig;\n}\n\nexport class ConfigService {\n  private static instance: ConfigService;\n  private configCache: Map<string, string> = new Map();\n  private prodModeExpiresAt: number | null = null;\n  private appConfig: AppConfig | null = null;\n\n  private constructor() {}\n\n  private getEnv(key: string, defaultValue?: string, required = false): string {\n    const value = process.env[key] || defaultValue;\n    \n    if (required && !value) {\n      const error = `FATAL: Required environment variable ${key} is not set`;\n      logger.error(error);\n      throw new Error(error);\n    }\n    \n    return value || '';\n  }\n\n  private getEnvNumber(key: string, defaultValue: number): number {\n    const value = process.env[key];\n    if (!value) return defaultValue;\n    const parsed = parseInt(value, 10);\n    if (isNaN(parsed)) {\n      logger.warn(`Invalid number for ${key}, using default: ${defaultValue}`);\n      return defaultValue;\n    }\n    return parsed;\n  }\n\n  private getEnvBoolean(key: string, defaultValue: boolean): boolean {\n    const value = process.env[key];\n    if (!value) return defaultValue;\n    return value.toLowerCase() === 'true' || value === '1';\n  }\n\n  async validateAndLoadConfig(): Promise<AppConfig> {\n    if (this.appConfig) {\n      return this.appConfig;\n    }\n\n    logger.info('Loading and validating application configuration');\n\n    try {\n      const databaseUrl = this.getEnv('DATABASE_URL', '', false);\n      \n      const config: AppConfig = {\n        database: {\n          url: databaseUrl,\n          poolSize: this.getEnvNumber('DB_POOL_SIZE', 10)\n        },\n        platform: {\n          baseUrl: this.getEnv('VITE_AOS_BASE_URL', this.getEnv('VITE_PLATFORM_URL', '')),\n          tenantId: this.getEnv('AOS_TENANT_ID', ''),\n          agentId: this.getEnv('AOS_AGENT_ID', ''),\n          jwt: this.getEnv('AOS_JWT', ''),\n          enabled: this.getEnvBoolean('USE_PLATFORM', false)\n        },\n        security: {\n          jwtSecret: this.getEnv('JWT_SECRET', 'dev-secret-key-change-in-production'),\n          jwtExpiry: this.getEnv('JWT_EXPIRY', '24h'),\n          bcryptRounds: this.getEnvNumber('BCRYPT_ROUNDS', 10)\n        },\n        features: {\n          usePlatform: this.getEnvBoolean('USE_PLATFORM', false),\n          simulationMode: this.getEnvBoolean('SIMULATION_MODE', true),\n          autoApproveLowRisk: this.getEnvBoolean('AUTO_APPROVE_LOW_RISK', false)\n        },\n        rateLimit: {\n          windowMs: this.getEnvNumber('RATE_LIMIT_WINDOW_MS', 60000),\n          maxRequests: this.getEnvNumber('RATE_LIMIT_MAX_REQUESTS', 100)\n        },\n        agent: await this.getAgentConfig()\n      };\n\n      if (!config.security.jwtSecret || config.security.jwtSecret === 'dev-secret-key-change-in-production') {\n        logger.warn('JWT_SECRET not set or using default. Please set a secure secret in production');\n      }\n\n      if (config.platform.enabled && !config.platform.baseUrl) {\n        logger.warn('Platform integration enabled but VITE_AOS_BASE_URL not set');\n      }\n\n      this.appConfig = config;\n      logger.info('Configuration loaded successfully', {\n        platformEnabled: config.platform.enabled,\n        simulationMode: config.features.simulationMode,\n        rateLimitWindow: config.rateLimit.windowMs\n      });\n\n      return config;\n    } catch (error) {\n      logger.error('Failed to load configuration', {}, error as Error);\n      throw error;\n    }\n  }\n\n  getConfig(): AppConfig {\n    if (!this.appConfig) {\n      throw new Error('Configuration not loaded. Call validateAndLoadConfig() first');\n    }\n    return this.appConfig;\n  }\n\n  static getInstance(): ConfigService {\n    if (!ConfigService.instance) {\n      ConfigService.instance = new ConfigService();\n    }\n    return ConfigService.instance;\n  }\n\n  async initializeDefaults() {\n    // Initialize default configuration values\n    const defaults = [\n      {\n        key: 'agent.autonomous_mode',\n        value: 'false',\n        description: 'Enable autonomous execution of recommendations without human approval',\n        updatedBy: 'system'\n      },\n      {\n        key: 'agent.prod_mode',\n        value: 'false',\n        description: 'Production Mode: When ON, use AI-powered analysis with RAG. When OFF, use heuristics-based analysis',\n        updatedBy: 'system'\n      },\n      {\n        key: 'agent.simulation_mode',\n        value: 'true',\n        description: 'Simulation Mode: When ON, generate synthetic dynamic data. When OFF, use static data',\n        updatedBy: 'system'\n      },\n      {\n        key: 'agent.max_autonomous_risk_level',\n        value: '5.0',\n        description: 'Maximum risk level (percentage) for autonomous execution',\n        updatedBy: 'system'\n      },\n      {\n        key: 'agent.approval_required_above_savings',\n        value: '10000000',\n        description: 'Annual savings amount (USD) above which approval is required even in autonomous mode',\n        updatedBy: 'system'\n      },\n      {\n        key: 'agent.auto_execute_types',\n        value: 'rightsizing,scheduling,storage-tiering',\n        description: 'Comma-separated list of recommendation types that can be executed autonomously',\n        updatedBy: 'system'\n      }\n    ];\n\n    for (const config of defaults) {\n      const existing = await storage.getSystemConfig(config.key, SYSTEM_TENANT_ID);\n      if (!existing) {\n        await storage.setSystemConfig({ ...config, tenantId: SYSTEM_TENANT_ID }, SYSTEM_TENANT_ID);\n        this.configCache.set(config.key, config.value);\n      } else {\n        this.configCache.set(config.key, existing.value);\n      }\n    }\n  }\n\n  async getAgentConfig(): Promise<AgentConfig> {\n    await this.refreshCache();\n    \n    const prodMode = this.getBooleanConfig('agent.prod_mode', false);\n    let prodModeTimeRemaining: number | undefined;\n\n    if (prodMode && this.prodModeExpiresAt) {\n      const remaining = Math.max(0, Math.floor((this.prodModeExpiresAt - Date.now()) / 1000));\n      prodModeTimeRemaining = remaining;\n    }\n    \n    return {\n      autonomousMode: this.getBooleanConfig('agent.autonomous_mode', false),\n      prodMode,\n      simulationMode: this.getBooleanConfig('agent.simulation_mode', false),\n      maxAutonomousRiskLevel: this.getNumberConfig('agent.max_autonomous_risk_level', 5.0),\n      approvalRequiredAboveSavings: this.getNumberConfig('agent.approval_required_above_savings', 10000),\n      autoExecuteTypes: this.getArrayConfig('agent.auto_execute_types', ['rightsizing', 'scheduling', 'storage-tiering']),\n      prodModeTimeRemaining\n    };\n  }\n\n  async setAutonomousMode(enabled: boolean, updatedBy: string): Promise<void> {\n    await storage.updateSystemConfig('agent.autonomous_mode', enabled.toString(), updatedBy, SYSTEM_TENANT_ID);\n    this.configCache.set('agent.autonomous_mode', enabled.toString());\n  }\n\n  async setMaxAutonomousRiskLevel(riskLevel: number, updatedBy: string): Promise<void> {\n    await storage.updateSystemConfig('agent.max_autonomous_risk_level', riskLevel.toString(), updatedBy, SYSTEM_TENANT_ID);\n    this.configCache.set('agent.max_autonomous_risk_level', riskLevel.toString());\n  }\n\n  async setProdMode(enabled: boolean, updatedBy: string): Promise<void> {\n    await storage.updateSystemConfig('agent.prod_mode', enabled.toString(), updatedBy, SYSTEM_TENANT_ID);\n    this.configCache.set('agent.prod_mode', enabled.toString());\n    \n    // Track expiration time when enabling prod mode\n    if (enabled) {\n      this.prodModeExpiresAt = Date.now() + (5 * 60 * 1000); // 5 minutes from now\n    } else {\n      this.prodModeExpiresAt = null;\n    }\n  }\n\n  async setSimulationMode(enabled: boolean, updatedBy: string): Promise<void> {\n    await storage.updateSystemConfig('agent.simulation_mode', enabled.toString(), updatedBy, SYSTEM_TENANT_ID);\n    this.configCache.set('agent.simulation_mode', enabled.toString());\n  }\n\n  // Method to invalidate cache when configuration is updated externally\n  invalidateCache(): void {\n    this.configCache.clear();\n  }\n\n  async canExecuteAutonomously(recommendation: {\n    type: string;\n    riskLevel: number;\n    projectedMonthlySavings: number;\n  }): Promise<boolean> {\n    const config = await this.getAgentConfig();\n    \n    // CRITICAL: Check autonomous mode FIRST - if disabled, ALWAYS return false\n    if (!config.autonomousMode) {\n      logger.info('Autonomous execution blocked: Autonomous Mode is OFF', {\n        recommendationType: recommendation.type,\n        riskLevel: recommendation.riskLevel,\n        projectedSavings: recommendation.projectedMonthlySavings,\n        decision: 'REQUIRES_APPROVAL'\n      });\n      return false;\n    }\n\n    // Check risk level\n    if (recommendation.riskLevel > config.maxAutonomousRiskLevel) {\n      logger.info('Autonomous execution blocked: Risk level too high', {\n        recommendationType: recommendation.type,\n        riskLevel: recommendation.riskLevel,\n        maxAllowed: config.maxAutonomousRiskLevel,\n        projectedSavings: recommendation.projectedMonthlySavings,\n        decision: 'REQUIRES_APPROVAL'\n      });\n      return false;\n    }\n\n    // Check savings threshold (monthly savings * 12 for annual comparison)\n    const annualizedSavings = recommendation.projectedMonthlySavings * 12;\n    if (annualizedSavings > config.approvalRequiredAboveSavings) {\n      logger.info('Autonomous execution blocked: Savings threshold exceeded', {\n        recommendationType: recommendation.type,\n        annualizedSavings: annualizedSavings,\n        threshold: config.approvalRequiredAboveSavings,\n        decision: 'REQUIRES_APPROVAL'\n      });\n      return false;\n    }\n\n    // Check if recommendation type is allowed for autonomous execution\n    if (!config.autoExecuteTypes.includes(recommendation.type)) {\n      logger.info('Autonomous execution blocked: Recommendation type not in allow list', {\n        recommendationType: recommendation.type,\n        allowedTypes: config.autoExecuteTypes,\n        decision: 'REQUIRES_APPROVAL'\n      });\n      return false;\n    }\n\n    // All checks passed - approve for autonomous execution\n    logger.info('Autonomous execution approved', {\n      recommendationType: recommendation.type,\n      riskLevel: recommendation.riskLevel,\n      projectedSavings: recommendation.projectedMonthlySavings,\n      decision: 'AUTO_EXECUTE'\n    });\n    return true;\n  }\n\n  async determineExecutionMode(recommendation: {\n    type: string;\n    riskLevel: number;\n    projectedMonthlySavings: number;\n  }): Promise<{\n    executionMode: 'autonomous' | 'hitl';\n    autoExecute: boolean;\n    reason: string;\n  }> {\n    const canExecute = await this.canExecuteAutonomously(recommendation);\n    \n    if (canExecute) {\n      return {\n        executionMode: 'autonomous',\n        autoExecute: true,\n        reason: 'Meets all criteria for autonomous execution'\n      };\n    } else {\n      const config = await this.getAgentConfig();\n      \n      let reason = 'Requires human approval: ';\n      const reasons: string[] = [];\n      \n      if (!config.autonomousMode) {\n        reasons.push('Autonomous mode disabled');\n      }\n      if (recommendation.riskLevel > config.maxAutonomousRiskLevel) {\n        reasons.push(`Risk level ${recommendation.riskLevel} exceeds max ${config.maxAutonomousRiskLevel}`);\n      }\n      const annualizedSavings = recommendation.projectedMonthlySavings * 12;\n      if (annualizedSavings > config.approvalRequiredAboveSavings) {\n        reasons.push(`Savings $${(annualizedSavings/1000).toFixed(0)}K exceeds threshold $${(config.approvalRequiredAboveSavings/1000).toFixed(0)}K`);\n      }\n      if (!config.autoExecuteTypes.includes(recommendation.type)) {\n        reasons.push(`Type '${recommendation.type}' not in auto-execute list`);\n      }\n      \n      reason += reasons.join(', ');\n      \n      return {\n        executionMode: 'hitl',\n        autoExecute: false,\n        reason\n      };\n    }\n  }\n\n  private async refreshCache(): Promise<void> {\n    // Only refresh cache if it's empty or periodically\n    if (this.configCache.size === 0) {\n      const allConfig = await storage.getAllSystemConfig(SYSTEM_TENANT_ID);\n      for (const config of allConfig) {\n        this.configCache.set(config.key, config.value);\n      }\n    }\n  }\n\n  private getBooleanConfig(key: string, defaultValue: boolean): boolean {\n    const value = this.configCache.get(key);\n    return value ? value.toLowerCase() === 'true' : defaultValue;\n  }\n\n  private getNumberConfig(key: string, defaultValue: number): number {\n    const value = this.configCache.get(key);\n    return value ? parseFloat(value) : defaultValue;\n  }\n\n  private getArrayConfig(key: string, defaultValue: string[]): string[] {\n    const value = this.configCache.get(key);\n    return value ? value.split(',').map(v => v.trim()) : defaultValue;\n  }\n}\n\nexport const configService = ConfigService.getInstance();","size_bytes":13904},"client/src/hooks/use-websocket.tsx":{"content":"import { useEffect, useRef, useState } from 'react';\nimport { isTokenValid, clearAuthAndRedirect } from '@/lib/auth-utils';\n\ninterface WebSocketMessage {\n  type: string;\n  data: any;\n  tenantId?: string;\n}\n\nexport function useWebSocket() {\n  const [isConnected, setIsConnected] = useState(false);\n  const [lastMessage, setLastMessage] = useState<WebSocketMessage | null>(null);\n  const [authError, setAuthError] = useState<string | null>(null);\n  const ws = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    // Get JWT token from localStorage\n    const token = localStorage.getItem('token');\n    \n    if (!token || !isTokenValid(token)) {\n      console.warn('[WebSocket] No valid authentication token found');\n      if (token && !isTokenValid(token)) {\n        console.error('[WebSocket] Token expired - logging out');\n        clearAuthAndRedirect();\n      }\n      setAuthError('Authentication required');\n      return;\n    }\n\n    const connectWebSocket = () => {\n      try {\n        const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        // Add JWT token as query parameter\n        const wsUrl = `${protocol}//${window.location.host}/ws?token=${encodeURIComponent(token)}`;\n        \n        console.log('[WebSocket] Connecting with authentication...');\n        ws.current = new WebSocket(wsUrl);\n\n        ws.current.onopen = () => {\n          setIsConnected(true);\n          setAuthError(null);\n          console.log('[WebSocket] Connected successfully');\n        };\n\n        ws.current.onmessage = (event) => {\n          try {\n            const message = JSON.parse(event.data);\n            \n            // Handle connection established message\n            if (message.type === 'connection_established') {\n              console.log('[WebSocket] Authentication confirmed:', message.data);\n            }\n            \n            // Handle authentication errors\n            if (message.type === 'error') {\n              console.error('[WebSocket] Server error:', message.data);\n              const errorMsg = message.data.message || message.data;\n              setAuthError(errorMsg);\n              \n              // If it's an auth error, clear token and redirect\n              if (errorMsg.toLowerCase().includes('token') || errorMsg.toLowerCase().includes('auth')) {\n                clearAuthAndRedirect();\n              }\n            }\n            \n            setLastMessage(message);\n          } catch (error) {\n            console.error('[WebSocket] Error parsing message:', error);\n          }\n        };\n\n        ws.current.onclose = (event) => {\n          setIsConnected(false);\n          \n          // Handle authentication errors (code 1008)\n          if (event.code === 1008) {\n            console.error('[WebSocket] Authentication failed:', event.reason);\n            setAuthError(event.reason || 'Authentication failed');\n            clearAuthAndRedirect();\n            return;\n          }\n          \n          console.log('[WebSocket] Connection closed:', event.reason);\n          \n          // Attempt to reconnect after 5 seconds for non-auth failures\n          if (event.code !== 1000) { // 1000 is normal closure\n            console.log('[WebSocket] Will attempt to reconnect in 5 seconds...');\n            reconnectTimeoutRef.current = setTimeout(() => {\n              console.log('[WebSocket] Reconnecting...');\n              connectWebSocket();\n            }, 5000);\n          }\n        };\n\n        ws.current.onerror = (error) => {\n          console.error('[WebSocket] Connection error:', error);\n        };\n      } catch (error) {\n        console.error('[WebSocket] Failed to create connection:', error);\n        setAuthError('Failed to establish WebSocket connection');\n      }\n    };\n\n    connectWebSocket();\n\n    return () => {\n      // Clear reconnect timeout\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n        reconnectTimeoutRef.current = null;\n      }\n      \n      // Close WebSocket connection\n      if (ws.current) {\n        ws.current.close(1000, 'Component unmounting');\n      }\n    };\n  }, []);\n\n  const sendMessage = (message: any) => {\n    if (ws.current && ws.current.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify(message));\n    } else {\n      console.warn('[WebSocket] Cannot send message - connection not open');\n    }\n  };\n\n  return {\n    isConnected,\n    lastMessage,\n    sendMessage,\n    authError\n  };\n}\n","size_bytes":4522},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/dashboard/recommendations-panel.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { AlertCircle, Info, CheckCircle, ExternalLink, CheckCheck, AlertTriangle } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Recommendation } from \"@shared/schema\";\n\ntype FilterType = 'all' | 'autonomous' | 'hitl' | 'pending';\n\ninterface AgentConfig {\n  autonomousMode: boolean;\n  prodMode: boolean;\n  simulationMode: boolean;\n  maxAutonomousRiskLevel: number;\n  approvalRequiredAboveSavings: number;\n  autoExecuteTypes: string[];\n}\n\nexport function RecommendationsPanel() {\n  const [selectedRecommendation, setSelectedRecommendation] = useState<string | null>(null);\n  const [activeFilter, setActiveFilter] = useState<FilterType>('all');\n  const { toast } = useToast();\n  \n  const { data: recommendations, isLoading } = useQuery<Recommendation[]>({\n    queryKey: ['/api/recommendations'],\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n\n  const { data: agentConfig } = useQuery<AgentConfig>({\n    queryKey: ['/api/agent-config'],\n    refetchInterval: 5000,\n  });\n\n  const approveAllMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('POST', '/api/approve-all-recommendations', {\n        approvedBy: 'current-user',\n        comments: 'Bulk approval of all pending recommendations'\n      });\n    },\n    onSuccess: (data: any) => {\n      const totalSavings = data.totalAnnualSavings || 0;\n      const formattedSavings = formatCurrencyK(totalSavings);\n      \n      toast({\n        title: \"Bulk Approval Successful\",\n        description: `Successfully approved ${data.approvedCount} recommendations with total annual savings of ${formattedSavings}`,\n      });\n      \n      // Force refresh all related data\n      queryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/metrics'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/optimization-history'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Bulk Approval Failed\",\n        description: error instanceof Error ? error.message : \"Failed to approve recommendations\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleApprovalRequest = (recommendationId: string) => {\n    setSelectedRecommendation(recommendationId);\n    // This will trigger the ApprovalModal to open\n    const event = new CustomEvent('openApprovalModal', { detail: { recommendationId } });\n    window.dispatchEvent(event);\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Priority Recommendations</CardTitle>\n        </CardHeader>\n        <CardContent className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {Array.from({ length: 6 }).map((_, i) => (\n            <div key={i} className=\"animate-pulse bg-muted rounded-lg p-4 h-32\"></div>\n          ))}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!recommendations || recommendations.length === 0) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Priority Recommendations</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8\">\n            <CheckCircle className=\"w-12 h-12 text-accent mx-auto mb-4\" />\n            <p className=\"text-muted-foreground\">No pending recommendations</p>\n            <p className=\"text-sm text-muted-foreground mt-2\">All resources are optimally configured</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Filter recommendations based on active filter\n  const getFilteredRecommendations = () => {\n    let filtered = recommendations || [];\n    \n    switch (activeFilter) {\n      case 'autonomous':\n        filtered = filtered.filter(r => r.executionMode === 'autonomous');\n        break;\n      case 'hitl':\n        filtered = filtered.filter(r => r.executionMode === 'hitl');\n        break;\n      case 'pending':\n        filtered = filtered.filter(r => r.status === 'pending');\n        break;\n      case 'all':\n      default:\n        // Show all\n        break;\n    }\n    \n    return filtered;\n  };\n\n  const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };\n  const pendingRecommendations = recommendations?.filter(r => r.status === 'pending') || [];\n  const filteredRecommendations = getFilteredRecommendations();\n  const sortedRecommendations = [...filteredRecommendations]\n    .sort((a, b) => priorityOrder[a.priority as keyof typeof priorityOrder] - priorityOrder[b.priority as keyof typeof priorityOrder])\n    .slice(0, 6); // Show more recommendations with the full width available\n\n  const getPriorityIcon = (priority: string) => {\n    switch (priority) {\n      case 'critical': return <AlertCircle className=\"w-4 h-4\" />;\n      case 'high': return <AlertCircle className=\"w-4 h-4\" />;\n      case 'medium': return <Info className=\"w-4 h-4\" />;\n      case 'low': return <CheckCircle className=\"w-4 h-4\" />;\n      default: return <Info className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'critical': return 'destructive';\n      case 'high': return 'destructive';\n      case 'medium': return 'secondary';\n      case 'low': return 'secondary';\n      default: return 'secondary';\n    }\n  };\n\n  const getExecutionModeBadge = (recommendation: Recommendation, index: number) => {\n    if (recommendation.executionMode === 'autonomous' && recommendation.status === 'executed') {\n      return (\n        <Badge variant=\"outline\" className=\"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30\" data-testid={`badge-autonomous-${index}`}>\n          ‚úÖ Auto-Executed\n        </Badge>\n      );\n    } else if (recommendation.executionMode === 'autonomous' && recommendation.status === 'pending') {\n      return (\n        <Badge variant=\"outline\" className=\"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30\" data-testid={`badge-autonomous-${index}`}>\n          ‚úÖ Auto-Optimized\n        </Badge>\n      );\n    } else if (recommendation.executionMode === 'hitl' && recommendation.status === 'pending') {\n      return (\n        <Badge variant=\"outline\" className=\"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/30\" data-testid={`badge-hitl-${index}`}>\n          üïí Needs Approval\n        </Badge>\n      );\n    } else if (recommendation.executionMode === 'hitl' && recommendation.status === 'approved') {\n      return (\n        <Badge variant=\"outline\" className=\"bg-indigo-500/10 text-indigo-600 dark:text-indigo-400 border-indigo-500/30\" data-testid={`badge-hitl-approved-${index}`}>\n          ‚è≥ Awaiting Execution\n        </Badge>\n      );\n    } else {\n      return (\n        <Badge variant=\"outline\" data-testid={`badge-default-${index}`}>\n          {recommendation.executionMode === 'autonomous' ? 'Autonomous' : 'HITL'}\n        </Badge>\n      );\n    }\n  };\n\n  return (\n    <Card data-testid=\"recommendations-panel\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between mb-4\">\n          <CardTitle className=\"text-lg font-semibold text-foreground\">Priority Recommendations</CardTitle>\n          <div className=\"flex items-center space-x-2\">\n            {pendingRecommendations.length > 0 && (\n              <Button \n                variant=\"default\" \n                size=\"sm\" \n                onClick={() => approveAllMutation.mutate()}\n                disabled={approveAllMutation.isPending}\n                className=\"bg-accent hover:bg-accent/90 text-accent-foreground\"\n                data-testid=\"button-approve-all\"\n              >\n                {approveAllMutation.isPending ? (\n                  <>\n                    <CheckCheck className=\"w-4 h-4 mr-1 animate-pulse\" />\n                    Approving...\n                  </>\n                ) : (\n                  <>\n                    <CheckCheck className=\"w-4 h-4 mr-1\" />\n                    Approve All ({pendingRecommendations.length})\n                  </>\n                )}\n              </Button>\n            )}\n            <Button variant=\"ghost\" size=\"sm\" className=\"text-primary text-sm hover:underline\" data-testid=\"button-view-all\">\n              View All\n            </Button>\n          </div>\n        </div>\n\n        {/* Config Status Banner */}\n        {agentConfig && !agentConfig.autonomousMode && pendingRecommendations.length > 0 && (\n          <Alert variant=\"default\" className=\"bg-amber-500/10 border-amber-500/30 mb-4\" data-testid=\"autonomous-mode-disabled-banner\">\n            <AlertTriangle className=\"h-4 w-4 text-amber-600 dark:text-amber-400\" />\n            <AlertDescription className=\"text-amber-600 dark:text-amber-400\">\n              ‚ö†Ô∏è Autonomous Mode Disabled - All recommendations require manual approval\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {/* Filter Chips */}\n        <div className=\"flex gap-2 flex-wrap\">\n          <Button\n            variant={activeFilter === 'all' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setActiveFilter('all')}\n            className={activeFilter === 'all' ? 'bg-accent text-accent-foreground' : ''}\n            data-testid=\"filter-all\"\n          >\n            All\n          </Button>\n          <Button\n            variant={activeFilter === 'autonomous' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setActiveFilter('autonomous')}\n            className={activeFilter === 'autonomous' ? 'bg-accent text-accent-foreground' : ''}\n            data-testid=\"filter-autonomous\"\n          >\n            Autonomous\n          </Button>\n          <Button\n            variant={activeFilter === 'hitl' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setActiveFilter('hitl')}\n            className={activeFilter === 'hitl' ? 'bg-accent text-accent-foreground' : ''}\n            data-testid=\"filter-hitl\"\n          >\n            HITL\n          </Button>\n          <Button\n            variant={activeFilter === 'pending' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setActiveFilter('pending')}\n            className={activeFilter === 'pending' ? 'bg-accent text-accent-foreground' : ''}\n            data-testid=\"filter-pending\"\n          >\n            Pending\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {sortedRecommendations.length === 0 ? (\n          <div className=\"col-span-full text-center py-8 text-muted-foreground\">\n            No recommendations match the selected filter\n          </div>\n        ) : (\n          sortedRecommendations.map((recommendation, index) => {\n            const isCritical = recommendation.priority === 'critical';\n            \n            return (\n              <Card \n                key={recommendation.id} \n                className={`${isCritical ? 'border-l-4 border-l-destructive' : 'border-l-4 border-l-accent'} hover:shadow-md transition-shadow`}\n                data-testid={`recommendation-${index}`}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div className=\"flex items-center space-x-2 flex-wrap gap-1\">\n                      <span className={`text-${getPriorityColor(recommendation.priority)}`}>\n                        {getPriorityIcon(recommendation.priority)}\n                      </span>\n                      <Badge variant={getPriorityColor(recommendation.priority) as any}>\n                        {recommendation.priority.toUpperCase()}\n                      </Badge>\n                      {getExecutionModeBadge(recommendation, index)}\n                    </div>\n                    <Badge variant=\"outline\" data-testid={`savings-badge-${index}`}>\n                      {formatCurrencyK(recommendation.projectedMonthlySavings * 12)}/year\n                    </Badge>\n                  </div>\n                  \n                  <h4 className=\"font-semibold text-foreground mb-2\" data-testid={`recommendation-title-${index}`}>\n                    {recommendation.title}\n                  </h4>\n                  <p className=\"text-sm text-muted-foreground mb-3\" data-testid={`recommendation-description-${index}`}>\n                    {recommendation.description}\n                  </p>\n                  \n                  <div className=\"space-y-2 mb-4 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Resource:</span>\n                      <span className=\"font-medium\" data-testid={`resource-id-${index}`}>{recommendation.resourceId}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Monthly Savings:</span>\n                      <span className=\"font-bold text-accent\" data-testid={`monthly-savings-${index}`}>\n                        {formatCurrencyK(recommendation.projectedMonthlySavings)}\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Risk Level:</span>\n                      <span className=\"text-accent\" data-testid={`risk-level-${index}`}>\n                        &lt; {recommendation.riskLevel}%\n                      </span>\n                    </div>\n                  </div>\n                  \n                  <Button \n                    className=\"w-full\" \n                    onClick={() => handleApprovalRequest(recommendation.id)}\n                    data-testid={`button-approve-${index}`}\n                  >\n                    Review & Approve\n                  </Button>\n                </CardContent>\n              </Card>\n            );\n          })\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":14395},"client/src/components/dashboard/metrics-cards.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { formatCurrencyCompact } from \"@/lib/currency\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\n\ninterface MetricsSummary {\n  monthlySpend: number;\n  ytdSpend: number;\n  identifiedSavingsAwaitingApproval: number;\n  realizedSavingsYTD: number;\n  wastePercentOptimizedYTD: number;\n  monthlySpendChange: number;\n  ytdSpendChange: number;\n}\n\nexport function MetricsCards() {\n  const { data: metrics, isLoading } = useQuery<MetricsSummary>({\n    queryKey: ['/api/metrics/summary'],\n    refetchInterval: 3000, // Refresh every 3 seconds\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Card key={i} className=\"animate-pulse\">\n            <CardContent className=\"p-6\">\n              <div className=\"h-20 bg-muted rounded\"></div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  if (!metrics) {\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6\">\n        <Card>\n          <CardContent className=\"p-6 text-center text-muted-foreground\">\n            No metrics available\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const renderChangeIndicator = (change: number) => {\n    if (change === 0) return null;\n    const isPositive = change > 0;\n    const Icon = isPositive ? TrendingUp : TrendingDown;\n    const colorClass = isPositive ? \"text-destructive\" : \"text-green-500\";\n    \n    return (\n      <div className={`flex items-center gap-1 text-sm ${colorClass} mt-1`}>\n        <Icon className=\"w-3.5 h-3.5\" />\n        <span>{Math.abs(change).toFixed(1)}% vs last period</span>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6\">\n      <Card className=\"hover:shadow-lg transition-all duration-200 hover:-translate-y-1\" data-testid=\"card-monthly-spend\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col justify-center\">\n            <p className=\"text-sm font-medium text-muted-foreground\">Monthly AWS Spend</p>\n            <p className=\"text-3xl font-bold text-foreground mt-2\" data-testid=\"monthly-spend-amount\">\n              {formatCurrencyCompact(metrics.monthlySpend)}\n            </p>\n            {renderChangeIndicator(metrics.monthlySpendChange)}\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"hover:shadow-lg transition-all duration-200 hover:-translate-y-1\" data-testid=\"card-ytd-spend\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col justify-center\">\n            <p className=\"text-sm font-medium text-muted-foreground\">YTD AWS Spend</p>\n            <p className=\"text-3xl font-bold text-foreground mt-2\" data-testid=\"ytd-spend-amount\">\n              {formatCurrencyCompact(metrics.ytdSpend)}\n            </p>\n            {renderChangeIndicator(metrics.ytdSpendChange)}\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"hover:shadow-lg transition-all duration-200 hover:-translate-y-1\" data-testid=\"card-identified-savings\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col justify-center\">\n            <p className=\"text-sm font-medium text-muted-foreground\">Identified Savings</p>\n            <p className=\"text-3xl font-bold text-accent mt-2\" data-testid=\"identified-savings-amount\">\n              {formatCurrencyCompact(metrics.identifiedSavingsAwaitingApproval)}\n            </p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Awaiting Approval\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"hover:shadow-lg transition-all duration-200 hover:-translate-y-1\" data-testid=\"card-realized-savings\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col justify-center\">\n            <p className=\"text-sm font-medium text-muted-foreground\">Realized Savings YTD</p>\n            <p className=\"text-3xl font-bold text-green-500 mt-2\" data-testid=\"realized-savings-amount\">\n              {formatCurrencyCompact(metrics.realizedSavingsYTD)}\n            </p>\n            <p className=\"text-sm text-green-500 mt-1\">\n              Year to Date\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"hover:shadow-lg transition-all duration-200 hover:-translate-y-1\" data-testid=\"card-waste-optimized\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col justify-center\">\n            <p className=\"text-sm font-medium text-muted-foreground\">Waste % Optimized</p>\n            <p className=\"text-3xl font-bold text-chart-3 mt-2\" data-testid=\"waste-optimized-amount\">\n              {metrics.wastePercentOptimizedYTD.toFixed(1)}%\n            </p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              YTD Performance\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5163},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/pages/recommendations.tsx":{"content":"import { Sidebar } from \"@/components/layout/sidebar\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport { RecommendationsPanel } from \"@/components/dashboard/recommendations-panel\";\nimport { ApprovalModal } from \"@/components/modals/approval-modal\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Recommendation } from \"@shared/schema\";\nimport { AlertCircle, CheckCircle, Info, Lightbulb, AlertTriangle } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport { useState } from \"react\";\n\nexport default function Recommendations() {\n  const { agentConfig, updateProdMode } = useAgentConfig();\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n  const { data: recommendations, isLoading, error } = useQuery<Recommendation[]>({\n    queryKey: ['/api/recommendations'],\n    refetchInterval: 30000,\n    retry: false,\n  });\n\n  const getStatusStats = () => {\n    if (!recommendations) return { pending: 0, approved: 0, executed: 0, rejected: 0 };\n    \n    return recommendations.reduce((acc, rec) => {\n      acc[rec.status as keyof typeof acc] = (acc[rec.status as keyof typeof acc] || 0) + 1;\n      return acc;\n    }, { pending: 0, approved: 0, executed: 0, rejected: 0 });\n  };\n\n  const stats = getStatusStats();\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex flex-col bg-background\">\n        <TopNav \n          lastSync=\"Error\"\n          prodMode={agentConfig?.prodMode || false}\n          onProdModeChange={updateProdMode}\n          onMenuClick={() => setIsMobileSidebarOpen(true)}\n        />\n        <div className=\"flex-1 flex pt-[60px]\">\n          <Sidebar \n            isMobileOpen={isMobileSidebarOpen}\n            onClose={() => setIsMobileSidebarOpen(false)}\n          />\n          <main className=\"flex-1 overflow-hidden w-full\">\n            <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n              <Alert variant=\"destructive\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertTitle>Error Loading Data</AlertTitle>\n                <AlertDescription>\n                  {error instanceof Error ? error.message : 'Failed to load recommendations. Please try again.'}\n                </AlertDescription>\n              </Alert>\n            </div>\n          </main>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <TopNav \n        lastSync=\"2 min ago\"\n        prodMode={agentConfig?.prodMode || false}\n        onProdModeChange={updateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n        \n        <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Cost Optimization Recommendations</h1>\n          <p className=\"text-muted-foreground\">\n            AI-powered recommendations to reduce your AWS costs\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Pending Review</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.pending}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Awaiting approval\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Approved</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.approved}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Ready for execution\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Executed</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.executed}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Successfully applied\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Rejected</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.rejected}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Not implemented\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-1 gap-6\">\n          <RecommendationsPanel />\n        </div>\n\n        {recommendations && recommendations.length > 3 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>All Recommendations</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {recommendations.slice(3).map((rec, index) => (\n                  <div key={rec.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <Lightbulb className=\"w-4 h-4\" />\n                        <h3 className=\"font-medium\">{rec.title}</h3>\n                        <Badge variant={rec.priority === 'high' || rec.priority === 'critical' ? 'destructive' : 'secondary'}>\n                          {rec.priority}\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">{rec.description}</p>\n                      <p className=\"text-sm font-medium mt-1\">\n                        Projected savings: {formatCurrencyK(rec.projectedMonthlySavings)}/month\n                      </p>\n                    </div>\n                    <Badge variant=\"outline\">{rec.status}</Badge>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n          </div>\n        </div>\n      </main>\n      </div>\n      \n      <ApprovalModal />\n    </div>\n  );\n}","size_bytes":6860},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"replit.md":{"content":"# FinOps Autopilot - Enterprise Cloud Cost Optimization Platform\n\n## Overview\nFinOps Autopilot is a comprehensive cloud cost optimization platform for enterprises. It automates AWS resource analysis, identifies cost-saving opportunities, and provides actionable recommendations. The platform features real-time monitoring, automated analysis, executive dashboards with approval workflows, and integrates FinOps best practices to reduce cloud spending through automated insights and human oversight.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend\n- **Framework**: React 18 with TypeScript (Vite)\n- **UI**: Shadcn/ui (Radix UI), Tailwind CSS\n- **State Management**: TanStack Query\n- **Routing**: Wouter\n- **Real-time**: WebSocket connection\n\n### Backend\n- **Runtime**: Node.js with Express.js\n- **Language**: TypeScript (ESM)\n- **ORM**: Drizzle ORM\n- **API**: RESTful with WebSocket support\n- **Session Management**: Express sessions (PostgreSQL store)\n- **Background Processing**: Node-cron for scheduled tasks\n\n### Data Storage\n- **Primary Database**: PostgreSQL (Neon serverless)\n- **Schema Management**: Drizzle migrations\n- **Models**: Users, AWS resources, cost reports, recommendations, approval workflows\n\n### Authentication & Authorization\n- **Authentication**: JWT-based with localStorage persistence\n- **JWT TTL**: 2 hours with automatic expiration\n- **Authorization**: Role-based access control (admin, user)\n- **Registration**: Secure registration with role selection (admin/user)\n- **Login UI**: Dedicated authentication page with tabbed login/register interface\n- **Auth Guard**: Frontend route protection with automatic redirect to login\n- **Workflows**: Multi-stage approval for high-impact optimizations\n\n### Enterprise Security (Phase 2 Complete)\n- **Security Headers**: \n  - Strict-Transport-Security (HSTS) with max-age 1 year, includeSubDomains\n  - X-Frame-Options: DENY (clickjacking protection)\n  - X-Content-Type-Options: nosniff (MIME sniffing protection)\n  - Content-Security-Policy (CSP) with strict directives\n  - X-XSS-Protection: 1; mode=block\n  - Referrer-Policy, Permissions-Policy, X-DNS-Prefetch-Control\n- **CORS Hardening**: \n  - Production fail-closed (requires ALLOWED_ORIGINS env var)\n  - Rejects wildcard origins (*) in production\n  - Startup validation fails-fast if misconfigured\n  - Development mode allows localhost origins only\n- **Session Timeout Enforcement**:\n  - 2-hour maximum session age (iat-based)\n  - Hard JWT expiration validation (exp check)\n  - Applied to both REST API and WebSocket connections\n  - Warning headers when token expiring <15 min (X-Token-Expiring-Soon, X-Token-Expires-In)\n  - Middleware ordering: authenticateToken ‚Üí enforceSessionTimeout ‚Üí audit ‚Üí handler\n- **Audit Logging**:\n  - 13+ critical endpoints logged (auth, recommendations, approvals, system config)\n  - Imperative logging in 4 complex workflows (approval, optimization, batch operations)\n  - Captures: userId, action, resourceType, resourceId, metadata, IP, user agent\n  - Asynchronous non-blocking writes (does not impact request latency)\n  - Only logs successful operations (2xx responses)\n- **Database Transactions**:\n  - Atomic operations for recommendation approval and optimization execution\n  - Retry logic with exponential backoff (3 retries)\n  - Automatic rollback on failure\n  - Transaction helpers: handleApprovalTransaction, handleOptimizationExecutionTransaction\n- **API Rate Limiting**:\n  - Auth endpoints: 5 requests/min (login, register)\n  - General API: 100 requests/min\n  - Write operations: 30 requests/min\n  - Read operations: 60 requests/min\n  - Per-IP enforcement with memory store\n- **WebSocket Security**:\n  - JWT authentication via query parameter\n  - Session age validation (2-hour limit)\n  - Token expiration check during connection\n  - Rejects stale sessions with code 1008 (Policy Violation)\n  - Connection refused for expired/invalid tokens\n- **Production Safety**:\n  - JWT_SECRET required at startup (32+ chars minimum)\n  - Fail-fast validation for missing/weak secrets\n  - Password hashing with bcrypt (10 rounds)\n  - Multi-tenant isolation via tenantId (COMPLETE)\n  - Circuit breakers and health check endpoints\n- **AWS Credential Safety** (November 2025):\n  - Lazy initialization - AWS SDK clients only instantiated when credentials available\n  - Credential validation before SDK initialization (checks AWS_ACCESS_KEY_ID + AWS_SECRET_ACCESS_KEY)\n  - All AWS methods guarded with initializeClients() including helper methods\n  - Preview/dev deployments without AWS credentials run error-free in simulation mode\n  - Clear error messages when AWS methods called without proper credentials\n\n### Multi-Tenancy Architecture (Complete)\n- **Database Layer**:\n  - tenantId column on all 9 user-scoped tables (NOT NULL, no defaults)\n  - Composite indexes for tenant-scoped queries (tenantId + createdAt/status/reportDate)\n  - Default tenant: 'default-tenant' for system operations\n- **Storage Layer**:\n  - All create/read/update/delete methods require tenantId parameter\n  - All queries filter by tenantId using WHERE clauses\n  - Pattern: `where(and(eq(table.id, id), eq(table.tenantId, tenantId)))`\n- **API Layer**:\n  - All authenticated endpoints extract tenantId from JWT (req.user?.tenantId)\n  - Fail with 401 if tenantId missing (except login/register)\n  - No 'default-tenant' fallbacks in authenticated routes\n- **Background Services**:\n  - SYSTEM_TENANT_ID = 'default-tenant' constant\n  - All storage calls explicitly pass SYSTEM_TENANT_ID\n  - scheduler.ts and data-generator.ts properly scoped\n- **Security Impact**:\n  - Complete tenant data isolation enforced\n  - No cross-tenant data leakage possible\n  - Both READ and WRITE paths secured\n  - JWT payload includes tenantId for all requests\n\n### Real-time Communication\n- **WebSocket Server**: Integrated for dashboard updates\n- **Event Broadcasting**: Notifications for recommendations and optimization completions\n- **Client Synchronization**: Automatic UI updates via query invalidation\n\n### autonomOS Platform Integration\n- **Client**: `aosClient.ts` for platform interactions\n- **APIs**: `getView()` for data, `postIntent()` for actions\n- **Task Polling**: Automatic status polling\n- **Feature Flag**: `VITE_USE_PLATFORM` for enabling/disabling\n- **HITL Safety**: Recommendations map to `explain_only: true, dry_run: true`\n- **Idempotency**: Unique keys for intent executions\n- **Approval Integration**: Platform intents sent on recommendation approval\n\n### Dashboard Structure\n- **Executive Dashboard**: Comprehensive financial overview (Monthly/YTD Spend, Identified/Realized Savings, Waste Optimized %). Auto-refreshes every 10 seconds.\n- **Operations Dashboard**: Integrates metrics into a Data Flow Pipeline visualization, combining financial KPIs and operational telemetry. Auto-refreshes every 3 seconds.\n\n### AI History Drill-Down & Execution Mode Transparency (November 2025)\n- **Database Schema**:\n  - Added `aiModeHistoryId` field to recommendations table (nullable, links recommendations to AI analysis runs)\n  - Added `calculationMetadata` jsonb field for calculation transparency (resourceMonthlyCost, savingsPercentage, methodology)\n  - Composite index on tenantId + aiModeHistoryId for efficient drill-down queries\n- **Drill-Down Modal**:\n  - AI history cards on Executive Dashboard are now clickable\n  - Opens detailed modal with three tabs: Overview, Recommendations, Calculations\n  - Overview tab: Shows run status, timestamps, total savings, execution mode distribution (autonomous % vs HITL %)\n  - Recommendations tab: Lists all recommendations from that AI run with execution mode badges\n  - Calculations tab: Displays savings breakdown by type (rightsizing, scheduling, storage-tiering) and methodology transparency\n- **Execution Mode Filters**:\n  - Filter chips on Dashboard Recommendations Panel: All, Autonomous, HITL, Pending\n  - Active filter highlighted with accent color\n  - Filters top 6 priority recommendations by execution mode and status\n- **Enhanced Execution Mode Badges**:\n  - ‚úÖ Auto-Executed (emerald) - autonomous recommendations that were executed\n  - ‚úÖ Auto-Optimized (emerald) - autonomous recommendations pending execution\n  - üïí Needs Approval (amber) - HITL recommendations requiring approval\n  - ‚è≥ Awaiting Execution (indigo) - HITL recommendations approved and awaiting execution\n- **Config Status Banner**:\n  - Warning banner appears when autonomous mode is disabled\n  - Shows: \"‚ö†Ô∏è Autonomous Mode Disabled - All recommendations require manual approval\"\n  - Only displays when autonomousMode=false AND pending recommendations exist\n- **Backend API Enhancement**:\n  - GET /api/ai-mode-history/:id - Returns complete drill-down data (AI run, recommendations, savings breakdown, execution mode counts)\n  - Storage computes savings aggregations: totalSavings, averageSavings, savingsByType, executionModeCounts\n  - All AI-generated recommendations include calculation metadata for full transparency\n\n### Automatic Initialization & Production Deployment (November 2025)\n- **Configuration**:\n  - Database default: `agent.simulation_mode='true'` in system_config table\n  - Code default: `simulationMode: true` in ConfigService initialization (server/services/config.ts line 125)\n  - No environment variable required - uses database configuration as single source of truth\n- **Fresh Deployment Behavior**:\n  - On startup with empty database, automatically generates:\n    - 6 synthetic AWS resources (EC2, RDS, Redshift clusters)\n    - 6 months of historical cost data (cost_reports table)\n    - Initial recommendation dataset with 80/20 autonomous/HITL distribution\n  - Starts continuous 3-second simulation loop\n  - Generates 2-5 new recommendations per cycle\n  - Auto-executes autonomous recommendations in background\n- **Production Safety**:\n  - Only generates data when `cost_reports.length === 0` (prevents duplicate data)\n  - Preserves existing data on restarts\n  - Simulation mode can be toggled via database config UI (Settings page)\n  - **Three-Layer Defense Against CredentialsError** (November 2025):\n    - **Layer 1 - Initialization Order**: Scheduler cron jobs deferred until after config initialization completes (prevents race condition during bootstrap)\n    - **Layer 2 - Environment Variable Failsafe**: All cron callbacks check `SIMULATION_MODE` env var synchronously before calling AWS APIs (bootstrap protection)\n    - **Layer 3 - AWS Service Centralized Guard**: `isReady()` method validates client availability across ALL AWS methods (never throws on read operations)\n    - All AWS service methods use centralized `isReady()` guard - returns safe fallbacks when clients unavailable\n    - Helper methods can safely call other helpers without re-throwing initialization errors\n    - Mutating operations (resize, delete) throw descriptive errors when clients unavailable\n    - Preview deployments work reliably without AWS credentials when `SIMULATION_MODE=true`\n\n### Performance Optimizations\n- **AI/RAG**: Gemini 2.0 Flash, Pinecone vector database for RAG, 5-minute TTL cache, Gemini text-embedding-004.\n- **Continuous Simulation**: High-velocity demo mode (3-second cycles), random resource utilization adjustments, 10x monetary multiplier for enterprise scale.\n- **Heuristic Recommendation Engine**: Runs every 3 seconds, generates 2-5 recommendations (Rightsizing, scheduling, storage-tiering), 80% autonomous / 20% HITL risk distribution.\n- **HITL vs Autonomous Labeling**: Recommendations tagged with `executionMode` (\"autonomous\" or \"hitl\"), visual badges, and dashboard widget showing 80/20 execution split.\n- **Currency Formatting**: Hybrid `formatCurrencyK` utility for smart, whole-number display (e.g., \"$71\", \"$260 K\").\n- **Database**: BIGINT for monetary fields, vector-based RAG, PostgreSQL for core data, optimized queries with indexing and minimal data transfer.\n\n## External Dependencies\n\n### Cloud Services\n- **AWS SDK v2**: AWS service integration\n- **Neon Database**: Serverless PostgreSQL hosting\n- **AWS Cost Explorer**: Cost analysis\n- **AWS CloudWatch**: Utilization metrics\n- **AWS Trusted Advisor**: Optimization recommendations\n\n### Third-party Integrations\n- **Pinecone**: Vector database for RAG\n- **Slack Web API**: Notifications\n- **AWS Support API**: Enhanced recommendation data\n\n### Development\n- **Replit Platform**: Development environment","size_bytes":12448},"client/src/components/layout/header.tsx":{"content":"import { RotateCcw, Bot, Settings, Activity } from \"lucide-react\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface AgentConfig {\n  autonomousMode: boolean;\n  prodMode: boolean;\n  simulationMode: boolean;\n  maxAutonomousRiskLevel: number;\n  approvalRequiredAboveSavings: number;\n  autoExecuteTypes: string[];\n}\n\nexport function Header() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch current agent configuration\n  const { data: agentConfig } = useQuery<AgentConfig>({\n    queryKey: ['/api/agent-config'],\n    staleTime: 30000,\n  });\n\n  // Mutation to update prod mode\n  const updateProdMode = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      const response = await fetch('/api/agent-config/prod-mode', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ enabled, updatedBy: 'admin-user' })\n      });\n      if (!response.ok) throw new Error('Failed to update prod mode');\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(['/api/agent-config'], data);\n      toast({\n        title: \"Prod Mode Updated\",\n        description: `${data.prodMode ? 'üöÄ AI Mode ON (Gemini + RAG)' : '‚öôÔ∏è Heuristics Mode ON'}`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update prod mode.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Mutation to update simulation mode\n  const updateSimulationMode = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      const response = await fetch('/api/agent-config/simulation-mode', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ enabled, updatedBy: 'admin-user' })\n      });\n      if (!response.ok) throw new Error('Failed to update simulation mode');\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(['/api/agent-config'], data);\n      toast({\n        title: \"Simulation Mode Updated\",\n        description: `${data.simulationMode ? 'üìä Dynamic Data ON (Synthetic Evolution)' : 'üìã Static Data Mode'}`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update simulation mode.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleToggleProdMode = () => {\n    if (agentConfig) {\n      updateProdMode.mutate(!agentConfig.prodMode);\n    }\n  };\n\n  const handleToggleSimulationMode = () => {\n    if (agentConfig) {\n      updateSimulationMode.mutate(!agentConfig.simulationMode);\n    }\n  };\n\n  return (\n    <header className=\"bg-card border-b border-border px-6 py-4\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground\">Executive Dashboard</h1>\n          <p className=\"text-muted-foreground mt-1\">Real-time cloud cost optimization insights</p>\n        </div>\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"flex items-center space-x-2 bg-muted px-3 py-2 rounded-lg\">\n            <RotateCcw className=\"w-4 h-4 text-accent\" />\n            <span className=\"text-sm text-muted-foreground\" data-testid=\"last-sync-time\">Last sync: 2 min ago</span>\n          </div>\n          \n          {/* Prod Mode Toggle */}\n          {agentConfig && (\n            <div className=\"flex items-center gap-3 px-4 py-2 rounded-lg border border-cyan-500/30 bg-gradient-to-r from-background to-cyan-950/10\">\n              <div className=\"flex items-center gap-2\">\n                {agentConfig.prodMode ? (\n                  <Bot className=\"w-4 h-4 text-cyan-400\" />\n                ) : (\n                  <Settings className=\"w-4 h-4 text-muted-foreground\" />\n                )}\n                <span className=\"text-sm font-medium\">Prod Mode</span>\n                <Badge \n                  variant={agentConfig.prodMode ? \"default\" : \"secondary\"} \n                  className={agentConfig.prodMode ? \"bg-cyan-500\" : \"\"}\n                  data-testid=\"header-prod-mode-badge\"\n                >\n                  {agentConfig.prodMode ? \"ON\" : \"OFF\"}\n                </Badge>\n              </div>\n              <Switch\n                checked={agentConfig.prodMode}\n                onCheckedChange={handleToggleProdMode}\n                disabled={updateProdMode.isPending}\n                data-testid=\"header-prod-mode-toggle\"\n                className=\"data-[state=checked]:bg-cyan-500\"\n              />\n            </div>\n          )}\n\n          {/* Synthetic Data Toggle */}\n          {agentConfig && (\n            <div className=\"flex items-center gap-3 px-4 py-2 rounded-lg border border-purple-500/30 bg-gradient-to-r from-background to-purple-950/10\">\n              <div className=\"flex items-center gap-2\">\n                {agentConfig.simulationMode ? (\n                  <Activity className=\"w-4 h-4 text-purple-400\" />\n                ) : (\n                  <Activity className=\"w-4 h-4 text-muted-foreground\" />\n                )}\n                <span className=\"text-sm font-medium\">Synthetic Data</span>\n                <Badge \n                  variant={agentConfig.simulationMode ? \"default\" : \"secondary\"} \n                  className={agentConfig.simulationMode ? \"bg-purple-500\" : \"\"}\n                  data-testid=\"header-simulation-mode-badge\"\n                >\n                  {agentConfig.simulationMode ? \"Y\" : \"N\"}\n                </Badge>\n              </div>\n              <Switch\n                checked={agentConfig.simulationMode}\n                onCheckedChange={handleToggleSimulationMode}\n                disabled={updateSimulationMode.isPending}\n                data-testid=\"header-simulation-mode-toggle\"\n                className=\"data-[state=checked]:bg-purple-500\"\n              />\n            </div>\n          )}\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":6154},"client/src/pages/cost-analysis.tsx":{"content":"import { Sidebar } from \"@/components/layout/sidebar\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { ChartLine, DollarSign, TrendingDown, TrendingUp, AlertTriangle } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { AwsResource } from \"@shared/schema\";\nimport { useState } from \"react\";\n\ninterface DashboardMetrics {\n  monthlySpend: number;\n  identifiedSavings: number;\n  realizedSavings: number;\n  resourcesAnalyzed: number;\n  wastePercentage: number;\n}\n\ninterface CostTrend {\n  month: string;\n  totalCost: number;\n}\n\nexport default function CostAnalysis() {\n  const { agentConfig, updateProdMode } = useAgentConfig();\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n  const { data: metrics, isLoading: metricsLoading, error: metricsError } = useQuery<DashboardMetrics>({\n    queryKey: ['/api/dashboard/metrics'],\n    refetchInterval: 60000,\n    retry: false,\n  });\n\n  const { data: trends, isLoading: trendsLoading, error: trendsError } = useQuery<CostTrend[]>({\n    queryKey: ['/api/dashboard/cost-trends'],\n    refetchInterval: 300000,\n    retry: false,\n  });\n\n  const { data: resources, isLoading: resourcesLoading, error: resourcesError } = useQuery<AwsResource[]>({\n    queryKey: ['/api/aws-resources'],\n    refetchInterval: 300000,\n    retry: false,\n  });\n\n  // Calculate cost variance from trends\n  const costVariance = trends && trends.length >= 2 \n    ? ((trends[trends.length - 1].totalCost - trends[trends.length - 2].totalCost) / trends[trends.length - 2].totalCost) * 100\n    : 0;\n\n  // Calculate forecast based on trend\n  const forecast = trends && trends.length >= 3\n    ? trends[trends.length - 1].totalCost * 1.025 // Simple 2.5% growth projection\n    : metrics?.monthlySpend ? metrics.monthlySpend * 1.025 : 0;\n\n  // Calculate service breakdown from resources\n  const serviceBreakdown = resources?.reduce((acc, resource) => {\n    const service = resource.resourceType;\n    const cost = Number(resource.monthlyCost) || 0;\n    acc[service] = (acc[service] || 0) + cost;\n    return acc;\n  }, {} as Record<string, number>) || {};\n\n  const sortedServices = Object.entries(serviceBreakdown)\n    .sort(([,a], [,b]) => b - a)\n    .slice(0, 5); // Top 5 services\n\n  const isLoading = metricsLoading || trendsLoading || resourcesLoading;\n  const error = metricsError || trendsError || resourcesError;\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex flex-col bg-background\">\n        <TopNav \n          lastSync=\"Error\"\n          prodMode={agentConfig?.prodMode || false}\n          onProdModeChange={updateProdMode}\n          onMenuClick={() => setIsMobileSidebarOpen(true)}\n        />\n        <div className=\"flex-1 flex pt-[60px]\">\n          <Sidebar \n            isMobileOpen={isMobileSidebarOpen}\n            onClose={() => setIsMobileSidebarOpen(false)}\n          />\n          <main className=\"flex-1 overflow-hidden w-full\">\n            <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n              <Alert variant=\"destructive\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertTitle>Error Loading Data</AlertTitle>\n                <AlertDescription>\n                  {error instanceof Error ? error.message : 'Failed to load cost analysis data. Please try again.'}\n                </AlertDescription>\n              </Alert>\n            </div>\n          </main>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex flex-col bg-background\">\n        <TopNav \n          lastSync=\"Loading...\"\n          prodMode={agentConfig?.prodMode || false}\n          onProdModeChange={updateProdMode}\n          onMenuClick={() => setIsMobileSidebarOpen(true)}\n        />\n        <div className=\"flex-1 flex pt-[60px]\">\n          <Sidebar \n            isMobileOpen={isMobileSidebarOpen}\n            onClose={() => setIsMobileSidebarOpen(false)}\n          />\n          <main className=\"flex-1 overflow-hidden w-full\">\n          <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n            <div className=\"space-y-6\">\n              <div>\n                <h1 className=\"text-3xl font-bold tracking-tight\">Cost Analysis</h1>\n                <p className=\"text-muted-foreground\">Loading cost analysis...</p>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n                {Array.from({ length: 4 }).map((_, i) => (\n                  <Card key={i} className=\"animate-pulse\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"h-20 bg-muted rounded\"></div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          </div>\n        </main>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <TopNav \n        lastSync=\"Just now\"\n        prodMode={agentConfig?.prodMode || false}\n        onProdModeChange={updateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n        \n        <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n          <div className=\"space-y-6\">\n            <div>\n              <h1 className=\"text-3xl font-bold tracking-tight\">Cost Analysis</h1>\n              <p className=\"text-muted-foreground\">\n                Detailed analysis of your AWS spending patterns and cost trends\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Monthly Spend</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"monthly-spend\">\n                    {formatCurrencyK(metrics?.monthlySpend || 0)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Current month spending\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Cost Variance</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"cost-variance\">\n                    {costVariance > 0 ? '+' : ''}{costVariance.toFixed(1)}%\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    vs. previous month\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Forecast</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"forecast\">\n                    {formatCurrencyK(forecast)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Projected monthly\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Potential Savings</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\" data-testid=\"potential-savings\">\n                    {formatCurrencyK(metrics?.identifiedSavings || 0)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Available optimizations\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Realized Savings</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold text-accent\" data-testid=\"realized-savings\">\n                    {formatCurrencyK(metrics?.realizedSavings || 0)}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    From approved optimizations\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Service Breakdown</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\" data-testid=\"service-breakdown\">\n                    {sortedServices.length > 0 ? (\n                      sortedServices.map(([service, cost]) => (\n                        <div key={service} className=\"flex justify-between items-center\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-3 h-3 bg-primary rounded-full\"></div>\n                            <span className=\"text-sm font-medium\">{service}</span>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className=\"text-sm font-bold\">{formatCurrencyK(cost)}/mo</div>\n                            <div className=\"text-xs text-muted-foreground\">\n                              {((cost / (metrics?.monthlySpend || 1)) * 100).toFixed(1)}%\n                            </div>\n                          </div>\n                        </div>\n                      ))\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <ChartLine className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                        <p className=\"text-muted-foreground\">No cost data available</p>\n                        <p className=\"text-sm text-muted-foreground mt-2\">\n                          Cost breakdown will appear here once resources are analyzed\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </main>\n      </div>\n    </div>\n  );\n}","size_bytes":10856},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/pages/governance.tsx":{"content":"import { Sidebar } from \"@/components/layout/sidebar\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Shield, AlertTriangle, CheckCircle, Users, DollarSign } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport default function Governance() {\n  const { agentConfig, updateProdMode } = useAgentConfig();\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n  const policies = [\n    {\n      id: 1,\n      name: \"Budget Alerts\",\n      description: \"Alert when spending exceeds 80% of budget\",\n      compliance: 95,\n      status: \"Active\",\n      violations: 2\n    },\n    {\n      id: 2,\n      name: \"Resource Tagging\",\n      description: \"All resources must have cost center and environment tags\",\n      compliance: 78,\n      status: \"Active\",\n      violations: 12\n    },\n    {\n      id: 3,\n      name: \"Instance Size Limits\",\n      description: \"Prevent provisioning of instances larger than 2xlarge without approval\",\n      compliance: 100,\n      status: \"Active\", \n      violations: 0\n    },\n    {\n      id: 4,\n      name: \"Dev Environment Shutdown\",\n      description: \"Development resources must be stopped outside business hours\",\n      compliance: 85,\n      status: \"Active\",\n      violations: 5\n    }\n  ];\n\n  const approvalRequests = [\n    {\n      id: 1,\n      type: \"Budget Increase\",\n      requestor: \"Engineering Team\",\n      amount: \"$2,500\",\n      reason: \"Q4 traffic spike preparation\",\n      status: \"Pending\"\n    },\n    {\n      id: 2,\n      type: \"Exception Request\",\n      requestor: \"DevOps Team\",\n      amount: \"$800\",\n      reason: \"Large instance for ML training\",\n      status: \"Pending\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <TopNav \n        lastSync=\"3 min ago\"\n        prodMode={agentConfig?.prodMode || false}\n        onProdModeChange={updateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n          <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n            <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Governance & Compliance</h1>\n          <p className=\"text-muted-foreground\">\n            Cost governance policies and approval workflows\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Active Policies</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">4</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Currently enforced\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Compliance Score</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">89%</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Overall compliance\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Policy Violations</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">19</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Needs attention\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Pending Approvals</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">2</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Awaiting review\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Governance Policies</CardTitle>\n                <Button>Create Policy</Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {policies.map((policy) => (\n                  <div key={policy.id} className=\"space-y-3 p-4 border rounded-lg\">\n                    <div className=\"flex items-center justify-between\">\n                      <h3 className=\"font-medium\">{policy.name}</h3>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant={policy.status === 'Active' ? 'default' : 'secondary'}>\n                          {policy.status}\n                        </Badge>\n                        {policy.violations > 0 && (\n                          <Badge variant=\"destructive\">{policy.violations} violations</Badge>\n                        )}\n                      </div>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">{policy.description}</p>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span>Compliance</span>\n                        <span>{policy.compliance}%</span>\n                      </div>\n                      <Progress value={policy.compliance} className=\"h-2\" />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Approval Requests</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {approvalRequests.map((request) => (\n                  <div key={request.id} className=\"p-4 border rounded-lg\">\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div>\n                        <h3 className=\"font-medium\">{request.type}</h3>\n                        <p className=\"text-sm text-muted-foreground\">by {request.requestor}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"flex items-center gap-1 font-medium\">\n                          <DollarSign className=\"w-4 h-4\" />\n                          {request.amount}\n                        </div>\n                        <Badge variant=\"outline\">{request.status}</Badge>\n                      </div>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground mb-3\">{request.reason}</p>\n                    <div className=\"flex gap-2\">\n                      <Button size=\"sm\" variant=\"default\">Approve</Button>\n                      <Button size=\"sm\" variant=\"outline\">Reject</Button>\n                      <Button size=\"sm\" variant=\"ghost\">Details</Button>\n                    </div>\n                  </div>\n                ))}\n                {approvalRequests.length === 0 && (\n                  <div className=\"text-center py-8\">\n                    <CheckCircle className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                    <p className=\"text-muted-foreground\">No pending approvals</p>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Recent Governance Activity</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-3 text-sm\">\n                <div className=\"w-2 h-2 bg-red-500 rounded-full\"></div>\n                <span className=\"text-muted-foreground\">1 hour ago</span>\n                <span>Policy violation: Untagged EC2 instance i-1234567890</span>\n                <Badge variant=\"destructive\" className=\"ml-auto\">High</Badge>\n              </div>\n              <div className=\"flex items-center gap-3 text-sm\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                <span className=\"text-muted-foreground\">3 hours ago</span>\n                <span>Approved budget increase for Engineering team</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">$2,500</Badge>\n              </div>\n              <div className=\"flex items-center gap-3 text-sm\">\n                <div className=\"w-2 h-2 bg-yellow-500 rounded-full\"></div>\n                <span className=\"text-muted-foreground\">5 hours ago</span>\n                <span>Budget alert: Marketing team at 85% of monthly budget</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">Warning</Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n            </div>\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}","size_bytes":9594},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/pages/dashboard.tsx":{"content":"import { Sidebar } from \"@/components/layout/sidebar\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport { AiModeIndicator } from \"@/components/ai-mode-indicator\";\nimport { RecommendationsPanel } from \"@/components/dashboard/recommendations-panel\";\nimport { ActivityFeed } from \"@/components/dashboard/activity-feed\";\nimport { ResourceMonitor } from \"@/components/dashboard/resource-monitor\";\nimport { ApprovalModal } from \"@/components/modals/approval-modal\";\nimport { DataFlowVisualization } from \"@/components/data-flow-viz\";\nimport { OptimizationMix } from \"@/components/dashboard/optimization-mix\";\nimport { useWebSocket } from \"@/hooks/use-websocket\";\nimport { useEffect, useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\n\nexport default function Dashboard() {\n  const { agentConfig, updateProdMode } = useAgentConfig();\n  const { lastMessage } = useWebSocket();\n  const { toast } = useToast();\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n\n  useEffect(() => {\n    if (lastMessage) {\n      // Handle real-time updates\n      switch (lastMessage.type) {\n        case 'new_recommendation':\n          toast({\n            title: \"New Optimization Opportunity\",\n            description: `${lastMessage.data.title} - Potential savings: $${Number(lastMessage.data.projectedMonthlySavings * 12).toLocaleString()}/year`,\n          });\n          queryClient.invalidateQueries({ queryKey: ['/api/recommendations'] });\n          break;\n        case 'optimization_executed':\n          toast({\n            title: lastMessage.data.status === 'success' ? \"Optimization Completed\" : \"Optimization Failed\",\n            description: lastMessage.data.status === 'success' ? \"Resource optimization executed successfully\" : lastMessage.data.error,\n            variant: lastMessage.data.status === 'success' ? \"default\" : \"destructive\",\n          });\n          queryClient.invalidateQueries({ queryKey: ['/api/optimization-history'] });\n          queryClient.invalidateQueries({ queryKey: ['/api/dashboard/metrics'] });\n          break;\n      }\n    }\n  }, [lastMessage, toast]);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <AiModeIndicator />\n      <TopNav \n        lastSync=\"Just now\"\n        prodMode={agentConfig?.prodMode || false}\n        onProdModeChange={updateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n        \n        <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n          {/* Data Flow Visualization with integrated metrics */}\n          <DataFlowVisualization />\n          \n          {/* Optimization Mix */}\n          <div className=\"mt-8\">\n            <OptimizationMix />\n          </div>\n          \n          {/* Recommendations Section - Responsive Layout */}\n          <div className=\"mt-8\">\n            <RecommendationsPanel />\n          </div>\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 lg:gap-8 mt-8\">\n            <ActivityFeed />\n            <ResourceMonitor />\n          </div>\n        </div>\n        </main>\n      </div>\n      \n      <ApprovalModal />\n    </div>\n  );\n}\n","size_bytes":3494},"finops/README.md":{"content":"# FinOps Phase 1 Prototype\n\nA lightweight AWS resource dashboard prototype with mock data, designed for DCL integration testing.\n\n## üéØ Overview\n\nThis is a standalone Phase 1 prototype that simulates a Supabase-style `aws_resources` table with mock JSON data. It provides a simple Express.js API and a dark-themed UI shell.\n\n## üöÄ Quick Start\n\n```bash\ncd finops\nnpm start\n```\n\nThe server will start on port 3001:\n- **Dashboard**: http://localhost:3001/dashboard.html\n- **API**: http://localhost:3001/api/resources\n\n## üìÅ Structure\n\n```\nfinops/\n‚îú‚îÄ‚îÄ index.js              # Express.js backend server\n‚îú‚îÄ‚îÄ dashboard.html        # Frontend UI shell\n‚îú‚îÄ‚îÄ aws_resources.json    # Mock AWS resource data\n‚îú‚îÄ‚îÄ package.json          # Node.js dependencies\n‚îî‚îÄ‚îÄ README.md            # This file\n```\n\n## üîå API Endpoints\n\n### GET /api/resources\nReturns all AWS resource data from the mock JSON file.\n\n**Response:**\n```json\n[\n  {\n    \"resourceId\": \"i-0a1b2c3d4e5f6g7h8\",\n    \"type\": \"EC2\",\n    \"region\": \"us-east-1\",\n    \"monthlyCost\": 245.50,\n    \"utilizationPercent\": 35,\n    \"instanceType\": \"t3.large\"\n  },\n  ...\n]\n```\n\n## üé® Design\n\n- **Background**: `#1B1E23` (Dark blue-black)\n- **Accent**: `#0BCAD9` (Cyan)\n- **Theme**: Dark mode, minimal, data-focused\n\n## üìä Features\n\n### Dashboard Display\n- Total resources count\n- Total monthly cost\n- Average utilization percentage\n- Number of unique regions\n\n### Resource Table\n- Resource ID\n- Type (EC2, RDS, S3, etc.)\n- Region\n- Monthly cost\n- Utilization percentage with visual bar\n\n## üîÑ Next Steps (Phase 2)\n\nThis prototype will be migrated to:\n- **Framework**: Next.js with `/app/dcl` structure\n- **Database**: Real Supabase table `aws_resources`\n- **API Routes**: Next.js API routes at `/api/resources`\n- **Enhanced Features**: Real-time updates, filtering, sorting\n\n## üìù Notes\n\n- Mock data includes 10 AWS resources across multiple types and regions\n- No authentication required (prototype only)\n- Static data (no database required)\n- Lightweight and fast for testing DCL integration patterns\n","size_bytes":2078},"finops/index.js":{"content":"import express from 'express';\nimport { fileURLToPath } from 'url';\nimport { dirname, join } from 'path';\nimport { readFileSync } from 'fs';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nconst app = express();\nconst PORT = 3001;\n\n// Enable JSON body parsing\napp.use(express.json());\n\n// In-memory storage for actions and feedback\nconst actionsLog = [];\nconst feedbackLog = [];\n\n// Load mock AWS resources data\nconst awsResourcesPath = join(__dirname, 'aws_resources.json');\nconst awsResources = JSON.parse(readFileSync(awsResourcesPath, 'utf-8'));\n\n// Generate mock historical spend data for last 6 months\nfunction generateHistoricalSpend() {\n  const months = ['May 2024', 'Jun 2024', 'Jul 2024', 'Aug 2024', 'Sep 2024', 'Oct 2024'];\n  const baseSpend = 3000;\n  return months.map((month, index) => ({\n    month,\n    spend: baseSpend + (Math.random() * 500) + (index * 100) // Slight upward trend\n  }));\n}\n\n// Calculate spend summary analytics\nfunction calculateSpendSummary() {\n  const historicalData = generateHistoricalSpend();\n  const currentMonthSpend = awsResources.reduce((sum, r) => sum + r.monthlyCost, 0);\n  \n  // Calculate YTD (Jan-Oct = 10 months)\n  const ytdSpend = historicalData.reduce((sum, d) => sum + d.spend, 0) + (currentMonthSpend * 4); // Add 4 months before May\n  \n  // Annual projection\n  const avgMonthlySpend = ytdSpend / 10; // 10 months so far\n  const annualProjection = avgMonthlySpend * 12;\n  \n  // Calculate average CPU and Memory utilization\n  const computeResources = awsResources.filter(r => ['EC2', 'RDS', 'ElastiCache'].includes(r.type));\n  const avgCpuUtilization = Math.round(\n    computeResources.reduce((sum, r) => sum + r.utilizationPercent, 0) / computeResources.length\n  );\n  const avgMemoryUtilization = Math.round(avgCpuUtilization * 0.85); // Simulate memory being slightly lower\n  \n  // Spend breakdown by resource type\n  const spendByType = {};\n  awsResources.forEach(resource => {\n    if (!spendByType[resource.type]) {\n      spendByType[resource.type] = 0;\n    }\n    spendByType[resource.type] += resource.monthlyCost;\n  });\n  \n  return {\n    monthlySpend: currentMonthSpend,\n    ytdSpend: Math.round(ytdSpend * 100) / 100,\n    annualProjection: Math.round(annualProjection * 100) / 100,\n    avgCpuUtilization,\n    avgMemoryUtilization,\n    spendByType,\n    historicalTrend: historicalData\n  };\n}\n\n// Mission 2: Generate optimization recommendations\nfunction generateRecommendations() {\n  const recommendations = [];\n  \n  awsResources.forEach(resource => {\n    const cpuUtil = resource.utilizationPercent;\n    const memUtil = cpuUtil * 0.85; // Simulate memory being slightly lower\n    \n    // Flag low CPU (<25%) or low Memory (<30%)\n    if (cpuUtil < 25 || memUtil < 30) {\n      const potentialSavings = Math.round(resource.monthlyCost * 0.20 * 100) / 100;\n      const confidence = 0.6 + (Math.random() * 0.3); // 0.6 - 0.9\n      \n      let reason = '';\n      if (cpuUtil < 25 && memUtil < 30) {\n        reason = `Low CPU (${cpuUtil}%) and Memory (${Math.round(memUtil)}%) utilization`;\n      } else if (cpuUtil < 25) {\n        reason = `Low CPU utilization (${cpuUtil}%)`;\n      } else {\n        reason = `Low Memory utilization (${Math.round(memUtil)}%)`;\n      }\n      \n      recommendations.push({\n        id: `rec-${resource.resourceId}`,\n        resourceId: resource.resourceId,\n        resourceType: resource.type,\n        region: resource.region,\n        recommendation: `Consider downsizing or removing this ${resource.type} resource`,\n        reason,\n        potentialSavings,\n        confidence: Math.round(confidence * 100) / 100,\n        currentCost: resource.monthlyCost\n      });\n    }\n  });\n  \n  return recommendations;\n}\n\n// Mission 4: Generate forecast with optional adoption rate\nfunction generateForecast(adoptionRate = 0) {\n  const historicalData = generateHistoricalSpend();\n  \n  // Calculate linear trend\n  const n = historicalData.length;\n  let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;\n  \n  historicalData.forEach((d, i) => {\n    sumX += i;\n    sumY += d.spend;\n    sumXY += i * d.spend;\n    sumX2 += i * i;\n  });\n  \n  const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);\n  const intercept = (sumY - slope * sumX) / n;\n  \n  // Project next 3 months\n  const forecast = [];\n  const nextMonths = ['Nov 2024', 'Dec 2024', 'Jan 2025'];\n  \n  const recommendations = generateRecommendations();\n  const totalPotentialSavings = recommendations.reduce((sum, r) => sum + r.potentialSavings, 0);\n  const savingsReduction = totalPotentialSavings * (adoptionRate / 100);\n  \n  nextMonths.forEach((month, i) => {\n    const x = n + i;\n    const projectedSpend = slope * x + intercept;\n    forecast.push({\n      month,\n      spend: Math.round((projectedSpend - savingsReduction) * 100) / 100\n    });\n  });\n  \n  return {\n    historical: historicalData,\n    forecast,\n    trend: { slope: Math.round(slope * 100) / 100, intercept: Math.round(intercept * 100) / 100 },\n    adoptionRate,\n    projectedSavings: Math.round(savingsReduction * 100) / 100\n  };\n}\n\n// Mission 5: Evaluate policy violations\nconst policies = [\n  { id: 'pol-1', name: 'Low CPU Utilization', threshold: 25, type: 'cpu', severity: 'medium' },\n  { id: 'pol-2', name: 'Very Low Utilization', threshold: 15, type: 'cpu', severity: 'high' },\n  { id: 'pol-3', name: 'Unoptimized EBS', threshold: 40, type: 'utilization', resourceType: 'EBS', severity: 'low' }\n];\n\nfunction evaluateViolations() {\n  const violations = [];\n  \n  awsResources.forEach(resource => {\n    policies.forEach(policy => {\n      let isViolation = false;\n      \n      if (policy.type === 'cpu' && resource.utilizationPercent < policy.threshold) {\n        isViolation = true;\n      } else if (policy.type === 'utilization' && policy.resourceType === resource.type && resource.utilizationPercent < policy.threshold) {\n        isViolation = true;\n      }\n      \n      if (isViolation) {\n        violations.push({\n          id: `viol-${resource.resourceId}-${policy.id}`,\n          policyId: policy.id,\n          policyName: policy.name,\n          resourceId: resource.resourceId,\n          resourceType: resource.type,\n          severity: policy.severity,\n          costImpact: Math.round(resource.monthlyCost * 0.1 * 100) / 100,\n          details: `${resource.type} ${resource.resourceId} has ${resource.utilizationPercent}% utilization (threshold: ${policy.threshold}%)`\n        });\n      }\n    });\n  });\n  \n  return violations;\n}\n\n// Mission 6: Generate aggregated report\nfunction generateReport() {\n  const summary = calculateSpendSummary();\n  const recommendations = generateRecommendations();\n  const actions = actionsLog.filter(a => a.actionType === 'apply');\n  \n  const totalSavingsIdentified = recommendations.reduce((sum, r) => sum + r.potentialSavings, 0);\n  const totalSavingsRealized = actions.reduce((sum, a) => {\n    const rec = recommendations.find(r => r.resourceId === a.resourceId);\n    return sum + (rec ? rec.potentialSavings : 0);\n  }, 0);\n  \n  const adoptionRate = recommendations.length > 0 \n    ? Math.round((actions.length / recommendations.length) * 100)\n    : 0;\n  \n  return {\n    reportDate: new Date().toISOString(),\n    totalSpend: summary.monthlySpend,\n    ytdSpend: summary.ytdSpend,\n    annualProjection: summary.annualProjection,\n    savingsIdentified: Math.round(totalSavingsIdentified * 100) / 100,\n    savingsRealized: Math.round(totalSavingsRealized * 100) / 100,\n    adoptionRate,\n    totalResources: awsResources.length,\n    recommendationsCount: recommendations.length,\n    actionsCount: actions.length\n  };\n}\n\n// Serve static HTML\napp.use(express.static(__dirname));\n\n// API endpoint to get all resources\napp.get('/api/resources', (req, res) => {\n  res.json(awsResources);\n});\n\n// API endpoint for spend summary\napp.get('/api/finops/spend-summary', (req, res) => {\n  const summary = calculateSpendSummary();\n  res.json(summary);\n});\n\n// Mission 2: API endpoint for recommendations\napp.get('/api/finops/recommendations', (req, res) => {\n  const recommendations = generateRecommendations();\n  \n  // Apply feedback adjustments to confidence scores\n  const adjustedRecs = recommendations.map(rec => {\n    const feedback = feedbackLog.filter(f => f.recommendationId === rec.id);\n    const positiveCount = feedback.filter(f => f.outcome === 1).length;\n    const negativeCount = feedback.filter(f => f.outcome === -1).length;\n    const totalFeedback = positiveCount + negativeCount;\n    \n    if (totalFeedback > 0) {\n      const feedbackScore = (positiveCount - negativeCount) / totalFeedback;\n      const adjustedConfidence = Math.max(0.1, Math.min(0.99, rec.confidence + (feedbackScore * 0.2)));\n      return { ...rec, confidence: Math.round(adjustedConfidence * 100) / 100 };\n    }\n    return rec;\n  });\n  \n  res.json(adjustedRecs);\n});\n\n// Mission 3: Action tracking endpoints\napp.post('/api/finops/actions', (req, res) => {\n  const { resourceId, actionType, result } = req.body;\n  \n  const action = {\n    id: `action-${Date.now()}`,\n    resourceId,\n    actionType,\n    result: result || 'pending',\n    timestamp: new Date().toISOString()\n  };\n  \n  actionsLog.push(action);\n  res.json({ success: true, action });\n});\n\napp.get('/api/finops/actions', (req, res) => {\n  res.json(actionsLog);\n});\n\n// Mission 4: Forecast endpoint\napp.get('/api/finops/forecast', (req, res) => {\n  const adoptionRate = parseInt(req.query.adoptionRate) || 0;\n  const forecast = generateForecast(adoptionRate);\n  res.json(forecast);\n});\n\n// Mission 5: Violations endpoint\napp.get('/api/finops/violations', (req, res) => {\n  const violations = evaluateViolations();\n  res.json(violations);\n});\n\n// Mission 6: Report and CSV export\napp.get('/api/finops/report', (req, res) => {\n  const format = req.query.format;\n  const report = generateReport();\n  \n  if (format === 'csv') {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const csvRows = [\n      ['Metric', 'Value'],\n      ['Report Date', report.reportDate],\n      ['Total Spend', `$${report.totalSpend}`],\n      ['YTD Spend', `$${report.ytdSpend}`],\n      ['Annual Projection', `$${report.annualProjection}`],\n      ['Savings Identified', `$${report.savingsIdentified}`],\n      ['Savings Realized', `$${report.savingsRealized}`],\n      ['Adoption Rate', `${report.adoptionRate}%`],\n      ['Total Resources', report.totalResources],\n      ['Recommendations Count', report.recommendationsCount],\n      ['Actions Count', report.actionsCount]\n    ];\n    \n    const csv = csvRows.map(row => row.join(',')).join('\\n');\n    \n    res.setHeader('Content-Type', 'text/csv');\n    res.setHeader('Content-Disposition', `attachment; filename=finops-report-${timestamp}.csv`);\n    res.send(csv);\n  } else {\n    res.json(report);\n  }\n});\n\n// Mission 7: Feedback endpoint\napp.post('/api/finops/feedback', (req, res) => {\n  const { recommendationId, outcome } = req.body;\n  \n  const feedback = {\n    id: `feedback-${Date.now()}`,\n    recommendationId,\n    outcome, // +1 or -1\n    timestamp: new Date().toISOString()\n  };\n  \n  feedbackLog.push(feedback);\n  res.json({ success: true, feedback });\n});\n\napp.get('/api/finops/feedback', (req, res) => {\n  const totalFeedback = feedbackLog.length;\n  const positiveFeedback = feedbackLog.filter(f => f.outcome === 1).length;\n  const positivePercentage = totalFeedback > 0 \n    ? Math.round((positiveFeedback / totalFeedback) * 100)\n    : 0;\n  \n  res.json({\n    total: totalFeedback,\n    positive: positiveFeedback,\n    negative: totalFeedback - positiveFeedback,\n    positivePercentage\n  });\n});\n\n// Root redirect to dashboard\napp.get('/', (req, res) => {\n  res.sendFile(join(__dirname, 'dashboard.html'));\n});\n\napp.listen(PORT, '0.0.0.0', () => {\n  console.log(`\\n‚úÖ FinOps Phase 1 Prototype running on http://0.0.0.0:${PORT}`);\n  console.log(`üìä Dashboard: http://0.0.0.0:${PORT}/dashboard.html`);\n  console.log(`\\nüîå API Endpoints:`);\n  console.log(`   - GET  /api/resources - All AWS resources`);\n  console.log(`   - GET  /api/finops/spend-summary - Spend analytics & trends`);\n  console.log(`   - GET  /api/finops/recommendations - Optimization recommendations`);\n  console.log(`   - POST /api/finops/actions - Record actions`);\n  console.log(`   - GET  /api/finops/actions - Action history`);\n  console.log(`   - GET  /api/finops/forecast?adoptionRate=X - Spend forecast`);\n  console.log(`   - GET  /api/finops/violations - Policy violations`);\n  console.log(`   - GET  /api/finops/report?format=csv - Export CSV report`);\n  console.log(`   - POST /api/finops/feedback - Submit feedback`);\n  console.log(`   - GET  /api/finops/feedback - Feedback statistics`);\n  \n  const recommendations = generateRecommendations();\n  const violations = evaluateViolations();\n  const avgSavings = recommendations.length > 0 \n    ? Math.round(recommendations.reduce((sum, r) => sum + r.potentialSavings, 0) / recommendations.length)\n    : 0;\n  \n  console.log(`\\nüìà Analytics Summary:`);\n  console.log(`   - ${recommendations.length} optimization opportunities identified`);\n  console.log(`   - $${avgSavings} avg potential savings per recommendation`);\n  console.log(`   - ${violations.length} policy violations detected`);\n  console.log(`   - 0 actions logged (in-memory storage)`);\n});\n","size_bytes":13253},"client/src/pages/executive-dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Sidebar } from \"@/components/layout/sidebar\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport { AiModeIndicator } from \"@/components/ai-mode-indicator\";\nimport { AiModeHistory } from \"@/components/ai-mode-history\";\nimport { OptimizationMix } from \"@/components/dashboard/optimization-mix\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { formatCurrencyCompact as formatCurrency } from \"@/lib/currency\";\nimport {\n  LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, \n  Tooltip, Legend, ResponsiveContainer, AreaChart, Area\n} from \"recharts\";\nimport { \n  TrendingUp, TrendingDown, DollarSign, Zap, Database, Network, \n  HardDrive, Cpu, AlertTriangle, CheckCircle, Clock, Target\n} from \"lucide-react\";\n\ntype Timeframe = \"month\" | \"quarter\" | \"ytd\" | \"annual\";\ntype Environment = \"prod\" | \"stage\" | \"synthetic\";\n\nexport default function ExecutiveDashboard() {\n  const [timeframe, setTimeframe] = useState<Timeframe>(\"month\");\n  const [environment, setEnvironment] = useState<Environment>(\"synthetic\");\n  const [selectedRegion, setSelectedRegion] = useState<string>(\"all\");\n  const [optimizationAdoption, setOptimizationAdoption] = useState([60]);\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n\n  const { agentConfig, updateProdMode } = useAgentConfig();\n  const { data: resources = [], error: resourcesError } = useQuery<any[]>({ \n    queryKey: [\"/api/aws-resources\"],\n    retry: false \n  });\n  const { data: recommendations = [], error: recommendationsError } = useQuery<any[]>({ \n    queryKey: [\"/api/recommendations\"],\n    retry: false \n  });\n  const { data: optimizationHistory = [], error: optimizationHistoryError } = useQuery<any[]>({ \n    queryKey: [\"/api/optimization-history\"],\n    retry: false \n  });\n  \n  // Use the new metrics summary endpoint with 3s refresh for real-time feel\n  const { data: metricsSummary, error: metricsSummaryError } = useQuery<any>({ \n    queryKey: [\"/api/metrics/summary\"],\n    refetchInterval: 3000,\n    retry: false \n  });\n\n  // Calculate metrics\n  const monthlySpend = metricsSummary?.monthlySpend || 0;\n  const ytdSpend = metricsSummary?.ytdSpend || 0;\n  const autonomousSavings = metricsSummary?.autonomousSavingsPending || 0;\n  const hitlSavings = metricsSummary?.hitlSavingsAwaiting || 0;\n  const realizedSavings = metricsSummary?.realizedSavingsYTD || 0;\n  const wastePercent = metricsSummary?.wastePercentOptimizedYTD || 0;\n  const monthlySpendChange = metricsSummary?.monthlySpendChange || 0;\n  const ytdSpendChange = metricsSummary?.ytdSpendChange || 0;\n\n  const roi = monthlySpend > 0 \n    ? ((realizedSavings / monthlySpend) * 100).toFixed(2) \n    : \"0\";\n\n  // Spend breakdown by category\n  const spendBreakdown = [\n    { name: \"Compute\", value: Math.floor(monthlySpend * 0.40), icon: Cpu, color: \"#0BCAD9\" },\n    { name: \"Storage\", value: Math.floor(monthlySpend * 0.25), icon: HardDrive, color: \"#08A0AE\" },\n    { name: \"Database\", value: Math.floor(monthlySpend * 0.20), icon: Database, color: \"#067682\" },\n    { name: \"Network\", value: Math.floor(monthlySpend * 0.10), icon: Network, color: \"#044C56\" },\n    { name: \"Other\", value: Math.floor(monthlySpend * 0.05), icon: Zap, color: \"#02222A\" },\n  ];\n\n  // Monthly trend data (simulated)\n  const monthlyTrend = [\n    { month: \"Jan\", spend: monthlySpend * 0.85, savings: realizedSavings * 0.70 },\n    { month: \"Feb\", spend: monthlySpend * 0.88, savings: realizedSavings * 0.75 },\n    { month: \"Mar\", spend: monthlySpend * 0.92, savings: realizedSavings * 0.80 },\n    { month: \"Apr\", spend: monthlySpend * 0.95, savings: realizedSavings * 0.85 },\n    { month: \"May\", spend: monthlySpend * 0.98, savings: realizedSavings * 0.90 },\n    { month: \"Jun\", spend: monthlySpend, savings: realizedSavings },\n  ];\n\n  // Utilization distribution\n  const utilizationDist = [\n    { range: \"0-20%\", count: resources.filter((r: any) => (r.utilizationMetrics?.cpuUtilization || 0) < 20).length },\n    { range: \"20-40%\", count: resources.filter((r: any) => (r.utilizationMetrics?.cpuUtilization || 0) >= 20 && (r.utilizationMetrics?.cpuUtilization || 0) < 40).length },\n    { range: \"40-60%\", count: resources.filter((r: any) => (r.utilizationMetrics?.cpuUtilization || 0) >= 40 && (r.utilizationMetrics?.cpuUtilization || 0) < 60).length },\n    { range: \"60-80%\", count: resources.filter((r: any) => (r.utilizationMetrics?.cpuUtilization || 0) >= 60 && (r.utilizationMetrics?.cpuUtilization || 0) < 80).length },\n    { range: \"80-100%\", count: resources.filter((r: any) => (r.utilizationMetrics?.cpuUtilization || 0) >= 80).length },\n  ];\n\n\n  const avgUtilization = resources.length > 0\n    ? resources.reduce((sum: number, r: any) => sum + (r.utilizationMetrics?.cpuUtilization || 0), 0) / resources.length\n    : 0;\n\n  const underutilizedResources = resources.filter((r: any) => (r.utilizationMetrics?.cpuUtilization || 0) < 30);\n\n  const error = resourcesError || recommendationsError || optimizationHistoryError || metricsSummaryError;\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex flex-col bg-background\">\n        <AiModeIndicator />\n        <TopNav \n          lastSync=\"Error\"\n          prodMode={agentConfig?.prodMode || false}\n          onProdModeChange={updateProdMode}\n          onMenuClick={() => setIsMobileSidebarOpen(true)}\n        />\n        <div className=\"flex-1 flex pt-[60px]\">\n          <Sidebar \n            isMobileOpen={isMobileSidebarOpen}\n            onClose={() => setIsMobileSidebarOpen(false)}\n          />\n          <main className=\"flex-1 overflow-hidden w-full\">\n            <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n              <Alert variant=\"destructive\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertTitle>Error Loading Data</AlertTitle>\n                <AlertDescription>\n                  {error instanceof Error ? error.message : 'Failed to load executive dashboard data. Please try again.'}\n                </AlertDescription>\n              </Alert>\n            </div>\n          </main>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <AiModeIndicator />\n      <TopNav \n        lastSync=\"2 min ago\"\n        prodMode={agentConfig?.prodMode || false}\n        onProdModeChange={updateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n          <div className=\"h-full overflow-y-auto bg-[#0A0E13] text-white p-4 sm:p-6\" data-testid=\"executive-dashboard\">\n            <div className=\"mb-6\">\n              <h1 className=\"text-3xl font-bold tracking-tight\">Executive Dashboard</h1>\n              <p className=\"text-gray-400 mt-1\">\n                Summary of AWS Financial Operations Agentic Actions\n              </p>\n            </div>\n\n      <Tabs defaultValue=\"overview\" className=\"space-y-6\">\n        <TabsList className=\"bg-[#1B1E23] border-[#0BCAD9]/20\">\n          <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"trends\" data-testid=\"tab-trends\">Cost Trends</TabsTrigger>\n          <TabsTrigger value=\"optimization\" data-testid=\"tab-optimization\">Optimization</TabsTrigger>\n          <TabsTrigger value=\"governance\" data-testid=\"tab-governance\">Governance</TabsTrigger>\n        </TabsList>\n\n        {/* OVERVIEW TAB */}\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          {/* Executive Summary - Financial Overview */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-monthly-spend\">\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-gray-400\">Monthly AWS Spend</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col justify-center\">\n                  <div className=\"text-2xl font-bold text-[#0BCAD9] mb-2\" data-testid=\"monthly-spend-value\">{formatCurrency(monthlySpend)}</div>\n                  <div className={`text-xs flex items-center gap-1 ${monthlySpendChange > 0 ? 'text-red-500' : 'text-green-500'}`}>\n                    {monthlySpendChange > 0 ? <TrendingUp className=\"w-3 h-3\" /> : <TrendingDown className=\"w-3 h-3\" />}\n                    <span>{Math.abs(monthlySpendChange).toFixed(1)}% vs last month</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-ytd-spend\">\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-gray-400\">YTD AWS Spend</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col justify-center\">\n                  <div className=\"text-2xl font-bold text-[#0BCAD9] mb-2\" data-testid=\"ytd-spend-value\">{formatCurrency(ytdSpend)}</div>\n                  <div className={`text-xs flex items-center gap-1 ${ytdSpendChange > 0 ? 'text-red-500' : 'text-green-500'}`}>\n                    {ytdSpendChange > 0 ? <TrendingUp className=\"w-3 h-3\" /> : <TrendingDown className=\"w-3 h-3\" />}\n                    <span>{Math.abs(ytdSpendChange).toFixed(1)}% vs prior-year YTD</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-emerald-500/20\" data-testid=\"card-autonomous-savings\">\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-gray-400\">Autonomous Savings</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col justify-center\">\n                  <div className=\"text-2xl font-bold text-emerald-500 mb-2\" data-testid=\"autonomous-savings-value\">{formatCurrency(autonomousSavings)}</div>\n                  <div className=\"text-xs text-emerald-400\">\n                    Auto-execute pending\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-amber-500/20\" data-testid=\"card-hitl-savings\">\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-gray-400\">Awaiting HITL</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col justify-center\">\n                  <div className=\"text-2xl font-bold text-amber-500 mb-2\" data-testid=\"hitl-savings-value\">{formatCurrency(hitlSavings)}</div>\n                  <div className=\"text-xs text-amber-400\">\n                    Needs approval\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-realized-savings\">\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-gray-400\">Realized Savings YTD</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col justify-center\">\n                  <div className=\"text-2xl font-bold text-[#0BCAD9] mb-2\" data-testid=\"realized-savings-value\">{formatCurrency(realizedSavings)}</div>\n                  <div className=\"text-xs text-gray-400\">\n                    {optimizationHistory.filter((h: any) => h.status === 'success').length} executed\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-waste-percentage\">\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-gray-400\">Waste % Optimized YTD</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col justify-center\">\n                  <div className=\"text-2xl font-bold text-orange-500 mb-2\" data-testid=\"waste-percentage-value\">{(wastePercent || 0).toFixed(1)}%</div>\n                  <div className=\"text-xs text-gray-400\">\n                    YTD Performance\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Optimization Mix */}\n          <OptimizationMix />\n\n          {/* AWS Spend Breakdown */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6\">\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-spend-breakdown\">\n              <CardHeader>\n                <CardTitle className=\"text-[#0BCAD9]\">AWS Spend Breakdown</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <PieChart>\n                    <Pie\n                      data={spendBreakdown}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      labelLine={false}\n                      label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                      outerRadius={80}\n                      fill=\"#8884d8\"\n                      dataKey=\"value\"\n                    >\n                      {spendBreakdown.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={entry.color} />\n                      ))}\n                    </Pie>\n                    <Tooltip \n                      formatter={(value: any) => formatCurrency(value)}\n                      contentStyle={{ backgroundColor: '#1B1E23', border: '1px solid #0BCAD9' }}\n                    />\n                  </PieChart>\n                </ResponsiveContainer>\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-4 min-w-0\">\n                  {spendBreakdown.map((item) => (\n                    <div key={item.name} className=\"flex items-center gap-2 text-sm\">\n                      <div className=\"w-3 h-3 rounded-sm\" style={{ backgroundColor: item.color }} />\n                      <span className=\"text-gray-400\">{item.name}:</span>\n                      <span className=\"text-white font-semibold\">{formatCurrency(item.value)}</span>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-utilization-dist\">\n              <CardHeader>\n                <CardTitle className=\"text-[#0BCAD9]\">Utilization Distribution</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <BarChart data={utilizationDist}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" />\n                    <XAxis dataKey=\"range\" stroke=\"#888\" />\n                    <YAxis stroke=\"#888\" />\n                    <Tooltip \n                      contentStyle={{ backgroundColor: '#1B1E23', border: '1px solid #0BCAD9' }}\n                    />\n                    <Bar dataKey=\"count\" fill=\"#0BCAD9\" />\n                  </BarChart>\n                </ResponsiveContainer>\n                <div className=\"mt-4 text-sm text-gray-400\">\n                  <p>Average CPU Utilization: <span className=\"text-[#0BCAD9] font-semibold\">{avgUtilization.toFixed(1)}%</span></p>\n                  <p>Underutilized Resources (&lt;30%): <span className=\"text-orange-500 font-semibold\">{underutilizedResources.length}</span></p>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* AI Mode History */}\n          <AiModeHistory />\n        </TabsContent>\n\n        {/* COST TRENDS TAB */}\n        <TabsContent value=\"trends\" className=\"space-y-6\">\n          <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-monthly-trend\">\n            <CardHeader>\n              <CardTitle className=\"text-[#0BCAD9]\">Monthly Spend & Savings Trend</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={400}>\n                <LineChart data={monthlyTrend}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" />\n                  <XAxis dataKey=\"month\" stroke=\"#888\" />\n                  <YAxis stroke=\"#888\" tickFormatter={(value) => formatCurrency(value)} />\n                  <Tooltip \n                    formatter={(value: any) => formatCurrency(value)}\n                    contentStyle={{ backgroundColor: '#1B1E23', border: '1px solid #0BCAD9' }}\n                  />\n                  <Legend />\n                  <Line type=\"monotone\" dataKey=\"spend\" stroke=\"#0BCAD9\" strokeWidth={2} name=\"Monthly Spend\" />\n                  <Line type=\"monotone\" dataKey=\"savings\" stroke=\"#10B981\" strokeWidth={2} name=\"Realized Savings\" />\n                </LineChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* OPTIMIZATION TAB */}\n        <TabsContent value=\"optimization\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6\">\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-top-recommendations\">\n              <CardHeader>\n                <CardTitle className=\"text-[#0BCAD9]\">Top Optimization Opportunities</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {recommendations.slice(0, 5).map((rec: any) => (\n                    <div key={rec.id} className=\"flex items-center justify-between p-3 bg-[#0A0E13] rounded-lg\" data-testid={`recommendation-${rec.id}`}>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium text-white\">{rec.title}</p>\n                        <p className=\"text-xs text-gray-400 mt-1\">{rec.type}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-bold text-green-500\">{formatCurrency(rec.projectedMonthlySavings)}/mo</p>\n                        <p className=\"text-xs text-gray-400\">{rec.priority} priority</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-forecast-simulation\">\n              <CardHeader>\n                <CardTitle className=\"text-[#0BCAD9]\">Forecast & Simulation</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"text-sm text-gray-400 mb-2 block\">\n                      Optimization Adoption Rate: {optimizationAdoption[0]}%\n                    </label>\n                    <Slider\n                      value={optimizationAdoption}\n                      onValueChange={setOptimizationAdoption}\n                      max={100}\n                      step={10}\n                      className=\"mb-4\"\n                      data-testid=\"slider-adoption-rate\"\n                    />\n                  </div>\n                  \n                  <div className=\"p-4 bg-[#0A0E13] rounded-lg space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-400\">Current Annual Spend:</span>\n                      <span className=\"text-white font-semibold\">{formatCurrency(monthlySpend * 12)}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-400\">Projected Annual Savings:</span>\n                      <span className=\"text-green-500 font-semibold\">\n                        {formatCurrency(((autonomousSavings + hitlSavings) * 12 * optimizationAdoption[0]) / 100)}\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-400\">Optimized Annual Spend:</span>\n                      <span className=\"text-[#0BCAD9] font-semibold\">\n                        {formatCurrency(monthlySpend * 12 - ((autonomousSavings + hitlSavings) * 12 * optimizationAdoption[0]) / 100)}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* GOVERNANCE TAB */}\n        <TabsContent value=\"governance\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-policy-status\">\n              <CardHeader>\n                <CardTitle className=\"text-[#0BCAD9]\">Policy Compliance</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-400\">Tagged Resources</span>\n                    <span className=\"text-green-500 font-semibold\">95%</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-400\">Cost Threshold Alerts</span>\n                    <span className=\"text-orange-500 font-semibold\">3 active</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-400\">Compliance Score</span>\n                    <span className=\"text-[#0BCAD9] font-semibold\">87/100</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-approval-queue\">\n              <CardHeader>\n                <CardTitle className=\"text-[#0BCAD9]\">Approval Queue</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"p-3 bg-[#0A0E13] rounded-lg\">\n                    <p className=\"text-sm font-medium text-white\">Pending Reviews</p>\n                    <p className=\"text-2xl font-bold text-orange-500 mt-1\">\n                      {recommendations.filter((r: any) => r.status === 'pending').length}\n                    </p>\n                  </div>\n                  <div className=\"p-3 bg-[#0A0E13] rounded-lg\">\n                    <p className=\"text-sm font-medium text-white\">Approved This Month</p>\n                    <p className=\"text-2xl font-bold text-green-500 mt-1\">\n                      {recommendations.filter((r: any) => r.status === 'approved').length}\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-[#1B1E23] border-[#0BCAD9]/20\" data-testid=\"card-agent-activity\">\n              <CardHeader>\n                <CardTitle className=\"text-[#0BCAD9]\">Agent Activity</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {optimizationHistory.slice(0, 3).map((item: any) => (\n                    <div key={item.id} className=\"flex items-start gap-2 text-sm\" data-testid={`activity-${item.id}`}>\n                      <Clock className=\"w-4 h-4 text-[#0BCAD9] mt-0.5\" />\n                      <div className=\"flex-1\">\n                        <p className=\"text-white\">{item.recommendationType || 'Optimization'}</p>\n                        <p className=\"text-xs text-gray-400\">\n                          {new Date(item.executionDate).toLocaleString()}\n                        </p>\n                      </div>\n                      <span className={`text-xs px-2 py-1 rounded ${\n                        item.status === 'success' ? 'bg-green-500/20 text-green-500' : 'bg-red-500/20 text-red-500'\n                      }`}>\n                        {item.status}\n                      </span>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}\n","size_bytes":25296},"server/services/synthetic-data.ts":{"content":"import { storage } from '../storage';\nimport { InsertAwsResource } from '@shared/schema';\n\ninterface SyntheticResourcePattern {\n  baseUtilization: number;\n  variability: number; // How much it can vary\n  trend: 'increasing' | 'decreasing' | 'stable' | 'cyclic';\n  cyclePeriod?: number; // Days for cyclic patterns\n}\n\nexport class SyntheticDataGenerator {\n  private resourcePatterns = new Map<string, SyntheticResourcePattern>();\n  private startTime = Date.now();\n\n  // Generate initial synthetic dataset\n  async generateInitialDataset() {\n    console.log('üìä Generating initial synthetic dataset...');\n\n    const syntheticResources: InsertAwsResource[] = [\n      // Redshift clusters with different patterns\n      {\n        tenantId: 'default-tenant',\n        resourceId: 'redshift-prod-analytics',\n        resourceType: 'Redshift',\n        region: 'us-east-1',\n        currentConfig: {\n          nodeType: 'dc2.8xlarge',\n          numberOfNodes: 4,\n          clusterIdentifier: 'redshift-prod-analytics'\n        },\n        utilizationMetrics: {\n          cpuUtilization: 35,\n          diskUtilization: 45,\n          queryCount: 15000\n        },\n        monthlyCost: 960000, // $960,000/month (enterprise scale)\n        lastAnalyzed: new Date()\n      },\n      {\n        tenantId: 'default-tenant',\n        resourceId: 'redshift-dev-testing',\n        resourceType: 'Redshift',\n        region: 'us-west-2',\n        currentConfig: {\n          nodeType: 'dc2.large',\n          numberOfNodes: 2,\n          clusterIdentifier: 'redshift-dev-testing'\n        },\n        utilizationMetrics: {\n          cpuUtilization: 18,\n          diskUtilization: 30,\n          queryCount: 2000\n        },\n        monthlyCost: 72000, // $72,000/month (enterprise scale)\n        lastAnalyzed: new Date()\n      },\n      {\n        tenantId: 'default-tenant',\n        resourceId: 'redshift-data-warehouse',\n        resourceType: 'Redshift',\n        region: 'eu-west-1',\n        currentConfig: {\n          nodeType: 'ra3.4xlarge',\n          numberOfNodes: 6,\n          clusterIdentifier: 'redshift-data-warehouse'\n        },\n        utilizationMetrics: {\n          cpuUtilization: 72,\n          diskUtilization: 65,\n          queryCount: 48000\n        },\n        monthlyCost: 2160000, // $2,160,000/month (enterprise scale)\n        lastAnalyzed: new Date()\n      },\n      // EC2 instances\n      {\n        tenantId: 'default-tenant',\n        resourceId: 'i-0a1b2c3d4e5f6g7h8',\n        resourceType: 'EC2',\n        region: 'us-east-1',\n        currentConfig: {\n          instanceType: 't3.xlarge',\n          state: 'running'\n        },\n        utilizationMetrics: {\n          cpuUtilization: 22,\n          networkIn: 1024000,\n          networkOut: 512000\n        },\n        monthlyCost: 12100, // $12,100/month (enterprise scale)\n        lastAnalyzed: new Date()\n      },\n      {\n        tenantId: 'default-tenant',\n        resourceId: 'i-9h8g7f6e5d4c3b2a1',\n        resourceType: 'EC2',\n        region: 'us-west-2',\n        currentConfig: {\n          instanceType: 'm5.2xlarge',\n          state: 'running'\n        },\n        utilizationMetrics: {\n          cpuUtilization: 15,\n          networkIn: 512000,\n          networkOut: 256000\n        },\n        monthlyCost: 28000, // $28,000/month (enterprise scale)\n        lastAnalyzed: new Date()\n      },\n      // RDS instances\n      {\n        tenantId: 'default-tenant',\n        resourceId: 'rds-prod-mysql',\n        resourceType: 'RDS',\n        region: 'us-east-1',\n        currentConfig: {\n          instanceClass: 'db.r5.2xlarge',\n          engine: 'mysql',\n          allocatedStorage: 1000\n        },\n        utilizationMetrics: {\n          cpuUtilization: 38,\n          connectionCount: 145,\n          readIOPS: 8500,\n          writeIOPS: 3200\n        },\n        monthlyCost: 87600, // $87,600/month (enterprise scale)\n        lastAnalyzed: new Date()\n      }\n    ];\n\n    // Define behavior patterns for each resource\n    this.resourcePatterns.set('redshift-prod-analytics', {\n      baseUtilization: 35,\n      variability: 15,\n      trend: 'stable',\n    });\n\n    this.resourcePatterns.set('redshift-dev-testing', {\n      baseUtilization: 18,\n      variability: 8,\n      trend: 'cyclic',\n      cyclePeriod: 7 // Weekly cycle\n    });\n\n    this.resourcePatterns.set('redshift-data-warehouse', {\n      baseUtilization: 72,\n      variability: 10,\n      trend: 'increasing',\n    });\n\n    this.resourcePatterns.set('i-0a1b2c3d4e5f6g7h8', {\n      baseUtilization: 22,\n      variability: 12,\n      trend: 'decreasing',\n    });\n\n    this.resourcePatterns.set('i-9h8g7f6e5d4c3b2a1', {\n      baseUtilization: 15,\n      variability: 10,\n      trend: 'stable',\n    });\n\n    this.resourcePatterns.set('rds-prod-mysql', {\n      baseUtilization: 38,\n      variability: 18,\n      trend: 'cyclic',\n      cyclePeriod: 1 // Daily cycle\n    });\n\n    // Store all resources (create new or update existing)\n    for (const resource of syntheticResources) {\n      try {\n        await storage.createAwsResource(resource, 'default-tenant');\n      } catch (error) {\n        // Resource already exists, update it with enterprise-scale costs\n        console.log(`Updating existing resource: ${resource.resourceId}`);\n        await storage.updateAwsResource(resource.resourceId, {\n          monthlyCost: resource.monthlyCost,\n          utilizationMetrics: resource.utilizationMetrics,\n          currentConfig: resource.currentConfig,\n          lastAnalyzed: new Date()\n        }, 'default-tenant');\n      }\n    }\n\n    console.log(`‚úÖ Generated ${syntheticResources.length} synthetic resources`);\n  }\n\n  // Evolve resource data based on time and patterns\n  async evolveResources() {\n    console.log('üîÑ Evolving synthetic resource data...');\n\n    const resources = await storage.getAllAwsResources('default-tenant');\n    const elapsedMinutes = (Date.now() - this.startTime) / (1000 * 60);\n    const elapsedDays = elapsedMinutes / (60 * 24);\n\n    for (const resource of resources) {\n      const pattern = this.resourcePatterns.get(resource.resourceId);\n      if (!pattern) continue;\n\n      const currentMetrics = resource.utilizationMetrics as any;\n      let newUtilization = pattern.baseUtilization;\n\n      // Apply trend and time-based evolution\n      switch (pattern.trend) {\n        case 'increasing':\n          newUtilization += (elapsedDays * 2); // Gradual increase\n          break;\n        case 'decreasing':\n          newUtilization -= (elapsedDays * 1.5); // Gradual decrease\n          break;\n        case 'cyclic':\n          if (pattern.cyclePeriod) {\n            const cyclePosition = (elapsedDays % pattern.cyclePeriod) / pattern.cyclePeriod;\n            const cycleOffset = Math.sin(cyclePosition * 2 * Math.PI) * (pattern.variability / 2);\n            newUtilization += cycleOffset;\n          }\n          break;\n        case 'stable':\n          // Just add some random noise\n          break;\n      }\n\n      // Add random variability\n      const randomVariation = (Math.random() - 0.5) * pattern.variability;\n      newUtilization += randomVariation;\n\n      // Clamp between 5 and 95\n      newUtilization = Math.max(5, Math.min(95, newUtilization));\n\n      // Update resource metrics\n      const updatedMetrics = {\n        ...currentMetrics,\n        cpuUtilization: Math.round(newUtilization),\n      };\n\n      // Cost can vary slightly based on usage\n      const costVariation = 1 + (Math.random() - 0.5) * 0.1; // ¬±5% variation\n      const updatedCost = Math.round((resource.monthlyCost || 0) * costVariation);\n\n      // Update the resource\n      await storage.updateAwsResource(resource.id, {\n        utilizationMetrics: updatedMetrics,\n        monthlyCost: updatedCost,\n        lastAnalyzed: new Date()\n      }, 'default-tenant');\n\n      console.log(`  Updated ${resource.resourceId}: ${currentMetrics.cpuUtilization}% ‚Üí ${Math.round(newUtilization)}%`);\n    }\n\n    console.log('‚úÖ Resource evolution complete');\n  }\n\n  // Add a new resource to simulate environment growth\n  async addNewResource() {\n    const newResourceTemplates: InsertAwsResource[] = [\n      {\n        tenantId: 'default-tenant',\n        resourceId: `redshift-new-${Date.now()}`,\n        resourceType: 'Redshift',\n        region: 'us-east-1',\n        currentConfig: {\n          nodeType: 'dc2.large',\n          numberOfNodes: 2,\n          clusterIdentifier: `redshift-new-${Date.now()}`\n        },\n        utilizationMetrics: {\n          cpuUtilization: Math.round(10 + Math.random() * 30),\n          diskUtilization: Math.round(20 + Math.random() * 40),\n          queryCount: Math.round(1000 + Math.random() * 5000)\n        },\n        monthlyCost: Math.round(500000 + Math.random() * 500000),\n        lastAnalyzed: new Date()\n      },\n      {\n        tenantId: 'default-tenant',\n        resourceId: `i-${Math.random().toString(36).substring(2, 15)}`,\n        resourceType: 'EC2',\n        region: 'us-west-2',\n        currentConfig: {\n          instanceType: 't3.medium',\n          state: 'running'\n        },\n        utilizationMetrics: {\n          cpuUtilization: Math.round(10 + Math.random() * 25),\n          networkIn: Math.round(100000 + Math.random() * 500000),\n          networkOut: Math.round(50000 + Math.random() * 250000)\n        },\n        monthlyCost: Math.round(30000 + Math.random() * 50000),\n        lastAnalyzed: new Date()\n      }\n    ];\n\n    const randomResource = newResourceTemplates[Math.floor(Math.random() * newResourceTemplates.length)];\n    \n    await storage.createAwsResource(randomResource, 'default-tenant');\n    \n    // Add pattern for new resource\n    this.resourcePatterns.set(randomResource.resourceId, {\n      baseUtilization: (randomResource.utilizationMetrics as any).cpuUtilization,\n      variability: 12,\n      trend: 'stable',\n    });\n\n    console.log(`‚úÖ Added new synthetic resource: ${randomResource.resourceId}`);\n  }\n\n  // Mark resources as terminated (update status instead of deleting)\n  async markTerminatedResources() {\n    const resources = await storage.getAllAwsResources('default-tenant');\n    \n    // Mark resources with very low utilization as terminated\n    for (const resource of resources) {\n      const metrics = resource.utilizationMetrics as any;\n      const hoursSinceAnalysis = (Date.now() - new Date(resource.lastAnalyzed).getTime()) / (1000 * 60 * 60);\n      \n      if (metrics?.cpuUtilization < 8 && hoursSinceAnalysis > 24) {\n        // Update resource to show terminated state\n        await storage.updateAwsResource(resource.resourceId, {\n          currentConfig: {\n            ...(resource.currentConfig as any),\n            state: 'terminated'\n          }\n        }, 'default-tenant');\n        this.resourcePatterns.delete(resource.resourceId);\n        console.log(`‚úÖ Marked resource as terminated: ${resource.resourceId}`);\n        break; // Only mark one at a time\n      }\n    }\n  }\n}\n\nexport const syntheticDataGenerator = new SyntheticDataGenerator();\n","size_bytes":10916},"client/src/components/layout/navbar.tsx":{"content":"import { Link } from \"wouter\";\nimport logoImage from \"@assets/image_1760627197455.png\";\n\nexport function Navbar() {\n  return (\n    <nav className=\"bg-[hsl(220,25%,8%)] border-b border-cyan-500/20 px-6 py-3\">\n      <div className=\"flex items-center\">\n        <Link href=\"/\" className=\"flex items-center hover:opacity-80 transition-opacity\" data-testid=\"navbar-logo-link\">\n          <img \n            src={logoImage} \n            alt=\"autonomOS\" \n            className=\"h-8\"\n          />\n        </Link>\n      </div>\n    </nav>\n  );\n}\n","size_bytes":533},"server/services/pinecone.ts":{"content":"import { Pinecone } from '@pinecone-database/pinecone';\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\n\nexport interface VectorMetadata {\n  id: string;\n  type: 'recommendation' | 'optimization_history';\n  content: string;\n  status?: string;\n  savings?: number;\n  timestamp: string;\n}\n\nexport class PineconeService {\n  private pinecone: Pinecone;\n  private indexName: string = 'autonomos-finops-rag';\n  private genAI: GoogleGenerativeAI;\n  private embeddingModel: any;\n  \n  constructor() {\n    const apiKey = process.env.PINECONE_API_KEY;\n    if (!apiKey) {\n      throw new Error(\"PINECONE_API_KEY is not configured\");\n    }\n    \n    this.pinecone = new Pinecone({ apiKey });\n    \n    const geminiKey = process.env.GEMINI_API_KEY;\n    if (!geminiKey) {\n      throw new Error(\"GEMINI_API_KEY is not configured for embeddings\");\n    }\n    \n    this.genAI = new GoogleGenerativeAI(geminiKey);\n    this.embeddingModel = this.genAI.getGenerativeModel({ model: \"text-embedding-004\" });\n  }\n\n  async ensureIndex(): Promise<void> {\n    try {\n      const indexes = await this.pinecone.listIndexes();\n      const indexExists = indexes.indexes?.some(idx => idx.name === this.indexName);\n      \n      if (!indexExists) {\n        console.log(`Creating Pinecone index: ${this.indexName}`);\n        await this.pinecone.createIndex({\n          name: this.indexName,\n          dimension: 768,\n          metric: 'cosine',\n          spec: {\n            serverless: {\n              cloud: 'aws',\n              region: 'us-east-1'\n            }\n          }\n        });\n        \n        await new Promise(resolve => setTimeout(resolve, 5000));\n      }\n    } catch (error) {\n      console.error(\"Error ensuring Pinecone index:\", error);\n      throw error;\n    }\n  }\n\n  async generateEmbedding(text: string): Promise<number[]> {\n    try {\n      const result = await this.embeddingModel.embedContent(text);\n      return result.embedding.values;\n    } catch (error) {\n      console.error(\"Error generating embedding:\", error);\n      throw error;\n    }\n  }\n\n  async storeRecommendation(recommendation: any): Promise<void> {\n    try {\n      await this.ensureIndex();\n      const index = this.pinecone.index(this.indexName);\n      \n      const content = `${recommendation.type}: ${recommendation.description}. Impact: $${recommendation.estimatedSavings} savings, Priority: ${recommendation.priority}`;\n      const embedding = await this.generateEmbedding(content);\n      \n      const metadata: VectorMetadata = {\n        id: recommendation.id,\n        type: 'recommendation',\n        content,\n        savings: recommendation.estimatedSavings,\n        timestamp: new Date(recommendation.createdAt).toISOString()\n      };\n      \n      await index.upsert([{\n        id: `rec_${recommendation.id}`,\n        values: embedding,\n        metadata: metadata as any\n      }]);\n      \n      console.log(`‚úÖ Stored recommendation ${recommendation.id} in Pinecone`);\n    } catch (error) {\n      console.error(\"Error storing recommendation in Pinecone:\", error);\n    }\n  }\n\n  async storeOptimizationHistory(history: any): Promise<void> {\n    try {\n      await this.ensureIndex();\n      const index = this.pinecone.index(this.indexName);\n      \n      const content = `Optimization ${history.recommendationType}: ${history.resourceId}. Status: ${history.status}, Result: ${history.resultMessage || 'N/A'}`;\n      const embedding = await this.generateEmbedding(content);\n      \n      const metadata: VectorMetadata = {\n        id: history.id,\n        type: 'optimization_history',\n        content,\n        status: history.status,\n        timestamp: new Date(history.createdAt).toISOString()\n      };\n      \n      await index.upsert([{\n        id: `opt_${history.id}`,\n        values: embedding,\n        metadata: metadata as any\n      }]);\n      \n      console.log(`‚úÖ Stored optimization history ${history.id} in Pinecone`);\n    } catch (error) {\n      console.error(\"Error storing optimization history in Pinecone:\", error);\n    }\n  }\n\n  async retrieveRelevantContext(query: string, topK: number = 10): Promise<VectorMetadata[]> {\n    try {\n      await this.ensureIndex();\n      const index = this.pinecone.index(this.indexName);\n      \n      const queryEmbedding = await this.generateEmbedding(query);\n      \n      const results = await index.query({\n        vector: queryEmbedding,\n        topK,\n        includeMetadata: true\n      });\n      \n      return results.matches?.map(match => match.metadata as unknown as VectorMetadata) || [];\n    } catch (error) {\n      console.error(\"Error retrieving context from Pinecone:\", error);\n      return [];\n    }\n  }\n\n  async clearIndex(): Promise<void> {\n    try {\n      await this.ensureIndex();\n      const index = this.pinecone.index(this.indexName);\n      await index.deleteAll();\n      console.log(`üóëÔ∏è Cleared Pinecone index: ${this.indexName}`);\n    } catch (error) {\n      console.error(\"Error clearing Pinecone index:\", error);\n    }\n  }\n}\n\nexport const pineconeService = new PineconeService();\n","size_bytes":5022},"server/services/gemini-ai.ts":{"content":"import { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport type { AwsResource, Recommendation } from \"@shared/schema\";\nimport { storage, pineconeCircuitBreaker } from \"../storage.js\";\nimport { pineconeService } from \"./pinecone.js\";\nimport { configService } from './config.js';\n\nexport class GeminiAIService {\n  private genAI: GoogleGenerativeAI;\n  private model: any;\n  private contextCache: {\n    data: any;\n    timestamp: number;\n  } | null = null;\n  private readonly CACHE_TTL = 5 * 60 * 1000; // 5 minutes cache\n\n  constructor() {\n    const apiKey = process.env.GEMINI_API_KEY;\n    if (!apiKey) {\n      throw new Error(\"GEMINI_API_KEY is not configured\");\n    }\n    \n    this.genAI = new GoogleGenerativeAI(apiKey);\n    // Use Gemini 2.0 Flash Experimental for optimal speed\n    this.model = this.genAI.getGenerativeModel({ model: \"gemini-2.0-flash-exp\" });\n  }\n\n  async analyzeResourcesForOptimization(resources: AwsResource[], aiModeHistoryId?: string, historicalMetrics?: any): Promise<any[]> {\n    // RAG: Retrieve historical context for better AI recommendations\n    const historicalContext = await this.retrieveHistoricalContext();\n    \n    const prompt = this.buildAnalysisPrompt(resources, historicalContext);\n    \n    try {\n      const result = await this.model.generateContent(prompt);\n      const response = await result.response;\n      const text = response.text();\n      \n      // Parse the AI response into structured recommendations\n      const recommendations = await this.parseRecommendations(text, resources, aiModeHistoryId);\n      \n      // Invalidate cache after generating new recommendations (for fresh RAG on next run)\n      this.invalidateCache();\n      \n      return recommendations;\n    } catch (error) {\n      console.error(\"Error generating AI recommendations:\", error);\n      throw error;\n    }\n  }\n\n  // Invalidate cache to ensure fresh data on next retrieval\n  public invalidateCache(): void {\n    this.contextCache = null;\n    console.log('üîÑ RAG cache invalidated');\n  }\n\n  // RAG: Retrieve historical context from Pinecone vector database (Optimized with caching)\n  private async retrieveHistoricalContext(): Promise<{\n    pastRecommendations: any[];\n    optimizationHistory: any[];\n    successPatterns: any;\n  }> {\n    try {\n      // Check cache first\n      const now = Date.now();\n      if (this.contextCache && (now - this.contextCache.timestamp) < this.CACHE_TTL) {\n        console.log('üì¶ Using cached RAG context from Pinecone (performance optimization)');\n        return this.contextCache.data;\n      }\n\n      // Use Pinecone for semantic search of relevant historical context with circuit breaker protection\n      const query = \"AWS resource optimization recommendations and execution history\";\n      const relevantContext = await pineconeCircuitBreaker.executeWithFallback(\n        () => pineconeService.retrieveRelevantContext(query, 20),\n        [] // Fallback to empty array if circuit is open\n      ) || [];\n      \n      // Separate recommendations from optimization history\n      const pastRecommendations = relevantContext\n        .filter(ctx => ctx.type === 'recommendation')\n        .slice(0, 10);\n      \n      const optimizationHistory = relevantContext\n        .filter(ctx => ctx.type === 'optimization_history')\n        .slice(0, 10);\n      \n      // Calculate success patterns\n      const successPatterns = this.analyzeSuccessPatterns(optimizationHistory);\n      \n      const result = {\n        pastRecommendations,\n        optimizationHistory,\n        successPatterns\n      };\n\n      // Update cache\n      this.contextCache = {\n        data: result,\n        timestamp: now\n      };\n\n      console.log('‚ú® RAG context fetched from Pinecone and cached');\n      \n      return result;\n    } catch (error) {\n      console.error(\"Error retrieving historical context from Pinecone:\", error);\n      return {\n        pastRecommendations: [],\n        optimizationHistory: [],\n        successPatterns: {}\n      };\n    }\n  }\n\n  private analyzeSuccessPatterns(history: any[]): any {\n    const successfulOptimizations = history.filter(h => h.status === 'success');\n    const failedOptimizations = history.filter(h => h.status === 'failed');\n    \n    return {\n      totalOptimizations: history.length,\n      successCount: successfulOptimizations.length,\n      failureCount: failedOptimizations.length,\n      successRate: history.length > 0 ? (successfulOptimizations.length / history.length * 100).toFixed(1) : '0',\n      commonSuccessTypes: this.getCommonTypes(successfulOptimizations),\n      commonFailureTypes: this.getCommonTypes(failedOptimizations)\n    };\n  }\n\n  private getCommonTypes(optimizations: any[]): string[] {\n    const typeCounts: Record<string, number> = {};\n    optimizations.forEach(opt => {\n      const type = opt.beforeConfig?.type || 'unknown';\n      typeCounts[type] = (typeCounts[type] || 0) + 1;\n    });\n    \n    return Object.entries(typeCounts)\n      .sort(([,a], [,b]) => b - a)\n      .slice(0, 3)\n      .map(([type]) => type);\n  }\n\n  private buildAnalysisPrompt(resources: AwsResource[], historicalContext?: any): string {\n    const resourceSummary = resources.map(r => ({\n      id: r.resourceId,\n      type: r.resourceType,\n      config: r.currentConfig,\n      cost: r.monthlyCost || 0,\n      utilization: r.utilizationMetrics\n    }));\n\n    // Include RAG context if available\n    const ragContext = historicalContext ? `\n\nHISTORICAL CONTEXT (RAG - Learn from Past Optimizations):\n${JSON.stringify({\n  successRate: historicalContext.successPatterns?.successRate + '%' || 'N/A',\n  totalOptimizations: historicalContext.successPatterns?.totalOptimizations || 0,\n  successfulTypes: historicalContext.successPatterns?.commonSuccessTypes || [],\n  failedTypes: historicalContext.successPatterns?.commonFailureTypes || [],\n  recentRecommendations: historicalContext.pastRecommendations?.map((r: any) => ({\n    type: r.type,\n    status: r.status,\n    savings: r.projectedMonthlySavings\n  })) || []\n}, null, 2)}\n\nLESSONS FROM HISTORY:\n- Past successful optimization types: ${historicalContext.successPatterns?.commonSuccessTypes?.join(', ') || 'None yet'}\n- Past failed optimization types: ${historicalContext.successPatterns?.commonFailureTypes?.join(', ') || 'None yet'}\n- Overall success rate: ${historicalContext.successPatterns?.successRate || '0'}%\n\nUse this historical data to:\n1. Favor optimization types that have succeeded before\n2. Be cautious with types that have failed previously\n3. Learn from past savings patterns\n4. Avoid repeating past mistakes\n` : '';\n\n    return `You are an expert AWS FinOps consultant analyzing cloud infrastructure for cost optimization opportunities.\n\nRESOURCES TO ANALYZE:\n${JSON.stringify(resourceSummary, null, 2)}\n${ragContext}\n\nTASK:\nAnalyze these AWS resources and identify cost optimization opportunities. For each recommendation:\n1. Consider actual utilization patterns, not just static thresholds\n2. Assess business impact and risk level\n3. Provide contextual reasoning for why this optimization makes sense\n4. Consider resource relationships and dependencies\n5. Calculate realistic savings projections\n6. LEARN from historical optimization patterns above (RAG context)\n\nRESPONSE FORMAT (JSON array):\n[\n  {\n    \"resourceId\": \"resource-id\",\n    \"type\": \"resize|storage-class|reserved-instance|terminate|schedule\",\n    \"priority\": \"critical|high|medium|low\",\n    \"title\": \"Brief recommendation title\",\n    \"description\": \"Detailed explanation with contextual reasoning\",\n    \"currentConfig\": {...},\n    \"recommendedConfig\": {...},\n    \"projectedMonthlySavings\": 0,\n    \"riskLevel\": \"0-100\",\n    \"reasoning\": \"Why this optimization makes sense for this specific resource\"\n  }\n]\n\nIMPORTANT RULES:\n- Only recommend optimizations with clear cost savings (> $10/month)\n- Risk levels on 0-10 scale: 1-3 (low risk), 4-7 (medium risk), 8-10 (high risk)\n- Consider business context from tags (production vs development)\n- Savings must be realistic based on AWS pricing\n- All monetary values should be direct dollar amounts (no multipliers)\n- Provide specific, actionable recommendations\n- Use historical success patterns to guide your recommendations\n\nGenerate recommendations now:`;\n  }\n\n  private async parseRecommendations(aiResponse: string, resources: AwsResource[], aiModeHistoryId?: string): Promise<any[]> {\n    try {\n      // Extract JSON from the response (AI might wrap it in markdown)\n      const jsonMatch = aiResponse.match(/\\[[\\s\\S]*\\]/);\n      if (!jsonMatch) {\n        console.error(\"No JSON array found in AI response\");\n        return [];\n      }\n\n      const recommendations = JSON.parse(jsonMatch[0]);\n      \n      // Validate and normalize recommendations\n      return Promise.all(recommendations.map(async (rec: any) => {\n        try {\n          // Find the corresponding resource to get its monthly cost\n          const resource = resources.find(r => r.resourceId === rec.resourceId);\n          const resourceMonthlyCost = resource?.monthlyCost || 0;\n          const projectedMonthlySavings = Math.round(rec.projectedMonthlySavings);\n          \n          // Calculate savings percentage\n          const savingsPercentage = resourceMonthlyCost > 0 \n            ? Math.round((projectedMonthlySavings / resourceMonthlyCost) * 100 * 10) / 10 // Round to 1 decimal\n            : 0;\n          \n          // Sanitize risk level: convert to number, clamp to 0-10 range, default to 10 on invalid input\n          const rawRiskLevel = Number(rec.riskLevel);\n          const sanitizedRiskLevel = isNaN(rawRiskLevel) ? 10 : Math.max(0, Math.min(10, rawRiskLevel));\n          \n          // Determine execution mode based on risk level, type, and savings\n          let executionMode = 'hitl'; // Default to HITL for safety\n          try {\n            const executionModeResult = await configService.determineExecutionMode({\n              type: rec.type || 'resize',\n              riskLevel: sanitizedRiskLevel,\n              projectedMonthlySavings: projectedMonthlySavings\n            });\n            executionMode = executionModeResult.executionMode;\n          } catch (error) {\n            console.error(`Failed to determine execution mode for recommendation ${rec.resourceId}, defaulting to HITL:`, error);\n            executionMode = 'hitl';\n          }\n          \n          return {\n            resourceId: rec.resourceId,\n            type: rec.type || 'resize',\n            priority: rec.priority || 'medium',\n            title: rec.title || 'AI-Generated Optimization',\n            description: rec.description || rec.reasoning || '',\n            currentConfig: typeof rec.currentConfig === 'string' \n              ? rec.currentConfig \n              : JSON.stringify(rec.currentConfig),\n            recommendedConfig: typeof rec.recommendedConfig === 'string'\n              ? rec.recommendedConfig\n              : JSON.stringify(rec.recommendedConfig),\n            projectedMonthlySavings: projectedMonthlySavings,\n            riskLevel: sanitizedRiskLevel.toString(),\n            executionMode: executionMode,\n            status: 'pending',\n            aiModeHistoryId: aiModeHistoryId || null,\n            calculationMetadata: {\n              resourceMonthlyCost: resourceMonthlyCost,\n              savingsPercentage: savingsPercentage,\n              methodology: 'AI-powered analysis using Gemini 2.0 Flash with RAG (Pinecone vector database for historical context)'\n            }\n          };\n        } catch (error) {\n          console.error(`Failed to parse recommendation for ${rec.resourceId}, skipping:`, error);\n          return null;\n        }\n      })).then(results => results.filter(r => r !== null));\n    } catch (error) {\n      console.error(\"Error parsing AI recommendations:\", error);\n      console.error(\"AI Response:\", aiResponse);\n      return [];\n    }\n  }\n\n  async explainRecommendation(recommendation: any, resource: AwsResource): Promise<string> {\n    const prompt = `As an AWS FinOps expert, provide a clear, concise explanation for this optimization recommendation:\n\nRESOURCE:\n- ID: ${resource.resourceId}\n- Type: ${resource.resourceType}\n- Current Config: ${JSON.stringify(resource.currentConfig)}\n- Monthly Cost: $${(resource.monthlyCost || 0)}\n- Utilization: ${JSON.stringify(resource.utilizationMetrics)}\n\nRECOMMENDATION:\n- Type: ${recommendation.type}\n- Current: ${recommendation.currentConfig}\n- Recommended: ${recommendation.recommendedConfig}\n- Projected Savings: $${recommendation.projectedMonthlySavings}/month\n- Risk Level: ${recommendation.riskLevel}%\n\nExplain in 2-3 sentences why this optimization is recommended and what the business impact would be.`;\n\n    try {\n      const result = await this.model.generateContent(prompt);\n      const response = await result.response;\n      return response.text();\n    } catch (error) {\n      console.error(\"Error generating explanation:\", error);\n      return \"Unable to generate explanation at this time.\";\n    }\n  }\n\n  async assessRisk(recommendation: any, resource: AwsResource): Promise<{\n    riskScore: number;\n    riskFactors: string[];\n    mitigationSteps: string[];\n  }> {\n    const prompt = `Assess the risk of implementing this AWS optimization:\n\nRESOURCE: ${resource.resourceType} (${resource.resourceId})\nOPTIMIZATION: ${recommendation.type}\nFROM: ${recommendation.currentConfig}\nTO: ${recommendation.recommendedConfig}\n\nProvide a JSON response:\n{\n  \"riskScore\": 0-100,\n  \"riskFactors\": [\"factor1\", \"factor2\"],\n  \"mitigationSteps\": [\"step1\", \"step2\"]\n}`;\n\n    try {\n      const result = await this.model.generateContent(prompt);\n      const response = await result.response;\n      const text = response.text();\n      \n      const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n      if (jsonMatch) {\n        return JSON.parse(jsonMatch[0]);\n      }\n    } catch (error) {\n      console.error(\"Error assessing risk:\", error);\n    }\n\n    return {\n      riskScore: 50,\n      riskFactors: [\"Unable to assess risk automatically\"],\n      mitigationSteps: [\"Review change manually before implementing\"]\n    };\n  }\n}\n\nexport const geminiAI = new GeminiAIService();\n","size_bytes":14078},"client/src/components/layout/top-nav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Cpu, LogOut, Menu } from \"lucide-react\";\nimport autonomosLogo from \"@assets/MAIN LOGO TEAL DARK BG PNG_1760814802183.png\";\n\ninterface TopNavProps {\n  lastSync?: string;\n  prodMode: boolean;\n  onProdModeChange: (enabled: boolean) => void;\n  onMenuClick?: () => void;\n}\n\nfunction handleLogout() {\n  localStorage.removeItem(\"token\");\n  localStorage.removeItem(\"user\");\n  window.location.href = \"/login\";\n}\n\nexport function TopNav({ \n  lastSync = \"Just now\", \n  prodMode,\n  onProdModeChange,\n  onMenuClick\n}: TopNavProps) {\n  return (\n    <nav \n      className=\"fixed top-0 left-0 right-0 h-[60px] bg-[#0f172a] border-b border-white/[0.08] z-50 px-4 sm:px-6\"\n      data-testid=\"top-nav\"\n    >\n      <div className=\"h-full flex items-center justify-between\">\n        {/* Left: Hamburger Menu + Logo */}\n        <div className=\"flex items-center gap-3\">\n          {/* Hamburger Menu Button - Only visible on mobile/tablet */}\n          {onMenuClick && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onMenuClick}\n              className=\"lg:hidden text-gray-300 hover:text-white hover:bg-white/10\"\n              data-testid=\"button-menu\"\n            >\n              <Menu className=\"w-5 h-5\" />\n            </Button>\n          )}\n          \n          <Link \n            href=\"/\" \n            className=\"hover:opacity-80 transition-opacity\"\n            data-testid=\"nav-home-link\"\n          >\n            <img \n              src={autonomosLogo} \n              alt=\"autonomOS\" \n              className=\"h-[42px]\"\n            />\n          </Link>\n        </div>\n\n        {/* Right: Last Sync, Toggles and Logout */}\n        <div className=\"flex items-center gap-4\">\n          {/* Last Sync */}\n          <div className=\"hidden lg:flex flex-col items-end\">\n            <span className=\"text-xs text-gray-400\">Last Sync</span>\n            <span className=\"text-xs text-white font-medium\" data-testid=\"last-sync\">\n              {lastSync}\n            </span>\n          </div>\n\n          {/* Prod Mode Toggle */}\n          <div className=\"flex items-center gap-2\">\n            <div className=\"hidden sm:flex items-center gap-1.5\">\n              <Cpu className=\"w-3.5 h-3.5 text-cyan-400\" />\n              <Label \n                htmlFor=\"prod-mode-toggle\" \n                className=\"text-sm text-gray-300 cursor-pointer font-medium\"\n              >\n                Prod Mode\n              </Label>\n            </div>\n            <Switch\n              id=\"prod-mode-toggle\"\n              checked={prodMode}\n              onCheckedChange={onProdModeChange}\n              className=\"data-[state=checked]:bg-cyan-500\"\n              data-testid=\"toggle-prod-mode\"\n            />\n          </div>\n\n          {/* Logout Button */}\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleLogout}\n            className=\"text-gray-300 hover:text-white hover:bg-white/10\"\n            data-testid=\"button-logout\"\n          >\n            <LogOut className=\"w-4 h-4 mr-2\" />\n            <span className=\"hidden sm:inline\">Logout</span>\n          </Button>\n        </div>\n      </div>\n    </nav>\n  );\n}\n","size_bytes":3366},"client/src/hooks/use-agent-config.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface AgentConfig {\n  autonomousMode: boolean;\n  prodMode: boolean;\n  simulationMode: boolean;\n  maxAutonomousRiskLevel: number;\n  approvalRequiredAboveSavings: number;\n  autoExecuteTypes: string[];\n  prodModeTimeRemaining?: number;\n}\n\nexport function useAgentConfig() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch current agent configuration with polling to catch auto-revert\n  const { data: agentConfig, isLoading } = useQuery<AgentConfig>({\n    queryKey: ['/api/agent-config'],\n    refetchInterval: 5000, // Poll every 5 seconds to catch prod mode auto-revert\n  });\n\n  // Mutation to update prod mode using new auto-revert endpoint\n  const updateProdMode = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      const response = await apiRequest('POST', '/api/mode/prod', { enabled });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/agent-config'] });\n      const message = data.prodMode \n        ? `Prod Mode ON (AI with RAG) - Auto-reverts in ${data.timeRemaining}s` \n        : 'Prod Mode OFF (Heuristics)';\n      toast({\n        title: \"Prod Mode Updated\",\n        description: message,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update prod mode.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  return {\n    agentConfig,\n    isLoading,\n    updateProdMode: (enabled: boolean) => updateProdMode.mutate(enabled),\n  };\n}\n","size_bytes":1709},"client/src/pages/faq.tsx":{"content":"import { Sidebar } from \"@/components/layout/sidebar\";\nimport { TopNav } from \"@/components/layout/top-nav\";\nimport { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { HelpCircle } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\nexport default function FAQ() {\n  const { agentConfig, updateProdMode } = useAgentConfig();\n  const [isMobileSidebarOpen, setIsMobileSidebarOpen] = useState(false);\n\n  useEffect(() => {\n    document.title = \"FAQ - FinOps Autopilot | Frequently Asked Questions\";\n    \n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute(\n        \"content\",\n        \"Get answers to frequently asked questions about FinOps Autopilot, Prod Mode, Heuristic Mode, and cost optimization features.\"\n      );\n    } else {\n      const meta = document.createElement('meta');\n      meta.name = \"description\";\n      meta.content = \"Get answers to frequently asked questions about FinOps Autopilot, Prod Mode, Heuristic Mode, and cost optimization features.\";\n      document.head.appendChild(meta);\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <TopNav \n        lastSync=\"Just now\"\n        prodMode={agentConfig?.prodMode || false}\n        onProdModeChange={updateProdMode}\n        onMenuClick={() => setIsMobileSidebarOpen(true)}\n      />\n      <div className=\"flex-1 flex pt-[60px]\">\n        <Sidebar \n          isMobileOpen={isMobileSidebarOpen}\n          onClose={() => setIsMobileSidebarOpen(false)}\n        />\n        <main className=\"flex-1 overflow-hidden w-full\">\n          <div className=\"p-4 sm:p-6 h-full overflow-y-auto\">\n            <div className=\"max-w-4xl mx-auto\">\n              <div className=\"flex items-center gap-3 mb-6\">\n                <HelpCircle className=\"w-8 h-8 text-primary\" />\n                <h1 className=\"text-3xl font-bold\" data-testid=\"faq-heading\">\n                  Frequently Asked Questions\n                </h1>\n              </div>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Learn About FinOps Autopilot</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <Accordion type=\"single\" collapsible className=\"w-full\" data-testid=\"faq-accordion\">\n                    <AccordionItem value=\"item-1\" data-testid=\"faq-item-what-is-finops\">\n                      <AccordionTrigger className=\"text-left\">\n                        What is FinOps Autopilot?\n                      </AccordionTrigger>\n                      <AccordionContent>\n                        <p className=\"text-muted-foreground\">\n                          FinOps Autopilot is an intelligent cloud cost optimization platform that continuously monitors \n                          your AWS infrastructure, identifies cost-saving opportunities, and can automatically execute \n                          optimizations based on your configuration. It combines heuristic analysis with AI-powered \n                          recommendations using Gemini 2.5 Flash and RAG (Retrieval-Augmented Generation) to provide \n                          context-aware cost optimization strategies.\n                        </p>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"item-2\" data-testid=\"faq-item-prod-mode\">\n                      <AccordionTrigger className=\"text-left\">\n                        What is Prod Mode?\n                      </AccordionTrigger>\n                      <AccordionContent>\n                        <p className=\"text-muted-foreground mb-3\">\n                          Prod Mode enables AI-powered analysis using Gemini 2.5 Flash with RAG (Retrieval-Augmented \n                          Generation). When enabled, the system:\n                        </p>\n                        <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                          <li>Uses advanced AI models to analyze resource utilization patterns</li>\n                          <li>Leverages historical optimization data through RAG for context-aware recommendations</li>\n                          <li>Generates more sophisticated and personalized cost optimization strategies</li>\n                          <li>Automatically reverts to Heuristic Mode after 5 minutes to manage AI costs</li>\n                        </ul>\n                        <p className=\"text-muted-foreground mt-3\">\n                          <strong>Note:</strong> Prod Mode has higher API costs due to AI model usage, which is why \n                          it automatically reverts to Heuristic Mode.\n                        </p>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"item-3\" data-testid=\"faq-item-heuristic-mode\">\n                      <AccordionTrigger className=\"text-left\">\n                        What is Heuristic Mode?\n                      </AccordionTrigger>\n                      <AccordionContent>\n                        <p className=\"text-muted-foreground mb-3\">\n                          Heuristic Mode is the default operating mode that uses rule-based analysis to identify \n                          cost optimization opportunities. This mode:\n                        </p>\n                        <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                          <li>Analyzes resource utilization metrics using predefined thresholds</li>\n                          <li>Identifies common cost optimization patterns (underutilized instances, oversized resources, etc.)</li>\n                          <li>Operates continuously without additional AI API costs</li>\n                          <li>Provides reliable, consistent recommendations based on industry best practices</li>\n                        </ul>\n                        <p className=\"text-muted-foreground mt-3\">\n                          Heuristic Mode is cost-effective and runs 24/7, making it ideal for continuous monitoring.\n                        </p>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"item-4\" data-testid=\"faq-item-simulation-data\">\n                      <AccordionTrigger className=\"text-left\">\n                        What data is simulated?\n                      </AccordionTrigger>\n                      <AccordionContent>\n                        <p className=\"text-muted-foreground mb-3\">\n                          The system can operate with simulated data for demonstration and testing purposes. \n                          Simulated data includes:\n                        </p>\n                        <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                          <li><strong>AWS Resources:</strong> EC2 instances, RDS databases, Redshift clusters, and S3 buckets</li>\n                          <li><strong>Utilization Metrics:</strong> CPU, memory, storage, and network usage patterns</li>\n                          <li><strong>Cost Data:</strong> Historical monthly spending across different services</li>\n                          <li><strong>Recommendations:</strong> Cost optimization opportunities based on simulated resource usage</li>\n                          <li><strong>Optimization History:</strong> Past executions and their results</li>\n                        </ul>\n                        <p className=\"text-muted-foreground mt-3\">\n                          The simulation evolves dynamically over time, with resources showing changing utilization \n                          patterns and new recommendations being generated continuously.\n                        </p>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"item-5\" data-testid=\"faq-item-auto-vs-manual\">\n                      <AccordionTrigger className=\"text-left\">\n                        What are Auto-Optimizations vs Human-Approved Optimizations?\n                      </AccordionTrigger>\n                      <AccordionContent>\n                        <p className=\"text-muted-foreground mb-3\">\n                          FinOps Autopilot supports two execution modes:\n                        </p>\n                        <div className=\"space-y-4\">\n                          <div>\n                            <h4 className=\"font-semibold text-foreground mb-2\">Auto-Optimizations (Autonomous Mode)</h4>\n                            <p className=\"text-muted-foreground mb-2\">\n                              When Autonomous Mode is enabled, the system can automatically execute optimizations that meet these criteria:\n                            </p>\n                            <ul className=\"list-disc list-inside space-y-1 text-muted-foreground ml-4\">\n                              <li>Risk level is below the configured threshold (default: 5%)</li>\n                              <li>Annual savings are below the approval threshold (default: $10,000)</li>\n                              <li>Optimization type is in the auto-execute list (e.g., resize, storage-class changes)</li>\n                            </ul>\n                          </div>\n                          <div>\n                            <h4 className=\"font-semibold text-foreground mb-2\">Human-Approved Optimizations</h4>\n                            <p className=\"text-muted-foreground mb-2\">\n                              Higher-risk or high-impact optimizations require manual approval:\n                            </p>\n                            <ul className=\"list-disc list-inside space-y-1 text-muted-foreground ml-4\">\n                              <li>High-risk operations (e.g., terminating resources)</li>\n                              <li>Large cost impact (above approval threshold)</li>\n                              <li>Changes to production-critical resources</li>\n                              <li>Any optimization when Autonomous Mode is disabled</li>\n                            </ul>\n                          </div>\n                        </div>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"item-6\" data-testid=\"faq-item-metrics-update\">\n                      <AccordionTrigger className=\"text-left\">\n                        How often are metrics updated?\n                      </AccordionTrigger>\n                      <AccordionContent>\n                        <p className=\"text-muted-foreground mb-3\">\n                          Metrics are updated on different schedules based on their type:\n                        </p>\n                        <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                          <li><strong>Dashboard Metrics:</strong> Auto-refresh every 10 seconds via polling</li>\n                          <li><strong>Resource Analysis:</strong> Runs every 6 hours to check for new optimization opportunities</li>\n                          <li><strong>Cost Data Sync:</strong> Daily at 2 AM to pull latest AWS billing data</li>\n                          <li><strong>Resource Utilization:</strong> Evolves every 30 minutes in simulation mode</li>\n                          <li><strong>Trusted Advisor:</strong> Weekly checks every Sunday at 3 AM</li>\n                        </ul>\n                        <p className=\"text-muted-foreground mt-3\">\n                          The system operates continuously in the background, ensuring you always have up-to-date \n                          information for making cost optimization decisions.\n                        </p>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"item-7\" data-testid=\"faq-item-data-storage\">\n                      <AccordionTrigger className=\"text-left\">\n                        Where is data stored?\n                      </AccordionTrigger>\n                      <AccordionContent>\n                        <p className=\"text-muted-foreground mb-3\">\n                          FinOps Autopilot uses a multi-layered data storage architecture:\n                        </p>\n                        <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                          <li><strong>PostgreSQL Database:</strong> Stores all resource metadata, recommendations, optimization \n                            history, cost reports, and system configuration</li>\n                          <li><strong>Pinecone Vector Database:</strong> Stores embeddings of recommendations and optimization \n                            history for RAG-powered AI analysis</li>\n                          <li><strong>In-Memory Cache:</strong> Caches system configuration for fast access</li>\n                          <li><strong>Session Storage:</strong> Manages user authentication and session data</li>\n                        </ul>\n                        <p className=\"text-muted-foreground mt-3\">\n                          All data is stored securely with proper encryption and access controls. The system supports \n                          both development and production database environments with automatic backups and rollback capabilities.\n                        </p>\n                      </AccordionContent>\n                    </AccordionItem>\n                  </Accordion>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}\n","size_bytes":13883},"client/src/components/dashboard/optimization-mix.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle2, Clock } from \"lucide-react\";\n\ninterface OptimizationMixData {\n  autonomousCount: number;\n  hitlCount: number;\n  autonomousPercentage: number;\n  hitlPercentage: number;\n  totalRecommendations: number;\n}\n\nexport function OptimizationMix() {\n  const { data: mixData, isLoading } = useQuery<OptimizationMixData>({\n    queryKey: ['/api/metrics/optimization-mix'],\n    refetchInterval: 3000, // Auto-refresh every 3 seconds\n  });\n\n  if (isLoading) {\n    return (\n      <Card data-testid=\"card-optimization-mix\">\n        <CardHeader>\n          <CardTitle className=\"text-sm font-medium\">Optimization Mix</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-12 animate-pulse bg-muted rounded\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const autonomousPercentage = mixData?.autonomousPercentage || 0;\n  const hitlPercentage = mixData?.hitlPercentage || 0;\n  const autonomousCount = mixData?.autonomousCount || 0;\n  const hitlCount = mixData?.hitlCount || 0;\n\n  return (\n    <Card data-testid=\"card-optimization-mix\">\n      <CardHeader>\n        <CardTitle className=\"text-sm font-medium\">Optimization Mix</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          {/* Visual Bar */}\n          <div className=\"flex h-8 rounded-lg overflow-hidden border border-border\">\n            {autonomousPercentage > 0 && (\n              <div\n                className=\"bg-emerald-500/20 border-r border-emerald-500/50 flex items-center justify-center text-xs font-semibold text-emerald-600 dark:text-emerald-400\"\n                style={{ width: `${autonomousPercentage}%` }}\n                data-testid=\"bar-autonomous\"\n              >\n                {autonomousPercentage}%\n              </div>\n            )}\n            {hitlPercentage > 0 && (\n              <div\n                className=\"bg-amber-500/20 flex items-center justify-center text-xs font-semibold text-amber-600 dark:text-amber-400\"\n                style={{ width: `${hitlPercentage}%` }}\n                data-testid=\"bar-hitl\"\n              >\n                {hitlPercentage}%\n              </div>\n            )}\n          </div>\n\n          {/* Legend */}\n          <div className=\"flex items-center justify-between text-sm\">\n            <div className=\"flex items-center gap-2\" data-testid=\"legend-autonomous\">\n              <div className=\"flex items-center gap-1.5\">\n                <CheckCircle2 className=\"h-4 w-4 text-emerald-500\" />\n                <span className=\"text-muted-foreground\">Autonomous</span>\n              </div>\n              <Badge variant=\"secondary\" className=\"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30\">\n                {autonomousCount}\n              </Badge>\n            </div>\n\n            <div className=\"flex items-center gap-2\" data-testid=\"legend-hitl\">\n              <div className=\"flex items-center gap-1.5\">\n                <Clock className=\"h-4 w-4 text-amber-500\" />\n                <span className=\"text-muted-foreground\">HITL</span>\n              </div>\n              <Badge variant=\"secondary\" className=\"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/30\">\n                {hitlCount}\n              </Badge>\n            </div>\n          </div>\n\n          {/* Summary Text */}\n          <p className=\"text-xs text-muted-foreground text-center\" data-testid=\"text-summary\">\n            {autonomousCount} auto-executed / {hitlCount} awaiting approval\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":3749},"client/src/components/ai-mode-history.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Zap, CheckCircle2, XCircle, Clock } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport { useState } from \"react\";\nimport { AiHistoryDetailsModal } from \"@/components/modals/ai-history-details-modal\";\n\ninterface AiModeHistoryEntry {\n  id: string;\n  startTime: string;\n  endTime: string | null;\n  status: 'running' | 'success' | 'failed';\n  summary: string;\n  recommendationsGenerated?: number;\n  totalSavingsIdentified?: number;\n  errorMessage?: string;\n  triggeredBy: string;\n}\n\nexport function AiModeHistory() {\n  const [selectedHistoryId, setSelectedHistoryId] = useState<string | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const { data: history, isLoading } = useQuery<AiModeHistoryEntry[]>({\n    queryKey: ['/api/ai-mode-history'],\n    refetchInterval: 5000, // Refresh every 5 seconds\n  });\n\n  const handleCardClick = (id: string) => {\n    setSelectedHistoryId(id);\n    setIsModalOpen(true);\n  };\n\n  const handleCloseModal = () => {\n    setIsModalOpen(false);\n    setSelectedHistoryId(null);\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleString('en-US', { \n      month: 'short', \n      day: 'numeric',\n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  const formatDuration = (start: string, end: string | null) => {\n    if (!end) return 'In progress...';\n    const duration = (new Date(end).getTime() - new Date(start).getTime()) / 1000;\n    return `${duration.toFixed(1)}s`;\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'success':\n        return <CheckCircle2 className=\"w-4 h-4 text-green-500\" />;\n      case 'failed':\n        return <XCircle className=\"w-4 h-4 text-red-500\" />;\n      case 'running':\n        return <Clock className=\"w-4 h-4 text-cyan-500 animate-spin\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants = {\n      success: 'default',\n      failed: 'destructive',\n      running: 'outline'\n    } as const;\n    \n    return (\n      <Badge variant={variants[status as keyof typeof variants] || 'outline'}>\n        {status}\n      </Badge>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"bg-[#1B1E23] border-gray-800\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Zap className=\"w-5 h-5 text-cyan-400\" />\n            AI Mode History\n          </CardTitle>\n          <CardDescription className=\"text-gray-400\">\n            Loading history...\n          </CardDescription>\n        </CardHeader>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      <Card className=\"bg-[#1B1E23] border-gray-800\" data-testid=\"ai-mode-history-panel\">\n        <CardHeader>\n          <CardTitle className=\"text-white flex items-center gap-2\">\n            <Zap className=\"w-5 h-5 text-cyan-400\" />\n            AI Mode History\n          </CardTitle>\n          <CardDescription className=\"text-gray-400\">\n            Last {history?.length || 0} RAG analysis runs\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!history || history.length === 0 ? (\n            <p className=\"text-gray-500 text-sm\">No AI analysis runs yet</p>\n          ) : (\n            <div className=\"space-y-3\">\n              {history.map((entry) => (\n                <button\n                  key={entry.id}\n                  onClick={() => handleCardClick(entry.id)}\n                  className=\"w-full p-3 bg-gray-800/50 rounded-lg border border-gray-700 hover:border-cyan-400 hover:bg-gray-800/70 transition-colors cursor-pointer text-left\"\n                  data-testid={`ai-history-card-clickable-${entry.id}`}\n                >\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex items-start gap-2 flex-1\">\n                      {getStatusIcon(entry.status)}\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm text-white font-medium truncate\">\n                          {entry.summary}\n                        </p>\n                        <p className=\"text-xs text-gray-400 mt-1\">\n                          {formatDate(entry.startTime)} ‚Ä¢ {formatDuration(entry.startTime, entry.endTime)}\n                        </p>\n                        {entry.status === 'success' && entry.recommendationsGenerated !== undefined && (\n                          <p className=\"text-xs text-cyan-400 mt-1\">\n                            {entry.recommendationsGenerated} recommendations ‚Ä¢ \n                            {formatCurrencyK(entry.totalSavingsIdentified || 0)} savings\n                          </p>\n                        )}\n                        {entry.status === 'failed' && entry.errorMessage && (\n                          <p className=\"text-xs text-red-400 mt-1 truncate\">\n                            Error: {entry.errorMessage}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                    {getStatusBadge(entry.status)}\n                  </div>\n                </button>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <AiHistoryDetailsModal \n        isOpen={isModalOpen}\n        onClose={handleCloseModal}\n        aiHistoryId={selectedHistoryId}\n      />\n    </>\n  );\n}\n","size_bytes":5641},"client/src/components/ai-mode-indicator.tsx":{"content":"import { useAgentConfig } from \"@/hooks/use-agent-config\";\nimport { Activity } from \"lucide-react\";\n\nexport function AiModeIndicator() {\n  const { agentConfig } = useAgentConfig();\n\n  if (!agentConfig?.prodMode) {\n    return null;\n  }\n\n  const timeRemaining = agentConfig.prodModeTimeRemaining ?? 30;\n\n  return (\n    <div \n      className=\"fixed top-4 right-4 z-50 bg-cyan-500/20 border-2 border-cyan-500 rounded-lg px-4 py-2 flex items-center gap-3 animate-pulse\"\n      data-testid=\"ai-mode-indicator\"\n    >\n      <Activity className=\"w-5 h-5 text-cyan-400\" />\n      <div className=\"flex flex-col\">\n        <span className=\"text-cyan-400 font-semibold text-sm\">\n          ‚ö° Prod Mode Active (RAG)\n        </span>\n        <span className=\"text-cyan-300 text-xs\" data-testid=\"ai-mode-countdown\">\n          Auto-revert in {timeRemaining}s\n        </span>\n      </div>\n    </div>\n  );\n}\n","size_bytes":886},"client/src/components/TraceIdFooter.tsx":{"content":"import { useState } from \"react\";\nimport { Copy, Check } from \"lucide-react\";\n\ninterface TraceIdFooterProps {\n  traceId?: string | null;\n}\n\nexport function TraceIdFooter({ traceId }: TraceIdFooterProps) {\n  const [copied, setCopied] = useState(false);\n  \n  // Only show in development mode\n  const isDev = import.meta.env.DEV;\n  \n  if (!isDev || !traceId) {\n    return null;\n  }\n\n  const handleCopy = async () => {\n    await navigator.clipboard.writeText(traceId);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  return (\n    <div \n      className=\"fixed bottom-0 left-0 right-0 bg-gray-900/80 backdrop-blur-sm border-t border-gray-700/50 px-4 py-2 z-50\"\n      data-testid=\"footer-trace-id\"\n    >\n      <div className=\"max-w-7xl mx-auto flex items-center justify-between text-xs\">\n        <div className=\"flex items-center gap-2 text-gray-400\">\n          <span className=\"font-mono\">trace_id:</span>\n          <code className=\"text-cyan-400 font-mono\">{traceId}</code>\n        </div>\n        <button\n          onClick={handleCopy}\n          className=\"flex items-center gap-1.5 px-2 py-1 rounded hover:bg-gray-800 transition-colors text-gray-400 hover:text-gray-200\"\n          data-testid=\"button-copy-trace-id\"\n        >\n          {copied ? (\n            <>\n              <Check className=\"w-3 h-3\" />\n              <span>Copied</span>\n            </>\n          ) : (\n            <>\n              <Copy className=\"w-3 h-3\" />\n              <span>Copy</span>\n            </>\n          )}\n        </button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1564},"client/src/lib/aosClient.ts":{"content":"/**\n * autonomOS Platform Integration Client\n * Handles Views (read) and Intents (actions) with HITL-safe execution modes\n */\n\n// Configuration (line 6-7)\nconst PLATFORM_BASE_URL = import.meta.env.VITE_AOS_BASE_URL || import.meta.env.VITE_PLATFORM_URL || 'https://autonomos-platform.replit.app';\nconst USE_PLATFORM = import.meta.env.VITE_USE_PLATFORM === 'true';\n\n// Retry configuration\nconst MAX_RETRIES = 3;\nconst BASE_DELAY = 1000; // 1 second\nconst RETRY_DELAYS = [1000, 2000, 4000]; // Exponential backoff: 1s, 2s, 4s\n\n// Export configuration for testing\nexport const AOS_CONFIG = {\n  baseUrl: PLATFORM_BASE_URL,\n  usePlatform: USE_PLATFORM,\n};\n\n/**\n * Check if an error is retryable (network errors and 5xx responses)\n */\nfunction isRetryableError(error: any, response?: Response): boolean {\n  // Network errors (no response)\n  if (!response && (error.message?.includes('fetch failed') || error.message?.includes('network'))) {\n    return true;\n  }\n  \n  // HTTP 5xx errors\n  if (response && response.status >= 500 && response.status < 600) {\n    return true;\n  }\n  \n  // Don't retry 4xx client errors\n  return false;\n}\n\n/**\n * Retry a fetch operation with exponential backoff\n */\nasync function retryFetch<T>(\n  operation: () => Promise<T>,\n  context: string\n): Promise<T> {\n  let lastError: any;\n  \n  for (let attempt = 0; attempt <= MAX_RETRIES; attempt++) {\n    try {\n      return await operation();\n    } catch (error) {\n      lastError = error;\n      const response = (error as any).response;\n      \n      // Check if we should retry\n      if (attempt === MAX_RETRIES || !isRetryableError(error, response)) {\n        console.error(`[aosClient:${context}] Failed after ${attempt + 1} attempts:`, error);\n        throw error;\n      }\n      \n      // Calculate delay for this attempt\n      const delay = RETRY_DELAYS[attempt] || BASE_DELAY * Math.pow(2, attempt);\n      \n      console.log(\n        `[aosClient:${context}] Attempt ${attempt + 1}/${MAX_RETRIES + 1} failed, ` +\n        `retrying in ${delay}ms...`,\n        error.message || error\n      );\n      \n      // Wait before retrying\n      await new Promise(resolve => setTimeout(resolve, delay));\n    }\n  }\n  \n  throw lastError;\n}\n\nexport interface PlatformViewResponse<T = any> {\n  data: T;\n  trace_id?: string;\n  timestamp?: string;\n}\n\nexport interface PlatformIntentRequest {\n  intent: string;\n  targets?: string[];\n  dry_run?: boolean;\n  explain_only?: boolean;\n  metadata?: Record<string, any>;\n}\n\nexport interface PlatformIntentResponse {\n  task_id: string;\n  trace_id: string;\n  status: 'pending' | 'running' | 'completed' | 'failed';\n  message?: string;\n  result?: any;\n}\n\nexport interface TaskStatusResponse {\n  task_id: string;\n  trace_id: string;\n  status: 'pending' | 'running' | 'completed' | 'failed';\n  progress?: number;\n  message?: string;\n  result?: any;\n  error?: string;\n  created_at?: string;\n  updated_at?: string;\n}\n\n/**\n * Map platform view names to local API endpoints\n */\nconst VIEW_TO_LOCAL_ENDPOINT: Record<string, string> = {\n  'accounts': '/api/aws-resources',\n  'resources': '/api/aws-resources',\n  'opportunities': '/api/recommendations',\n  'recommendations': '/api/recommendations',\n  'history': '/api/optimization-history',\n  'optimization-history': '/api/optimization-history',\n  'metrics': '/api/metrics/summary',\n  'summary': '/api/metrics/summary',\n};\n\n/**\n * Fetch data from a platform view\n * Falls back to local API endpoints if USE_PLATFORM=false\n */\nexport async function getView<T = any>(viewName: string): Promise<PlatformViewResponse<T>> {\n  if (!USE_PLATFORM) {\n    // Fallback to existing local API endpoints\n    const localEndpoint = VIEW_TO_LOCAL_ENDPOINT[viewName] || `/api/${viewName}`;\n    console.log(`[aosClient] USE_PLATFORM=false, falling back to local endpoint: ${localEndpoint}`);\n    \n    try {\n      const res = await fetch(localEndpoint, {\n        method: 'GET',\n        credentials: 'include',\n      });\n\n      if (!res.ok) {\n        const errorText = await res.text();\n        throw new Error(`Local API fetch failed (${res.status}): ${errorText}`);\n      }\n\n      const data = await res.json();\n      return {\n        data,\n        trace_id: `local-${Date.now()}`,\n        timestamp: new Date().toISOString()\n      };\n    } catch (error) {\n      console.error(`[aosClient] Local fallback error for ${viewName}:`, error);\n      throw error;\n    }\n  }\n\n  // Try platform first with retry logic, fall back to local on error\n  try {\n    return await retryFetch(async () => {\n      const res = await fetch(`${PLATFORM_BASE_URL}/api/v1/dcl/views/${viewName}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n      });\n\n      if (!res.ok) {\n        // For 5xx errors, throw to trigger retry\n        if (res.status >= 500 && res.status < 600) {\n          const errorText = await res.text();\n          const error = new Error(`Platform API error ${res.status}: ${errorText}`);\n          (error as any).response = res;\n          throw error;\n        }\n        \n        // For 4xx errors, don't retry - fall back to local immediately\n        const errorText = await res.text();\n        console.warn(`[aosClient] Platform view fetch failed (${res.status}), falling back to local`, errorText);\n        \n        // Graceful fallback to local API\n        const localEndpoint = VIEW_TO_LOCAL_ENDPOINT[viewName] || `/api/${viewName}`;\n        const localRes = await fetch(localEndpoint, {\n          method: 'GET',\n          credentials: 'include',\n        });\n        \n        if (!localRes.ok) {\n          throw new Error(`Both platform and local API failed for view ${viewName}`);\n        }\n        \n        const data = await localRes.json();\n        return {\n          data,\n          trace_id: `fallback-${Date.now()}`,\n          timestamp: new Date().toISOString()\n        };\n      }\n\n      return await res.json();\n    }, `getView(${viewName})`);\n  } catch (error) {\n    console.error(`[aosClient] Platform error after retries, falling back to local for ${viewName}:`, error);\n    \n    // Final fallback to local API\n    const localEndpoint = VIEW_TO_LOCAL_ENDPOINT[viewName] || `/api/${viewName}`;\n    const localRes = await fetch(localEndpoint, {\n      method: 'GET',\n      credentials: 'include',\n    });\n    \n    if (!localRes.ok) {\n      throw new Error(`Both platform and local API failed for view ${viewName}`);\n    }\n    \n    const data = await localRes.json();\n    return {\n      data,\n      trace_id: `error-fallback-${Date.now()}`,\n      timestamp: new Date().toISOString()\n    };\n  }\n}\n\n/**\n * Execute a platform intent with HITL-safe parameters\n * \n * @param agentId - The agent identifier (e.g., 'finops')\n * @param action - The action to perform (e.g., 'execute', 'analyze')\n * @param params - Intent parameters including intent name, targets, and execution mode\n * @param options - Additional options like idempotencyKey\n */\nexport async function postIntent(\n  agentId: string,\n  action: string,\n  params: PlatformIntentRequest,\n  options?: {\n    idempotencyKey?: string;\n  }\n): Promise<PlatformIntentResponse> {\n  if (!USE_PLATFORM) {\n    // Fallback to mock response\n    console.log(`[aosClient] USE_PLATFORM=false, mocking intent: ${agentId}/${action}`, params);\n    return {\n      task_id: `mock-task-${Date.now()}`,\n      trace_id: `mock-trace-${Date.now()}`,\n      status: 'completed',\n      message: 'Mock intent execution (USE_PLATFORM=false)',\n      result: { success: true, mode: 'mock' }\n    };\n  }\n\n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json',\n  };\n\n  if (options?.idempotencyKey) {\n    headers['Idempotency-Key'] = options.idempotencyKey;\n  }\n\n  // Try platform first with retry logic, fall back to degraded mode on error\n  try {\n    return await retryFetch(async () => {\n      const res = await fetch(`${PLATFORM_BASE_URL}/api/v1/intents/${agentId}/${action}`, {\n        method: 'POST',\n        headers,\n        credentials: 'include',\n        body: JSON.stringify(params),\n      });\n\n      if (!res.ok) {\n        // For 5xx errors, throw to trigger retry\n        if (res.status >= 500 && res.status < 600) {\n          const errorText = await res.text();\n          const error = new Error(`Platform API error ${res.status}: ${errorText}`);\n          (error as any).response = res;\n          throw error;\n        }\n        \n        // For 4xx errors, don't retry - return degraded mode immediately\n        const errorText = await res.text();\n        console.warn(`[aosClient] Platform intent failed (${res.status}), falling back to degraded mode`, errorText);\n        \n        // Graceful fallback with failed status to indicate degraded mode\n        return {\n          task_id: `fallback-task-${Date.now()}`,\n          trace_id: `fallback-trace-${Date.now()}`,\n          status: 'failed',\n          message: `Platform unavailable (${res.status}), operation not executed - using degraded mode`,\n          result: { \n            success: false, \n            mode: 'fallback',\n            reason: `platform_unavailable_${res.status}`,\n            degraded: true\n          }\n        };\n      }\n\n      return await res.json();\n    }, `postIntent(${agentId}/${action})`);\n  } catch (error) {\n    console.error(`[aosClient] Platform error after retries, falling back to degraded mode for ${agentId}/${action}:`, error);\n    \n    // Final fallback with failed status to indicate degraded mode\n    return {\n      task_id: `error-fallback-task-${Date.now()}`,\n      trace_id: `error-fallback-trace-${Date.now()}`,\n      status: 'failed',\n      message: `Platform error after retries, operation not executed: ${error instanceof Error ? error.message : String(error)}`,\n      result: { \n        success: false, \n        mode: 'error-fallback',\n        error: error instanceof Error ? error.message : String(error),\n        degraded: true\n      }\n    };\n  }\n}\n\n/**\n * Poll task status until completion or timeout\n * \n * @param taskId - The task ID to poll\n * @param options - Polling configuration\n */\nexport async function pollTaskStatus(\n  taskId: string,\n  options?: {\n    intervalMs?: number;\n    timeoutMs?: number;\n    onProgress?: (status: TaskStatusResponse) => void;\n  }\n): Promise<TaskStatusResponse> {\n  const intervalMs = options?.intervalMs || 1000;\n  const timeoutMs = options?.timeoutMs || 30000;\n  const startTime = Date.now();\n\n  while (Date.now() - startTime < timeoutMs) {\n    const status = await getTaskStatus(taskId);\n    \n    if (options?.onProgress) {\n      options.onProgress(status);\n    }\n\n    if (status.status === 'completed' || status.status === 'failed') {\n      return status;\n    }\n\n    await new Promise(resolve => setTimeout(resolve, intervalMs));\n  }\n\n  throw new Error(`Task ${taskId} polling timeout after ${timeoutMs}ms`);\n}\n\n/**\n * Get current task status\n */\nexport async function getTaskStatus(taskId: string): Promise<TaskStatusResponse> {\n  if (!USE_PLATFORM) {\n    // Mock completed task\n    return {\n      task_id: taskId,\n      trace_id: `mock-trace-${Date.now()}`,\n      status: 'completed',\n      progress: 100,\n      message: 'Mock task complete',\n      result: { success: true }\n    };\n  }\n\n  const res = await fetch(`${PLATFORM_BASE_URL}/api/tasks/${taskId}`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const errorText = await res.text();\n    throw new Error(`Task status fetch failed (${res.status}): ${errorText}`);\n  }\n\n  return await res.json();\n}\n\n/**\n * Map HITL mode to platform intent parameters\n */\nexport function mapHITLToIntentParams(hitlMode: boolean): { dry_run: boolean; explain_only: boolean } {\n  if (hitlMode) {\n    // HITL mode: explain only, don't execute\n    return {\n      dry_run: true,\n      explain_only: true\n    };\n  } else {\n    // Autonomous mode: execute immediately\n    return {\n      dry_run: false,\n      explain_only: false\n    };\n  }\n}\n","size_bytes":11982},"client/src/components/TaskStatusBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Loader2, CheckCircle2, XCircle, Clock } from \"lucide-react\";\nimport { TaskStatusResponse } from \"@/lib/aosClient\";\n\ninterface TaskStatusBadgeProps {\n  status: TaskStatusResponse | null;\n  className?: string;\n}\n\nexport function TaskStatusBadge({ status, className }: TaskStatusBadgeProps) {\n  if (!status) {\n    return null;\n  }\n\n  const getBadgeContent = () => {\n    switch (status.status) {\n      case 'pending':\n        return {\n          icon: <Clock className=\"w-3 h-3\" />,\n          text: 'Pending',\n          variant: 'secondary' as const,\n        };\n      case 'running':\n        return {\n          icon: <Loader2 className=\"w-3 h-3 animate-spin\" />,\n          text: `Running${status.progress ? ` ${status.progress}%` : ''}`,\n          variant: 'default' as const,\n        };\n      case 'completed':\n        return {\n          icon: <CheckCircle2 className=\"w-3 h-3\" />,\n          text: 'Completed',\n          variant: 'default' as const,\n          className: 'bg-green-500/20 text-green-400 border-green-500/30',\n        };\n      case 'failed':\n        return {\n          icon: <XCircle className=\"w-3 h-3\" />,\n          text: 'Failed',\n          variant: 'destructive' as const,\n        };\n      default:\n        return null;\n    }\n  };\n\n  const content = getBadgeContent();\n  if (!content) return null;\n\n  return (\n    <Badge\n      variant={content.variant}\n      className={`flex items-center gap-1.5 ${content.className || ''} ${className || ''}`}\n      data-testid={`badge-task-${status.status}`}\n    >\n      {content.icon}\n      <span className=\"text-xs\">{content.text}</span>\n    </Badge>\n  );\n}\n","size_bytes":1667},"server/middleware/auth.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\n\nexport interface JWTPayload {\n  userId: string;\n  username: string;\n  role: string;\n  tenantId?: string;\n  iat?: number; // Issued at (automatically added by jwt.sign)\n  exp?: number; // Expiration (automatically added by jwt.sign)\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: JWTPayload;\n    }\n  }\n}\n\nconst JWT_SECRET = process.env.JWT_SECRET || '';\n\n// Validate JWT_SECRET at module load - fail fast if missing or too short\nif (!JWT_SECRET || JWT_SECRET.length === 0) {\n  throw new Error(\n    'CRITICAL SECURITY ERROR: JWT_SECRET environment variable is not set.\\n' +\n    'Authentication cannot function without a secure JWT secret.\\n' +\n    'Please set JWT_SECRET to a random string of at least 32 characters.\\n' +\n    'Example: export JWT_SECRET=$(openssl rand -base64 32)'\n  );\n}\n\nif (JWT_SECRET.length < 32) {\n  throw new Error(\n    `CRITICAL SECURITY ERROR: JWT_SECRET is too short (${JWT_SECRET.length} characters).\\n` +\n    'JWT_SECRET must be at least 32 characters for security.\\n' +\n    'Please set JWT_SECRET to a random string of at least 32 characters.\\n' +\n    'Example: export JWT_SECRET=$(openssl rand -base64 32)'\n  );\n}\n\nconsole.log('‚úì JWT_SECRET validated successfully (length: ' + JWT_SECRET.length + ' characters)');\n\n/**\n * FUTURE SESSION SECURITY ENHANCEMENTS:\n * \n * 1. Refresh Token Rotation:\n *    - Implement separate refresh tokens with longer TTL (7-30 days)\n *    - Short-lived access tokens (15 min) + long-lived refresh tokens\n *    - Rotate refresh tokens on each use to prevent reuse attacks\n * \n * 2. Session Tracking Database:\n *    - Create sessions table to track active sessions\n *    - Store: sessionId, userId, tenantId, createdAt, lastActivityAt, ipAddress, userAgent\n *    - Enable server-side session revocation\n *    - Implement concurrent session limits per user\n * \n * 3. Inactivity Timeout:\n *    - Track last activity timestamp in session DB\n *    - Auto-expire sessions after 30 min of inactivity\n *    - Update lastActivityAt on each authenticated request\n * \n * 4. Secure Cookie-based Sessions (if migrating from header-based JWT):\n *    - httpOnly: true (prevent XSS)\n *    - secure: true (HTTPS only)\n *    - sameSite: 'strict' (CSRF protection)\n *    - signed cookies for integrity\n * \n * 5. Token Binding:\n *    - Bind tokens to specific IP addresses or user agents\n *    - Detect token theft via location/device changes\n *    - Require re-authentication on suspicious activity\n */\n\nexport function authenticateToken(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (!token) {\n    return res.status(401).json({ error: 'Authentication required' });\n  }\n\n  try {\n    const payload = jwt.verify(token, JWT_SECRET) as JWTPayload;\n    req.user = payload;\n    next();\n  } catch (error) {\n    return res.status(403).json({ error: 'Invalid or expired token' });\n  }\n}\n\nexport function optionalAuth(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (token) {\n    try {\n      const payload = jwt.verify(token, JWT_SECRET) as JWTPayload;\n      req.user = payload;\n    } catch (error) {\n      // Token is invalid, but we don't reject the request\n    }\n  }\n  \n  next();\n}\n\nexport function checkTokenAge(req: Request, res: Response, next: NextFunction) {\n  if (!req.user || !req.user.exp) {\n    return next();\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  const timeUntilExpiry = req.user.exp - now;\n  const fifteenMinutes = 15 * 60;\n\n  // Warn if token expires in less than 15 minutes\n  if (timeUntilExpiry < fifteenMinutes && timeUntilExpiry > 0) {\n    res.setHeader('X-Token-Expiring-Soon', 'true');\n    res.setHeader('X-Token-Expires-In', timeUntilExpiry.toString());\n  }\n\n  next();\n}\n\n/**\n * Enforce session timeout and absolute session age limits.\n * This middleware provides comprehensive session security by:\n * 1. Validating JWT token expiration (hard expiration)\n * 2. Enforcing maximum session age from issuance (absolute session duration)\n * 3. Warning clients when tokens are expiring soon\n * \n * Should be mounted globally after rate limiting but will gracefully skip\n * unauthenticated requests (where req.user is undefined).\n */\nexport function enforceSessionTimeout(req: Request, res: Response, next: NextFunction) {\n  // Step 1: Ensure req.user is defined (already authenticated)\n  if (!req.user) {\n    console.log(`[enforceSessionTimeout] Skipping - no authenticated user (path: ${req.path})`);\n    return next(); // Skip if not authenticated (shouldn't happen after authenticateToken)\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  const sessionAge = req.user.iat ? now - req.user.iat : 0;\n  const timeUntilExpiry = req.user.exp ? req.user.exp - now : 0;\n\n  console.log(`[enforceSessionTimeout] Checking session for user ${req.user.username} (path: ${req.path}, age: ${sessionAge}s, expiry: ${timeUntilExpiry}s)`);\n\n  // Step 2: Check if JWT token is expired (hard expiration)\n  if (!req.user.exp || req.user.exp <= now) {\n    console.error(`[enforceSessionTimeout] ‚ùå Token expired for user ${req.user.username} - returning 401`);\n    return res.status(401).json({\n      error: 'Session expired',\n      code: 'TOKEN_EXPIRED'\n    });\n  }\n\n  // Step 3: Check maximum session age (iat-based absolute session duration)\n  const MAX_SESSION_AGE = 2 * 60 * 60; // 2 hours (matches JWT TTL)\n  const issuedAt = req.user.iat ?? (req.user.exp - (2 * 60 * 60)); // Fallback if iat missing\n  \n  if (now - issuedAt > MAX_SESSION_AGE) {\n    console.error(`[enforceSessionTimeout] ‚ùå Session too old for user ${req.user.username} (age: ${now - issuedAt}s > max: ${MAX_SESSION_AGE}s) - returning 401`);\n    return res.status(401).json({\n      error: 'Session too old - please login again',\n      code: 'SESSION_TOO_OLD'\n    });\n  }\n\n  // Step 4: Set warning headers if token expiring soon (<15 minutes)\n  const FIFTEEN_MINUTES = 15 * 60;\n  \n  if (timeUntilExpiry < FIFTEEN_MINUTES && timeUntilExpiry > 0) {\n    console.warn(`[enforceSessionTimeout] ‚ö†Ô∏è  Token expiring soon for user ${req.user.username} (${timeUntilExpiry}s remaining)`);\n    res.setHeader('X-Token-Expiring-Soon', 'true');\n    res.setHeader('X-Token-Expires-In', timeUntilExpiry.toString());\n  }\n\n  // Step 5: Continue to next middleware\n  console.log(`[enforceSessionTimeout] ‚úì Session valid for user ${req.user.username} - continuing to next middleware`);\n  next();\n}\n\nconst roleHierarchy: Record<string, number> = {\n  'readonly': 1,\n  'user': 2,\n  'admin': 3,\n  'cfo': 3,\n  'Head of Cloud Platform': 3\n};\n\nexport function requireRole(minRole: string) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    const userRoleLevel = roleHierarchy[req.user.role] || 0;\n    const requiredRoleLevel = roleHierarchy[minRole] || 999;\n\n    if (userRoleLevel < requiredRoleLevel) {\n      return res.status(403).json({ \n        error: 'Insufficient permissions',\n        required: minRole,\n        current: req.user.role\n      });\n    }\n\n    next();\n  };\n}\n\nexport function generateToken(payload: Omit<JWTPayload, 'iat' | 'exp'>): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '2h' });\n}\n","size_bytes":7500},"test-platform-integration.ts":{"content":"/**\n * Platform Integration Test Script\n * Tests safe-mode platform wiring with explain_only + dry_run\n */\n\nimport { getView, postIntent, AOS_CONFIG } from './client/src/lib/aosClient';\n\ninterface TestResult {\n  step: string;\n  status: 'PASS' | 'FAIL' | 'FALLBACK';\n  message: string;\n  data?: any;\n}\n\nconst results: TestResult[] = [];\n\nasync function runTests() {\n  console.log('='.repeat(60));\n  console.log('PLATFORM INTEGRATION TEST - SAFE MODE');\n  console.log('='.repeat(60));\n  console.log(`AOS_BASE_URL: ${AOS_CONFIG.baseUrl}`);\n  console.log(`USE_PLATFORM flag location: client/src/lib/aosClient.ts:7`);\n  console.log(`Current USE_PLATFORM value: ${AOS_CONFIG.usePlatform}`);\n  console.log('='.repeat(60));\n  console.log('');\n\n  // Step 1: Baseline test with USE_PLATFORM=false\n  console.log('STEP 1: Baseline test (USE_PLATFORM=false)');\n  console.log('-'.repeat(60));\n  \n  if (!AOS_CONFIG.usePlatform) {\n    console.log('‚úì USE_PLATFORM is false - testing local fallback...');\n    \n    try {\n      const accountsView = await getView('accounts');\n      if (accountsView.data && Array.isArray(accountsView.data)) {\n        results.push({\n          step: 'Baseline - Local Fallback',\n          status: 'PASS',\n          message: `Retrieved ${accountsView.data.length} resources from local API`,\n          data: { trace_id: accountsView.trace_id }\n        });\n        console.log(`‚úì Baseline OK - Retrieved ${accountsView.data.length} resources`);\n        console.log(`  Trace ID: ${accountsView.trace_id}`);\n      } else {\n        results.push({\n          step: 'Baseline - Local Fallback',\n          status: 'FAIL',\n          message: 'Invalid data structure received'\n        });\n        console.log('‚úó Baseline FAIL - Invalid data structure');\n      }\n    } catch (error) {\n      results.push({\n        step: 'Baseline - Local Fallback',\n        status: 'FAIL',\n        message: `Error: ${error instanceof Error ? error.message : String(error)}`\n      });\n      console.log(`‚úó Baseline FAIL - ${error instanceof Error ? error.message : String(error)}`);\n    }\n  } else {\n    console.log('‚äó Skipping baseline (USE_PLATFORM is already true)');\n  }\n  \n  console.log('');\n\n  // Step 2: Platform view fetch test\n  console.log('STEP 2: Platform view fetch test');\n  console.log('-'.repeat(60));\n  \n  try {\n    // Note: This will use fallback if USE_PLATFORM=false\n    const response = await fetch(`${AOS_CONFIG.baseUrl}/api/v1/dcl/views/accounts`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      results.push({\n        step: 'Platform View Fetch',\n        status: 'PASS',\n        message: `Successfully fetched from platform (${response.status})`,\n        data: { trace_id: data.trace_id || 'none' }\n      });\n      console.log(`‚úì Platform fetch OK - Status: ${response.status}`);\n      console.log(`  Response: ${JSON.stringify(data).substring(0, 100)}...`);\n    } else {\n      results.push({\n        step: 'Platform View Fetch',\n        status: 'FALLBACK',\n        message: `Platform returned ${response.status}, falling back to local`\n      });\n      console.log(`‚äó Platform unavailable (${response.status}) - Fallback engaged`);\n    }\n  } catch (error) {\n    results.push({\n      step: 'Platform View Fetch',\n      status: 'FALLBACK',\n      message: `Network error: ${error instanceof Error ? error.message : String(error)}`\n    });\n    console.log(`‚äó Network error - Fallback engaged`);\n    console.log(`  Error: ${error instanceof Error ? error.message : String(error)}`);\n  }\n\n  console.log('');\n\n  // Step 3: Safe intent execution test (explain_only + dry_run)\n  console.log('STEP 3: Safe intent execution (explain_only + dry_run)');\n  console.log('-'.repeat(60));\n  \n  try {\n    const intentResponse = await fetch(`${AOS_CONFIG.baseUrl}/api/v1/intents/finops/execute`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Idempotency-Key': `test-${Date.now()}`,\n      },\n      body: JSON.stringify({\n        intent: 'noop',\n        explain_only: true,\n        dry_run: true,\n        metadata: {\n          test: true,\n          source: 'platform-integration-test'\n        }\n      }),\n    });\n\n    if (intentResponse.ok) {\n      const intentData = await intentResponse.json();\n      results.push({\n        step: 'Safe Intent Execution',\n        status: 'PASS',\n        message: 'Intent posted successfully',\n        data: {\n          task_id: intentData.task_id,\n          trace_id: intentData.trace_id,\n          status: intentData.status\n        }\n      });\n      console.log(`‚úì Intent execution OK`);\n      console.log(`  Task ID: ${intentData.task_id}`);\n      console.log(`  Trace ID: ${intentData.trace_id}`);\n      console.log(`  Status: ${intentData.status}`);\n      console.log(`  Full response: ${JSON.stringify(intentData, null, 2)}`);\n    } else {\n      const errorText = await intentResponse.text();\n      results.push({\n        step: 'Safe Intent Execution',\n        status: 'FALLBACK',\n        message: `Platform returned ${intentResponse.status}`,\n        data: { error: errorText }\n      });\n      console.log(`‚äó Intent failed (${intentResponse.status}) - Fallback engaged`);\n      console.log(`  Error: ${errorText}`);\n    }\n  } catch (error) {\n    results.push({\n      step: 'Safe Intent Execution',\n      status: 'FALLBACK',\n      message: `Network error: ${error instanceof Error ? error.message : String(error)}`\n    });\n    console.log(`‚äó Network error - Fallback engaged`);\n    console.log(`  Error: ${error instanceof Error ? error.message : String(error)}`);\n  }\n\n  console.log('');\n\n  // Summary\n  console.log('='.repeat(60));\n  console.log('TEST SUMMARY');\n  console.log('='.repeat(60));\n  \n  const passCount = results.filter(r => r.status === 'PASS').length;\n  const failCount = results.filter(r => r.status === 'FAIL').length;\n  const fallbackCount = results.filter(r => r.status === 'FALLBACK').length;\n  \n  results.forEach((result, index) => {\n    const icon = result.status === 'PASS' ? '‚úì' : result.status === 'FAIL' ? '‚úó' : '‚äó';\n    console.log(`${icon} ${result.step}: ${result.status}`);\n    console.log(`  ${result.message}`);\n    if (result.data) {\n      console.log(`  Data: ${JSON.stringify(result.data)}`);\n    }\n  });\n  \n  console.log('');\n  console.log(`Total: ${results.length} tests`);\n  console.log(`Passed: ${passCount}`);\n  console.log(`Failed: ${failCount}`);\n  console.log(`Fallback: ${fallbackCount}`);\n  \n  const overallStatus = failCount === 0 ? 'PASS' : 'FAIL';\n  console.log('');\n  console.log(`OVERALL: ${overallStatus}`);\n  console.log('='.repeat(60));\n  \n  return results;\n}\n\n// Run tests\nrunTests().catch(error => {\n  console.error('Test execution failed:', error);\n  process.exit(1);\n});\n","size_bytes":6854},"test-platform.js":{"content":"/**\n * Platform Integration Test - Safe Mode\n * Tests explain_only + dry_run (non-destructive)\n */\n\nconst AOS_BASE_URL = 'https://autonomos-platform.replit.app';\nconst USE_PLATFORM = process.env.VITE_USE_PLATFORM === 'true';\n\nconst results = [];\n\nasync function testPlatformIntegration() {\n  console.log('='.repeat(60));\n  console.log('PLATFORM INTEGRATION TEST - SAFE MODE');\n  console.log('='.repeat(60));\n  console.log(`AOS_BASE_URL: ${AOS_BASE_URL}`);\n  console.log(`USE_PLATFORM flag location: client/src/lib/aosClient.ts:7`);\n  console.log(`Current USE_PLATFORM value: ${USE_PLATFORM}`);\n  console.log('='.repeat(60));\n  console.log('');\n\n  // Step 1: Baseline test\n  console.log('STEP 1: Baseline test (local API)');\n  console.log('-'.repeat(60));\n  \n  try {\n    const response = await fetch('http://localhost:5000/api/aws-resources');\n    if (response.ok) {\n      const data = await response.json();\n      results.push({ step: 'Baseline', status: 'PASS', message: `Local API OK - ${data.length} resources` });\n      console.log(`‚úì Baseline OK - Retrieved ${data.length} resources from local API`);\n    } else {\n      results.push({ step: 'Baseline', status: 'FAIL', message: `Local API returned ${response.status}` });\n      console.log(`‚úó Baseline FAIL - Status ${response.status}`);\n    }\n  } catch (error) {\n    results.push({ step: 'Baseline', status: 'FAIL', message: error.message });\n    console.log(`‚úó Baseline FAIL - ${error.message}`);\n  }\n  \n  console.log('');\n\n  // Step 2: Platform view fetch\n  console.log('STEP 2: Platform view fetch');\n  console.log('-'.repeat(60));\n  \n  try {\n    const response = await fetch(`${AOS_BASE_URL}/api/v1/dcl/views/accounts`, {\n      method: 'GET',\n      headers: { 'Content-Type': 'application/json' }\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      results.push({ \n        step: 'View Fetch', \n        status: 'PASS', \n        message: `Platform OK (${response.status})`,\n        data: { trace_id: data.trace_id || 'none' }\n      });\n      console.log(`‚úì Platform fetch OK - Status: ${response.status}`);\n      console.log(`  Response snippet: ${JSON.stringify(data).substring(0, 100)}...`);\n    } else {\n      const errorText = await response.text();\n      results.push({ step: 'View Fetch', status: 'FALLBACK', message: `Status ${response.status}` });\n      console.log(`‚äó Platform unavailable (${response.status}) - Fallback engaged`);\n      console.log(`  Error: ${errorText.substring(0, 200)}`);\n    }\n  } catch (error) {\n    results.push({ step: 'View Fetch', status: 'FALLBACK', message: error.message });\n    console.log(`‚äó Network error - Fallback engaged`);\n    console.log(`  Error: ${error.message}`);\n  }\n\n  console.log('');\n\n  // Step 3: Safe intent execution\n  console.log('STEP 3: Safe intent execution (explain_only + dry_run)');\n  console.log('-'.repeat(60));\n  \n  try {\n    const response = await fetch(`${AOS_BASE_URL}/api/v1/intents/finops/execute`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Idempotency-Key': `test-${Date.now()}`\n      },\n      body: JSON.stringify({\n        intent: 'noop',\n        explain_only: true,\n        dry_run: true,\n        metadata: {\n          test: true,\n          source: 'platform-integration-test'\n        }\n      })\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      results.push({\n        step: 'Safe Intent',\n        status: 'PASS',\n        message: 'Intent posted successfully',\n        data: {\n          task_id: data.task_id,\n          trace_id: data.trace_id,\n          status: data.status\n        }\n      });\n      console.log(`‚úì Intent execution OK`);\n      console.log(`  Task ID: ${data.task_id}`);\n      console.log(`  Trace ID: ${data.trace_id}`);\n      console.log(`  Status: ${data.status}`);\n      console.log(`  Full response:`);\n      console.log(JSON.stringify(data, null, 2));\n    } else {\n      const errorText = await response.text();\n      results.push({ step: 'Safe Intent', status: 'FALLBACK', message: `Status ${response.status}` });\n      console.log(`‚äó Intent failed (${response.status}) - Fallback engaged`);\n      console.log(`  Error: ${errorText.substring(0, 200)}`);\n    }\n  } catch (error) {\n    results.push({ step: 'Safe Intent', status: 'FALLBACK', message: error.message });\n    console.log(`‚äó Network error - Fallback engaged`);\n    console.log(`  Error: ${error.message}`);\n  }\n\n  console.log('');\n\n  // Summary\n  console.log('='.repeat(60));\n  console.log('TEST SUMMARY');\n  console.log('='.repeat(60));\n  \n  const passCount = results.filter(r => r.status === 'PASS').length;\n  const failCount = results.filter(r => r.status === 'FAIL').length;\n  const fallbackCount = results.filter(r => r.status === 'FALLBACK').length;\n  \n  results.forEach(result => {\n    const icon = result.status === 'PASS' ? '‚úì' : result.status === 'FAIL' ? '‚úó' : '‚äó';\n    console.log(`${icon} ${result.step}: ${result.status}`);\n    console.log(`  ${result.message}`);\n    if (result.data) {\n      console.log(`  Data: ${JSON.stringify(result.data)}`);\n    }\n  });\n  \n  console.log('');\n  console.log(`Total: ${results.length} tests`);\n  console.log(`Passed: ${passCount}`);\n  console.log(`Failed: ${failCount}`);\n  console.log(`Fallback: ${fallbackCount}`);\n  \n  const overallStatus = failCount === 0 ? 'PASS' : 'FAIL';\n  console.log('');\n  console.log(`OVERALL: ${overallStatus}`);\n  console.log('='.repeat(60));\n}\n\ntestPlatformIntegration().catch(error => {\n  console.error('Test execution failed:', error);\n  process.exit(1);\n});\n","size_bytes":5598},"server/lib/retry.ts":{"content":"/**\n * Retry utility with exponential backoff\n * Provides configurable retry logic for resilient API calls\n */\n\nexport interface RetryOptions {\n  maxRetries?: number;\n  baseDelay?: number;\n  maxDelay?: number;\n  retryableErrors?: (error: any) => boolean;\n  onRetry?: (attempt: number, error: any, delay: number) => void;\n}\n\nexport interface RetryResult<T> {\n  success: boolean;\n  data?: T;\n  error?: any;\n  attempts: number;\n}\n\n/**\n * Default retryable error checker\n * Retries on network errors and 5xx server errors, but not 4xx client errors\n */\nfunction defaultRetryableErrors(error: any): boolean {\n  // Network errors (no response)\n  if (!error.response && (error.code === 'ECONNREFUSED' || error.code === 'ETIMEDOUT' || error.message?.includes('fetch failed'))) {\n    return true;\n  }\n  \n  // HTTP 5xx errors\n  if (error.response?.status >= 500 && error.response?.status < 600) {\n    return true;\n  }\n  \n  // HTTP status from fetch Response object\n  if (error.status >= 500 && error.status < 600) {\n    return true;\n  }\n  \n  // Don't retry 4xx client errors\n  return false;\n}\n\n/**\n * Execute a function with exponential backoff retry logic\n * \n * @param fn - The async function to execute\n * @param options - Retry configuration options\n * @returns Promise with retry result including success status, data, and attempt count\n */\nexport async function retry<T>(\n  fn: () => Promise<T>,\n  options: RetryOptions = {}\n): Promise<RetryResult<T>> {\n  const {\n    maxRetries = 3,\n    baseDelay = 1000,\n    maxDelay = 10000,\n    retryableErrors = defaultRetryableErrors,\n    onRetry\n  } = options;\n\n  let lastError: any;\n  \n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      const data = await fn();\n      return {\n        success: true,\n        data,\n        attempts: attempt + 1\n      };\n    } catch (error) {\n      lastError = error;\n      \n      // Don't retry if we've exhausted attempts or error is not retryable\n      if (attempt === maxRetries || !retryableErrors(error)) {\n        console.error(`[Retry] Failed after ${attempt + 1} attempts (non-retryable or max retries reached):`, error);\n        return {\n          success: false,\n          error,\n          attempts: attempt + 1\n        };\n      }\n      \n      // Calculate exponential backoff delay with jitter\n      const exponentialDelay = Math.min(baseDelay * Math.pow(2, attempt), maxDelay);\n      const jitter = Math.random() * 0.3 * exponentialDelay; // Add up to 30% jitter\n      const delay = exponentialDelay + jitter;\n      \n      console.log(`[Retry] Attempt ${attempt + 1}/${maxRetries + 1} failed, retrying in ${Math.round(delay)}ms:`, error.message || error);\n      \n      if (onRetry) {\n        onRetry(attempt + 1, error, delay);\n      }\n      \n      // Wait before retrying\n      await new Promise(resolve => setTimeout(resolve, delay));\n    }\n  }\n  \n  // Should never reach here, but TypeScript needs it\n  return {\n    success: false,\n    error: lastError,\n    attempts: maxRetries + 1\n  };\n}\n\n/**\n * Helper to create a retry wrapper for a specific function\n * Useful for creating pre-configured retry functions\n */\nexport function createRetryWrapper<T extends any[], R>(\n  fn: (...args: T) => Promise<R>,\n  options: RetryOptions = {}\n): (...args: T) => Promise<R> {\n  return async (...args: T): Promise<R> => {\n    const result = await retry(() => fn(...args), options);\n    if (!result.success) {\n      throw result.error;\n    }\n    return result.data as R;\n  };\n}\n","size_bytes":3474},"server/lib/circuit-breaker.ts":{"content":"/**\n * Circuit Breaker Pattern Implementation\n * Protects external service calls from cascading failures\n */\n\nexport enum CircuitState {\n  CLOSED = 'CLOSED',     // Normal operation\n  OPEN = 'OPEN',         // Failing, reject calls immediately\n  HALF_OPEN = 'HALF_OPEN' // Testing if service recovered\n}\n\nexport interface CircuitBreakerOptions {\n  failureThreshold?: number;      // Number of failures before opening\n  successThreshold?: number;      // Number of successes in HALF_OPEN to close\n  timeout?: number;               // Time in ms before trying HALF_OPEN\n  onStateChange?: (oldState: CircuitState, newState: CircuitState) => void;\n  onOpen?: () => void;\n  onClose?: () => void;\n}\n\nexport class CircuitBreakerError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'CircuitBreakerError';\n  }\n}\n\n/**\n * Circuit Breaker for protecting external service calls\n * \n * States:\n * - CLOSED: Normal operation, calls go through\n * - OPEN: Service is failing, calls rejected immediately\n * - HALF_OPEN: Testing if service recovered, limited calls allowed\n */\nexport class CircuitBreaker {\n  private state: CircuitState = CircuitState.CLOSED;\n  private failureCount: number = 0;\n  private successCount: number = 0;\n  private lastFailureTime: number | null = null;\n  private nextAttemptTime: number | null = null;\n  \n  private readonly failureThreshold: number;\n  private readonly successThreshold: number;\n  private readonly timeout: number;\n  private readonly onStateChange?: (oldState: CircuitState, newState: CircuitState) => void;\n  private readonly onOpen?: () => void;\n  private readonly onClose?: () => void;\n  \n  constructor(\n    private name: string,\n    options: CircuitBreakerOptions = {}\n  ) {\n    this.failureThreshold = options.failureThreshold ?? 5;\n    this.successThreshold = options.successThreshold ?? 2;\n    this.timeout = options.timeout ?? 30000; // 30 seconds default\n    this.onStateChange = options.onStateChange;\n    this.onOpen = options.onOpen;\n    this.onClose = options.onClose;\n  }\n  \n  /**\n   * Execute a function through the circuit breaker\n   */\n  async execute<T>(fn: () => Promise<T>): Promise<T> {\n    if (this.state === CircuitState.OPEN) {\n      // Check if we should try HALF_OPEN\n      if (this.nextAttemptTime && Date.now() >= this.nextAttemptTime) {\n        this.transitionTo(CircuitState.HALF_OPEN);\n      } else {\n        const waitTime = this.nextAttemptTime ? Math.round((this.nextAttemptTime - Date.now()) / 1000) : 0;\n        throw new CircuitBreakerError(\n          `Circuit breaker [${this.name}] is OPEN. Service unavailable. Retry in ${waitTime}s.`\n        );\n      }\n    }\n    \n    try {\n      const result = await fn();\n      this.onSuccess();\n      return result;\n    } catch (error) {\n      this.onFailure();\n      throw error;\n    }\n  }\n  \n  /**\n   * Execute with graceful degradation - returns null on failure instead of throwing\n   */\n  async executeWithFallback<T>(fn: () => Promise<T>, fallbackValue: T | null = null): Promise<T | null> {\n    try {\n      return await this.execute(fn);\n    } catch (error) {\n      if (error instanceof CircuitBreakerError) {\n        console.warn(`[CircuitBreaker:${this.name}] Circuit is OPEN, using fallback value`);\n        return fallbackValue;\n      }\n      throw error;\n    }\n  }\n  \n  /**\n   * Handle successful execution\n   */\n  private onSuccess(): void {\n    this.failureCount = 0;\n    \n    if (this.state === CircuitState.HALF_OPEN) {\n      this.successCount++;\n      if (this.successCount >= this.successThreshold) {\n        this.transitionTo(CircuitState.CLOSED);\n        this.successCount = 0;\n      }\n    }\n  }\n  \n  /**\n   * Handle failed execution\n   */\n  private onFailure(): void {\n    this.failureCount++;\n    this.lastFailureTime = Date.now();\n    this.successCount = 0; // Reset success count on any failure\n    \n    if (this.state === CircuitState.HALF_OPEN) {\n      // Any failure in HALF_OPEN immediately opens the circuit\n      this.transitionTo(CircuitState.OPEN);\n    } else if (this.failureCount >= this.failureThreshold) {\n      this.transitionTo(CircuitState.OPEN);\n    }\n  }\n  \n  /**\n   * Transition to a new state\n   */\n  private transitionTo(newState: CircuitState): void {\n    if (this.state === newState) return;\n    \n    const oldState = this.state;\n    this.state = newState;\n    \n    console.log(`[CircuitBreaker:${this.name}] State transition: ${oldState} -> ${newState}`);\n    \n    if (newState === CircuitState.OPEN) {\n      this.nextAttemptTime = Date.now() + this.timeout;\n      console.warn(\n        `[CircuitBreaker:${this.name}] Circuit OPEN after ${this.failureCount} failures. ` +\n        `Will retry in ${this.timeout / 1000}s`\n      );\n      if (this.onOpen) this.onOpen();\n    } else if (newState === CircuitState.CLOSED) {\n      this.failureCount = 0;\n      this.nextAttemptTime = null;\n      console.log(`[CircuitBreaker:${this.name}] Circuit CLOSED. Service recovered.`);\n      if (this.onClose) this.onClose();\n    } else if (newState === CircuitState.HALF_OPEN) {\n      console.log(`[CircuitBreaker:${this.name}] Circuit HALF_OPEN. Testing service recovery...`);\n    }\n    \n    if (this.onStateChange) {\n      this.onStateChange(oldState, newState);\n    }\n  }\n  \n  /**\n   * Get current circuit state\n   */\n  getState(): CircuitState {\n    return this.state;\n  }\n  \n  /**\n   * Get circuit statistics\n   */\n  getStats() {\n    return {\n      state: this.state,\n      failureCount: this.failureCount,\n      successCount: this.successCount,\n      lastFailureTime: this.lastFailureTime,\n      nextAttemptTime: this.nextAttemptTime\n    };\n  }\n  \n  /**\n   * Manually reset the circuit breaker\n   */\n  reset(): void {\n    this.transitionTo(CircuitState.CLOSED);\n    this.failureCount = 0;\n    this.successCount = 0;\n    this.lastFailureTime = null;\n    this.nextAttemptTime = null;\n  }\n}\n","size_bytes":5864},"server/services/logger.ts":{"content":"import { Request } from 'express';\n\nexport enum LogLevel {\n  ERROR = 'ERROR',\n  WARN = 'WARN',\n  INFO = 'INFO',\n  DEBUG = 'DEBUG'\n}\n\ninterface LogContext {\n  requestId?: string;\n  userId?: string;\n  method?: string;\n  path?: string;\n  [key: string]: any;\n}\n\ninterface LogEntry {\n  timestamp: string;\n  level: LogLevel;\n  message: string;\n  context?: LogContext;\n  error?: {\n    name: string;\n    message: string;\n    stack?: string;\n  };\n}\n\nclass Logger {\n  private isDevelopment: boolean;\n\n  constructor() {\n    this.isDevelopment = process.env.NODE_ENV !== 'production';\n  }\n\n  private formatLog(entry: LogEntry): string {\n    if (this.isDevelopment) {\n      const timestamp = new Date(entry.timestamp).toLocaleTimeString();\n      const level = entry.level.padEnd(5);\n      const contextStr = entry.context \n        ? ` [${Object.entries(entry.context)\n            .filter(([k]) => k !== 'requestId' && k !== 'userId')\n            .map(([k, v]) => `${k}=${v}`)\n            .join(', ')}]` \n        : '';\n      const requestInfo = entry.context?.requestId \n        ? ` [reqId=${entry.context.requestId}]` \n        : '';\n      const userInfo = entry.context?.userId \n        ? ` [userId=${entry.context.userId}]` \n        : '';\n      \n      let output = `${timestamp} ${level} ${entry.message}${requestInfo}${userInfo}${contextStr}`;\n      \n      if (entry.error) {\n        output += `\\n  Error: ${entry.error.message}`;\n        if (entry.error.stack && this.isDevelopment) {\n          output += `\\n${entry.error.stack}`;\n        }\n      }\n      \n      return output;\n    } else {\n      return JSON.stringify(entry);\n    }\n  }\n\n  private log(level: LogLevel, message: string, context?: LogContext, error?: Error): void {\n    const entry: LogEntry = {\n      timestamp: new Date().toISOString(),\n      level,\n      message,\n      context\n    };\n\n    if (error) {\n      entry.error = {\n        name: error.name,\n        message: error.message,\n        stack: error.stack\n      };\n    }\n\n    const formatted = this.formatLog(entry);\n    \n    switch (level) {\n      case LogLevel.ERROR:\n        console.error(formatted);\n        break;\n      case LogLevel.WARN:\n        console.warn(formatted);\n        break;\n      case LogLevel.INFO:\n        console.info(formatted);\n        break;\n      case LogLevel.DEBUG:\n        if (this.isDevelopment) {\n          console.debug(formatted);\n        }\n        break;\n    }\n  }\n\n  error(message: string, context?: LogContext, error?: Error): void {\n    this.log(LogLevel.ERROR, message, context, error);\n  }\n\n  warn(message: string, context?: LogContext): void {\n    this.log(LogLevel.WARN, message, context);\n  }\n\n  info(message: string, context?: LogContext): void {\n    this.log(LogLevel.INFO, message, context);\n  }\n\n  debug(message: string, context?: LogContext): void {\n    this.log(LogLevel.DEBUG, message, context);\n  }\n\n  withRequest(req: Request): RequestLogger {\n    return new RequestLogger(this, req);\n  }\n}\n\nclass RequestLogger {\n  private logger: Logger;\n  private context: LogContext;\n\n  constructor(logger: Logger, req: Request) {\n    this.logger = logger;\n    this.context = {\n      requestId: (req as any).requestId,\n      userId: req.user?.userId,\n      method: req.method,\n      path: req.path\n    };\n  }\n\n  error(message: string, additionalContext?: Record<string, any>, error?: Error): void {\n    this.logger.error(message, { ...this.context, ...additionalContext }, error);\n  }\n\n  warn(message: string, additionalContext?: Record<string, any>): void {\n    this.logger.warn(message, { ...this.context, ...additionalContext });\n  }\n\n  info(message: string, additionalContext?: Record<string, any>): void {\n    this.logger.info(message, { ...this.context, ...additionalContext });\n  }\n\n  debug(message: string, additionalContext?: Record<string, any>): void {\n    this.logger.debug(message, { ...this.context, ...additionalContext });\n  }\n}\n\nexport const logger = new Logger();\n","size_bytes":3931},"server/middleware/rate-limit.ts":{"content":"import { Request, Response } from 'express';\nimport rateLimit from 'express-rate-limit';\nimport { logger } from '../services/logger';\n\n/**\n * PRODUCTION NOTE: For production deployments, consider using an external store like Redis\n * instead of the default memory store to enable rate limiting across multiple server instances.\n * \n * Example with Redis:\n * import RedisStore from 'rate-limit-redis';\n * import { createClient } from 'redis';\n * \n * const redisClient = createClient({ url: process.env.REDIS_URL });\n * const store = new RedisStore({ client: redisClient, prefix: 'rl:' });\n * \n * Then add `store` to each rateLimit() configuration below.\n * \n * The memory store works fine for development and single-instance deployments,\n * and automatically cleans up expired entries.\n */\n\nconst customRateLimitHandler = (req: Request, res: Response) => {\n  const ip = req.ip || req.socket.remoteAddress || 'unknown';\n  const method = req.method;\n  const path = req.path;\n  const userAgent = req.get('user-agent') || 'unknown';\n  \n  logger.warn('Rate limit exceeded', {\n    requestId: req.requestId,\n    ip,\n    method,\n    path,\n    userAgent,\n    userId: req.user?.userId\n  });\n\n  res.status(429).json({\n    error: 'Too many requests',\n    message: 'You have exceeded the rate limit. Please try again later.',\n    retryAfter: res.getHeader('Retry-After')\n  });\n};\n\nexport const generalApiLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 minute\n  max: 300, // 300 requests per minute (allows ~5 req/sec sustained)\n  message: {\n    error: 'Too many requests from this IP',\n    message: 'Please slow down and try again in a moment'\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n  handler: customRateLimitHandler,\n  skip: (req) => {\n    return req.path === '/api/health' || req.path === '/api/health/detailed';\n  }\n});\n\nexport const authLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 5,\n  message: {\n    error: 'Too many authentication attempts',\n    message: 'Please try again after 15 minutes'\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n  handler: customRateLimitHandler,\n  skipSuccessfulRequests: true\n});\n\nexport const writeLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 50,\n  message: {\n    error: 'Too many write operations',\n    message: 'Please try again after 15 minutes'\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n  handler: customRateLimitHandler,\n  skip: (req) => {\n    return req.method === 'GET' || req.method === 'HEAD' || req.method === 'OPTIONS';\n  }\n});\n\nexport const readLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 minute\n  max: 200, // 200 requests per minute (allows ~3 req/sec sustained)\n  message: {\n    error: 'Too many read operations',\n    message: 'Please slow down and try again in a moment'\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n  handler: customRateLimitHandler,\n  skip: (req) => {\n    return req.method !== 'GET' && req.method !== 'HEAD';\n  }\n});\n","size_bytes":2949},"server/middleware/logging.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { randomUUID } from 'crypto';\nimport { logger } from '../services/logger';\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      requestId: string;\n    }\n  }\n}\n\nexport function loggingMiddleware(req: Request, res: Response, next: NextFunction): void {\n  const requestId = randomUUID();\n  req.requestId = requestId;\n\n  const start = Date.now();\n  const { method, path, ip } = req;\n  const userAgent = req.get('user-agent') || 'unknown';\n\n  logger.info('Request started', {\n    requestId,\n    method,\n    path,\n    ip,\n    userAgent,\n    userId: req.user?.userId\n  });\n\n  const originalJson = res.json;\n  let responseBody: any;\n\n  res.json = function(body: any) {\n    responseBody = body;\n    return originalJson.call(this, body);\n  };\n\n  res.on('finish', () => {\n    const duration = Date.now() - start;\n    const { statusCode } = res;\n\n    const logContext = {\n      requestId,\n      method,\n      path,\n      statusCode,\n      duration,\n      userId: req.user?.userId\n    };\n\n    if (statusCode >= 500) {\n      logger.error('Request failed', logContext);\n    } else if (statusCode >= 400) {\n      logger.warn('Request completed with client error', logContext);\n    } else {\n      logger.info('Request completed', logContext);\n    }\n  });\n\n  res.on('error', (error: Error) => {\n    logger.error('Response error', {\n      requestId,\n      method,\n      path,\n      userId: req.user?.userId\n    }, error);\n  });\n\n  next();\n}\n","size_bytes":1505},"server/services/audit.ts":{"content":"import { db } from '../db';\nimport { auditLogs, type InsertAuditLog } from '@shared/schema';\nimport { logger } from './logger';\n\nexport enum AuditAction {\n  CREATE = 'CREATE',\n  UPDATE = 'UPDATE',\n  DELETE = 'DELETE',\n  APPROVE = 'APPROVE',\n  REJECT = 'REJECT',\n  EXECUTE = 'EXECUTE'\n}\n\nexport interface AuditLogData {\n  requestId: string;\n  userId?: string;\n  action: AuditAction;\n  resourceType: string;\n  resourceId?: string;\n  changes?: Record<string, any>;\n  metadata?: Record<string, any>;\n  ipAddress?: string;\n  userAgent?: string;\n}\n\nclass AuditService {\n  private static instance: AuditService;\n\n  private constructor() {}\n\n  static getInstance(): AuditService {\n    if (!AuditService.instance) {\n      AuditService.instance = new AuditService();\n    }\n    return AuditService.instance;\n  }\n\n  async log(data: AuditLogData): Promise<void> {\n    try {\n      const auditLogEntry: InsertAuditLog = {\n        requestId: data.requestId,\n        userId: data.userId,\n        action: data.action,\n        resourceType: data.resourceType,\n        resourceId: data.resourceId,\n        changes: data.changes,\n        metadata: data.metadata,\n        ipAddress: data.ipAddress,\n        userAgent: data.userAgent\n      };\n\n      await db.insert(auditLogs).values(auditLogEntry);\n\n      logger.debug('Audit log created', {\n        requestId: data.requestId,\n        action: data.action,\n        resourceType: data.resourceType,\n        resourceId: data.resourceId\n      });\n    } catch (error) {\n      logger.error('Failed to create audit log', {\n        requestId: data.requestId,\n        action: data.action,\n        resourceType: data.resourceType\n      }, error as Error);\n    }\n  }\n\n  async logCreate(\n    requestId: string,\n    userId: string | undefined,\n    resourceType: string,\n    resourceId: string,\n    resourceData: Record<string, any>,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.log({\n      requestId,\n      userId,\n      action: AuditAction.CREATE,\n      resourceType,\n      resourceId,\n      changes: { created: resourceData },\n      metadata\n    });\n  }\n\n  async logUpdate(\n    requestId: string,\n    userId: string | undefined,\n    resourceType: string,\n    resourceId: string,\n    oldData: Record<string, any>,\n    newData: Record<string, any>,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    const changes: Record<string, any> = {};\n    \n    for (const key in newData) {\n      if (oldData[key] !== newData[key]) {\n        changes[key] = {\n          old: oldData[key],\n          new: newData[key]\n        };\n      }\n    }\n\n    await this.log({\n      requestId,\n      userId,\n      action: AuditAction.UPDATE,\n      resourceType,\n      resourceId,\n      changes,\n      metadata\n    });\n  }\n\n  async logDelete(\n    requestId: string,\n    userId: string | undefined,\n    resourceType: string,\n    resourceId: string,\n    resourceData: Record<string, any>,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.log({\n      requestId,\n      userId,\n      action: AuditAction.DELETE,\n      resourceType,\n      resourceId,\n      changes: { deleted: resourceData },\n      metadata\n    });\n  }\n\n  async logApprove(\n    requestId: string,\n    userId: string | undefined,\n    resourceType: string,\n    resourceId: string,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.log({\n      requestId,\n      userId,\n      action: AuditAction.APPROVE,\n      resourceType,\n      resourceId,\n      metadata\n    });\n  }\n\n  async logReject(\n    requestId: string,\n    userId: string | undefined,\n    resourceType: string,\n    resourceId: string,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.log({\n      requestId,\n      userId,\n      action: AuditAction.REJECT,\n      resourceType,\n      resourceId,\n      metadata\n    });\n  }\n\n  async logExecute(\n    requestId: string,\n    userId: string | undefined,\n    resourceType: string,\n    resourceId: string,\n    executionDetails: Record<string, any>,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.log({\n      requestId,\n      userId,\n      action: AuditAction.EXECUTE,\n      resourceType,\n      resourceId,\n      changes: executionDetails,\n      metadata\n    });\n  }\n}\n\nexport const auditService = AuditService.getInstance();\n","size_bytes":4294},"server/middleware/cors.ts":{"content":"import cors from 'cors';\nimport { logger } from '../services/logger';\n\nconst ALLOWED_ORIGINS = process.env.ALLOWED_ORIGINS\n  ? process.env.ALLOWED_ORIGINS.split(',').map(origin => origin.trim())\n  : [];\n\nconst isDevelopment = process.env.NODE_ENV !== 'production';\n\nconst developmentCorsOptions: cors.CorsOptions = {\n  origin: true,\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],\n  exposedHeaders: ['X-Request-Id'],\n  maxAge: 86400, // 24 hours\n};\n\nconst productionCorsOptions: cors.CorsOptions = {\n  origin: (origin, callback) => {\n    if (!origin) {\n      return callback(null, true);\n    }\n\n    if (ALLOWED_ORIGINS.length === 0) {\n      logger.error('CORS: No ALLOWED_ORIGINS configured - rejecting request for security', {\n        origin,\n      });\n      return callback(new Error('CORS not configured - set ALLOWED_ORIGINS environment variable'));\n    }\n\n    const isAllowed = ALLOWED_ORIGINS.some(allowed => {\n      if (allowed === '*') {\n        logger.error('CORS: Wildcard origin (*) not allowed in production - rejecting request', {\n          requestOrigin: origin,\n        });\n        return false;\n      }\n      return origin === allowed || origin.endsWith(`.${allowed}`);\n    });\n\n    if (isAllowed) {\n      callback(null, true);\n    } else {\n      logger.error('CORS: Origin rejected', {\n        origin,\n        allowedOrigins: ALLOWED_ORIGINS,\n      });\n      callback(new Error(`Origin ${origin} not allowed by CORS policy`));\n    }\n  },\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],\n  exposedHeaders: ['X-Request-Id'],\n  maxAge: 86400, // 24 hours\n  optionsSuccessStatus: 204,\n};\n\nexport const corsMiddleware = cors(\n  isDevelopment ? developmentCorsOptions : productionCorsOptions\n);\n\nlogger.info('CORS middleware configured', {\n  mode: isDevelopment ? 'development' : 'production',\n  allowedOrigins: isDevelopment ? 'all' : ALLOWED_ORIGINS,\n});\n","size_bytes":2089},"server/middleware/security-headers.ts":{"content":"import { type Request, type Response, type NextFunction } from 'express';\nimport crypto from 'crypto';\n\nexport interface SecurityHeadersConfig {\n  enableHSTS?: boolean;\n  hstsMaxAge?: number;\n  hstsIncludeSubDomains?: boolean;\n  hstsPreload?: boolean;\n  enableCSP?: boolean;\n  cspDirectives?: Record<string, string[]>;\n  enableFrameProtection?: boolean;\n  enableContentTypeOptions?: boolean;\n  enableReferrerPolicy?: boolean;\n  enablePermissionsPolicy?: boolean;\n}\n\nconst DEFAULT_CONFIG: Required<SecurityHeadersConfig> = {\n  enableHSTS: true,\n  hstsMaxAge: 31536000, // 1 year (365 days)\n  hstsIncludeSubDomains: true,\n  hstsPreload: false, // Requires manual submission to browsers' preload lists\n  enableCSP: true,\n  cspDirectives: {\n    'default-src': [\"'self'\"],\n    'script-src': [\"'self'\", \"'unsafe-inline'\", \"'unsafe-eval'\"], // Vite dev mode requires unsafe-inline/eval\n    'style-src': [\"'self'\", \"'unsafe-inline'\"],\n    'img-src': [\"'self'\", 'data:', 'https:'],\n    'font-src': [\"'self'\", 'data:'],\n    'connect-src': [\"'self'\", 'wss:', 'ws:'],\n    'frame-ancestors': [\"'none'\"],\n    'base-uri': [\"'self'\"],\n    'form-action': [\"'self'\"],\n  },\n  enableFrameProtection: true,\n  enableContentTypeOptions: true,\n  enableReferrerPolicy: true,\n  enablePermissionsPolicy: true,\n};\n\nfunction buildCSPHeader(directives: Record<string, string[]>): string {\n  return Object.entries(directives)\n    .map(([key, values]) => `${key} ${values.join(' ')}`)\n    .join('; ');\n}\n\nexport function securityHeadersMiddleware(config: SecurityHeadersConfig = {}) {\n  const finalConfig = { ...DEFAULT_CONFIG, ...config };\n\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (finalConfig.enableHSTS) {\n      let hstsValue = `max-age=${finalConfig.hstsMaxAge}`;\n      if (finalConfig.hstsIncludeSubDomains) {\n        hstsValue += '; includeSubDomains';\n      }\n      if (finalConfig.hstsPreload) {\n        hstsValue += '; preload';\n      }\n      res.setHeader('Strict-Transport-Security', hstsValue);\n    }\n\n    if (finalConfig.enableCSP && finalConfig.cspDirectives) {\n      const cspHeader = buildCSPHeader(finalConfig.cspDirectives);\n      res.setHeader('Content-Security-Policy', cspHeader);\n    }\n\n    if (finalConfig.enableFrameProtection) {\n      res.setHeader('X-Frame-Options', 'DENY');\n    }\n\n    if (finalConfig.enableContentTypeOptions) {\n      res.setHeader('X-Content-Type-Options', 'nosniff');\n    }\n\n    if (finalConfig.enableReferrerPolicy) {\n      res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin');\n    }\n\n    if (finalConfig.enablePermissionsPolicy) {\n      res.setHeader(\n        'Permissions-Policy',\n        'camera=(), microphone=(), geolocation=(), interest-cohort=()'\n      );\n    }\n\n    res.setHeader('X-XSS-Protection', '1; mode=block');\n    res.setHeader('X-DNS-Prefetch-Control', 'off');\n    res.setHeader('X-Download-Options', 'noopen');\n\n    next();\n  };\n}\n\nexport const developmentSecurityHeaders = securityHeadersMiddleware({\n  enableHSTS: true, // Enable for testing (browsers ignore HSTS on HTTP anyway)\n  hstsMaxAge: 31536000,\n  hstsIncludeSubDomains: true,\n  enableCSP: true,\n  cspDirectives: {\n    'default-src': [\"'self'\"],\n    'script-src': [\"'self'\", \"'unsafe-inline'\", \"'unsafe-eval'\"], // Required for Vite HMR\n    'style-src': [\"'self'\", \"'unsafe-inline'\"],\n    'img-src': [\"'self'\", 'data:', 'https:', 'blob:'],\n    'font-src': [\"'self'\", 'data:'],\n    'connect-src': [\"'self'\", 'wss:', 'ws:', 'http:', 'https:'],\n    'frame-ancestors': [\"'none'\"],\n    'base-uri': [\"'self'\"],\n    'form-action': [\"'self'\"],\n  },\n});\n\nexport const productionSecurityHeaders = securityHeadersMiddleware({\n  enableHSTS: true,\n  hstsMaxAge: 31536000, // 1 year\n  hstsIncludeSubDomains: true,\n  hstsPreload: false, // Enable after manual preload list submission\n  enableCSP: true,\n  cspDirectives: {\n    'default-src': [\"'self'\"],\n    'script-src': [\"'self'\"],\n    'style-src': [\"'self'\", \"'unsafe-inline'\"], // Some styling libraries require inline styles\n    'img-src': [\"'self'\", 'data:', 'https:'],\n    'font-src': [\"'self'\", 'data:'],\n    'connect-src': [\"'self'\", 'wss:', 'https:'],\n    'frame-ancestors': [\"'none'\"],\n    'base-uri': [\"'self'\"],\n    'form-action': [\"'self'\"],\n    'upgrade-insecure-requests': [],\n  },\n});\n","size_bytes":4276},"server/middleware/audit.ts":{"content":"import { type Request, type Response, type NextFunction } from 'express';\nimport { db } from '../db';\nimport { auditLogs } from '@shared/schema';\nimport { logger } from '../services/logger';\n\nexport interface AuditLogData {\n  action: string;\n  resourceType: string;\n  resourceId?: string;\n  changes?: any;\n  metadata?: any;\n}\n\nexport async function logAudit(\n  req: Request,\n  data: AuditLogData\n): Promise<void> {\n  try {\n    const userId = req.user?.userId;\n    const requestId = req.requestId;\n    const ipAddress = req.ip || req.connection.remoteAddress;\n    const userAgent = req.get('user-agent');\n\n    await db.insert(auditLogs).values({\n      requestId: requestId!,\n      userId: userId || null,\n      action: data.action,\n      resourceType: data.resourceType,\n      resourceId: data.resourceId || null,\n      changes: data.changes || null,\n      metadata: data.metadata || null,\n      ipAddress: ipAddress || null,\n      userAgent: userAgent || null,\n    });\n\n    logger.info('Audit log created', {\n      requestId,\n      userId,\n      action: data.action,\n      resourceType: data.resourceType,\n      resourceId: data.resourceId,\n    });\n  } catch (error) {\n    logger.error('Failed to create audit log', {\n      requestId: req.requestId,\n      userId: req.user?.userId,\n      action: data.action,\n      resourceType: data.resourceType,\n    }, error as Error);\n  }\n}\n\nexport function auditMiddleware(\n  action: string,\n  resourceType: string,\n  getResourceId?: (req: Request) => string | undefined\n) {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    const originalSend = res.send;\n    const originalJson = res.json;\n\n    let responseBody: any;\n\n    res.send = function (body: any) {\n      responseBody = body;\n      return originalSend.call(this, body);\n    };\n\n    res.json = function (body: any) {\n      responseBody = body;\n      return originalJson.call(this, body);\n    };\n\n    res.on('finish', async () => {\n      if (res.statusCode >= 200 && res.statusCode < 300) {\n        try {\n          const resourceId = getResourceId ? getResourceId(req) : req.params.id;\n          \n          await logAudit(req, {\n            action,\n            resourceType,\n            resourceId,\n            changes: req.method !== 'GET' ? req.body : undefined,\n            metadata: {\n              method: req.method,\n              path: req.path,\n              statusCode: res.statusCode,\n              query: req.query,\n            },\n          });\n        } catch (error) {\n          logger.error('Audit middleware error', {\n            requestId: req.requestId,\n            action,\n            resourceType,\n          }, error as Error);\n        }\n      }\n    });\n\n    next();\n  };\n}\n\nexport const auditActions = {\n  CREATE: 'CREATE',\n  UPDATE: 'UPDATE',\n  DELETE: 'DELETE',\n  APPROVE: 'APPROVE',\n  REJECT: 'REJECT',\n  EXECUTE: 'EXECUTE',\n  LOGIN: 'LOGIN',\n  LOGOUT: 'LOGOUT',\n  REGISTER: 'REGISTER',\n} as const;\n\nexport const auditResourceTypes = {\n  USER: 'user',\n  RECOMMENDATION: 'recommendation',\n  APPROVAL_REQUEST: 'approval_request',\n  OPTIMIZATION: 'optimization',\n  AWS_RESOURCE: 'aws_resource',\n  SYSTEM_CONFIG: 'system_config',\n  SESSION: 'session',\n} as const;\n","size_bytes":3202},"server/lib/transaction.ts":{"content":"import { db } from '../db';\nimport { logger } from '../services/logger';\nimport type { PgTransaction } from 'drizzle-orm/pg-core';\nimport type { PostgresJsQueryResultHKT } from 'drizzle-orm/postgres-js';\nimport type { ExtractTablesWithRelations } from 'drizzle-orm';\nimport * as schema from '@shared/schema';\n\nexport type Transaction = PgTransaction<\n  PostgresJsQueryResultHKT,\n  typeof schema,\n  ExtractTablesWithRelations<typeof schema>\n>;\n\nexport interface TransactionOptions {\n  maxRetries?: number;\n  retryDelay?: number;\n  onRetry?: (attempt: number, error: Error) => void;\n}\n\nconst DEFAULT_OPTIONS: Required<TransactionOptions> = {\n  maxRetries: 3,\n  retryDelay: 100,\n  onRetry: (attempt, error) => {\n    logger.warn('Transaction retry', { attempt, error: error.message });\n  },\n};\n\nexport async function withTransaction<T>(\n  fn: (tx: Transaction) => Promise<T>,\n  options: TransactionOptions = {}\n): Promise<T> {\n  const opts = { ...DEFAULT_OPTIONS, ...options };\n  let lastError: Error | undefined;\n\n  for (let attempt = 1; attempt <= opts.maxRetries; attempt++) {\n    try {\n      return await db.transaction(async (tx) => {\n        return await fn(tx as Transaction);\n      });\n    } catch (error) {\n      lastError = error as Error;\n\n      const isRetryable =\n        lastError.message.includes('deadlock') ||\n        lastError.message.includes('serialization') ||\n        lastError.message.includes('concurrent');\n\n      if (!isRetryable || attempt === opts.maxRetries) {\n        logger.error('Transaction failed', {\n          attempt,\n          maxRetries: opts.maxRetries,\n          error: lastError.message,\n        });\n        throw lastError;\n      }\n\n      opts.onRetry(attempt, lastError);\n\n      if (attempt < opts.maxRetries) {\n        await new Promise((resolve) =>\n          setTimeout(resolve, opts.retryDelay * attempt)\n        );\n      }\n    }\n  }\n\n  throw lastError || new Error('Transaction failed without error');\n}\n\nexport interface TransactionContext {\n  tx: Transaction;\n  requestId?: string;\n  userId?: string;\n  tenantId?: string;\n}\n\nexport async function executeInTransaction<T>(\n  fn: (context: TransactionContext) => Promise<T>,\n  metadata: {\n    requestId?: string;\n    userId?: string;\n    tenantId?: string;\n  } = {},\n  options: TransactionOptions = {}\n): Promise<T> {\n  const startTime = Date.now();\n\n  try {\n    const result = await withTransaction(async (tx) => {\n      return await fn({\n        tx,\n        ...metadata,\n      });\n    }, options);\n\n    logger.info('Transaction completed successfully', {\n      duration: Date.now() - startTime,\n      ...metadata,\n    });\n\n    return result;\n  } catch (error) {\n    logger.error(\n      'Transaction failed',\n      {\n        duration: Date.now() - startTime,\n        ...metadata,\n      },\n      error as Error\n    );\n    throw error;\n  }\n}\n\nexport interface ApprovalTransactionData {\n  recommendationId: string;\n  approvalRequestId: string;\n  status: 'approved' | 'rejected';\n  approvedBy: string;\n  comments?: string;\n  tenantId: string;\n}\n\nexport interface OptimizationExecutionData {\n  recommendationId: string;\n  executedBy: string;\n  beforeConfig: any;\n  afterConfig: any;\n  actualSavings?: number;\n  status: 'success' | 'failed' | 'in-progress';\n  errorMessage?: string;\n  tenantId: string;\n}\n\nexport async function handleApprovalTransaction(\n  data: ApprovalTransactionData,\n  metadata: { requestId?: string; userId?: string }\n): Promise<{\n  recommendation: any;\n  approvalRequest: any;\n}> {\n  return await executeInTransaction(\n    async ({ tx }) => {\n      const { recommendations, approvalRequests } = await import('@shared/schema');\n      const { eq } = await import('drizzle-orm');\n\n      const [updatedRecommendation] = await tx\n        .update(recommendations)\n        .set({\n          status: data.status,\n          updatedAt: new Date(),\n        })\n        .where(eq(recommendations.id, data.recommendationId))\n        .returning();\n\n      if (!updatedRecommendation) {\n        throw new Error(`Recommendation ${data.recommendationId} not found`);\n      }\n\n      const [updatedApprovalRequest] = await tx\n        .update(approvalRequests)\n        .set({\n          status: data.status,\n          approvedBy: data.approvedBy,\n          approvalDate: new Date(),\n          comments: data.comments || null,\n        })\n        .where(eq(approvalRequests.id, data.approvalRequestId))\n        .returning();\n\n      if (!updatedApprovalRequest) {\n        throw new Error(`Approval request ${data.approvalRequestId} not found`);\n      }\n\n      return {\n        recommendation: updatedRecommendation,\n        approvalRequest: updatedApprovalRequest,\n      };\n    },\n    { ...metadata, tenantId: data.tenantId }\n  );\n}\n\nexport async function handleOptimizationExecutionTransaction(\n  data: OptimizationExecutionData,\n  metadata: { requestId?: string; userId?: string }\n): Promise<{\n  recommendation: any;\n  optimizationHistory: any;\n}> {\n  return await executeInTransaction(\n    async ({ tx }) => {\n      const { recommendations, optimizationHistory } = await import('@shared/schema');\n      const { eq } = await import('drizzle-orm');\n\n      const [updatedRecommendation] = await tx\n        .update(recommendations)\n        .set({\n          status: 'executed',\n          updatedAt: new Date(),\n        })\n        .where(eq(recommendations.id, data.recommendationId))\n        .returning();\n\n      if (!updatedRecommendation) {\n        throw new Error(`Recommendation ${data.recommendationId} not found`);\n      }\n\n      const [historyRecord] = await tx\n        .insert(optimizationHistory)\n        .values({\n          tenantId: data.tenantId,\n          recommendationId: data.recommendationId,\n          executedBy: data.executedBy,\n          executionDate: new Date(),\n          beforeConfig: data.beforeConfig,\n          afterConfig: data.afterConfig,\n          actualSavings: data.actualSavings || null,\n          status: data.status,\n          errorMessage: data.errorMessage || null,\n        })\n        .returning();\n\n      return {\n        recommendation: updatedRecommendation,\n        optimizationHistory: historyRecord,\n      };\n    },\n    { ...metadata, tenantId: data.tenantId }\n  );\n}\n","size_bytes":6195},"client/src/pages/Auth.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { LogIn, UserPlus } from \"lucide-react\";\n\nconst loginSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nconst registerSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  role: z.string().default(\"user\"),\n});\n\ntype LoginFormData = z.infer<typeof loginSchema>;\ntype RegisterFormData = z.infer<typeof registerSchema>;\n\nexport default function Auth() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState<\"login\" | \"register\">(\"login\");\n\n  const loginForm = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n  const registerForm = useForm<RegisterFormData>({\n    resolver: zodResolver(registerSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n      role: \"user\",\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/login\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      localStorage.setItem(\"token\", data.token);\n      localStorage.setItem(\"user\", JSON.stringify(data.user));\n      \n      toast({\n        title: \"Login Successful\",\n        description: `Welcome back, ${data.user.username}!`,\n      });\n      \n      window.location.href = \"/\";\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login Failed\",\n        description: error.message || \"Invalid credentials. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: RegisterFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/register\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      localStorage.setItem(\"token\", data.token);\n      localStorage.setItem(\"user\", JSON.stringify(data.user));\n      \n      toast({\n        title: \"Registration Successful\",\n        description: `Welcome, ${data.user.username}! Your account has been created.`,\n      });\n      \n      window.location.href = \"/\";\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Registration Failed\",\n        description: error.message || \"Failed to create account. Username may already exist.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onLoginSubmit = (data: LoginFormData) => {\n    loginMutation.mutate(data);\n  };\n\n  const onRegisterSubmit = (data: RegisterFormData) => {\n    registerMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-cyan-950/20 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <CardTitle className=\"text-2xl font-bold text-center\">FinOps Autopilot</CardTitle>\n          <CardDescription className=\"text-center\">\n            Cloud cost optimization platform\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as \"login\" | \"register\")}>\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"login\" data-testid=\"tab-login\">\n                Login\n              </TabsTrigger>\n              <TabsTrigger value=\"register\" data-testid=\"tab-register\">\n                Register\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"login\">\n              <Form {...loginForm}>\n                <form onSubmit={loginForm.handleSubmit(onLoginSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={loginForm.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Username</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Enter your username\"\n                            data-testid=\"input-login-username\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={loginForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Password</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"password\"\n                            placeholder=\"Enter your password\"\n                            data-testid=\"input-login-password\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full\"\n                    disabled={loginMutation.isPending}\n                    data-testid=\"button-login-submit\"\n                  >\n                    {loginMutation.isPending ? (\n                      \"Logging in...\"\n                    ) : (\n                      <>\n                        <LogIn className=\"w-4 h-4 mr-2\" />\n                        Login\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </Form>\n            </TabsContent>\n\n            <TabsContent value=\"register\">\n              <Form {...registerForm}>\n                <form onSubmit={registerForm.handleSubmit(onRegisterSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={registerForm.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Username</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Choose a username\"\n                            data-testid=\"input-register-username\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={registerForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Password</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"password\"\n                            placeholder=\"Choose a password (min 6 characters)\"\n                            data-testid=\"input-register-password\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={registerForm.control}\n                    name=\"role\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Role</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-register-role\">\n                              <SelectValue placeholder=\"Select a role\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"user\" data-testid=\"select-role-user\">User</SelectItem>\n                            <SelectItem value=\"admin\" data-testid=\"select-role-admin\">Admin</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full\"\n                    disabled={registerMutation.isPending}\n                    data-testid=\"button-register-submit\"\n                  >\n                    {registerMutation.isPending ? (\n                      \"Creating account...\"\n                    ) : (\n                      <>\n                        <UserPlus className=\"w-4 h-4 mr-2\" />\n                        Register\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </Form>\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":10036},"client/src/components/AuthGuard.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { isTokenValid } from \"@/lib/auth-utils\";\n\ninterface AuthGuardProps {\n  children: React.ReactNode;\n}\n\nexport function AuthGuard({ children }: AuthGuardProps) {\n  const [, setLocation] = useLocation();\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n    \n    if (!token || !isTokenValid(token)) {\n      console.log('[AuthGuard] No valid token found - redirecting to login');\n      localStorage.removeItem(\"token\");\n      setIsAuthenticated(false);\n      setLocation(\"/login\");\n      return;\n    }\n    \n    setIsAuthenticated(true);\n  }, [setLocation]);\n\n  if (isAuthenticated === null) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n","size_bytes":1202},"client/src/lib/auth-utils.ts":{"content":"interface DecodedJWT {\n  userId: string;\n  username: string;\n  role: string;\n  tenantId?: string;\n  iat?: number;\n  exp?: number;\n}\n\nfunction decodeJWT(token: string): DecodedJWT | null {\n  try {\n    const base64Url = token.split('.')[1];\n    if (!base64Url) return null;\n    \n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(\n      atob(base64)\n        .split('')\n        .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n        .join('')\n    );\n    \n    return JSON.parse(jsonPayload);\n  } catch (error) {\n    console.error('[auth-utils] Failed to decode JWT:', error);\n    return null;\n  }\n}\n\nexport function isTokenValid(token: string | null): boolean {\n  if (!token) return false;\n  \n  const decoded = decodeJWT(token);\n  if (!decoded || !decoded.exp) return false;\n  \n  const now = Math.floor(Date.now() / 1000);\n  return decoded.exp > now;\n}\n\nexport function getTokenExpiry(token: string | null): number | null {\n  if (!token) return null;\n  \n  const decoded = decodeJWT(token);\n  return decoded?.exp ?? null;\n}\n\nexport function clearAuthAndRedirect(): void {\n  console.log('[auth-utils] Clearing authentication and redirecting to login');\n  localStorage.removeItem('token');\n  localStorage.removeItem('user');\n  window.location.href = '/login';\n}\n\nexport function handleAuthError(error: any): void {\n  const status = error?.status || error?.response?.status;\n  const message = error?.message || error?.error || '';\n  \n  // Handle 401 (unauthorized) or 403 with token-related errors\n  if (status === 401) {\n    console.error('[auth-utils] 401 Unauthorized - clearing token');\n    clearAuthAndRedirect();\n    return;\n  }\n  \n  if (status === 403 && message.toLowerCase().includes('token')) {\n    console.error('[auth-utils] 403 with token error - clearing token');\n    clearAuthAndRedirect();\n    return;\n  }\n}\n","size_bytes":1896},"client/src/components/modals/ai-history-details-modal.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { X, CheckCircle2, XCircle, Clock, Zap, TrendingUp, Activity } from \"lucide-react\";\nimport { formatCurrencyK } from \"@/lib/currency\";\nimport type { AiModeHistory, Recommendation } from \"@shared/schema\";\n\ninterface AiHistoryDetailsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  aiHistoryId: string | null;\n}\n\ninterface AiHistoryDetailsData {\n  aiRun: AiModeHistory;\n  recommendations: Recommendation[];\n  savingsBreakdown: {\n    totalSavings: number;\n    averageSavings: number;\n    savingsByType: Record<string, number>;\n  };\n  executionModeCounts: {\n    autonomous: number;\n    hitl: number;\n    autonomousPercentage: number;\n    hitlPercentage: number;\n  };\n}\n\nexport function AiHistoryDetailsModal({ isOpen, onClose, aiHistoryId }: AiHistoryDetailsModalProps) {\n  const { data, isLoading, isError } = useQuery<AiHistoryDetailsData>({\n    queryKey: ['/api/ai-mode-history', aiHistoryId],\n    enabled: !!aiHistoryId && isOpen,\n  });\n\n  const formatDate = (dateString: string | Date) => {\n    const date = new Date(dateString);\n    return date.toLocaleString('en-US', { \n      month: 'short', \n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  const formatDuration = (start: string | Date, end: string | Date | null | undefined) => {\n    if (!end) return 'In progress...';\n    const duration = (new Date(end).getTime() - new Date(start).getTime()) / 1000;\n    return `${duration.toFixed(1)}s`;\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'success':\n        return <CheckCircle2 className=\"w-5 h-5 text-green-500\" />;\n      case 'failed':\n        return <XCircle className=\"w-5 h-5 text-red-500\" />;\n      case 'running':\n        return <Clock className=\"w-5 h-5 text-cyan-500 animate-spin\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants = {\n      success: 'default',\n      failed: 'destructive',\n      running: 'outline'\n    } as const;\n    \n    const bgColors = {\n      success: 'bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/30',\n      failed: 'bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/30',\n      running: 'bg-cyan-500/10 text-cyan-600 dark:text-cyan-400 border-cyan-500/30'\n    };\n    \n    return (\n      <Badge variant=\"outline\" className={bgColors[status as keyof typeof bgColors] || ''}>\n        {status.toUpperCase()}\n      </Badge>\n    );\n  };\n\n  const getExecutionModeBadge = (recommendation: Recommendation) => {\n    if (recommendation.executionMode === 'autonomous' && recommendation.status === 'executed') {\n      return (\n        <Badge variant=\"outline\" className=\"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30\">\n          ‚úÖ Auto-Executed\n        </Badge>\n      );\n    } else if (recommendation.executionMode === 'hitl' && recommendation.status === 'pending') {\n      return (\n        <Badge variant=\"outline\" className=\"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/30\">\n          üïí Needs Approval\n        </Badge>\n      );\n    } else if (recommendation.executionMode === 'hitl' && recommendation.status === 'approved') {\n      return (\n        <Badge variant=\"outline\" className=\"bg-indigo-500/10 text-indigo-600 dark:text-indigo-400 border-indigo-500/30\">\n          ‚è≥ Awaiting Execution\n        </Badge>\n      );\n    } else {\n      return (\n        <Badge variant=\"outline\">\n          {recommendation.executionMode === 'autonomous' ? 'Autonomous' : 'HITL'}\n        </Badge>\n      );\n    }\n  };\n\n  if (!aiHistoryId) {\n    return null;\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto bg-[#1B1E23] border-gray-800\" data-testid=\"ai-history-details-modal\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-xl font-bold text-white flex items-center gap-2\">\n              <Zap className=\"w-6 h-6 text-cyan-400\" />\n              AI Analysis Run Details\n            </DialogTitle>\n            <Button variant=\"ghost\" size=\"sm\" onClick={onClose} data-testid=\"button-close-modal\">\n              <X className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"py-8 text-center text-gray-400\" data-testid=\"loading-state\">\n            <div className=\"flex flex-col items-center gap-3\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400\"></div>\n              <p>Loading AI run details...</p>\n            </div>\n          </div>\n        ) : isError ? (\n          <div className=\"py-8 text-center text-red-400\" data-testid=\"error-state\">\n            <div className=\"flex flex-col items-center gap-3\">\n              <XCircle className=\"w-12 h-12\" />\n              <p>Failed to load AI run details</p>\n              <Button variant=\"outline\" size=\"sm\" onClick={onClose}>Close</Button>\n            </div>\n          </div>\n        ) : !data || !data.aiRun ? (\n          <div className=\"py-8 text-center text-gray-400\" data-testid=\"not-found-state\">\n            <div className=\"flex flex-col items-center gap-3\">\n              <XCircle className=\"w-12 h-12\" />\n              <p>AI run not found</p>\n              <Button variant=\"outline\" size=\"sm\" onClick={onClose}>Close</Button>\n            </div>\n          </div>\n        ) : (\n          <Tabs defaultValue=\"overview\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-3 bg-gray-800/50\">\n              <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">Overview</TabsTrigger>\n              <TabsTrigger value=\"recommendations\" data-testid=\"tab-recommendations\">\n                Recommendations ({data.recommendations?.length || 0})\n              </TabsTrigger>\n              <TabsTrigger value=\"calculations\" data-testid=\"tab-calculations\">Calculations</TabsTrigger>\n            </TabsList>\n\n            {/* Overview Tab */}\n            <TabsContent value=\"overview\" className=\"space-y-4 mt-4\">\n              <Card className=\"bg-gray-800/30 border-gray-700\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <Activity className=\"w-5 h-5 text-cyan-400\" />\n                    Run Summary\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <p className=\"text-sm text-gray-400\">Status</p>\n                      <div className=\"flex items-center gap-2 mt-1\">\n                        {getStatusIcon(data.aiRun.status)}\n                        {getStatusBadge(data.aiRun.status)}\n                      </div>\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-gray-400\">Triggered By</p>\n                      <p className=\"text-white mt-1 capitalize\">{data.aiRun.triggeredBy || 'Unknown'}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-gray-400\">Start Time</p>\n                      <p className=\"text-white mt-1\">{formatDate(data.aiRun.startTime)}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-gray-400\">Duration</p>\n                      <p className=\"text-white mt-1\">\n                        {formatDuration(data.aiRun.startTime, data.aiRun.endTime)}\n                      </p>\n                    </div>\n                  </div>\n\n                  {data.aiRun.summary && (\n                    <div>\n                      <p className=\"text-sm text-gray-400\">Summary</p>\n                      <p className=\"text-white mt-1\">{data.aiRun.summary}</p>\n                    </div>\n                  )}\n\n                  {data.aiRun.errorMessage && (\n                    <div className=\"bg-red-500/10 border border-red-500/30 rounded-lg p-3\">\n                      <p className=\"text-sm text-gray-400\">Error Message</p>\n                      <p className=\"text-red-400 mt-1\">{data.aiRun.errorMessage}</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <Card className=\"bg-gray-800/30 border-gray-700\">\n                  <CardHeader>\n                    <CardTitle className=\"text-white flex items-center gap-2\">\n                      <TrendingUp className=\"w-5 h-5 text-green-400\" />\n                      Savings Identified\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      <div>\n                        <p className=\"text-sm text-gray-400\">Total Annual Savings</p>\n                        <p className=\"text-2xl font-bold text-green-400 mt-1\" data-testid=\"total-savings\">\n                          {formatCurrencyK(data.aiRun?.totalSavingsIdentified || 0)}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-sm text-gray-400\">Recommendations Generated</p>\n                        <p className=\"text-xl font-semibold text-white mt-1\" data-testid=\"recommendations-count\">\n                          {data.aiRun?.recommendationsGenerated || 0}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-gray-800/30 border-gray-700\">\n                  <CardHeader>\n                    <CardTitle className=\"text-white\">Execution Mode Split</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {data.executionModeCounts ? (\n                      <div className=\"space-y-3\">\n                        <div>\n                          <div className=\"flex justify-between mb-1\">\n                            <span className=\"text-sm text-gray-400\">Autonomous</span>\n                            <span className=\"text-sm text-emerald-400 font-semibold\" data-testid=\"autonomous-count\">\n                              {data.executionModeCounts.autonomous || 0} ({(data.executionModeCounts.autonomousPercentage || 0).toFixed(0)}%)\n                            </span>\n                          </div>\n                          <div className=\"w-full bg-gray-700 rounded-full h-2\">\n                            <div \n                              className=\"bg-emerald-500 h-2 rounded-full\" \n                              style={{ width: `${data.executionModeCounts.autonomousPercentage || 0}%` }}\n                            ></div>\n                          </div>\n                        </div>\n                        <div>\n                          <div className=\"flex justify-between mb-1\">\n                            <span className=\"text-sm text-gray-400\">HITL (Manual)</span>\n                            <span className=\"text-sm text-amber-400 font-semibold\" data-testid=\"hitl-count\">\n                              {data.executionModeCounts.hitl || 0} ({(data.executionModeCounts.hitlPercentage || 0).toFixed(0)}%)\n                            </span>\n                          </div>\n                          <div className=\"w-full bg-gray-700 rounded-full h-2\">\n                            <div \n                              className=\"bg-amber-500 h-2 rounded-full\" \n                              style={{ width: `${data.executionModeCounts.hitlPercentage || 0}%` }}\n                            ></div>\n                          </div>\n                        </div>\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-4 text-gray-400\">\n                        No execution mode data available\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            {/* Recommendations Tab */}\n            <TabsContent value=\"recommendations\" className=\"space-y-3 mt-4\">\n              {!data.recommendations || data.recommendations.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-400\">\n                  No recommendations generated in this run\n                </div>\n              ) : (\n                data.recommendations.map((rec, index) => (\n                  <Card key={rec.id} className=\"bg-gray-800/30 border-gray-700\" data-testid={`recommendation-${index}`}>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-start justify-between gap-3 mb-3\">\n                        <div className=\"flex-1\">\n                          <h4 className=\"font-semibold text-white mb-1\">{rec.title}</h4>\n                          <p className=\"text-sm text-gray-400\">{rec.description}</p>\n                        </div>\n                        <div className=\"flex flex-col gap-2 items-end\">\n                          {getExecutionModeBadge(rec)}\n                          <Badge variant=\"outline\" className=\"bg-cyan-500/10 text-cyan-400 border-cyan-500/30\">\n                            {rec.priority.toUpperCase()}\n                          </Badge>\n                        </div>\n                      </div>\n                      \n                      <Separator className=\"my-3 bg-gray-700\" />\n                      \n                      <div className=\"grid grid-cols-3 gap-3 text-sm\">\n                        <div>\n                          <p className=\"text-gray-400\">Resource</p>\n                          <p className=\"text-white font-medium mt-1\">{rec.resourceId}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-gray-400\">Type</p>\n                          <p className=\"text-white font-medium mt-1 capitalize\">{rec.type}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-gray-400\">Annual Savings</p>\n                          <p className=\"text-green-400 font-bold mt-1\">\n                            {formatCurrencyK(rec.projectedMonthlySavings * 12)}\n                          </p>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </TabsContent>\n\n            {/* Calculations Tab */}\n            <TabsContent value=\"calculations\" className=\"space-y-4 mt-4\">\n              {data.savingsBreakdown ? (\n                <Card className=\"bg-gray-800/30 border-gray-700\">\n                  <CardHeader>\n                    <CardTitle className=\"text-white\">Savings Breakdown</CardTitle>\n                    <CardDescription className=\"text-gray-400\">\n                      Detailed analysis of cost optimization opportunities\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"bg-gray-900/50 rounded-lg p-4\">\n                        <p className=\"text-sm text-gray-400\">Total Annual Savings</p>\n                        <p className=\"text-2xl font-bold text-green-400 mt-2\">\n                          {formatCurrencyK(data.savingsBreakdown?.totalSavings || 0)}\n                        </p>\n                      </div>\n                      <div className=\"bg-gray-900/50 rounded-lg p-4\">\n                        <p className=\"text-sm text-gray-400\">Average per Recommendation</p>\n                        <p className=\"text-2xl font-bold text-cyan-400 mt-2\">\n                          {formatCurrencyK(data.savingsBreakdown?.averageSavings || 0)}\n                        </p>\n                      </div>\n                    </div>\n\n                    <Separator className=\"bg-gray-700\" />\n\n                    <div>\n                      <h4 className=\"font-semibold text-white mb-3\">Savings by Type</h4>\n                      {data.savingsBreakdown?.savingsByType && Object.keys(data.savingsBreakdown.savingsByType).length > 0 ? (\n                        <div className=\"space-y-2\">\n                          {Object.entries(data.savingsBreakdown.savingsByType).map(([type, amount]) => (\n                            <div key={type} className=\"flex justify-between items-center bg-gray-900/50 rounded-lg p-3\">\n                              <span className=\"text-gray-300 capitalize\">{type.replace('-', ' ')}</span>\n                              <span className=\"text-green-400 font-semibold\">\n                                {formatCurrencyK(amount)}\n                              </span>\n                            </div>\n                          ))}\n                        </div>\n                      ) : (\n                        <div className=\"text-center py-4 text-gray-400\">\n                          No savings breakdown available\n                        </div>\n                      )}\n                    </div>\n\n                    <Separator className=\"bg-gray-700\" />\n\n                    <div className=\"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4\">\n                      <h4 className=\"font-semibold text-blue-400 mb-2\">Calculation Methodology</h4>\n                      <ul className=\"text-sm text-gray-300 space-y-1\">\n                        <li>‚Ä¢ Savings calculated using current resource costs vs. optimized configurations</li>\n                        <li>‚Ä¢ Projections based on 30-day usage patterns and AWS pricing data</li>\n                        <li>‚Ä¢ Risk assessment includes performance impact and business continuity factors</li>\n                        <li>‚Ä¢ Annual savings assume consistent usage patterns throughout the year</li>\n                      </ul>\n                    </div>\n                  </CardContent>\n                </Card>\n              ) : (\n                <Card className=\"bg-gray-800/30 border-gray-700\">\n                  <CardContent className=\"py-8 text-center text-gray-400\">\n                    No calculation data available for this AI run\n                  </CardContent>\n                </Card>\n              )}\n            </TabsContent>\n          </Tabs>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":18952},"scripts/start-production.sh":{"content":"#!/bin/bash\nset -e\n\necho \"üöÄ Starting FinOps Autopilot in production mode...\"\n\n# Step 1: Run database migrations\necho \"üìä Running database migrations...\"\nnpm run db:push --force || {\n  echo \"‚ùå Database migration failed!\"\n  exit 1\n}\n\necho \"‚úÖ Database migrations complete\"\n\n# Step 2: Start the application\necho \"üåê Starting application server...\"\nNODE_ENV=production tsx server/index.ts\n","size_bytes":395}},"version":2}